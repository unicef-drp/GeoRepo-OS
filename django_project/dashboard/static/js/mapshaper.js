!function(){var e="0.6.42",t=Object.freeze({__proto__:null,get default(){return t},get getUniqueName(){return c},get isFunction(){return f},get isObject(){return l},get clamp(){return d},get isArray(){return p},get isNumber(){return h},get isValidNumber(){return g},get isFiniteNumber(){return m},get isNonNegNumber(){return y},get isInteger(){return v},get isEven(){return b},get isOdd(){return x},get isString(){return _},get isDate(){return w},get isBoolean(){return S},get formatDateISO(){return A},get toArray(){return I},get isArrayLike(){return M},get addslashes(){return E},get regexEscape(){return P},get htmlEscape(){return O},get defaults(){return k},get extend(){return F},get inherit(){return z},get promisify(){return C},get reduceAsync(){return N},get merge(){return T},get difference(){return L},get intersection(){return B},get indexOf(){return D},get contains(){return U},get some(){return R},get every(){return q},get find(){return $},get range(){return V},get repeat(){return G},get sum(){return J},get getArrayBounds(){return W},get uniq(){return Y},get pluck(){return H},get countValues(){return X},get indexOn(){return Z},get groupBy(){return Q},get arrayToIndex(){return K},get forEach(){return ee},get forEachProperty(){return te},get initializeArray(){return ne},get replaceArray(){return re},get repeatString(){return ie},get splitLines(){return ae},get pluralSuffix(){return oe},get endsWith(){return se},get lpad(){return ue},get rpad(){return ce},get trim(){return fe},get ltrim(){return de},get rtrim(){return he},get addThousandsSep(){return ge},get numToStr(){return me},get formatNumber(){return ye},get formatIntlNumber(){return ve},get formatNumberForDisplay(){return be},get shuffle(){return xe},get sortOn(){return _e},get genericSort(){return we},get getSortedIds(){return Se},get sortArrayIndex(){return Ae},get reorderArray(){return Ie},get getKeyComparator(){return Me},get getGenericComparator(){return Ee},get quicksort(){return Pe},get quicksortPartition(){return je},get findRankByValue(){return Oe},get findValueByPct(){return ke},get findValueByRank(){return Fe},get findMedian(){return ze},get findQuantile(){return Ce},get mean(){return Ne},get format(){return Te},get formatter(){return Be},get wildcardToRegExp(){return De},get createBuffer(){return Ue},get toBuffer(){return Re},get expandoBuffer(){return qe},get copyElements(){return $e},get extendBuffer(){return Ve},get mergeNames(){return Ge},get findStringPrefix(){return Je},get parsePercent(){return We},get formatVersionedName(){return Ye},get uniqifyNames(){return He},get parseString(){return Xe},get parseNumber(){return Ze},get parseIntlNumber(){return Qe},get cleanNumericString(){return et},get trimQuotes(){return nt}}),n={};function r(e,t){e in n&&dt("Tried to replace a stashed variable:",e),n[e]=t}function i(e){if(e in n!=!1)return n[e]}function a(){n={}}var o=Object.freeze({__proto__:null,stashVar:r,getStashedVar:i,clearStash:a}),s="undefined"!=typeof Buffer?Buffer:require("buffer").Buffer,u=0;function c(e){return(e||"__id_")+ ++u}function f(e){return"function"==typeof e}function l(e){return e===Object(e)}function d(e,t,n){return e<t?t:e>n?n:e}function p(e){return Array.isArray(e)}function h(e){return null!=e&&e.constructor==Number}function g(e){return h(e)&&!isNaN(e)}function m(e){return g(e)&&e!==1/0&&e!==-1/0}function y(e){return h(e)&&e>=0}function v(e){return h(e)&&(0|e)===e}function b(e){return e%2==0}function x(e){return e%2==1}function _(e){return null!=e&&e.toString===String.prototype.toString}function w(e){return!!e&&e.getTime===Date.prototype.getTime}function S(e){return!0===e||!1===e}function A(e){return w(e)?e.toISOString().replace(":00.000Z","Z"):""}function I(e){var t;M(e)||dt("toArray() requires an array-like object");try{t=Array.prototype.slice.call(e,0)}catch(i){t=[];for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}return t}function M(e){return!!e&&(!!p(e)||!_(e)&&(0===e.length||e.length>0))}function E(e){return(e+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")}function P(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function O(e){return String(e).replace(/[&<>"'/]/g,(function(e){return j[e]}))}function k(e){for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t]||{};for(var i in r)i in e==!1&&r.hasOwnProperty(i)&&(e[i]=r[i])}return e}function F(e){var t,n,r,i=e||{},a=arguments.length;for(n=1;n<a;n++)for(t in r=arguments[n]||{})r.hasOwnProperty(t)&&(i[t]=r[t]);return i}function z(e,t){var n=function(){this.__super__==n&&(this.__super__=t.prototype.__super__,t.apply(this,arguments),delete this.__super__)};n.prototype=t.prototype||t,e.prototype=F(new n,e.prototype),e.prototype.constructor=e,e.prototype.__super__=n}function C(e){return function(){var t=I(arguments);return new Promise(((n,r)=>{t.push((function(e,t){e?r(e):n(t)})),e.apply(this,t)}))}}function N(e,t,n,r){var i="undefined"==typeof setImmediate?setTimeout:setImmediate,a=0;!function t(o,s){if(o)return r(o,null);i((function(){a<e.length==!1?r(null,s):n(s,e[a++],t)}),0)}(null,t)}function T(e,t){p(e)&&p(t)||dt("Usage: merge(destArray, srcArray);");for(var n=0,r=t.length;n<r;n++)e.push(t[n]);return e}function L(e,t){var n=K(t);return e.filter((function(e){return!Object.prototype.hasOwnProperty.call(n,e)}))}function B(e,t){return e.filter((function(e){return t.includes(e)}))}function D(e,t){for(var n=t!=t,r=0,i=e.length||0;r<i;r++){if(e[r]===t)return r;if(n&&e[r]!=e[r])return r}return-1}function U(e,t){return _(e)?-1!=e.indexOf(t):M(e)?-1!=D(e,t):void dt("Expected Array or String argument")}function R(e,t){return e.reduce((function(e,n){return e||t(n)}),!1)}function q(e,t){return e.reduce((function(e,n){return e&&t(n)}),!0)}function $(e,t,n){var r=e.filter(t,n);return 0===r.length?null:r[0]}function V(e,t,n){for(var r=[],i=void 0===t?0:t,a=void 0===n?1:n;e--;)r.push(i),i+=a;return r}function G(e,t){for(var n,r=[],i=0;i<e;i++)void 0!==(n=t(i))&&(r[i]=n);return r.length>0?r:void 0}function J(e,t){M(e)||dt("sum() expects an array, received:",e);for(var n,r=0,i=0,a=0,o=e.length;a<o;a++)(n=e[a])?r+=n:isNaN(n)&&i++;return t&&(t.nan=i),r}function W(e){for(var t,n=1/0,r=-1/0,i=0,a=0,o=e.length;a<o;a++)(t=e[a])!=t&&i++,t<n&&(n=t),t>r&&(r=t);return{min:n,max:r,nan:i}}function Y(e){for(var t,n=new Set,r=[],i=0,a=e.length;i<a;i++)t=e[i],n.has(t)||(r.push(t),n.add(t));return r}function H(e,t){return e.map((function(e){return e[t]}))}function X(e){return e.reduce((function(e,t){return e[t]=t in e?e[t]+1:1,e}),{})}function Z(e,t){return e.reduce((function(e,n){return e[n[t]]=n,e}),{})}function Q(e,t){return e.reduce((function(e,n){var r=n[t];return r in e?e[r].push(n):e[r]=[n],e}),{})}function K(e,t){var n=arguments.length>1;return e.reduce((function(e,r){return e[r]=!n||t,e}),{})}function ee(e,t,n){if(!M(e))throw new Error("#forEach() takes an array-like argument. "+e);for(var r=0,i=e.length;r<i;r++)t.call(n,e[r],r)}function te(e,t,n){Object.keys(e).forEach((function(r){t.call(n,e[r],r)}))}function ne(e,t){for(var n=0,r=e.length;n<r;n++)e[n]=t;return e}function re(e,t){e.splice(0,e.length);for(var n=0,r=t.length;n<r;n++)e.push(t[n])}function ie(e,t){for(var n="",r=0;r<t;r++)n+=e;return n}function ae(e){return e.split(/\r?\n/)}function oe(e){return 1!=e?"s":""}function se(e,t){return-1!==e.indexOf(t,e.length-t.length)}function ue(e,t,n){return ie(n=n||" ",t-(e=String(e)).length)+e}function ce(e,t,n){return n=n||" ",(e=String(e))+ie(n,t-e.length)}function fe(e){return de(he(e))}var le=/^\s+/;function de(e){return e.replace(le,"")}var pe=/\s+$/;function he(e){return e.replace(pe,"")}function ge(e){for(var t="",n="-"==e[0]?1:0,r=e.indexOf("."),i=e.length,a=(-1==r?i:r)-3;a>n;)t=","+e.substring(a,i)+t,i=a,a-=3;return e.substring(0,i)+t}function me(e,t){return t>=0?e.toFixed(t):String(e)}function ye(e){return e+""}function ve(e){return'"'+ye(e).replace(".",",")+'"'}function be(e,t,n,r){var i;return isNaN(e)?i=n||"-":(i=ge(i=me(e,t)),r&&parseFloat(i)>0&&(i="+"+i)),i}function xe(e){var t,n,r;for(n=e.length-1;n>0;n--)r=Math.floor(Math.random()*(n+1)),t=e[n],e[n]=e[r],e[r]=t}function _e(e){for(var t=[],n=1;n<arguments.length;n+=2)t.push(Me(arguments[n],arguments[n+1]));return e.sort((function(e,n){for(var r=0,i=0,a=t.length;i<a&&0===r;)r=t[i](e,n),i++;return r})),e}function we(e,t){var n=Ee(t);return Array.prototype.sort.call(e,n),e}function Se(e,t){var n=V(e.length);return Ae(n,e,t),n}function Ae(e,t,n){var r=Ee(n);e.sort((function(e,n){var i=r(t[e],t[n]);return i>0||0===i&&e>n?1:-1}))}function Ie(e,t){for(var n=t.length,r=[],i=0;i<n;i++){var a=t[i];(a<0||a>=n)&&dt("Out-of-bounds array idx"),r[i]=e[a]}re(e,r)}function Me(e,t){var n=Ee(t);return function(t,r){return n(t[e],r[e])}}function Ee(e){return e=!1!==e,function(t,n){var r=0;return null==n?r=null==t?0:-1:null==t?r=1:t<n?r=e?-1:1:t>n?r=e?1:-1:t!=t?r=1:n!=n&&(r=-1),r}}function Pe(e,t){return je(e,0,e.length-1),!1===t&&Array.prototype.reverse.call(e),e}function je(e,t,n){for(var r,i,a=t,o=n;a<n;){for(r=e[t+n>>1];a<=o;){for(;e[a]<r;)a++;for(;e[o]>r;)o--;a<=o&&(i=e[a],e[a]=e[o],e[o]=i,a++,o--)}t<o&&je(e,t,o),t=a,o=n}}function Oe(e,t){if(isNaN(t))return e.length;for(var n=1,r=0,i=e.length;r<i;r++)t>e[r]&&n++;return n}function ke(e,t){return Fe(e,Math.ceil((1-t)*e.length))}function Fe(e,t){(!e.length||t<1||t>e.length)&&dt("[findValueByRank()] invalid input");for(var n,r,i,a,o=(t=d(0|t,1,e.length))-1,s=0,u=e.length-1;s<u;){i=e[o],n=s,r=u;do{for(;e[n]<i;)n++;for(;i<e[r];)r--;n<=r&&(a=e[n],e[n]=e[r],e[r]=a,n++,r--)}while(n<=r);r<o&&(s=n),o<n&&(u=r)}return e[o]}function ze(e){return Ce(e,.5)}function Ce(e,t){var n=e.length,r=Math.floor((n-1)*t),i=Math.ceil((n-1)*t);if(r<0||i>=n)return NaN;var a=Fe(e,r+1);return r==i?a:(a*(i/(n-1)-t)+Fe(e,i+1)*(t-r/(n-1)))*(n-1)}function Ne(e){for(var t,n=0,r=NaN,i=0,a=e.length;i<a;i++)t=e[i],isNaN(t)||(r=1==++n?t:t/n+(n-1)/n*r);return r}function Te(e){return Be(e).apply(null,Array.prototype.slice.call(arguments,1))}function Le(e,t){var n,r,i,a=t[1],o=t[2],s=t[3]?parseInt(t[3].substr(1)):void 0,u=t[4],c="s"==u,f="x"==u||"X"==u,l=!c,d="",p=0,h=!1,g=!1;if(c?n=String(e):f?(n=e.toString(16),"X"==u&&(n=n.toUpperCase())):l&&("-"==(n=me(e,s))[0]&&(g=!0,n=n.substr(1)),h=0==parseFloat(n),-1==a.indexOf("'")&&-1==a.indexOf(",")||(n=ge(n)),h||(g?d="âˆ’":-1!=a.indexOf("+")&&(d="+"))),o){var m=n.length+d.length,y=parseInt(o,10);m<y&&(p=y-m,i=ie(r=-1==a.indexOf("0")?" ":"0",p))}return n=0==p?d+n:"0"==r?d+i+n:i+d+n}function Be(e){for(var t,n=/%([',+0]*)([1-9]?)((?:\.[1-9])?)([sdifxX%])/g,r=[],i=[],a=0,o="",s=n.exec(e);s;)t=e.substring(a,n.lastIndex-s[0].length),"%%"==s[0]?o+=t+"%":(r.push(o+t),o="",i.push(s)),a=n.lastIndex,s=n.exec(e);return r.push(o+e.substr(a)),function(){var t=r[0],n=arguments.length;n!=i.length&&dt("[format()] Data does not match format string; format:",e,"data:",arguments);for(var a=0;a<n;a++)t+=Le(arguments[a],i[a])+r[a+1];return t}}function De(e){var t=e.split("*").map((function(e){return P(e)})).join(".*");return new RegExp("^"+t+"$")}function Ue(e,t){return v(e)?s.allocUnsafe?s.allocUnsafe(e):new s(e):s.from&&s.allocUnsafe?s.from(e,t):new s(e,t)}function Re(e){return e instanceof s?e:e instanceof ArrayBuffer?s.from(e):e instanceof Uint8Array?s.from(e.buffer,e.byteOffset,e.byteLength):void dt("Unexpected argument type")}function qe(e,t){var n,r=0,i=t>=1?t:1.2;return function(t){return t>r&&(r=Math.ceil(t*i),n=e?new e(r):Ue(r)),n}}function $e(e,t,n,r,i,a){var o,s=e==n||e.buffer&&e.buffer==n.buffer,u=1,c=0;if(a&&(s&&dt("copy error"),u=-1,c=i-1),s&&r>t)for(o=i-1;o>=0;o--)n[r+o]=e[t+o];else for(o=0;o<i;o++,c+=u)n[o+r]=e[t+c]}function Ve(e,t,n){var r=Math.max(e.length,t),i=n||e.length,a=new e.constructor(r);return $e(e,0,a,0,i),a}function Ge(e,t){var n;return e&&t&&(n=Je(e,t).replace(/[-_]$/,"")),n||""}function Je(e,t){for(var n=0,r=e.length;n<r&&e[n]===t[n];n++);return e.substr(0,n)}function We(e){var t,n=String(e);return(t=n.indexOf("%")>0?Number(n.replace("%",""))/100:Number(n))>=0&&t<=1||pt(Te("Invalid percentage: %s",n)),t}function Ye(e,t){var n=String(t);return/[0-9]$/.test(e)&&(n="-"+n),e+n}function He(e,t){var n=X(e),r=t||Ye,i=[];return e.forEach((function(e){for(var t,a=0,o=e;i.indexOf(o)>-1||o==e&&n[o]>1||o!=e&&n[o]>0;){if(a++,!(t=r(e,a))||t==o)throw new Error("Naming error");o=t}i.push(o)})),i}function Xe(e){return e||""}function Ze(e){return Ke(e,et)}function Qe(e){return Ke(e,tt)}function Ke(e,t){var n=String(e).trim(),r=n?Number(t(n)):NaN;return isNaN(r)?null:r}function et(e){return e.indexOf(",")>0?e.replace(/,([0-9]{3})/g,"$1"):e}function tt(e){return(e=e.replace(/[ .]([0-9]{3})/g,"$1")).replace(",",".")}function nt(e){var t,n,r=e.length;return r>=2&&(t=e.charAt(0),n=e.charAt(r-1),('"'==t&&'"'==n&&!e.includes('","')||"'"==t&&"'"==n&&!e.includes("','"))&&(e=(e=e.substr(1,r-2)).replace('"'==t?/\\(?=")/g:/\\(?=')/g,""))),e}var rt,it,at,ot=!1,st=!1,ut=function(){throw new St(Mt(arguments))};function ct(){mt((function(){Pt(arguments)}),(function(){var e=t.toArray(arguments).join(" ");throw new Error(e)}),(function(){throw new wt(Mt(arguments))}))}function ft(){ot=!0}function lt(){return!!ot}function dt(){rt.apply(null,t.toArray(arguments))}function pt(){it.apply(null,Et(arguments))}function ht(){ut.apply(null,t.toArray(arguments))}function gt(){at.apply(null,Et(arguments))}function mt(e,t,n){at=e,rt=t,it=n}function yt(e){var t="string"==typeof e.stack?e.stack.split(/\n\s*\n/):[];return t.length,"\nError details:\n"+t[0]}function vt(){st=!0,at(t.toArray(arguments)),st=!1}function bt(){i("VERBOSE")&&gt.apply(null,arguments)}function xt(){i("DEBUG")&&Pt(arguments)}function _t(e){var n;ot&&(t.isString(e)&&(e=new wt(e)),"NonFatalError"==e.name?console.error(Et([e.message]).join(" ")):"UserError"==e.name?(n=e.message,/Error/.test(n)||(n="Error: "+n),console.error(Et([n]).join(" ")),console.error("Run mapshaper -h to view help")):console.error(e))}function wt(e){var t=new Error(e);return t.name="UserError",t}function St(e){var t=new Error(e);return t.name="NonFatalError",t}function At(e,t){var n=e.reduce((function(e,t){return t.map((function(t,n){return e?Math.max(e[n],t.length):t.length}))}),null);return e.map((function(e){return e=e.map((function(e,r){return(t&&"right"==t[r]?e.padStart:e.padEnd).bind(e)(n[r]," ")})),"  "+e.join(" ")})).join("\n")}function It(e){var n=e.reduce((function(e,t){return Math.max(e,t.length)}),0)+2,r=Math.floor(80/n)||1;return e.reduce((function(e,i,a){var o=a%r;return a>0&&0===o&&(e+="\n"),o<r-1&&(i=t.rpad(i,n-2," ")),e+"  "+i}),"")}function Mt(e){return t.toArray(e).join(" ")}function Et(e){var n=t.toArray(e),r=i("current_command");return r&&"help"!=r&&n.unshift("["+r+"]"),n}function Pt(e){if(ot&&!i("QUIET")&&t.isArrayLike(e)){var n=Mt(e);st?console.log(n):console.error(n)}}ct();var jt=Object.freeze({__proto__:null,getLoggingSetter:function(){var e=rt,t=it,n=at;return function(){mt(n,e,t)}},setLoggingForCLI:ct,enableLogging:ft,loggingEnabled:lt,error:dt,stop:pt,interrupt:ht,message:gt,setLoggingFunctions:mt,getErrorDetail:yt,print:vt,verbose:bt,debug:xt,printError:_t,UserError:wt,NonFatalError:St,formatColumns:At,formatStringsAsGrid:It,formatLogArgs:Mt,logArgs:Pt});function Ot(){this.mx=this.my=1,this.bx=this.by=0}function kt(){arguments.length>0&&this.setBounds.apply(this,arguments)}function Ft(e){var t=new kt;return Nt(e,(function(e){t.mergePoint(e[0],e[1])})),t}function zt(e,t){var n,r=e?e.length:0;t||(t=new kt);for(var i=0;i<r;i++)n=e[i],t.mergePoint(n[0],n[1]);return t}function Ct(e){var t=[];return Nt(e.shapes,(function(e){t.push(e)})),t}function Nt(e,t){var n,r,i,a,o;for(n=0,r=e.length;n<r;n++)for(i=0,a=(o=e[n])?o.length:0;i<a;i++)t(o[i],n)}Ot.prototype.isNull=function(){return!this.mx||!this.my||isNaN(this.bx)||isNaN(this.by)},Ot.prototype.invert=function(){var e=new Ot;return e.mx=1/this.mx,e.my=1/this.my,e.bx=-this.bx/this.mx,e.by=-this.by/this.my,e},Ot.prototype.transform=function(e,t,n){return(n=n||[])[0]=e*this.mx+this.bx,n[1]=t*this.my+this.by,n},Ot.prototype.toString=function(){return JSON.stringify(Object.assign({},this))},kt.from=function(){var e=new kt;return e.setBounds.apply(e,arguments)},kt.prototype.toString=function(){return JSON.stringify({xmin:this.xmin,xmax:this.xmax,ymin:this.ymin,ymax:this.ymax})},kt.prototype.toArray=function(){return this.hasBounds()?[this.xmin,this.ymin,this.xmax,this.ymax]:[]},kt.prototype.hasBounds=function(){return this.xmin<=this.xmax&&this.ymin<=this.ymax},kt.prototype.sameBounds=kt.prototype.equals=function(e){return e&&this.xmin===e.xmin&&this.xmax===e.xmax&&this.ymin===e.ymin&&this.ymax===e.ymax},kt.prototype.width=function(){return this.xmax-this.xmin||0},kt.prototype.height=function(){return this.ymax-this.ymin||0},kt.prototype.area=function(){return this.width()*this.height()||0},kt.prototype.empty=function(){return this.xmin=this.ymin=this.xmax=this.ymax=void 0,this},kt.prototype.setBounds=function(e,n,r,i){return 1==arguments.length&&(t.isArrayLike(e)?(n=e[1],r=e[2],i=e[3],e=e[0]):(n=e.ymin,r=e.xmax,i=e.ymax,e=e.xmin)),this.xmin=e,this.ymin=n,this.xmax=r,this.ymax=i,(e>r||n>i)&&this.update(),this},kt.prototype.centerX=function(){return.5*(this.xmin+this.xmax)},kt.prototype.centerY=function(){return.5*(this.ymax+this.ymin)},kt.prototype.containsPoint=function(e,t){return e>=this.xmin&&e<=this.xmax&&t<=this.ymax&&t>=this.ymin},kt.prototype.containsBufferedPoint=kt.prototype.containsCircle=function(e,t,n){return e+n>this.xmin&&e-n<this.xmax&&t-n<this.ymax&&t+n>this.ymin},kt.prototype.intersects=function(e){return e.xmin<=this.xmax&&e.xmax>=this.xmin&&e.ymax>=this.ymin&&e.ymin<=this.ymax},kt.prototype.contains=function(e){return e.xmin>=this.xmin&&e.ymax<=this.ymax&&e.xmax<=this.xmax&&e.ymin>=this.ymin},kt.prototype.shift=function(e,t){this.setBounds(this.xmin+e,this.ymin+t,this.xmax+e,this.ymax+t)},kt.prototype.padBounds=function(e,t,n,r){this.xmin-=e,this.ymin-=t,this.xmax+=n,this.ymax+=r},kt.prototype.scale=function(e,t){var n=.5*(this.xmax-this.xmin),r=.5*(this.ymax-this.ymin),i=e-1,a=void 0===t?i:t-1;this.xmin-=n*i,this.ymin-=r*a,this.xmax+=n*i,this.ymax+=r*a},kt.prototype.cloneBounds=kt.prototype.clone=function(){return new kt(this.xmin,this.ymin,this.xmax,this.ymax)},kt.prototype.clearBounds=function(){this.setBounds(new kt)},kt.prototype.mergePoint=function(e,t){void 0===this.xmin?this.setBounds(e,t,e,t):(e<this.xmin?this.xmin=e:e>this.xmax&&(this.xmax=e),t<this.ymin?this.ymin=t:t>this.ymax&&(this.ymax=t))},kt.prototype.fillOut=function(e,t,n){arguments.length<3&&(t=.5,n=.5);var r,i=this.width(),a=this.height(),o=i/a;return isNaN(e)||e<=0||(o<e?(r=a*e-i,this.xmin-=(1-t)*r,this.xmax+=t*r):(r=i/e-a,this.ymin-=(1-n)*r,this.ymax+=n*r)),this},kt.prototype.update=function(){var e;this.xmin>this.xmax&&(e=this.xmin,this.xmin=this.xmax,this.xmax=e),this.ymin>this.ymax&&(e=this.ymin,this.ymin=this.ymax,this.ymax=e)},kt.prototype.transform=function(e){return this.xmin=this.xmin*e.mx+e.bx,this.xmax=this.xmax*e.mx+e.bx,this.ymin=this.ymin*e.my+e.by,this.ymax=this.ymax*e.my+e.by,this.update(),this},kt.prototype.getTransform=function(e,t){var n=new Ot;return n.mx=e.width()/this.width()||1,n.bx=e.xmin-n.mx*this.xmin,t?(n.my=-e.height()/this.height()||1,n.by=e.ymax-n.my*this.ymin):(n.my=e.height()/this.height()||1,n.by=e.ymin-n.my*this.ymin),n},kt.prototype.mergeCircle=function(e,t,n){n<0&&(n=-n),this.mergeBounds([e-n,t-n,e+n,t+n])},kt.prototype.mergeBounds=function(e){var t,n,r,i;return e instanceof kt?(t=e.xmin,n=e.ymin,r=e.xmax,i=e.ymax):4==arguments.length?(t=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3]):4==e.length?(t=e[0],n=e[1],r=e[2],i=e[3]):dt("Bounds#mergeBounds() invalid argument:",e),void 0===this.xmin?this.setBounds(t,n,r,i):(t<this.xmin&&(this.xmin=t),n<this.ymin&&(this.ymin=n),r>this.xmax&&(this.xmax=r),i>this.ymax&&(this.ymax=i)),this};var Tt=Object.freeze({__proto__:null,countPointsInLayer:function(e){var t=0;return Qr(e)&&Nt(e.shapes,(function(){t++})),t},getPointBounds:Ft,getPointFeatureBounds:zt,getPointsInLayer:Ct,forEachPoint:Nt});function Lt(e){return e>=0?e:~e}function Bt(e,t,n,r){var i,a,o,s,u,c,f=0|n,l=isNaN(r)?e.length-f:r+f;for(l>0&&(o=u=e[f],s=c=t[f]),f++;f<l;f++)(i=e[f])<o&&(o=i),i>u&&(u=i),(a=t[f])<s&&(s=a),a>c&&(c=a);return[o,s,u,c]}var Dt=Object.freeze({__proto__:null,absArcId:Lt,calcArcBounds:Bt,deleteVertex:function(e,n){for(var r=e.getVertexData(),i=r.nn,a=r.xx.length,o=new Float64Array(r.xx.buffer,0,a-1),s=new Float64Array(r.yy.buffer,0,a-1),u=e.isFlat()?null:new Float64Array(r.zz.buffer,0,a-1),c=e.getRetainedInterval(),f=0,l=!1,d=0;d<i.length;d++)(f+=i[d])>=n&&!l&&(i[d]=i[d]-1,l=!0);t.copyElements(r.xx,0,o,0,n),t.copyElements(r.yy,0,s,0,n),t.copyElements(r.xx,n+1,o,n,a-n-1),t.copyElements(r.yy,n+1,s,n,a-n-1),u&&(t.copyElements(r.zz,0,u,0,n),t.copyElements(r.zz,n+1,u,n,a-n-1)),e.updateVertexData(i,o,s,u),e.setRetainedInterval(c)},insertVertex:function(e,n,r){var i,a,o,s=e.getVertexData(),u=s.nn,c=s.xx.length,f=0,l=!1;s.xx.buffer.byteLength>=8*s.xx.length+8?(i=new Float64Array(s.xx.buffer,0,c+1),a=new Float64Array(s.yy.buffer,0,c+1)):(i=new Float64Array(new ArrayBuffer(8*(c+50)),0,c+1),a=new Float64Array(new ArrayBuffer(8*(c+50)),0,c+1)),e.isFlat()||(o=new Float64Array(new ArrayBuffer(8*(c+1)),0,c+1));for(var d=0;d<u.length;d++)(f+=u[d])>=n&&!l&&(u[d]=u[d]+1,l=!0);t.copyElements(s.xx,0,i,0,n),t.copyElements(s.yy,0,a,0,n),t.copyElements(s.xx,n,i,n+1,c-n),t.copyElements(s.yy,n,a,n+1,c-n),i[n]=r[0],a[n]=r[1],o&&(o[n]=1/0,t.copyElements(s.zz,0,o,0,n),t.copyElements(s.zz,n,o,n+1,c-n)),e.updateVertexData(u,i,a,o)}}),Ut={SEMIMAJOR_AXIS:6378137,SEMIMINOR_AXIS:6356752.3142,AUTHALIC_RADIUS:6371007.2,VOLUMETRIC_RADIUS:6371000.8},Rt=Ut.SEMIMAJOR_AXIS,qt=Math.PI/180,$t=180/Math.PI;function Vt(e,t,n,r,i,a){var o=e-r,s=t-i,u=n-a;return Math.sqrt(o*o+s*s+u*u)}function Gt(e,t,n,r){var i=e-n,a=t-r;return i*i+a*a}function Jt(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}function Wt(e,t,n,r,i,a){var o=e-r,s=t-i,u=n-a;return o*o+s*s+u*u}function Yt(e){for(var t=2*Math.PI;e<0;)e+=t;for(;e>=t;)e-=t;return e}function Ht(e,t,n,r){var i=Math.PI/180;e*=i,n*=i,t*=i,r*=i;var a=Math.sin(n-e)*Math.cos(r),o=Math.cos(t)*Math.sin(r)-Math.sin(t)*Math.cos(r)*Math.cos(n-e);return Math.atan2(a,o)}function Xt(e,t,n){var r;e*=qt,t*=qt,r=Math.cos(t),n[0]=Math.cos(e)*r*Rt,n[1]=Math.sin(e)*r*Rt,n[2]=Math.sin(t)*Rt}function Zt(e,t,n,r){var i=n-e,a=r-t,o=Math.sin(a/2)*Math.sin(a/2)+Math.cos(t)*Math.cos(r)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}function Qt(e,t,n,r){var i=Math.PI/180;return Zt(e*i,t*i,n*i,r*i)*Rt}function Kt(e,t,n,r,i,a){var o=e*r-e*a+n*a-n*t+i*t-i*r;return o*o}function en(e,t,n){var r;if(0===n)r=e;else if(e>=t+n)r=t;else if(t>=e+n)r=e;else{var i=e+n-t;r=e-i*i/n*.25}return r<0&&(r=0),r}function tn(e,t,n,r,i,a){var o=Gt(n,r,i,a),s=((e-n)*(i-n)+(t-r)*(a-r))/o;return 0===o?Gt(e,t,n,r):(s<0&&(s=0),s>1&&(s=1),Gt(e,t,n+s*(i-n),r+s*(a-r)))}var nn,rn=Object.freeze({__proto__:null,R:Rt,D2R:qt,R2D:$t,degreesToMeters:function(e){return e*qt*Rt},distance3D:Vt,distanceSq:Gt,distance2D:Jt,distanceSq3D:Wt,innerAngle2:function(e,t,n,r,i,a){var o=Math.atan2(t-r,e-n),s=Math.atan2(a-r,i-n),u=Math.abs(o-s);return u>Math.PI&&(u=2*Math.PI-u),u},standardAngle:Yt,signedAngle:function(e,t,n,r,i,a){if(e==n&&t==r||n==i&&r==a)return NaN;var o=e-n,s=t-r,u=i-n,c=a-r,f=o*u+s*c,l=o*c-s*u;return Yt(Math.atan2(l,f))},bearing2D:function(e,t,n,r){var i=Math.PI/2-Math.atan2(r-t,n-e);return i>Math.PI?i-2*Math.PI:i},bearing:Ht,signedAngleSph:function(e,t,n,r,i,a){if(e==n&&t==r||n==i&&r==a)return NaN;var o=Ht(n,r,e,t),s=Ht(n,r,i,a);return Yt(2*Math.PI+o-s)},convLngLatToSph:function(e,t,n,r,i){for(var a=[],o=0,s=e.length;o<s;o++)Xt(e[o],t[o],a),n[o]=a[0],r[o]=a[1],i[o]=a[2]},xyzToLngLat:function(e,t,n,r){var i=Vt(0,0,0,e,t,n),a=Math.asin(n/i)/qt,o=Math.atan2(t/i,e/i)/qt;r[0]=o,r[1]=a},lngLatToXYZ:Xt,sphericalDistance:Zt,greatCircleDistance:Qt,innerAngle:function(e,t,n,r,i,a){var o,s=Jt(e,t,n,r),u=Jt(n,r,i,a);return 0===s||0===u||(o=((e-n)*(i-n)+(t-r)*(a-r))/(s*u))>=1-1e-14?0:o<=1e-14-1?Math.PI:Math.acos(o)},innerAngle3D:function(e,t,n,r,i,a,o,s,u){var c,f=Vt(e,t,n,r,i,a),l=Vt(r,i,a,o,s,u);return 0===f||0===l||(c=((e-r)*(o-r)+(t-i)*(s-i)+(n-a)*(u-a))/(f*l))>=1?0:c<=-1?Math.PI:Math.acos(c)},triangleArea:function(e,t,n,r,i,a){return Math.abs(((t-a)*(n-i)+(r-a)*(i-e))/2)},cosine:function(e,t,n,r,i,a){var o=Jt(e,t,n,r)*Jt(n,r,i,a),s=0;return o>0&&((s=((e-n)*(i-n)+(t-r)*(a-r))/o)>1?s=1:s<-1&&(s=-1)),s},cosine3D:function(e,t,n,r,i,a,o,s,u){var c=Vt(e,t,n,r,i,a)*Vt(r,i,a,o,s,u),f=0;return c>0&&((f=((e-r)*(o-r)+(t-i)*(s-i)+(n-a)*(u-a))/c)>1?f=1:f<-1&&(f=-1)),f},triangleArea3D:function(e,t,n,r,i,a,o,s,u){return.5*Math.sqrt(Kt(e,t,r,i,o,s)+Kt(e,n,r,a,o,u)+Kt(t,n,i,a,s,u))},pointSegDistSq:function(e,t,n,r,i,a){return en(Gt(e,t,n,r),Gt(e,t,i,a),Gt(n,r,i,a))},pointSegDistSq3D:function(e,t,n,r,i,a,o,s,u){return en(Wt(e,t,n,r,i,a),Wt(e,t,n,o,s,u),Wt(r,i,a,o,s,u))},pointSegDistSq2:tn,containsBounds:function(e,t){return e[0]<=t[0]&&e[2]>=t[2]&&e[1]<=t[1]&&e[3]>=t[3]}});function an(e,t,n,r){var i,a,o,s,u,c,f,l,d,p,h=r.getShapeIter(n),g=1/0;for(h.hasNext()&&(a=c=l=h.x,o=f=d=h.y);h.hasNext();)(p=tn(e,t,a,o,s=h.x,u=h.y))<g&&(g=p,i=h._ids[h._i],c=a,f=o,l=s,d=u),a=s,o=u;return g==1/0?{distance:1/0}:{segment:[[c,f],[l,d]],distance:Math.sqrt(g),arcId:i}}function on(e,t,n,r){return(n||[]).reduce((function(n,i){var a=an(e,t,i,r);return!n||a.distance<n.distance?a:n}),null)||{distance:1/0,arcId:-1,segment:null}}function sn(e,t){var n=t.getShapeIter(e);if(!n.hasNext())return null;for(var r=n.x,i=n.y,a=0,o=0,s=0;n.hasNext();)a++,o+=n.x,s+=n.y;return 0!==a&&n.x===r&&n.y===i||(o+=r,s+=i,a++),{x:o/a,y:s/a}}function un(e,t){var n=0;return(e||[]).reduce((function(e,r){var i=t.getSimpleShapeBounds(r).area();return i>n&&(n=i,e=r),e}),null)}nn=function(){var e,t;function n(n,r,i,a){e+=t(i[n],a[n],i[r],a[r])}return function(r,i,a){a&&i.isPlanar()&&dt("Expected lat-long coordinates"),t=a?Qt:Jt,e=0;for(var o=0,s=r.length;o<s;o++)i.forEachArcSegment(r[o],n);return e}}();var cn=Object.freeze({__proto__:null,pathIsClosed:function(e,t){var n=e[0],r=e[e.length-1],i=t.getVertex(n,0),a=t.getVertex(r,-1);return i.x===a.x&&i.y===a.y},getPointToPathDistance:function(e,t,n,r){return an(e,t,n,r).distance},getPointToPathInfo:an,getPointToShapeDistance:function(e,t,n,r){var i=on(e,t,n,r);return i?i.distance:1/0},getPointToShapeInfo:on,getAvgPathXY:sn,getMaxPath:un,countVerticesInPath:function(e,t){for(var n=t.getShapeIter(e),r=0;n.hasNext();)r++;return r},getPathBounds:function(e){for(var t=new kt,n=0,r=e.length;n<r;n++)t.mergePoint(e[n][0],e[n][1]);return t},get calcPathLen(){return nn}});function fn(e,t){var n,r,i,a,o,s,u,c,f=t.getShapeIter(e),l=0,d=0,p=0;if(!f.hasNext())return null;for(i=0,a=0,n=-f.x,r=-f.y;f.hasNext();)o=i,s=a,i=f.x+n,l+=u=o*(a=f.y+r)-s*i,d+=u*(o+i),p+=u*(s+a);return 0===(c=l/2)?sn(e,t):{x:d/(6*c)-n,y:p/(6*c)-r}}var ln=Object.freeze({__proto__:null,getShapeCentroid:function(e,t){var n=un(e,t);return n?fn(n,t):null},getPathCentroid:fn});function dn(e,t,n){return!!n.containsPoint(e[0],e[1])||!!($n.segmentIntersection(e[0],e[1],t[0],t[1],n.xmin,n.ymin,n.xmin,n.ymax)||$n.segmentIntersection(e[0],e[1],t[0],t[1],n.xmin,n.ymax,n.xmax,n.ymax)||$n.segmentIntersection(e[0],e[1],t[0],t[1],n.xmax,n.ymax,n.xmax,n.ymin)||$n.segmentIntersection(e[0],e[1],t[0],t[1],n.xmax,n.ymin,n.xmin,n.ymin))}function pn(e,t,n){if(!t||!hn(e.xmin,e.ymin,t,n))return!1;var r=!0;return t.forEach((function(t){er(t,n,(function(t,n,i,a){r=r&&!dn([i[t],a[t]],[i[n],a[n]],e)}))})),r}function hn(e,t,n,r){var i=!1,a=!1;return!!n&&(n.forEach((function(n){var o=gn(e,t,n,r);1==o?i=!i:-1==o&&(a=!0)})),a||i)}function gn(e,t,n,r){var i=!1,a=!1;return er(n,r,(function(n,r,o,s){var u=mn(e,t,o[n],s[n],o[r],s[r]);1==u?i=!i:isNaN(u)&&(a=!0)})),a?-1:i?1:0}function mn(e,t,n,r,i,a){var o=yn(e,t,n,r,i,a);return o!=o?NaN:o==-1/0?0:1}function yn(e,t,n,r,i,a){var o,s=-1/0;return e<n&&e<i||e>n&&e>i||t>r&&t>a||(e===n||e===i?e===n&&e===i?t!=r&&t!=a&&t>r==t>a||(s=NaN):e===n?t===r?s=NaN:i<n&&t<r&&(s=r):t===a?s=NaN:n<i&&t<a&&(s=a):(o=function(e,t,n,r,i){return n+(e-t)*(i-n)/(r-t)}(e,n,r,i,a),o>t?s=o:o==t&&(s=NaN))),s}function vn(e,t){return(t.isPlanar()?_n:bn)(e,t)}function bn(e,t,n){return xn(t.getShapeIter(e),n)}function xn(e,t){var n,r,i,a,o=0,s=!1,u=Math.PI/180;for(t=t||Ut.SEMIMAJOR_AXIS;e.hasNext();)n=e.x*u,r=Math.sin(e.y*u),s?o+=(n-i)*(2+r+a):s=!0,i=n,a=r;return o/2*t*t}function _n(e,t){var n,r,i,a,o,s,u=t.getShapeIter(e),c=0;if(u.hasNext())for(n=0,r=0,o=-u.x,s=-u.y;u.hasNext();)i=n,a=r,c+=(n=u.x+o)*a-i*(r=u.y+s);return c/2}function wn(e,t){return(t.isPlanar()?Sn:An)(e,t)}function Sn(e,t){return nn(e,t,!1)}function An(e,t){return nn(e,t,!0)}var In=Object.freeze({__proto__:null,calcPolsbyPopperCompactness:function(e,t){return t<=0?0:Math.abs(e)*Math.PI*4/(t*t)},calcSchwartzbergCompactness:function(e,t){return t<=0?0:2*Math.PI*Math.sqrt(Math.abs(e)/Math.PI)/t},getPathWinding:function(e,t){var n=vn(e,t);return(n>0?1:n<0&&-1)||0},getShapeArea:function(e,t){return(e||[]).reduce((function(e,n){return e+vn(n,t)}),0)},getPlanarShapeArea:function(e,t){return(e||[]).reduce((function(e,n){return e+_n(n,t)}),0)},getSphericalShapeArea:function(e,t,n){return t.isPlanar()&&dt("[getSphericalShapeArea()] Function requires decimal degree coordinates"),(e||[]).reduce((function(e,r){return e+bn(r,t,n)}),0)},testBoundsInPolygon:pn,testPointInPolygon:hn,testPointInRing:gn,testRayIntersection:mn,getRayIntersection:yn,getPathArea:vn,getSphericalPathArea:bn,getSphericalPathArea2:xn,getPlanarPathArea2:function(e){for(var t,n,r,i,a,o,s,u=0,c=0,f=e.length;c<f;c++)s=e[c],0===c?(t=0,n=0,a=-s[0],o=-s[1]):u+=(t=s[0]+a)*i-r*(n=s[1]+o),r=t,i=n;return u/2},getPlanarPathArea:_n,getPathPerimeter:wn,getShapePerimeter:function(e,t){return(e||[]).reduce((function(e,n){return e+wn(n,t)}),0)},getSphericalShapePerimeter:function(e,t){return t.isPlanar()&&dt("[getSphericalShapePerimeter()] Function requires decimal degree coordinates"),(e||[]).reduce((function(e,n){return e+An(n,t)}),0)},getPlanarPathPerimeter:Sn,getSphericalPathPerimeter:An});function Mn(e){return 1e-14*Math.max.apply(null,e.map(Math.abs))}function En(e,n){var r=Vn(e),i=.0025*r;n>0&&(i=n,gt(t.format("Applying snapping threshold of %s -- %.6f times avg. segment length",n,n/r)));var a=Pn(e,i);a>0&&e.dedupCoords(),gt(t.format("Snapped %s point%s",a,t.pluralSuffix(a)))}function Pn(e,t){return t>0==!1?0:On(kn(e),e,t)}function jn(e,t){return t>0==!1?0:On(Fn(e),e,t)}function On(e,t,n){var r=0,i=e.length,a=t.getVertexData();zn(a.xx,e,0,i-1);for(var o=0;o<i;o++)r+=s(o,n,e,a.xx,a.yy);return r;function s(e,t,n,r,i){for(var a,o,s,u=e,c=n.length,f=r[n[e]],l=i[n[e]],d=0;++u<c&&!((o=r[a=n[u]]-f)>t);)s=i[a]-l,0===o&&0===s||o*o+s*s>t*t||(r[a]=f,i[a]=l,d++);return d}}function kn(e){for(var t=e.getVertexData().xx.length,n=new Uint32Array(t),r=0;r<t;r++)n[r]=r;return n}function Fn(e){var t=0,n=[];return e.getVertexData().nn.forEach((function(e){e>0!=!1&&(n.push(t,t+e-1),t+=e)})),n}function zn(e,t,n,r){if(r-n>24){for(var i,a=e[t[n+r>>1]],o=n,s=r;o<=s;){for(;e[t[o]]<a;)o++;for(;e[t[s]]>a;)s--;o<=s&&(i=t[o],t[o]=t[s],t[s]=i,o++,s--)}s>n&&zn(e,t,n,s),o<r&&zn(e,t,o,r)}else!function(e,t,n,r){var i,a,o;for(o=n+1;o<=r;o++){for(i=t[o],a=o-1;a>=n&&e[i]<e[t[a]];a--)t[a+1]=t[a];t[a+1]=i}}(e,t,n,r)}var Cn=Object.freeze({__proto__:null,getHighPrecisionSnapInterval:Mn,snapCoords:En,snapCoordsByInterval:Pn,snapEndpointsByInterval:jn,getCoordinateIds:kn,getEndpointIds:Fn});function Nn(e,t,n,r,i,a,o,s){if(!(tn(n,r,i,a,o,s)>t)){var u=Gt(i,a,n,r),c=Gt(o,s,n,r);u<=t||c<=t||e.push(n,r)}}function Tn(e,t,n,r,i,a){var o=Jt(n,r,i,a);return o<t&&(t=o,e[0]=i,e[1]=a),t}function Ln(e,t,n){var r;return function(e,t,n){return t<n?e<t||e>n:t>n?e>t||e<n:e!=t}(e,t,n)&&(r=Math.abs(e-t)<Math.abs(e-n)?t:n,Math.abs(e-r)>1e-15&&xt("[clampToCloseRange()] large clamping interval",e,t,n),e=r),e}function Bn(e,t,n,r){return e*r-t*n}function Dn(e,t,n,r,i,a){return Bn(e-i,t-a,n-i,r-a)}function Un(e,t,n,r,i,a,o,s){return Dn(e,t,n,r,i,a)*Dn(e,t,n,r,o,s)<=0&&Dn(i,a,o,s,e,t)*Dn(i,a,o,s,n,r)<=0}function Rn(e,t,n,r){var i=e[0],a=e[1],o=t[0],s=t[1],u=o-n[0],c=s-n[1],f=Dn(i,a,o,s,r[0]+u,r[1]+c);return f?f<0?1:-1:0}var qn=Object.freeze({__proto__:null,segmentIntersection:function(e,t,n,r,i,a,o,s,u){var c,f,l=u>=0?u:Mn([e,t,n,r,i,a,o,s]),d=l*l;return!(c=function(e,t,n,r,i,a,o,s,u){var c=[];if(Nn(c,e,t,n,a,o,s,u),Nn(c,e,r,i,a,o,s,u),Nn(c,e,a,o,t,n,r,i),Nn(c,e,s,u,t,n,r,i),0===c.length)return null;c.length>4&&xt("Intersection detection error");return c}(d,e,t,n,r,i,a,o,s))&&function(e,t,n,r,i,a,o,s,u){return Gt(t,n,a,o)<=e||Gt(t,n,s,u)<=e||Gt(r,i,a,o)<=e||Gt(r,i,s,u)<=e}(d,e,t,n,r,i,a,o,s)?null:(f=function(e,t,n,r,i,a,o,s,u){if(!Un(e,t,n,r,i,a,o,s))return null;var c=Bn(n-e,r-t,o-i,s-a),f=Dn(i,a,o,s,e,t)/c,l=[e+f*(n-e),t+f*(r-t)];if(Math.abs(c)<1e-18)return null;u>0&&function(e,t,n,r,i,a,o,s,u,c){var f=e[0],l=e[1],d=c;d=Tn(e,d,f,l,t,n),d=Tn(e,d,f,l,r,i),d=Tn(e,d,f,l,a,o),d=Tn(e,d,f,l,s,u)}(l,e,t,n,r,i,a,o,s,u);return function(e,t,n,r,i,a,o,s,u){var c=e[0],f=e[1];c=Ln(c,t,r),c=Ln(c,a,s),f=Ln(f,n,i),f=Ln(f,o,u),e[0]=c,e[1]=f}(l,e,t,n,r,i,a,o,s),l}(e,t,n,r,i,a,o,s,l),c||f||null)},findClosestPointOnSeg:function(e,t,n,r,i,a){var o=i-n,s=a-r,u=o*o+s*s,c=0===u?-1:((e-n)*o+(t-r)*s)/u;return c<=.1?[n,r]:c>=.9?[i,a]:[n+c*o,r+c*s]},orient2D:Dn,segmentHit:Un,segmentTurn:Rn}),$n=Object.assign({},rn,In,cn,qn,ln);function Vn(e){var t=0,n=e.forEachSegment((function(e,n,r,i){var a=r[e]-r[n],o=i[e]-i[n];t+=Math.sqrt(a*a+o*o)}));return t/n||0}function Gn(e){var t=0,n=0,r=e.forEachSegment((function(e,r,i,a){t+=Math.abs(i[e]-i[r]),n+=Math.abs(a[e]-a[r])}));return[t/r||0,n/r||0]}function Jn(e,t){var n=new Uint8Array(t.size());return Wn(e,n),function(e){return e<0&&(e=~e),n[e]>0}}function Wn(e,t){tr(e,null,(function(e){for(var n,r=e.arcs,i=0;i<r.length;i++)(n=r[i])<0&&(n=~n),t[n]++}))}function Yn(e,t){var n=new kt;return Qn(e,(function(e){t.mergeArcBounds(e,n)})),n}function Hn(e){e.reverse();for(var t=0,n=e.length;t<n;t++)e[t]=~e[t];return e}function Xn(e,t){return t<=0?e=1/0:t>=1&&(e=0),e}function Zn(e,t,n,r){var i,a,o=0,s=-1;n>r&&(i=n,n=r,r=i);for(var u=n+1;u<r;u++)(a=e[u])<t&&a>o&&(s=u,o=a);return s}function Qn(e,n){for(var r,i=0;i<e.length;i++)if((r=e[i])instanceof Array)Qn(r,n);else if(t.isInteger(r)){var a=n(r);void 0!==a&&(e[i]=a)}else r&&dt("Non-integer arc id in:",e)}function Kn(e,t,n){for(var r=0,i=e?e.length:0;r<i;r++)er(e[r],t,n)}function er(e,t,n){for(var r=0,i=e.length;r<i;r++)t.forEachArcSegment(e[r],n)}function tr(e,t,n,r){var i=0;e.forEach((function(e,a){if(e&&0!==e.length){var o,s;r&&r(a);for(var u=0,c=e.length;u<c;u++)if(o=e[u],n&&n({i:u,shapeId:a,shape:e,arcs:o}),t)for(var f=0,l=o.length;f<l;f++,i++)s=o[f],t({i:f,shapeId:a,partId:u,arcId:s,segId:i})}}))}function nr(e,t){var n,r,i=t.getArcIter(e);if(i.hasNext())for(n=i.x,r=i.y;i.hasNext();)if(i.x!=n||i.y!=r)return!0;return!1}function rr(e,t){if(!e)return null;var n=[];return e.forEach((function(e){for(var r=[],i=0;i<e.length;i++)nr(e[i],t)&&r.push(e[i]);r.length>0&&n.push(r)})),n.length>0?n:null}function ir(e,t,n){for(var r,i=[],a=0,o=e&&e.length;a<o;a++)r=e[a],i.push({ids:r,area:"polygon"==n?$n.getPlanarPathArea(r,t):0,bounds:t.getSimpleShapeBounds(r)});return i}var ar=Object.freeze({__proto__:null,getAvgSegment:Vn,getAvgSegment2:Gn,getDirectedArcPresenceTest:function(e,t){var n=new Uint8Array(t);return Qn(e,(function(e){var r=Lt(e);r<t==!1&&dt("index error"),n[r]|=e<0?2:1})),function(e){var t=Lt(e);return e<0?2==(2&n[t]):1==(1&n[t])}},getArcPresenceTest:Jn,countArcsInShapes:Wn,getPathBounds:Yn,findShapesByArcId:function(e,t,n){var r=n?new Uint8Array(n):[],i=[];return t.forEach((function(e){r[Lt(e)]=1})),e.forEach((function(e,t){var n=!1;Qn(e||[],(function(e){n=n||1==r[Lt(e)]})),n&&i.push(t)})),i},reversePath:Hn,clampIntervalByPct:Xn,findNextRemovableVertex:Zn,forEachArcId:Qn,forEachSegmentInShape:Kn,forEachSegmentInPath:er,traversePaths:tr,filterEmptyArcs:rr,getPathMetadata:ir,quantizeArcs:function(e,t){var n=e.getBounds(),r=new kt(0,0,t-1,t-1),i=n.getTransform(r),a=i.invert();e.transformPoints((function(e,t){var n=i.transform(e,t);return a.transform(Math.round(n[0]),Math.round(n[1]))}))}});function or(e){return e?e.map((function(e){return e.concat()})):null}function sr(e){return t.isArray(e)?e.map(or):null}function ur(e,t){fr(e,t)}function cr(e,t){for(var n=0,r=e.length;n<r;n++)e[n]=fr(e[n],t)}function fr(e,n){if(!e)return null;t.isArray(e)||dt("Expected an array, received:",e);for(var r,i=0,a=e.length,o=0;o<a;o++)null===(r=n(e[o],o,e))?(i++,e[o]=null):t.isArray(r)&&(e[o]=r);return i==a?null:i>0?e.filter((function(e){return!!e})):e}function lr(e){for(var t,n=0,r=0,i=e.length;r<i;r++)(t=e[r])&&t.length>n&&(n=t.length);return n}var dr=Object.freeze({__proto__:null,cloneShape:or,cloneShapes:sr,forEachShapePart:ur,editShapes:cr,editShapeParts:fr,findMaxPartCount:lr}),pr="function"==typeof require?require:function(){},hr=pr("iconv-lite"),gr=function(e){var n=null;if("utf8"!=(e=wr(e)))return null;"undefined"!=typeof TextEncoder&&(n=new TextEncoder(e));return function(r){return n?s.from(n.encode(r).buffer):t.createBuffer(r,e)}}("utf8"),mr=function(e){var t=null;if("utf8"!=(e=wr(e)))return null;"undefined"!=typeof TextDecoder&&(t=new TextDecoder(e));return function(n){return t?t.decode(n):n.toString(e)}}("utf8");function yr(){return hr.encodingExists("ascii"),Object.keys(hr.encodings)}function vr(e){return Mr(e)||pt("Unknown encoding:",e,"\nRun the -encodings command see a list of supported encodings"),e}function br(e){for(var t=0,n=e.length;t<n;t++)if(e.charCodeAt(t)>=128)return!1;return!0}function xr(e){return!e||/^utf-?8$/i.test(String(e))}function _r(e){return!(e=wr(e))||/^(win|latin|utf8|ascii|iso88|gb)/.test(e)}function wr(e){return(e||"").toLowerCase().replace(/[_-]/g,"")}function Sr(e,t,n,r){return n>=0&&(e=e.slice(n,r)),Ir(e,t)}function Ar(e,t){return xr(t)?gr(e):hr.encode(e,t)}function Ir(e,t){return xr(t)?mr(e):hr.decode(e,t)}function Mr(e){var t=wr(e);return yr().includes(t)}function Er(e){return 65279==e.charCodeAt(0)&&(e=e.substr(1)),e}function Pr(){var e=yr().filter((function(e){return!/^(_|cs|internal|ibm|isoir|singlebyte|table|[0-9]|l[0-9]|windows)/.test(e)}));e.sort(),vt("Supported encodings:\n"+It(e))}var jr=Object.freeze({__proto__:null,getEncodings:yr,validateEncoding:vr,stringsAreAscii:function(e){return br(e.join(""))},stringIsAscii:br,encodingIsUtf8:xr,encodingIsAsciiCompat:_r,standardizeEncodingName:wr,bufferToString:Sr,encodeString:Ar,decodeString:Ir,encodingIsSupported:Mr,trimBOM:Er,printEncodings:Pr});function Or(e){var n,r,i={};if(!e)return null;for(n in e)e.hasOwnProperty(n)&&((r=e[n])==e&&delete(r=t.extend({},r))[n],i[n]=r&&r.constructor===Object?Or(r):r);return i}function kr(e){var n=null;return t.isString(e)?n="string":t.isNumber(e)?n="number":t.isBoolean(e)?n="boolean":t.isDate(e)?n="date":t.isObject(e)&&(n="object"),n}function Fr(e){var t=function(e){var t,n,r,i={};for(t=0;t<e.length;t++)for(r=Object.keys(e[t]||{}),n=0;n<r.length;n++)i[r[n]]=1+(0|i[r[n]]);return Object.keys(i).filter((function(t){return i[t]<e.length}))}(e);!function(e,t){var n,r,i,a;for(r=0;r<e.length;r++)for(n=e[r]||(e[r]={}),i=0;i<t.length;i++)(a=t[i])in n==!1&&(n[a]=void 0)}(e,t)}function zr(e,n){return e.indexOf("*")>-1||0===t.difference(n,e).length}function Cr(e,t){for(var n,r=null,i=0,a=t.length;i<a&&!(r=(n=t[i])?kr(n[e]):null);i++);return r}function Nr(e,t){e.getFields().forEach((function(n){t(n)&&e.deleteField(n)}))}function Tr(e){return/^\s*$/.test(e)}function Lr(e,n,r){var i={};return e.map((function(a){var o,s=0;do{o=r&&"ascii"!=r?Rr(a,n,s,r):Ur(a,n,s),s++}while(o in i||a!=o&&t.contains(e,o));return i[o]=!0,o}))}function Br(e,t){return e.map((function(e){return e?e[t]:void 0}))}function Dr(e,t){var n={},r=[];return e.forEach((function(e){var i=e[t];i in n==!1&&(n[i]=!0,r.push(i))})),r}function Ur(e,t,n){var r,i;return t=t||256,n?(1==(i=String(n)).length&&(i="_"+i),r=e.substr(0,t-i.length)+i):r=e.substr(0,t),r}function Rr(e,t,n,r){var i=e+(n?String(n):"");return Ar(i,r).length>(t||256)?Rr(e=e.substr(0,e.length-1),t,n,r):i}function qr(e,t){return"ascending"==t&&e.sort((function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1})),e}function $r(e){for(var t=0,n=e?e.length:0;t<n;t++)if(e[t])return e[t];return null}function Vr(e,t){var n=$r(e);return qr(n?Object.keys(n):[],t)}var Gr=Object.freeze({__proto__:null,copyRecord:Or,getValueType:kr,fixInconsistentFields:Fr,fieldListContainsAll:zr,getColumnType:Cr,deleteFields:Nr,isInvalidFieldName:Tr,getUniqFieldNames:Lr,getFieldValues:Br,getUniqFieldValues:Dr,applyFieldOrder:qr,getFirstNonEmptyRecord:$r,findFieldNames:Vr});function Jr(e){var n;if(t.isArray(e))n=e;else if(n=[],t.isInteger(e))for(var r=0;r<e;r++)n.push({});else e&&dt("Invalid DataTable constructor argument:",e);this.getRecords=function(){return n},this.getReadOnlyRecordAt=function(e){return Or(n[e])}}function Wr(e,t,n){for(var r,i,a=ti(e)||n.length,o=(e.data=e.data||new Jr(a)).getRecords(),s=0,u=o.length;s<u;s++)r=o[s],i=n[s],r||(r=o[s]={}),r[t]=void 0===i?null:i}function Yr(e){var t=e.data;return t||(t=e.data=new Jr(e.shapes?e.shapes.length:0)),t}function Hr(e){return!(!e.data||!$r(e.data.getRecords()))}function Xr(e){return Zr(e)||Qr(e)}function Zr(e){return("polygon"==e.geometry_type||"polyline"==e.geometry_type)&&Kr(e)}function Qr(e){return"point"==e.geometry_type&&Kr(e)}function Kr(e){return t.some(e.shapes||[],(function(e){return!!e}))}function ei(e,t){Qr(e)&&Nt(e.shapes,(function(e){var n=t(e[0],e[1]);e[0]=n[0],e[1]=n[1]}))}function ti(e){var t=0;return e.data?t=e.data.size():e.shapes&&(t=e.shapes.length),t}function ni(e){return 0==ti(e)}function ri(e,t,n){var r=e.fieldExists?e:e.data;t||pt("Missing a field parameter"),r&&r.fieldExists(t)||pt(n||"Missing a field named:",t)}function ii(e,n){if(n&&n.length){e||pt("Missing attribute data");var r=e.getFields(),i=t.difference(n,r);i.length>0&&pt("Table is missing one or more fields:\n",i,"\nExisting fields:","\n"+It(r))}}function ai(e,n,r){var i;return r&&t.isString(r)?i=r:(i=n+", ",e&&e.geometry_type?i+="received a "+e.geometry_type+" layer":i+="received a layer with no geometry"),i}function oi(e,t){e&&"point"===e.geometry_type||pt(ai(e,"Expected a point layer",t))}function si(e,t){oi(e),mi(e)>0&&pt(t||"This command requires single points; layer contains multi-point features.")}function ui(e,t){e&&"polyline"===e.geometry_type||pt(ai(e,"Expected a polyline layer",t))}function ci(e,t){e&&"polygon"===e.geometry_type||pt(ai(e,"Expected a polygon layer",t))}function fi(e,t){var n=t.info&&t.info.input_files;return n&&n[0]||""}function li(e,n,r){var i=t.uniq(r).map((function(t){for(var i,a=[],o=[],s=0,u=0,c=e.length;u<c;u++)r[u]==t&&(t&&o.push(e[u]),i=n[u],a.push(i),i||s++);return{geometry_type:t,shapes:o,data:s<a.length?new Jr(a):null}}));return i}function di(e,t){return t&&t.no_replace?{geometry_type:e.geometry_type}:e}function pi(e,t,n,r){(r=r||{}).name?e.name=r.name:r.no_replace?e.name=n||void 0:e.name=t&&t.name||n||void 0}function hi(e){var t=gi(e);return t.data&&(t.data=t.data.clone()),t}function gi(e){var n=t.extend({},e);return e.shapes&&(n.shapes=sr(e.shapes)),n}function mi(e){for(var t=0,n=0,r=e.length;n<r;n++)e[n]&&e[n].length>1&&t++;return t}function yi(e,t){var n=vi(e,t);return function(e){return n[Lt(e)]>0}}function vi(e,t){var n=new Uint32Array(t.size());return e.filter(Zr).forEach((function(e){Wn(e.shapes,n)})),n}function bi(e,t){var n=null;return"point"==e.geometry_type?n=Ft(e.shapes):"polygon"!=e.geometry_type&&"polyline"!=e.geometry_type||(n=Yn(e.shapes,t)),n}function xi(e){e.data=new Jr(ti(e))}Jr.prototype={fieldExists:function(e){return t.contains(this.getFields(),e)},toString:function(){return JSON.stringify(this)},toJSON:function(){return this.getRecords()},addField:function(e,n){var r=t.isFunction(n);t.isNumber(n)||t.isString(n)||r||dt("DataTable#addField() requires a string, number or function for initialization"),this.fieldExists(e)&&dt("DataTable#addField() tried to add a field that already exists:",e),this.getRecords().forEach((function(t,i){t[e]=r?n(t,i):n}))},getRecordAt:function(e){return this.getRecords()[e]},addIdField:function(){this.addField("FID",(function(e,t){return t}))},deleteField:function(e){this.getRecords().forEach((function(t){delete t[e]}))},getFields:function(){return Vr(this.getRecords())},isEmpty:function(){return 0===this.getFields().length||0===this.size()},update:function(e){for(var t=this.getRecords(),n=0,r=t.length;n<r;n++)t[n]=e(t[n],n)},clone:function(){return new Jr(this.getRecords().map(Or))},size:function(){return this.getRecords().length}};var _i=Object.freeze({__proto__:null,insertFieldValues:Wr,getLayerDataTable:Yr,layerHasNonNullData:Hr,layerHasGeometry:Xr,layerHasPaths:Zr,layerHasPoints:Qr,layerHasNonNullShapes:Kr,deleteFeatureById:function(e,t){e.shapes&&e.shapes.splice(t,1),e.data&&e.data.getRecords().splice(t,1)},transformPointsInLayer:ei,getFeatureCount:ti,layerIsEmpty:ni,requireDataField:ri,requireDataFields:ii,layerTypeMessage:ai,requirePointLayer:oi,requireSinglePointLayer:si,requirePolylineLayer:ui,requirePolygonLayer:ci,requirePathLayer:function(e,t){e&&Zr(e)||pt(ai(e,"Expected a polygon or polyline layer",t))},getLayerSourceFile:fi,divideFeaturesByType:li,getOutputLayer:di,setOutputLayerName:pi,copyLayer:hi,filterPathLayerByArcIds:function(e,n){var r=n.reduce((function(e,t){return e[t]=!0,e}),{}),i=sr(e.shapes);return cr(i,(function(e){for(var t=0;t<e.length;t++)if(Lt(e[t])in r)return null;return e})),t.defaults({shapes:i},e)},copyLayerShapes:gi,countMultiPartFeatures:mi,getArcPresenceTest2:yi,countArcsInLayers:vi,getLayerBounds:bi,isolateLayer:function(e,n){return t.defaults({layers:n.layers.filter((function(t){return t==e}))},n)},initDataTable:xi});function wi(){this.a=1,this.c=0,this.tx=0,this.b=0,this.d=1,this.ty=0}wi.prototype.transformXY=function(e,t,n){return(n=n||{}).x=e*this.a+t*this.c+this.tx,n.y=e*this.b+t*this.d+this.ty,n},wi.prototype.translate=function(e,t){this.tx+=e,this.ty+=t},wi.prototype.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e);t=t||0,n=n||0,this.a=r,this.c=-i,this.b=i,this.d=r,this.tx+=t-t*r+n*i,this.ty+=n-t*i-n*r},wi.prototype.scale=function(e,t,n,r){n=n||0,r=r||0,this.a*=e,this.c*=e,this.b*=t,this.d*=t,this.tx-=n*(e-1),this.ty-=r*(t-1)};var Si=pr("mproj");function Ai(e,n){var r=s(e),i=r.crs,a=[r],o=function(e){e.internal.pj_list.mixed||e.pj_add((function(e){e.a=1}),"mixed","Mapshaper Mixed Projection");return e.pj_init("+proj=mixed")}(Si);function s(e){return{bounds:new kt(u(e.bbox)),crs:Si.pj_init(e.proj)}}function u(e){var t=Math.PI/180;return e.map((function(e){return e*t}))}return i.__mixed_crs=o,i.addFrame=function(e){var r,i,o,u=function(e,n){var r=n[e.name];return t.defaults(e,{scale:1,dx:0,dy:0,rotation:0}),r?(Object.keys(r).forEach((function(t){var n=r[t];t in e?e[t]=r[t]:e.proj=function(e,t,n){var r="+"+t+"=";return e.split(" ").map((function(e){return 0===e.indexOf(r)&&(e=e.substr(0,r.length)+n),e})).join(" ")}(e.proj,t,n)})),e):e}(e,n),c=s(u),f=new wi,l=u.origin?(r=u.origin,i=c.crs,[(o=Si.pj_fwd_deg({lam:r[0],phi:r[1]},i)).x,o.y]):[0,0],d=u.placement||[0,0],p=d[0]-l[0]+(+u.dx||0),h=d[1]-l[1]+(+u.dy||0);return u.rotation&&f.rotate(u.rotation*Math.PI/180,l[0],l[1]),u.scale&&f.scale(u.scale,u.scale,l[0],l[1]),f.translate(p,h),c.matrix=f,a.push(c),this},o.fwd=function(e,t){for(var n,r,i=0,o=a.length;i<o;i++)if((n=a[i]).bounds.containsPoint(e.lam,e.phi)){r=Si.pj_fwd(e,n.crs),n.matrix&&n.matrix.transformXY(r.x,r.y,r);break}t.x=r?r.x:1/0,t.y=r?r.y:1/0},i}function Ii(e){var t=e.trim().split(/ +/),n=[],r=t.filter((function(e){return!/^\+/.test(e)||(n.push(e.substr(1)),!1)})),i=r[0],a=Ei(n);return 1!=r.length?null:function(e,t){if("albersusa"==e)return new Mi(t);return null}(i,a)}function Mi(e){var t=e||{},n=new Ai({proj:"+proj=aea +lon_0=-96 +lat_0=37.5 +lat_1=29.5 +lat_2=45.5",bbox:[-129,23,-62,52]},t).addFrame({name:"AK",proj:"+proj=aea +lat_1=55 +lat_2=70 +lat_0=65 +lon_0=-148 +x_0=0 +y_0=0",bbox:[-172.26,50.89,-127,73.21],origin:[-152,63],placement:[-1882782,-969242],scale:.37}).addFrame({name:"HI",proj:"+proj=aea +lat_1=19 +lat_2=24 +lat_0=20.9 +lon_0=-156.5 +x_0=0 +y_0=0",bbox:[-160.5,18.72,-154.57,22.58],origin:[-157,21],placement:[-1050326,-1055362]});return t.PR&&n.addFrame({name:"PR",proj:"+proj=aea +lat_1=18 +lat_2=18.43 +lat_0=17.83 +lon_0=-66.43 +x_0=0 +y_0=0",bbox:[-68.092,17.824,-65.151,18.787],origin:[-66.431,18.228],placement:[1993101,-1254517]}),t.VI&&n.addFrame({name:"VI",proj:"+proj=aea +lat_1=18 +lat_2=18.43 +lat_0=17.83 +lon_0=-66.43 +x_0=0 +y_0=0",bbox:[-65.104,17.665,-64.454,18.505],origin:[-66.431,18.228],placement:[1993101,-1254517]}),n}function Ei(e){var n={};return e.forEach((function(e){!function(e,n){var r=e.split("="),i=r[0].split("."),a=i.pop(),o=i.reduce((function(e,n){if(n in e==!1)e[n]={};else if(!t.isObject(e[n]))return{};return e[n]}),n);r.length>1?o[a]=function(e){var n;if(e.indexOf(",")>0)return n=e.split(",").map(parseFloat);n=t.parseNumber(e),null===n&&(n=e);return n}(r[1]):a in o!=!1||i.length||(o[a]={})}(e,n)})),n}var Pi=Object.freeze({__proto__:null,parseCustomProjection:Ii,AlbersUSA:Mi,parseCustomParams:Ei});function ji(e){return[-180+(e=t.isFiniteNumber(e)?e:1e-10),-90+e,180-e,90-e]}function Oi(e){var t=ji(-1),n=e instanceof kt?e.toArray():e;return $n.containsBounds(t,n)}function ki(e){var t=e instanceof kt?e.toArray():e;return(new kt).setBounds(Math.max(t[0],-180),Math.max(t[1],-90),Math.min(t[2],180),Math.min(t[3],90))}function Fi(e){for(var t=e-180;t<=-180;)t+=360;return t}var zi=Object.freeze({__proto__:null,getWorldBounds:ji,probablyDecimalDegreeBounds:Oi,clampToWorldBounds:ki,getAntimeridian:Fi}),Ci=pr("mproj"),Ni=null,Ti={robinson:"+proj=robin +datum=WGS84",webmercator:"+proj=merc +a=6378137 +b=6378137",wgs84:"+proj=longlat +datum=WGS84",albersusa:Mi};async function Li(e){Ni&&await Ni(e)}function Bi(e,t){var n=ta(e);return t=t.__mixed_crs||t,function(r,i){var a;return n&&(r<-180?r=-180:r>180&&(r=180)),a=[r,i],Ci.pj_transform_point(e,t,a),a}}function Di(e,t){var n=[0],r=[0],i=e.is_latlong?Ci.internal.DEG_TO_RAD:1,a=t.is_latlong?Ci.internal.RAD_TO_DEG:1,o=ta(e);return function(s,u){var c;o&&(s<-180?s=-180:s>180&&(s=180)),n[0]=s*i,r[0]=u*i;try{t=t.__mixed_crs||t,Ci.pj_transform(e,t,n,r),c=n[0]==1/0}catch(e){c=!0}return c?null:[n[0]*a,r[0]*a]}}function Ui(e){var t,n;try{(t=Qi(e))&&(n=Ri(t))}catch(e){}return n||"[unknown]"}function Ri(e){return Ci.internal.get_proj_defn(e)}function qi(e){var t;try{t=Ci.internal.wkt_from_proj4(e)}catch(e){}return t}function $i(e,t){var n=Ri(e);return!!n&&n==Ri(t)}function Vi(e){return e in Ti}function Gi(e){var n;return e=e.replace(/(^| )([\w]+)($| )/,(function(e,t,n,r){return n in Ci.internal.pj_list?t+"+proj="+n+r:e})),Ji(e)?n=e:Vi(e)?(n=Ti[e],t.isFunction(n)&&(n=n())):n=function(e){return/^(esri|epsg|nad83|nad27):[0-9]+$/i.test(String(e))}(e)?"+init="+e.toLowerCase():e in(i("defs")||{})?i("defs")[e]:Ii(e),n||pt("Unknown projection definition:",e),n}function Ji(e){return/^(\+[^ ]+ *)+$/.test(e)}function Wi(e){return{crs_string:e,crs:Yi(e)}}function Yi(e){var n,r=Gi(e);if(t.isString(r))try{n=Ci.pj_init(r)}catch(e){pt("Unable to use projection",r,"("+e.message+")")}else n=r;return n||null}function Hi(e){ta(Qi(e))&&pt("Command requires a target with projected coordinates (not lat-long)")}function Xi(e,t){return t=t||{},e.info=e.info||{},e.info.crs=t.crs,e.info.prj=t.prj,e.info.crs_string=t.crs_string,e}function Zi(e){var t=e.info||{},n=t.crs,r=t.crs_string;return!n&&t.prj&&(n=Yi(ia(t.prj))),!n&&Oi($a(e))&&(n=Yi(r="wgs84")),{crs:n||null,crs_string:r,prj:t.prj}}function Qi(e){return Zi(e).crs}function Ki(e){e.reduce((function(e,t){var n=Qi(t);return e&&n&&ta(e)!=ta(n)&&pt("Unable to combine projected and unprojected datasets"),n||e}),null)}function ea(e,t,n){var r=Ci.pj_inv_deg({x:e,y:t},n),i=Ci.pj_inv_deg({x:e+1,y:t},n);return 1/$n.greatCircleDistance(r.lam,r.phi,i.lam,i.phi)}function ta(e){return e&&e.is_latlong||!1}function na(e){return ta(Qi(e))}function ra(){var e=Ci.internal.pj_list,n="Proj4 projections\n";Object.keys(e).sort().forEach((function(r){n+="  "+t.rpad(r,7," ")+"  "+e[r].name+"\n"})),n+="\nAliases",Object.keys(Ti).sort().forEach((function(e){n+="\n  "+e})),vt(n)}function ia(e){var t;try{t=Ci.internal.wkt_to_proj4(e)}catch(e){pt("Unusable .prj file ("+e.message+")")}return t}function aa(e){return Yi(ia(e))}var oa=Object.freeze({__proto__:null,initProjLibrary:Li,setProjectionLoader:function(e){Ni=e},findProjLibs:function(e){var n=e.match(/\b(esri|epsg|nad83|nad27)(?=:[0-9]+\b)/gi)||[];return t.uniq(n.map((function(e){return e.toLowerCase()})))},getProjTransform:Bi,getProjTransform2:Di,toLngLat:function(e,t){return ta(t)?e.concat():Bi(t,Yi("wgs84"))(e[0],e[1])},getProjInfo:Ui,crsToProj4:Ri,crsToPrj:qi,crsAreEqual:$i,isProjAlias:Vi,getProjDefn:Gi,looksLikeProj4String:Ji,getCrsInfo:Wi,parseCrsString:Yi,requireProjectedDataset:Hi,setDatasetCrsInfo:Xi,getDatasetCrsInfo:Zi,getDatasetCRS:Qi,requireDatasetsHaveCompatibleCRS:Ki,getScaleFactorAtXY:ea,isProjectedCRS:function(e){return!ta(e)},isInvertibleCRS:function(e){return!(!e||!e.inv)},isLatLngCRS:ta,isWGS84:function(e){return!!ta(e)&&Ri(e).toLowerCase().includes("84")},isWebMercator:function(e){if(!e)return!1;var t=Ri(e);return t.includes("+proj=merc")&&t.includes("+a=6378137")&&t.includes("+b=6378137")},isLatLngDataset:na,printProjections:ra,translatePrj:ia,parsePrj:aa});function sa(e){var t=e.length,n=0,r={x:0,y:0,hasNext:function(){return!(n>=t)&&(r.x=e[n][0],r.y=e[n][1],n++,!0)}};return r}function ua(e,t){this._i=0,this._n=0,this._inc=1,this._xx=e,this._yy=t,this.i=0,this.x=0,this.y=0}function ca(e,t,n){var r=0,i=0,a=1,o=0;this.init=function(e,t,n,s){return r=s||0,n?(i=e,a=1,o=e+t):(i=e+t-1,a=-1,o=e-1),this},this.hasNext=function(){var s=n,u=i,c=u,f=r,l=o,d=a;if(u==l)return!1;do{c+=d}while(c!=l&&s[c]<f);return i=c,this.x=e[u],this.y=t[u],this.i=u,!0}}function fa(e){this._arcs=e,this._i=0,this._n=0,this.x=0,this.y=0}ua.prototype.init=function(e,t,n){return n?(this._i=e,this._inc=1):(this._i=e+t-1,this._inc=-1),this._n=t,this},ua.prototype.hasNext=function(){var e=this._i;return this._n>0&&(this._i=e+this._inc,this.x=this._xx[e],this.y=this._yy[e],this.i=e,this._n--,!0)},fa.prototype.hasNext=function(){var e=this._arc;return this._i<this._n!=!1&&(e.hasNext()?(this.x=e.x,this.y=e.y,!0):(this.nextArc(),this.hasNext()))},fa.prototype.init=function(e){return this._ids=e,this._n=e.length,this.reset(),this},fa.prototype.nextArc=function(){var e=this._i+1;e<this._n&&(this._arc=this._arcs.getArcIter(this._ids[e]),e>0&&this._arc.hasNext()),this._i=e},fa.prototype.reset=function(){this._i=-1,this.nextArc()};var la=Object.freeze({__proto__:null,PointIter:sa,ArcIter:ua,FilteredArcIter:ca,MultiShapeIter:function(e){new fa(e)},ShapeIter:fa});function da(e){var n=e.getPointCount(),r=Math.ceil(n/5e5),i=e.getRemovableThresholds(r);return t.quicksort(i,!0),function(e){var t=i.length,n=pa(e,i.length);return n<1?0:n>t?1/0:i[n-1]}}function pa(e,t){return 0===t||e>=1?0:e<=0?t+1:Math.floor((1-e)*(t+2))}function ha(e,n,r){var i=n.getRemovableThresholds(r),a=pa(e,i.length);return a<1?0:a>i.length?1/0:t.findValueByRank(i,a)}var ga=Object.freeze({__proto__:null,getThresholdFunction:da,getThresholdByPct:ha});function ma(){var e,n,r,i,a,o,s,u,c,f,l,d,p=0;function h(t,o,s){var f=t.length;t instanceof Array&&(t=new Uint32Array(t)),o instanceof Array&&(o=new Float64Array(o)),s instanceof Array&&(s=new Float64Array(s)),e=o,n=s,i=t,a=null,p=0,c=null,r=new Uint32Array(f);for(var l=0,d=0;d<f;d++)r[d]=l,l+=t[d];return l==e.length&&e.length==n.length||dt("ArcCollection#initXYData() Counting error"),m(),u=new ua(e,n),this}function g(t){t?(t.length!=e.length&&dt("ArcCollection#initZData() mismatched arrays"),t instanceof Array&&(t=new Float64Array(t)),c=new ca(e,n,a=t)):(a=null,p=0,c=null)}function m(){var t=function(e,t,n){for(var r,i,a,o=n.length,s=new Float64Array(4*o),u=new kt,c=0,f=0;f<o;f++)(r=n[f])>0&&(i=4*f,a=Bt(e,t,c,r),s[i++]=a[0],s[i++]=a[1],s[i++]=a[2],s[i]=a[3],c+=r,u.mergeBounds(a));return{bb:s,bounds:u}}(e,n,i);o=t.bb,s=t.bounds}function y(){var e=a,t=p;if(!e||!t)return this.getPointCount();for(var n=0,r=0,i=e.length;r<i;r++)e[r]>=t&&n++;return n}function v(){for(var t,r=y(),o=i.length,s=new Float64Array(r),u=new Float64Array(r),c=new Float64Array(r),f=new Int32Array(o),l=0,d=0,h=0;h<o;h++){t=0;for(var g=l+i[h];l<g;l++)a[l]>=p&&(s[d]=e[l],u[d]=n[l],c[d]=a[l],d++,t++);1==t&&dt("Collapsed arc"),f[h]=t}return{xx:s,yy:u,zz:c,nn:f}}1==arguments.length?(f=[],l=[],d=arguments[0].map((function(e){for(var t=e?e.length:0,n=0;n<t;n++)f.push(e[n][0]),l.push(e[n][1]);return t})),h(d,f,l)):3==arguments.length?h.apply(this,arguments):dt("ArcCollection() Invalid arguments"),this.updateVertexData=function(e,t,n,r){h(e,t,n),g(r||null)},this.getVertexData=function(){return{xx:e,yy:n,zz:a,bb:o,nn:i,ii:r}},this.getCopy=function(){var t=new ma(new Int32Array(i),new Float64Array(e),new Float64Array(n));return a&&(t.setThresholds(new Float64Array(a)),t.setRetainedInterval(p)),t},this.getFilteredCopy=function(){if(!a||0===p)return this.getCopy();var e=v(),t=new ma(e.nn,e.xx,e.yy);return t.setThresholds(e.zz),t},this.toArray=function(){var e=[];return this.forEach((function(t){for(var n=[];t.hasNext();)n.push([t.x,t.y]);e.push(n)})),e},this.toJSON=function(){return this.toArray()},this.forEachArcSegment=function(t,o){for(var s=t>=0,u=s?t:~t,c=this.getRetainedInterval(),f=i[u],l=s?1:-1,d=s?r[u]:r[u]+f-1,p=d,h=e,g=n,m=a,y=0,v=1;v<f;v++)p+=l,(0===c||m[p]>=c)&&(o(d,p,h,g),d=p,y++);return y},this.forEachSegment=function(e){for(var t=0,n=0,r=this.size();n<r;n++)t+=this.forEachArcSegment(n,e);return t},this.transformPoints=function(t){for(var r,a=e,o=n,s=-1,u=0,c=0,f=a.length;c<f;c++,u--){for(;0===u;)u=i[++s];(r=t(a[c],o[c],s))&&(a[c]=r[0],o[c]=r[1])}m()},this.forEach=function(e){for(var t=0,n=this.size();t<n;t++)e(this.getArcIter(t),t)},this.forEach2=function(t){for(var o=0,s=this.size();o<s;o++)t(r[o],i[o],e,n,a,o)},this.forEach3=function(t){for(var o,s,u,c,f,l=0,d=this.size();l<d;l++)s=(o=r[l])+i[l],u=e.subarray(o,s),c=n.subarray(o,s),a&&(f=a.subarray(o,s)),t(u,c,f,l)},this.filter=function(e){var t=function(t){return e(this.getArcIter(t),t)}.bind(this);return this.deleteArcs(t)},this.deleteArcs=function(o){for(var s=this.size(),u=new Int32Array(s),c=0,f=0;f<s;f++)o(f)?(u[f]=c++,i[f]):u[f]=-1;return c<s&&function(o){for(var s,u,c=0,f=0,l=t.copyElements,d=0,p=o.length;d<p;d++)s=o[d],u=i[d],s>-1&&(l(e,r[d],e,c,u),l(n,r[d],n,c,u),a&&l(a,r[d],a,c,u),i[s]=u,c+=u,f++);h(i.subarray(0,f),e.subarray(0,c),n.subarray(0,c)),a&&g(a.subarray(0,c))}(u),u},this.dedupCoords=function(){for(var t,r,o=0,s=0,u=0,c=this.size(),f=a;o<c;)r=ya(s,u,t=i[o],e,n,f),i[o]=r,s+=t,u+=r,o++;return s>u&&(h(i,e.subarray(0,u),n.subarray(0,u)),f&&g(f.subarray(0,u))),s-u},this.getVertex=function(t,r){var i=this.indexOfVertex(t,r);return{x:e[i],y:n[i]}},this.getVertex2=function(t){return[e[t],n[t]]},this.indexOfVertex=function(e,t){var n=e<0?~e:e,a=i[n];return t<0&&(t=a+t),n!=e&&(t=a-t-1),(t<0||t>=a)&&dt("[ArcCollection] out-of-range vertex id"),r[n]+t},this.arcIsClosed=function(t){var r=this.indexOfVertex(t,0),i=this.indexOfVertex(t,-1);return r!=i&&e[r]==e[i]&&n[r]==n[i]},this.arcIsLollipop=function(t){var r,i;return!(this.getArcLength(t)<=2||!this.arcIsClosed(t))&&(r=this.indexOfVertex(t,1),i=this.indexOfVertex(t,-2),e[r]==e[i]&&n[r]==n[i])},this.arcIsDegenerate=function(e){for(var t,n,r=this.getArcIter(e),i=0;r.hasNext();){if(i>0&&(t!=r.x||n!=r.y))return!1;t=r.x,n=r.y,i++}return!0},this.getArcLength=function(e){return i[Lt(e)]},this.getArcIter=function(e){var t=e>=0,n=t?e:~e,o=a&&p?c:u;return n>=i.length&&dt("#getArcId() out-of-range arc id:",e),o.init(r[n],i[n],t,p)},this.getShapeIter=function(e){return new fa(this).init(e)},this.setThresholds=function(e){var t=this.getPointCount(),n=null;return e&&(e.length==t?n=e:e.length==this.size()?n=function(e,t){var n=new Float64Array(t),r=0;e.forEach((function(e){for(var t=0,i=e.length;t<i;r++,t++)n[r]=e[t]})),r!=t&&dt("Mismatched thresholds");return n}(e,t):dt("Invalid threshold data")),g(n),this},this.flatten=function(){if(p>0){var e=v();this.updateVertexData(e.nn,e.xx,e.yy),p=0}else a=null},this.isFlat=function(){return!a},this.getRetainedInterval=function(){return p},this.setRetainedInterval=function(e){return p=e,this},this.getRetainedPct=function(){return this.getPctByThreshold(p)},this.setRetainedPct=function(e){return p=e>=1?0:Xn(p=this.getThresholdByPct(e),e),this},this.getRemovableThresholds=function(e){a||dt("[arcs] Missing simplification data.");for(var t,n=1|e,r=new Float64Array(Math.ceil(a.length/n)),i=0,o=0,s=this.getPointCount();i<s;i+=n)(t=a[i])!=1/0&&(r[o++]=t);return r.subarray(0,o)},this.getArcThresholds=function(e){e>=0&&e<this.size()||dt("[arcs] Invalid arc id:",e);var t=r[e],n=t+i[e];return a.subarray(t,n)},this.getPctByThreshold=function(e,n){var r,i,a;return e>0?(r=this.getRemovableThresholds(n),i=t.findRankByValue(r,e),a=r.length>0?1-(i-1)/r.length:1):a=1,a},this.getThresholdByPct=function(e,t){return ha(e,this,t)},this.arcIntersectsBBox=function(e,t){var n=o,r=4*e;return n[r]<=t[2]&&n[r+2]>=t[0]&&n[r+3]>=t[1]&&n[r+1]<=t[3]},this.arcIsContained=function(e,t){var n=o,r=4*e;return n[r]>=t[0]&&n[r+2]<=t[2]&&n[r+1]>=t[1]&&n[r+3]<=t[3]},this.arcIsSmaller=function(e,t){var n=o,r=4*e;return n[r+2]-n[r]<t&&n[r+3]-n[r+1]<t},this.isPlanar=function(){return!Oi(this.getBounds())},this.size=function(){return r&&r.length||0},this.getPointCount=function(){return e&&e.length||0},this.getFilteredPointCount=y,this.getBounds=function(){return s.clone()},this.getSimpleShapeBounds=function(e,t){t=t||new kt;for(var n=0,r=e.length;n<r;n++)this.mergeArcBounds(e[n],t);return t},this.getSimpleShapeBounds2=function(e,t){var n=t||[],r=o,i=4*Lt(e[0]);n[0]=r[i],n[1]=r[++i],n[2]=r[++i],n[3]=r[++i];for(var a=1,s=e.length;a<s;a++)r[i=4*Lt(e[a])]<n[0]&&(n[0]=r[i]),r[++i]<n[1]&&(n[1]=r[i]),r[++i]>n[2]&&(n[2]=r[i]),r[++i]>n[3]&&(n[3]=r[i]);return n},this.getMultiShapeBounds=function(e,t){if(t=t||new kt,e)for(var n=0,r=e.length;n<r;n++)this.getSimpleShapeBounds(e[n],t);return t},this.mergeArcBounds=function(e,t){e<0&&(e=~e);var n=4*e;t.mergeBounds(o[n],o[n+1],o[n+2],o[n+3])}}function ya(e,t,n,r,i,a){for(var o,s,u,c,f,l=0,d=0;l<n;)o=r[c=e+l],s=i[c],(f=o==o&&s==s&&(0===d||o!=r[c-1]||s!=i[c-1]))&&(r[u=t+d]=o,i[u]=s,d++),a&&d>0&&(f||a[c]>a[u])&&(a[u]=a[c]),l++;return d>1?d:0}function va(e){var t=new ArrayBuffer(16),n=new Float64Array(t),r=new Uint32Array(t),i=0|e;if(i>0==!1)throw new Error("Invalid size param: "+e);return function(e,t){var a,o=r;return n[0]=e,n[1]=t,(2147483647&(a=(a=o[0]^o[1])<<5^a>>7^o[2]^o[3]))%i}}function ba(e){var n=Math.floor(.25*e+1),r=va(n),i=new Int32Array(n),a=[],o=[],s=0;function u(e,t,n,s,u){for(var c,f,l,d=u(n),p=r(e[n],t[n]),h=i[p];-1!=h;){if(c=o[h][0],f=o[h][1],l=c.length,c[0]===e[s]&&c[l-1]===e[n]&&c[l-2]===e[d]&&f[0]===t[s]&&f[l-1]===t[n]&&f[l-2]===t[d])return h;h=a[h]}return null}t.initializeArray(i,-1),this.addArc=function(e,t){var n=e.length-1,u=r(e[n],t[n]),c=i[u],f=o.length;return i[u]=f,o.push([e,t]),s+=e.length,a.push(c),f},this.findDuplicateArc=function(e,t,n,r,i,a){var o=u(e,t,n,r,i);return o=null===o?u(e,t,r,n,a):~o},this.getVertexData=function(){for(var e,n,r=new Float64Array(s),i=new Float64Array(s),a=new Uint32Array(o.length),u=0,c=0,f=o.length;c<f;c++)n=(e=o[c])[0].length,t.copyElements(e[0],0,r,u,n),t.copyElements(e[1],0,i,u,n),a[c]=n,u+=n;return{xx:r,yy:i,nn:a}}}function xa(e,t){for(var n,r,i,a,o=function(e,t){var n,r,i,a,o,s=e.length,u=Math.floor(1.3*s)||1,c=va(u),f=new Int32Array(u),l=new Int32Array(s);for(i=0;i<s;i++)a=e[i],o=t[i],a!=a||o!=o?r=-1:(r=f[n=c(a,o)]-1,f[n]=i+1),l[i]=r>=0?r:i;return l}(e,t),s=e.length-1;s>=0;s--)if(!((r=o[s])>=s)){i=s,a=-1;do{r=o[n=r],t[n]==t[s]&&e[n]==e[s]?(o[n]=i,i=n):(a>-1&&(o[a]=n),a=n)}while(r<n);a>-1&&(o[a]=a),o[s]=i}return o}function _a(e){if(e.arcs){var t=e.arcs.getVertexData(),n=wa(t.nn,t.xx,t.yy);e.arcs.updateVertexData(n.nn,n.xx,n.yy),e.layers.forEach((function(e){"polyline"!=e.geometry_type&&"polygon"!=e.geometry_type||(e.shapes=function(e,t){return e.map((function(e){return n(e,t)}));function n(e,t){return e?e.map((function(e){return r(e,t)})):null}function r(e,t){return e.reduce((function(e,n){var r=Lt(n),i=t[r];if(i){n<0&&Hn(i=i.concat());for(var a=0,o=i.length;a<o;a++)e.push(i[a])}return e}),[])}}(e.shapes,n.paths))}))}}function wa(e,t,n){var r,i,a=t.length,o=xa(t,n),s=function(e,t){for(var n=new Int32Array(e),r=0,i=0,a=t.length;i<a;i++)for(var o=0,s=t[i];o<s;o++,r++)n[r]=i;return n}(a,e),u=new ba(a),c=f()?t.subarray:Array.prototype.slice;return r=function(e){for(var t,n=[],r=0,i=0,a=e.length;i<a;i++)t=e[i],n.push(t<2?null:h(r,r+t-1)),r+=t;return n}(e),(i=u.getVertexData()).paths=r,i;function f(){return!(!t.subarray||!n.subarray)}function l(t){var n=s[t],r=t+1;if(r<a&&s[r]===n)return t+1;var i=e[n];return p(t,t-i+1)?t-i+2:-1}function d(t){var n=s[t],r=t-1;if(r>=0&&s[r]===n)return t-1;var i=e[n];return p(t,t+i-1)?t+i-2:-1}function p(e,r){return t[e]==t[r]&&n[e]==n[r]}function h(r,i){for(var a,c=[],f=-1,p=r;p<i;p++)g(p)&&(f>-1?c.push(v(a,p)):f=p,a=p);return-1==f?c.push(function(r,i){var a,c=o[r],f=s[r];for(;c!=r&&!(s[c]<f);)c=o[c];if(c==r)return v(r,i);for(var p=r;p<i;p++)if(null!==(a=u.findDuplicateArc(t,n,p,p,l,d)))return a;dt("Unmatched ring; id:",f,"len:",e[f])}(r,i)):f==r?(g(i)||dt("Topology error"),c.push(v(a,p))):c.push(function(e,r,i,a){var o=u.findDuplicateArc(t,n,e,a,l,d);null===o&&(o=u.addArc(y(t,e,r,i,a),y(n,e,r,i,a)));return o}(a,i,r+1,f)),c}function g(e){var t,n,r=o[e],i=d(e),a=l(e);if(-1==i||-1==a)return!0;for(;e!=r;){if(t=d(r),n=l(r),-1==t||-1==n||m(i,a,t,n))return!0;r=o[r]}return!1}function m(e,r,i,a){var o=t[e],s=t[r],u=t[i],c=t[a],f=n[e],l=n[r],d=n[i],p=n[a];return!(o==c&&s==u&&f==p&&l==d||o==u&&s==c&&f==d&&l==p)}function y(e,t,n,r,i){var a,o=n-t+i-r+2,s=new(f()?Float64Array:Array)(o),u=0;for(a=t;a<=n;a++)s[u++]=e[a];for(a=r;a<=i;a++)s[u++]=e[a];return s}function v(e,r){var i=u.findDuplicateArc(t,n,e,r,l,d);return null===i&&(i=u.addArc(c.call(t,e,r+1),c.call(n,e,r+1))),i}}var Sa=Object.freeze({__proto__:null,buildTopology:_a,buildPathTopology:wa});function Aa(e,t){var n=Ea([e].concat(t)),r=t.reduce((function(e,t){return e.concat(t.layers)}),[]);return e.arcs=n.arcs,r}function Ia(e){return Ea(e.map((function(e){return t.defaults({layers:e.layers.map(gi)},e)})))}function Ma(e,t){var n,r=[],i=[],a=0;return e.forEach((function(e){r=r.concat(e.layers),i=i.concat(e.dataset),e.dataset.arcs&&e.dataset.arcs.size()>0&&a++})),n=Ea(i),a>1&&_a(n),i.forEach(t.removeDataset),t.addDataset(n),t.setDefaultTarget(r,n),[{layers:r,dataset:n}]}function Ea(e){var t=[],n=0,r={info:{},layers:[]};return Ki(e),e.forEach((function(e){var i=e.arcs?e.arcs.size():0;i>0&&t.push(e.arcs),Pa(r,e),e.layers.forEach((function(e){"polygon"!=e.geometry_type&&"polyline"!=e.geometry_type||Qn(e.shapes,(function(e){return e<0?e-n:e+n})),r.layers.push(e)})),n+=i})),t.length>0&&(r.arcs=ja(t),r.arcs.size()!=n&&dt("[mergeDatasets()] Arc indexing error")),r}function Pa(e,n){var r=n.info||{},i=e.info||(e.info={});i.input_files=t.uniq((i.input_files||[]).concat(r.input_files||[])),i.input_formats=t.uniq((i.input_formats||[]).concat(r.input_formats||[])),t.defaults(i,r)}function ja(e){var n=e.map((function(e){return e.getRetainedInterval()>0&&(bt("Baking-in simplification setting."),e.flatten()),e.getVertexData()})),r=Oa(t.pluck(n,"xx"),Float64Array),i=Oa(t.pluck(n,"yy"),Float64Array);return new ma(Oa(t.pluck(n,"nn"),Int32Array),r,i)}function Oa(e,t){var n=function(e){return e.reduce((function(e,t){return e+(t.length||0)}),0)}(e),r=new(t||Array)(n),i=0;return e.forEach((function(e){for(var t=e.length,n=0;n<t;n++)r[n+i]=e[n];i+=t})),r}var ka=Object.freeze({__proto__:null,mergeDatasetsIntoDataset:Aa,mergeDatasetsForExport:Ia,mergeCommandTargets:Ma,mergeDatasets:Ea,mergeDatasetInfo:Pa,mergeArcs:ja});function Fa(e,t){var n=new Uint8Array(t.size());function r(e){ur(e,i)}function i(e){a(~e[0]),a(e[e.length-1])}function a(e){var t=Lt(e),r=t==e;n[t]|=r?1:2}return e.forEach((function(e){Zr(e)&&e.shapes.forEach(r)})),function(e){var t=Lt(e),r=t==e,i=n[t];return r?1==(1&i):2==(2&i)}}var za=Object.freeze({__proto__:null,getPathEndpointTest:Fa});function Ca(e,n){Array.isArray(e)&&(e=new ma(e));var r,i=e.getVertexData(),a=i.nn,o=i.xx,s=i.yy;function u(e){return c(e)?null:[r.xx[e],r.yy[e]]}function c(e){return isNaN(r.xx[e])}function f(e){var t=d(e),n=p(),i=n[t],a=function(e){var t=p(),n=e,r=t[e];for(;r!=e;)n=r,(r=t[r])==n&&dt("Node indexing error");return n}(t);r.xx[t]=NaN,r.yy[t]=NaN,n[t]=t,n[a]=i}function l(e){var t=e>>1;return!0&e?t:~t}function d(e){return e>=0?2*e+1:2*~e}function p(){return r||(r=function(e,t){var n=2*e.size(),r=new Float64Array(n),i=new Float64Array(n),a=new Int32Array(n);e.forEach2((function(e,n,o,s,u,c){var f=e,l=e+n-1,d=2*c,p=d+1,h=o[f],g=s[f],m=o[l],y=s[l];t&&!t(c)&&(h=g=m=y=NaN),r[d]=h,i[d]=g,a[d]=c,r[p]=m,i[p]=y,a[p]=c}));var o=xa(r,i);return{xx:r,yy:i,ids:a,chains:o}}(e,n),2*a.length!=r.chains.length&&dt("[NodeCollection] count error")),r.chains}function h(e,t){var n=t>=0?t:~t,r=a[e>=0?e:~e];return!(r<2)&&(r==a[n]&&!!(g(e,t,-1)&&g(e,t,1)&&g(e,t,-2)))}function g(t,n,r){var i=e.indexOfVertex(t,r),a=e.indexOfVertex(n,r);return o[i]==o[a]&&s[i]==s[a]}function m(e){var t=d(e),n=p(),r=n[t];return r>=0&&r<n.length||dt("out-of-range chain id"),l(r)}Object.defineProperty(this,"arcs",{value:e}),this.toArray=function(){var e=p(),n=new Uint8Array(e.length),r=[];return t.forEach(e,(function(t,i){var a,o;if(1!=n[i]&&(o=u(i)))for(a={coordinates:o,arcs:[]},r.push(a);1!=n[i];)a.arcs.push(l(i)),n[i]=1,i=e[i]})),r},this.size=function(){return this.toArray().length},this.findDanglingEndpoints=function(){for(var e,t=p(),n=[],r=0,i=t.length;r<i;r++)t[r]==r&&(e=u(r))&&n.push({point:e,arc:l(r)});return n},this.detachAcyclicArcs=function(){for(var e,t,n=p(),r=0,i=0,a=n.length;i<a;i+=2)e=i==n[i],t=i+1==n[i+1],!e&&!t||c(i)||(this.detachArc(l(i)),r++);return r>0&&(r+=this.detachAcyclicArcs()),r},this.detachArc=function(e){f(e),f(~e)},this.forEachConnectedArc=function(e,t){for(var n=m(e),r=0;n!=e;)t(n,r++),n=m(n)},this.getConnectedArcs=function(e,t){var n=[],r=!!t,i=m(e);for(r&&t(e);i!=e;)r&&!t(i)||n.push(i),i=m(i);return n},this.findDuplicateArc=function(e){for(var t=m(e),n=e;t!=e;)h(e,t)&&Lt(t)<Lt(n)&&(n=t),t=m(t);return n},this.internal={testArcMatch:h,testVertexMatch:g}}function Na(e){var n=e.arcs,r=e.layers.filter(Zr);if(n&&r.length){var i=Ta(r,n),a=[],o=0,s=new Int32Array(n.size()),u=new Uint8Array(n.size());r.forEach((function(e){e.shapes=e.shapes.map((function(e){return fr(e&&e.concat(),c)}))})),e.arcs=function(e,n,r){var i=new Uint32Array(n.length),a=new Float64Array(r),o=new Float64Array(r),s=e.getVertexData(),u=s.zz?new Float64Array(r):null,c=e.getRetainedInterval(),f=0;return n.forEach((function(e,t){e.forEach((function(e,n){l(e,t)}))})),new ma(i,a,o).setThresholds(u).setRetainedInterval(c);function l(e,n){var r=Lt(e),c=e<0,l=s.nn[r],d=s.ii[r],p=i[n];l>0&&(p>0&&(l--,c||d++),t.copyElements(s.xx,d,a,f,l,c),t.copyElements(s.yy,d,o,f,l,c),u&&t.copyElements(s.zz,d,u,f,l,c),i[n]+=l,f+=l)}}(n,a,o)}else e.arcs=null;function c(e){for(var t,r,c,f,l,d,p=0,h=[],g=0,m=e.length;g<m;g++)l=(r=e[g])===(c=Lt(r)),n.arcIsDegenerate(r)||(0!==u[c]?t=null:(f=n.getArcLength(r),t&&i(e[g-1],r)?(f>0&&f--,t.push(r),u[c]=1):(t=[r],s[c]=a.length,a.push(t),u[c]=l?2:3),p+=f)),u[c]>1&&(d=s[c],(l&&3==u[c]||!l&&2==u[c])&&(d=~d),h.push(d));return o+=p,h}}function Ta(e,t){var n,r,i=new Ca(t,yi(e,t)),a=Fa(e.filter((function(e){return"polyline"==e.geometry_type})),t);return function(e,t){return e==t||e==~t?(bt("Unexpected arc sequence:",e,t),!1):(n=0,i.forEachConnectedArc(e,o),1==n&&r==~t&&!a(e)&&!a(~t))};function o(e,t){n++,r=e}}var La=Object.freeze({__proto__:null,dissolveArcs:Na,getArcDissolveTest:Ta});function Ba(e){return e.layers.map((function(n){var r={arcs:e.arcs,layers:[n],info:t.extend({},e.info)};return Na(r),r}))}function Da(e,n){var r=[];return e.layers=e.layers.filter((function(i){if(!n.includes(i))return!0;var a={arcs:e.arcs,layers:[i],info:t.extend({},e.info)};return Na(a),r.push(a),!1})),e.layers.length&&(Na(e),r.push(e)),r}function Ua(e){var n=t.extend({},e);return n.layers=n.layers.map(hi),n.arcs&&(n.arcs=n.arcs.getFilteredCopy()),n}function Ra(e){var n=t.extend({},e);return n.layers=n.layers.map(gi),n.arcs&&(n.arcs=n.arcs.getFilteredCopy()),n}function qa(e){return t.defaults({layers:e.layers.map((function(e){return t.extend({},e)}))},e)}function $a(e){var t=new kt;return e.layers.forEach((function(n){var r=bi(n,e.arcs);r&&t.mergeBounds(r)})),t}function Va(e){return t.some(e.layers,(function(e){return Xr(e)}))}function Ga(e){return t.some(e.layers,(function(e){return Zr(e)}))}function Ja(e){if(e.arcs&&!t.some(e.layers,Zr))return e.arcs=null,!0}function Wa(e){Ja(e),e.arcs&&Na(e)}function Ya(e,n,r){var i=e.layers.concat();t.repeat(Math.max(n.length,r.length),(function(e){var t=n[e],a=r[e],o=t?i.indexOf(t):i.length;t&&i.splice(o,1),a&&i.splice(o,0,a)})),e.layers=i}function Ha(e,t,n){Zr(Xa(e,t,n,{}))&&_a(t)}function Xa(e,t,n,r){n&&1==n.layers.length||dt("Invalid source dataset"),!1===t.layers.includes(e)&&dt("Invalid target layer");var i=Aa(t,[n])[0];return!i.data&&e.data&&ti(i)==e.data.size()&&(i.data=r.no_replace?e.data.clone():e.data),r.no_replace||(i=Object.assign(e,{data:null,shapes:null},i),Zr(e)&&Na(t)),i.name=r.name||i.name,i}function Za(e,t){e.arcs&&e.arcs.transformPoints(t),e.layers.forEach((function(e){Qr(e)&&ei(e,t)}))}var Qa=Object.freeze({__proto__:null,splitDataset:Ba,mergeDatasetInfo:function(e,n){var r=n.info||{},i=e.info||(e.info={});i.input_files=t.uniq((i.input_files||[]).concat(r.input_files||[])),i.input_formats=t.uniq((i.input_formats||[]).concat(r.input_formats||[])),t.defaults(i,r)},splitApartLayers:Da,copyDataset:Ua,copyDatasetForExport:Ra,copyDatasetForRenaming:qa,getDatasetBounds:$a,datasetHasGeometry:Va,datasetHasPaths:Ga,cleanupArcs:Ja,pruneArcs:Wa,replaceLayers:Ya,replaceLayerContents:Ha,mergeOutputLayerIntoDataset:Xa,transformPoints:Za});function Ka(e){var t={filename:"",directory:"",basename:"",extension:""},n=function(e){return-1==e.indexOf("/")&&-1!=e.indexOf("\\")?"\\":"/"}(e),r=e.split(n),i=r.pop(),a=/\.([a-z][a-z0-9]*)$/i,o=a.test(i)?a.exec(i)[0]:"";return o||i.includes("*")?(t.filename=i,t.extension=o?o.slice(1):"",t.basename=i.slice(0,i.length-o.length),t.directory=r.join(n)):t.directory=i?e:r.join(n),t}function eo(e){return Ka(e).basename}function to(e){return Ka(e).extension}function no(e){var t=Ka(e);return t.extension?e.slice(0,e.length-t.extension.length-1):e}function ro(e,t){var n=no(e);return t?n+"."+t:n}function io(e){var t=to(e);return t?no(e)+"."+t.toLowerCase():e}function ao(e){return e.reduce((function(e,n,r){return e=0===r?eo(n):t.mergeNames(e,n)}),"")}function oo(e){var t=e.info&&e.info.input_files;return t&&ao(t)||"output"}var so,uo,co,fo=Object.freeze({__proto__:null,parseLocalPath:Ka,getFileBase:eo,getFileExtension:to,getPathBase:no,replaceFileExtension:ro,toLowerCaseExtension:io,getCommonFileBase:ao,getOutputFileBase:oo});try{so=new TextDecoder}catch(dt){}var lo,po,ho,go,mo,yo=0,vo={},bo=0,xo=0,_o=[],wo={useRecords:!1,mapsAsObjects:!0};class So{}const Ao=new So;Ao.name="MessagePack 0xC1";var Io=!1,Mo=2;try{new Function("")}catch(dt){Mo=1/0}class Eo{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.sequential&&!1!==e.trusted&&(e.trusted=!0,e.structures||0==e.useRecords||(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(uo)return Ko((()=>(es(),this?this.unpack(e,t):Eo.prototype.unpack.call(wo,e,t))));"object"==typeof t?(co=t.end||e.length,yo=t.start||0):(yo=0,co=t>-1?t:e.length),xo=0,po=null,ho=null,uo=e;try{mo=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(uo=null,e instanceof Uint8Array)throw t;throw new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof Eo){if(vo=this,this.structures)return lo=this.structures,Po(t);(!lo||lo.length>0)&&(lo=[])}else vo=wo,(!lo||lo.length>0)&&(lo=[]);return Po(t)}unpackMultiple(e,t){let n,r=0;try{Io=!0;let i=e.length,a=this?this.unpack(e,i):ns.unpack(e,i);if(!t){for(n=[a];yo<i;)r=yo,n.push(Po());return n}if(!1===t(a))return;for(;yo<i;)if(r=yo,!1===t(Po()))return}catch(e){throw e.lastPosition=r,e.values=n,e}finally{Io=!1,es()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map((e=>e.slice(0))));for(let t=0,n=e.length;t<n;t++){let n=e[t];n&&(n.isShared=!0,t>=32&&(n.highByte=t-32>>5))}e.sharedLength=e.length;for(let n in t||[])if(n>=0){let r=e[n],i=t[n];i&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[n]=r),e[n]=i)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function Po(e){try{if(!vo.trusted&&!Io){let e=lo.sharedLength||0;e<lo.length&&(lo.length=e)}let e;if(vo.randomAccessStructure&&uo[yo]<64&&uo[yo],e=Oo(),ho&&(yo=ho.postBundlePosition,ho=null),yo==co)lo&&lo.restoreStructures&&jo(),lo=null,uo=null,go&&(go=null);else{if(yo>co)throw new Error("Unexpected end of MessagePack data");if(!Io)throw new Error("Data read, but end of buffer not reached "+JSON.stringify(e).slice(0,100))}return e}catch(e){throw lo&&lo.restoreStructures&&jo(),es(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||yo>co)&&(e.incomplete=!0),e}}function jo(){for(let e in lo.restoreStructures)lo[e]=lo.restoreStructures[e];lo.restoreStructures=null}function Oo(){let e=uo[yo++];if(e<160){if(e<128){if(e<64)return e;{let t=lo[63&e]||vo.getStructures&&Co()[63&e];return t?(t.read||(t.read=Fo(t,63&e)),t.read()):e}}if(e<144){if(e-=128,vo.mapsAsObjects){let t={};for(let n=0;n<e;n++){let e=Ho();"__proto__"===e&&(e="__proto_"),t[e]=Oo()}return t}{let t=new Map;for(let n=0;n<e;n++)t.set(Oo(),Oo());return t}}{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Oo();return vo.freezeData?Object.freeze(t):t}}if(e<192){let t=e-160;if(xo>=yo)return po.slice(yo-bo,(yo+=t)-bo);if(0==xo&&co<140){let e=t<16?Vo(t):$o(t);if(null!=e)return e}return No(t)}{let t;switch(e){case 192:return null;case 193:return ho?(t=Oo(),t>0?ho[1].slice(ho.position1,ho.position1+=t):ho[0].slice(ho.position0,ho.position0-=t)):Ao;case 194:return!1;case 195:return!0;case 196:if(t=uo[yo++],void 0===t)throw new Error("Unexpected end of buffer");return Jo(t);case 197:return t=mo.getUint16(yo),yo+=2,Jo(t);case 198:return t=mo.getUint32(yo),yo+=4,Jo(t);case 199:return Wo(uo[yo++]);case 200:return t=mo.getUint16(yo),yo+=2,Wo(t);case 201:return t=mo.getUint32(yo),yo+=4,Wo(t);case 202:if(t=mo.getFloat32(yo),vo.useFloat32>2){let e=ts[(127&uo[yo])<<1|uo[yo+1]>>7];return yo+=4,(e*t+(t>0?.5:-.5)>>0)/e}return yo+=4,t;case 203:return t=mo.getFloat64(yo),yo+=8,t;case 204:return uo[yo++];case 205:return t=mo.getUint16(yo),yo+=2,t;case 206:return t=mo.getUint32(yo),yo+=4,t;case 207:return"number"===vo.int64AsType?(t=4294967296*mo.getUint32(yo),t+=mo.getUint32(yo+4)):t="string"===vo.int64AsType?mo.getBigUint64(yo).toString():mo.getBigUint64(yo),yo+=8,t;case 208:return mo.getInt8(yo++);case 209:return t=mo.getInt16(yo),yo+=2,t;case 210:return t=mo.getInt32(yo),yo+=4,t;case 211:return"number"===vo.int64AsType?(t=4294967296*mo.getInt32(yo),t+=mo.getUint32(yo+4)):t="string"===vo.int64AsType?mo.getBigInt64(yo).toString():mo.getBigInt64(yo),yo+=8,t;case 212:if(t=uo[yo++],114==t)return Xo(63&uo[yo++]);{let e=_o[t];if(e)return e.read?(yo++,e.read(Oo())):e.noBuffer?(yo++,e()):e(uo.subarray(yo,++yo));throw new Error("Unknown extension "+t)}case 213:return t=uo[yo],114==t?(yo++,Xo(63&uo[yo++],uo[yo++])):Wo(2);case 214:return Wo(4);case 215:return Wo(8);case 216:return Wo(16);case 217:return t=uo[yo++],xo>=yo?po.slice(yo-bo,(yo+=t)-bo):To(t);case 218:return t=mo.getUint16(yo),xo>=(yo+=2)?po.slice(yo-bo,(yo+=t)-bo):Lo(t);case 219:return t=mo.getUint32(yo),xo>=(yo+=4)?po.slice(yo-bo,(yo+=t)-bo):Bo(t);case 220:return t=mo.getUint16(yo),yo+=2,Uo(t);case 221:return t=mo.getUint32(yo),yo+=4,Uo(t);case 222:return t=mo.getUint16(yo),yo+=2,Ro(t);case 223:return t=mo.getUint32(yo),yo+=4,Ro(t);default:if(e>=224)return e-256;if(void 0===e){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+e)}}}const ko=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Fo(e,t){function n(){if(n.count++>Mo){let n=e.read=new Function("r","return function(){return "+(vo.freezeData?"Object.freeze":"")+"({"+e.map((e=>"__proto__"===e?"__proto_:r()":ko.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"})}")(Oo);return 0===e.highByte&&(e.read=zo(t,e.read)),n()}let r={};for(let t=0,n=e.length;t<n;t++){let n=e[t];"__proto__"===n&&(n="__proto_"),r[n]=Oo()}return vo.freezeData?Object.freeze(r):r}return n.count=0,0===e.highByte?zo(t,n):n}const zo=(e,t)=>function(){let n=uo[yo++];if(0===n)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=lo[r]||Co()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Fo(i,e)),i.read()};function Co(){let e=Ko((()=>(uo=null,vo.getStructures())));return lo=vo._mergeStructures(e,lo)}var No=Do,To=Do,Lo=Do,Bo=Do;function Do(e){let t;if(e<16&&(t=Vo(e)))return t;if(e>64&&so)return so.decode(uo.subarray(yo,yo+=e));const n=yo+e,r=[];for(t="";yo<n;){const e=uo[yo++];if(0==(128&e))r.push(e);else if(192==(224&e)){const t=63&uo[yo++];r.push((31&e)<<6|t)}else if(224==(240&e)){const t=63&uo[yo++],n=63&uo[yo++];r.push((31&e)<<12|t<<6|n)}else if(240==(248&e)){let t=(7&e)<<18|(63&uo[yo++])<<12|(63&uo[yo++])<<6|63&uo[yo++];t>65535&&(t-=65536,r.push(t>>>10&1023|55296),t=56320|1023&t),r.push(t)}else r.push(e);r.length>=4096&&(t+=qo.apply(String,r),r.length=0)}return r.length>0&&(t+=qo.apply(String,r)),t}function Uo(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Oo();return vo.freezeData?Object.freeze(t):t}function Ro(e){if(vo.mapsAsObjects){let t={};for(let n=0;n<e;n++){let e=Ho();"__proto__"===e&&(e="__proto_"),t[e]=Oo()}return t}{let t=new Map;for(let n=0;n<e;n++)t.set(Oo(),Oo());return t}}var qo=String.fromCharCode;function $o(e){let t=yo,n=new Array(e);for(let r=0;r<e;r++){const e=uo[yo++];if((128&e)>0)return void(yo=t);n[r]=e}return qo.apply(String,n)}function Vo(e){if(e<4){if(e<2){if(0===e)return"";{let e=uo[yo++];return(128&e)>1?void(yo-=1):qo(e)}}{let t=uo[yo++],n=uo[yo++];if((128&t)>0||(128&n)>0)return void(yo-=2);if(e<3)return qo(t,n);let r=uo[yo++];return(128&r)>0?void(yo-=3):qo(t,n,r)}}{let t=uo[yo++],n=uo[yo++],r=uo[yo++],i=uo[yo++];if((128&t)>0||(128&n)>0||(128&r)>0||(128&i)>0)return void(yo-=4);if(e<6){if(4===e)return qo(t,n,r,i);{let e=uo[yo++];return(128&e)>0?void(yo-=5):qo(t,n,r,i,e)}}if(e<8){let a=uo[yo++],o=uo[yo++];if((128&a)>0||(128&o)>0)return void(yo-=6);if(e<7)return qo(t,n,r,i,a,o);let s=uo[yo++];return(128&s)>0?void(yo-=7):qo(t,n,r,i,a,o,s)}{let a=uo[yo++],o=uo[yo++],s=uo[yo++],u=uo[yo++];if((128&a)>0||(128&o)>0||(128&s)>0||(128&u)>0)return void(yo-=8);if(e<10){if(8===e)return qo(t,n,r,i,a,o,s,u);{let e=uo[yo++];return(128&e)>0?void(yo-=9):qo(t,n,r,i,a,o,s,u,e)}}if(e<12){let c=uo[yo++],f=uo[yo++];if((128&c)>0||(128&f)>0)return void(yo-=10);if(e<11)return qo(t,n,r,i,a,o,s,u,c,f);let l=uo[yo++];return(128&l)>0?void(yo-=11):qo(t,n,r,i,a,o,s,u,c,f,l)}{let c=uo[yo++],f=uo[yo++],l=uo[yo++],d=uo[yo++];if((128&c)>0||(128&f)>0||(128&l)>0||(128&d)>0)return void(yo-=12);if(e<14){if(12===e)return qo(t,n,r,i,a,o,s,u,c,f,l,d);{let e=uo[yo++];return(128&e)>0?void(yo-=13):qo(t,n,r,i,a,o,s,u,c,f,l,d,e)}}{let p=uo[yo++],h=uo[yo++];if((128&p)>0||(128&h)>0)return void(yo-=14);if(e<15)return qo(t,n,r,i,a,o,s,u,c,f,l,d,p,h);let g=uo[yo++];return(128&g)>0?void(yo-=15):qo(t,n,r,i,a,o,s,u,c,f,l,d,p,h,g)}}}}}function Go(){let e,t=uo[yo++];if(t<192)e=t-160;else switch(t){case 217:e=uo[yo++];break;case 218:e=mo.getUint16(yo),yo+=2;break;case 219:e=mo.getUint32(yo),yo+=4;break;default:throw new Error("Expected string")}return Do(e)}function Jo(e){return vo.copyBuffers?Uint8Array.prototype.slice.call(uo,yo,yo+=e):uo.subarray(yo,yo+=e)}function Wo(e){let t=uo[yo++];if(_o[t]){let n;return _o[t](uo.subarray(yo,n=yo+=e),(e=>{yo=e;try{return Oo()}finally{yo=n}}))}throw new Error("Unknown extension type "+t)}var Yo=new Array(4096);function Ho(){let e=uo[yo++];if(!(e>=160&&e<192))return yo--,Oo().toString();if(e-=160,xo>=yo)return po.slice(yo-bo,(yo+=e)-bo);if(!(0==xo&&co<180))return No(e);let t,n=4095&(e<<5^(e>1?mo.getUint16(yo):e>0?uo[yo]:0)),r=Yo[n],i=yo,a=yo+e-3,o=0;if(r&&r.bytes==e){for(;i<a;){if(t=mo.getUint32(i),t!=r[o++]){i=1879048192;break}i+=4}for(a+=3;i<a;)if(t=uo[i++],t!=r[o++]){i=1879048192;break}if(i===a)return yo=i,r.string;a-=3,i=yo}for(r=[],Yo[n]=r,r.bytes=e;i<a;)t=mo.getUint32(i),r.push(t),i+=4;for(a+=3;i<a;)t=uo[i++],r.push(t);let s=e<16?Vo(e):$o(e);return r.string=null!=s?s:No(e)}const Xo=(e,t)=>{let n=Oo().map((e=>e.toString())),r=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=lo[e];return i&&i.isShared&&((lo.restoreStructures||(lo.restoreStructures=[]))[e]=i),lo[e]=n,n.read=Fo(n,r),n.read()};_o[0]=()=>{},_o[0].noBuffer=!0,_o[101]=()=>{let e=Oo();return(globalThis[e[0]]||Error)(e[1])},_o[105]=e=>{let t=mo.getUint32(yo-4);go||(go=new Map);let n,r=uo[yo];n=r>=144&&r<160||220==r||221==r?[]:{};let i={target:n};go.set(t,i);let a=Oo();return i.used?Object.assign(n,a):(i.target=a,a)},_o[112]=e=>{let t=mo.getUint32(yo-4),n=go.get(t);return n.used=!0,n.target},_o[115]=()=>new Set(Oo());const Zo=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((e=>e+"Array"));_o[116]=e=>{let t=e[0],n=Zo[t];if(!n)throw new Error("Could not find typed array for code "+t);return new globalThis[n](Uint8Array.prototype.slice.call(e,1).buffer)},_o[120]=()=>{let e=Oo();return new RegExp(e[0],e[1])};const Qo=[];function Ko(e){let t=co,n=yo,r=bo,i=xo,a=po,o=go,s=ho,u=new Uint8Array(uo.slice(0,co)),c=lo,f=lo.slice(0,lo.length),l=vo,d=Io,p=e();return co=t,yo=n,bo=r,xo=i,po=a,go=o,ho=s,uo=u,Io=d,(lo=c).splice(0,lo.length,...f),vo=l,mo=new DataView(uo.buffer,uo.byteOffset,uo.byteLength),p}function es(){uo=null,go=null,lo=null}_o[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=yo;return yo+=t-e.length,ho=Qo,(ho=[Go(),Go()]).position0=0,ho.position1=0,ho.postBundlePosition=yo,yo=n,Oo()},_o[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");const ts=new Array(147);for(let e=0;e<256;e++)ts[e]=+("1e"+Math.floor(45.15-.30103*e));var ns=new Eo({useRecords:!1});const rs=ns.unpack;ns.unpackMultiple,ns.unpack;let is,as,os,ss=new Float32Array(1);new Uint8Array(ss.buffer,0,4);try{is=new TextEncoder}catch(dt){}const us="undefined"!=typeof Buffer,cs=us?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,fs=us?Buffer:Uint8Array,ls=us?4294967296:2144337920;let ds,ps,hs,gs,ms=0,ys=null;const vs=/[\u0080-\uFFFF]/,bs=Symbol("record-id");function xs(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:a,position:o}=n(4+i);a[o++]=199,a[o++]=i+1}else if(i+1<65536){var{target:a,position:o}=n(5+i);a[o++]=200,a[o++]=i+1>>8,a[o++]=i+1&255}else{var{target:a,position:o,targetView:s}=n(7+i);a[o++]=201,s.setUint32(o,i+1),o+=4}a[o++]=116,a[o++]=t,a.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function _s(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=255&n}else{var{target:r,position:i,targetView:a}=t(n+5);r[i++]=198,a.setUint32(i,n),i+=4}r.set(e,i)}function ws(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=255&i):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=255&i)}return t[n++]=r,t.set(e,n),n+=i}function Ss(e,t,n){if(ys.length>0){hs.setUint32(ys.position+e,ms+n-ys.position-e),ys.stringsPosition=ms-e;let r=ys;ys=null,t(r[0]),t(r[1])}}os=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,So],as=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&r>=0&&r<4294967296){let{target:e,targetView:n,position:i}=t(6);e[i++]=214,e[i++]=255,n.setUint32(i,r)}else if(r>0&&r<4294967296){let{target:n,targetView:i,position:a}=t(10);n[a++]=215,n[a++]=255,i.setUint32(a,4e6*e.getMilliseconds()+(r/1e3/4294967296>>0)),i.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:e,targetView:r,position:i}=t(3);e[i++]=212,e[i++]=255,e[i++]=255}else{let{target:n,targetView:i,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,i.setUint32(a,1e6*e.getMilliseconds()),i.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){let r=Array.from(e),{target:i,position:a}=t(this.moreTypes?3:0);this.moreTypes&&(i[a++]=212,i[a++]=115,i[a++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?xs(e,16,t):_s(us?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==fs&&this.moreTypes?xs(e,Zo.indexOf(n.name),t):_s(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];let As=new class extends Eo{constructor(e){let t,n,r,i;super(e),this.offset=0;let a=fs.prototype.utf8Write?function(e,t){return ds.utf8Write(e,t,4294967295)}:!(!is||!is.encodeInto)&&function(e,t){return is.encodeInto(e,ds.subarray(t)).written},o=this;e||(e={});let s=e&&e.sequential,u=e.structures||e.saveStructures,c=e.maxSharedStructures;if(null==c&&(c=u?32:0),c>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&null==e.moreTypes&&(this.moreTypes=!0);let f=e.maxOwnStructures;null==f&&(f=u?32:64),this.structures||0==e.useRecords||(this.structures=[]);let l=c>32||f+c>64,d=c+64,p=c+f+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let h=[],g=0,m=0;this.pack=this.encode=function(e,a){if(ds||(ds=new cs(8192),hs=ds.dataView||(ds.dataView=new DataView(ds.buffer,0,8192)),ms=0),gs=ds.length-10,gs-ms<2048?(ds=new cs(ds.length),hs=ds.dataView||(ds.dataView=new DataView(ds.buffer,0,ds.length)),gs=ds.length-10,ms=0):ms=ms+7&2147483640,t=ms,i=o.structuredClone?new Map:null,o.bundleStrings&&"string"!=typeof e?(ys=[],ys.size=1/0):ys=null,r=o.structures,r){r.uninitialized&&(r=o._mergeStructures(o.getStructures()));let e=r.sharedLength||0;if(e>c)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+r.sharedLength);if(!r.transitions){r.transitions=Object.create(null);for(let t=0;t<e;t++){let e=r[t];if(!e)continue;let n,i=r.transitions;for(let t=0,r=e.length;t<r;t++){let r=e[t];n=i[r],n||(n=i[r]=Object.create(null)),i=n}i[bs]=t+64}this.lastNamedStructuresLength=e}s||(r.nextId=e+64)}n&&(n=!1);try{o.randomAccessStructure&&e.constructor&&e.constructor===Object?S(e):v(e);let n=ys;if(ys&&Ss(t,v,0),i&&i.idsToInsert){let e=i.idsToInsert.sort(((e,t)=>e.offset>t.offset?1:-1)),r=e.length,a=-1;for(;n&&r>0;){let i=e[--r].offset+t;i<n.stringsPosition+t&&-1===a&&(a=0),i>n.position+t?a>=0&&(a+=6):(a>=0&&(hs.setUint32(n.position+t,hs.getUint32(n.position+t)+a),a=-1),n=n.previous,r++)}a>=0&&n&&hs.setUint32(n.position+t,hs.getUint32(n.position+t)+a),ms+=6*e.length,ms>gs&&x(ms),o.offset=ms;let s=function(e,t){let n,r=6*t.length,i=e.length-r;for(;n=t.pop();){let t=n.offset,a=n.id;e.copyWithin(t+r,t,i),r-=6;let o=t+r;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=255&a,i=t}return e}(ds.subarray(t,ms),e);return i=null,s}return o.offset=ms,a&Ms?(ds.start=t,ds.end=ms,ds):ds.subarray(t,ms)}finally{if(r){m<10&&m++;let i=r.sharedLength||0;if(r.length>i&&(r.length=i),g>1e4)r.transitions=null,m=0,g=0,h.length>0&&(h=[]);else if(h.length>0&&!s){for(let e=0,t=h.length;e<t;e++)h[e][bs]=0;h=[]}if(n&&o.saveStructures){let n=ds.subarray(t,ms),a=function(e,t){return e.isCompatible=e=>{let n=!e||(t.lastNamedStructuresLength||0)===e.length;return n||t._mergeStructures(e),n},e}(r,o);return!1===o.saveStructures(a,a.isCompatible)?o.pack(e):(o.lastNamedStructuresLength=i,n)}}a&Es&&(ms=t)}};const y=e=>{var t=e.length;t<16?ds[ms++]=144|t:t<65536?(ds[ms++]=220,ds[ms++]=t>>8,ds[ms++]=255&t):(ds[ms++]=221,hs.setUint32(ms,t),ms+=4);for(let n=0;n<t;n++)v(e[n])},v=e=>{ms>gs&&(ds=x(ms));var n,r=typeof e;if("string"===r){let r,i=e.length;if(ys&&i>=4&&i<4096){if((ys.size+=i)>21760){let e,n,r=(ys[0]?3*ys[0].length+ys[1].length:0)+10;ms+r>gs&&(ds=x(ms+r)),ys.position?(n=ys,ds[ms]=200,ms+=3,ds[ms++]=98,e=ms-t,ms+=4,Ss(t,v,0),hs.setUint16(e+t-3,ms-t-e)):(ds[ms++]=214,ds[ms++]=98,e=ms-t,ms+=4),ys=["",""],ys.previous=n,ys.size=0,ys.position=e}let n=vs.test(e);return ys[n?0:1]+=e,ds[ms++]=193,void v(n?-i:i)}r=i<32?1:i<256?2:i<65536?3:5;let o=3*i;if(ms+o>gs&&(ds=x(ms+o)),i<64||!a){let t,a,o,s=ms+r;for(t=0;t<i;t++)a=e.charCodeAt(t),a<128?ds[s++]=a:a<2048?(ds[s++]=a>>6|192,ds[s++]=63&a|128):55296==(64512&a)&&56320==(64512&(o=e.charCodeAt(t+1)))?(a=65536+((1023&a)<<10)+(1023&o),t++,ds[s++]=a>>18|240,ds[s++]=a>>12&63|128,ds[s++]=a>>6&63|128,ds[s++]=63&a|128):(ds[s++]=a>>12|224,ds[s++]=a>>6&63|128,ds[s++]=63&a|128);n=s-ms-r}else n=a(e,ms+r);n<32?ds[ms++]=160|n:n<256?(r<2&&ds.copyWithin(ms+2,ms+1,ms+1+n),ds[ms++]=217,ds[ms++]=n):n<65536?(r<3&&ds.copyWithin(ms+3,ms+2,ms+2+n),ds[ms++]=218,ds[ms++]=n>>8,ds[ms++]=255&n):(r<5&&ds.copyWithin(ms+5,ms+3,ms+3+n),ds[ms++]=219,hs.setUint32(ms,n),ms+=4),ms+=n}else if("number"===r)if(e>>>0===e)e<32||e<128&&!1===this.useRecords||e<64&&!this.randomAccessStructure?ds[ms++]=e:e<256?(ds[ms++]=204,ds[ms++]=e):e<65536?(ds[ms++]=205,ds[ms++]=e>>8,ds[ms++]=255&e):(ds[ms++]=206,hs.setUint32(ms,e),ms+=4);else if(e>>0===e)e>=-32?ds[ms++]=256+e:e>=-128?(ds[ms++]=208,ds[ms++]=e+256):e>=-32768?(ds[ms++]=209,hs.setInt16(ms,e),ms+=2):(ds[ms++]=210,hs.setInt32(ms,e),ms+=4);else{let t;if((t=this.useFloat32)>0&&e<4294967296&&e>=-2147483648){let n;if(ds[ms++]=202,hs.setFloat32(ms,e),t<4||(n=e*ts[(127&ds[ms])<<1|ds[ms+1]>>7])>>0===n)return void(ms+=4);ms--}ds[ms++]=203,hs.setFloat64(ms,e),ms+=8}else if("object"===r)if(e){if(i){let n=i.get(e);if(n){if(!n.id){let e=i.idsToInsert||(i.idsToInsert=[]);n.id=e.push(n)}return ds[ms++]=214,ds[ms++]=112,hs.setUint32(ms,n.id),void(ms+=4)}i.set(e,{offset:ms-t})}let r=e.constructor;if(r===Object)b(e,!0);else if(r===Array)y(e);else if(r===Map){(n=e.size)<16?ds[ms++]=128|n:n<65536?(ds[ms++]=222,ds[ms++]=n>>8,ds[ms++]=255&n):(ds[ms++]=223,hs.setUint32(ms,n),ms+=4);for(let[t,n]of e)v(t),v(n)}else{for(let t=0,n=as.length;t<n;t++){if(e instanceof os[t]){let n=as[t];if(n.write){n.type&&(ds[ms++]=212,ds[ms++]=n.type,ds[ms++]=0);let t=n.write.call(this,e);return void(t===e?Array.isArray(e)?y(e):b(e):v(t))}let r,i=ds,a=hs,o=ms;ds=null;try{r=n.pack.call(this,e,(e=>(ds=i,i=null,ms+=e,ms>gs&&x(ms),{target:ds,targetView:hs,position:ms-e})),v)}finally{i&&(ds=i,hs=a,ms=o,gs=ds.length-10)}return void(r&&(r.length+ms>gs&&x(r.length+ms),ms=ws(r,ds,ms,n.type)))}}Array.isArray(e)?y(e):b(e,!e.hasOwnProperty)}}else ds[ms++]=192;else if("boolean"===r)ds[ms++]=e?195:194;else if("bigint"===r){if(e<BigInt(1)<<BigInt(63)&&e>=-(BigInt(1)<<BigInt(63)))ds[ms++]=211,hs.setBigInt64(ms,e);else if(e<BigInt(1)<<BigInt(64)&&e>0)ds[ms++]=207,hs.setBigUint64(ms,e);else{if(!this.largeBigIntToFloat)throw new RangeError(e+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");ds[ms++]=203,hs.setFloat64(ms,Number(e))}ms+=8}else if("undefined"===r)this.encodeUndefinedAsNil?ds[ms++]=192:(ds[ms++]=212,ds[ms++]=0,ds[ms++]=0);else{if("function"!==r)throw new Error("Unknown type: "+r);v(this.writeFunction&&this.writeFunction())}},b=!1===this.useRecords?this.variableMapSize?e=>{let t,n=Object.keys(e),r=n.length;r<16?ds[ms++]=128|r:r<65536?(ds[ms++]=222,ds[ms++]=r>>8,ds[ms++]=255&r):(ds[ms++]=223,hs.setUint32(ms,r),ms+=4);for(let i=0;i<r;i++)v(t=n[i]),v(e[t])}:(e,n)=>{ds[ms++]=222;let r=ms-t;ms+=2;let i=0;for(let t in e)(n||e.hasOwnProperty(t))&&(v(t),v(e[t]),i++);ds[r+++t]=i>>8,ds[r+t]=255&i}:e.progressiveRecords&&!l?(e,n)=>{let i,a,o=r.transitions||(r.transitions=Object.create(null)),s=ms++-t;for(let u in e)if(n||e.hasOwnProperty(u)){if(i=o[u],i)o=i;else{let n=Object.keys(e),c=o;o=r.transitions;let f=0;for(let e=0,t=n.length;e<t;e++){let t=n[e];i=o[t],i||(i=o[t]=Object.create(null),f++),o=i}s+t+1==ms?(ms--,_(o,n,f)):w(o,n,s,f),a=!0,o=c[u]}v(e[u])}if(!a){let n=o[bs];n?ds[s+t]=n:w(o,Object.keys(e),s,0)}}:(e,t)=>{let n,i=r.transitions||(r.transitions=Object.create(null)),a=0;for(let r in e)(t||e.hasOwnProperty(r))&&(n=i[r],n||(n=i[r]=Object.create(null),a++),i=n);let o=i[bs];o?o>=96&&l?(ds[ms++]=96+(31&(o-=96)),ds[ms++]=o>>5):ds[ms++]=o:_(i,i.__keys__||Object.keys(e),a);for(let n in e)(t||e.hasOwnProperty(n))&&v(e[n])},x=e=>{let n;if(e>16777216){if(e-t>ls)throw new Error("Packed buffer would be larger than maximum buffer size");n=Math.min(ls,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else n=1+(Math.max(e-t<<2,ds.length-1)>>12)<<12;let r=new cs(n);return hs=r.dataView||(r.dataView=new DataView(r.buffer,0,n)),e=Math.min(e,ds.length),ds.copy?ds.copy(r,0,t,e):r.set(ds.slice(t,e)),ms-=t,t=0,gs=r.length-10,ds=r},_=(e,t,i)=>{let a=r.nextId;a||(a=64),a<d&&this.shouldShareStructure&&!this.shouldShareStructure(t)?(a=r.nextOwnId,a<p||(a=d),r.nextOwnId=a+1):(a>=p&&(a=d),r.nextId=a+1);let o=t.highByte=a>=96&&l?a-96>>5:-1;e[bs]=a,e.__keys__=t,r[a-64]=t,a<d?(t.isShared=!0,r.sharedLength=a-63,n=!0,o>=0?(ds[ms++]=96+(31&a),ds[ms++]=o):ds[ms++]=a):(o>=0?(ds[ms++]=213,ds[ms++]=114,ds[ms++]=96+(31&a),ds[ms++]=o):(ds[ms++]=212,ds[ms++]=114,ds[ms++]=a),i&&(g+=m*i),h.length>=f&&(h.shift()[bs]=0),h.push(e),v(t))},w=(e,n,r,i)=>{let a=ds,o=ms,s=gs,u=t;ds=ps,ms=0,t=0,ds||(ps=ds=new cs(8192)),gs=ds.length-10,_(e,n,i),ps=ds;let c=ms;if(ds=a,ms=o,gs=s,t=u,c>1){let e=ms+c-1;e>gs&&x(e);let n=r+t;ds.copyWithin(n+c,n+1,ms),ds.set(ps.slice(0,c),n),ms=e}else ds[r+t]=ps[0]},S=(e,t)=>{let i=undefined(e,ds,ms,r,x,((e,t,r)=>{if(r)return n=!0;ms=t;let i=ds;return v(e),i!==ds?{position:ms,targetView:hs,target:ds}:ms}),this);if(0===i)return b(e,!0);ms=i}}useBuffer(e){ds=e,hs=new DataView(ds.buffer,ds.byteOffset,ds.byteLength),ms=0}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}({useRecords:!1});const Is=As.pack;As.pack;const Ms=512,Es=1024;var Ps={},js=Uint8Array,Os=Uint16Array,ks=Uint32Array,Fs=new js([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zs=new js([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Cs=new js([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ns=function(e,t){for(var n=new Os(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new ks(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return[n,i]},Ts=Ns(Fs,2),Ls=Ts[0],Bs=Ts[1];Ls[28]=258,Bs[258]=28;for(var Ds=Ns(zs,0),Us=Ds[0],Rs=Ds[1],qs=new Os(32768),$s=0;$s<32768;++$s){var Vs=(43690&$s)>>>1|(21845&$s)<<1;Vs=(61680&(Vs=(52428&Vs)>>>2|(13107&Vs)<<2))>>>4|(3855&Vs)<<4,qs[$s]=((65280&Vs)>>>8|(255&Vs)<<8)>>>1}var Gs=function(e,t,n){for(var r=e.length,i=0,a=new Os(t);i<r;++i)e[i]&&++a[e[i]-1];var o,s=new Os(t);for(i=0;i<t;++i)s[i]=s[i-1]+a[i-1]<<1;if(n){o=new Os(1<<t);var u=15-t;for(i=0;i<r;++i)if(e[i])for(var c=i<<4|e[i],f=t-e[i],l=s[e[i]-1]++<<f,d=l|(1<<f)-1;l<=d;++l)o[qs[l]>>>u]=c}else for(o=new Os(r),i=0;i<r;++i)e[i]&&(o[i]=qs[s[e[i]-1]++]>>>15-e[i]);return o},Js=new js(288);for($s=0;$s<144;++$s)Js[$s]=8;for($s=144;$s<256;++$s)Js[$s]=9;for($s=256;$s<280;++$s)Js[$s]=7;for($s=280;$s<288;++$s)Js[$s]=8;var Ws=new js(32);for($s=0;$s<32;++$s)Ws[$s]=5;var Ys=Gs(Js,9,0),Hs=Gs(Js,9,1),Xs=Gs(Ws,5,0),Zs=Gs(Ws,5,1),Qs=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Ks=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},eu=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},tu=function(e){return(e+7)/8|0},nu=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(2==e.BYTES_PER_ELEMENT?Os:4==e.BYTES_PER_ELEMENT?ks:js)(n-t);return r.set(e.subarray(t,n)),r},ru=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],iu=function(e,t,n){var r=new Error(t||ru[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,iu),!n)throw r;return r},au=function(e,t,n){var r=e.length;if(!r||n&&n.f&&!n.l)return t||new js(0);var i=!t||n,a=!n||n.i;n||(n={}),t||(t=new js(3*r));var o=function(e){var n=t.length;if(e>n){var r=new js(Math.max(2*n,e));r.set(t),t=r}},s=n.f||0,u=n.p||0,c=n.b||0,f=n.l,l=n.d,d=n.m,p=n.n,h=8*r;do{if(!f){s=Ks(e,u,1);var g=Ks(e,u+1,3);if(u+=3,!g){var m=e[(E=tu(u)+4)-4]|e[E-3]<<8,y=E+m;if(y>r){a&&iu(0);break}i&&o(c+m),t.set(e.subarray(E,y),c),n.b=c+=m,n.p=u=8*y,n.f=s;continue}if(1==g)f=Hs,l=Zs,d=9,p=5;else if(2==g){var v=Ks(e,u,31)+257,b=Ks(e,u+10,15)+4,x=v+Ks(e,u+5,31)+1;u+=14;for(var _=new js(x),w=new js(19),S=0;S<b;++S)w[Cs[S]]=Ks(e,u+3*S,7);u+=3*b;var A=Qs(w),I=(1<<A)-1,M=Gs(w,A,1);for(S=0;S<x;){var E,P=M[Ks(e,u,I)];if(u+=15&P,(E=P>>>4)<16)_[S++]=E;else{var j=0,O=0;for(16==E?(O=3+Ks(e,u,3),u+=2,j=_[S-1]):17==E?(O=3+Ks(e,u,7),u+=3):18==E&&(O=11+Ks(e,u,127),u+=7);O--;)_[S++]=j}}var k=_.subarray(0,v),F=_.subarray(v);d=Qs(k),p=Qs(F),f=Gs(k,d,1),l=Gs(F,p,1)}else iu(1);if(u>h){a&&iu(0);break}}i&&o(c+131072);for(var z=(1<<d)-1,C=(1<<p)-1,N=u;;N=u){var T=(j=f[eu(e,u)&z])>>>4;if((u+=15&j)>h){a&&iu(0);break}if(j||iu(2),T<256)t[c++]=T;else{if(256==T){N=u,f=null;break}var L=T-254;if(T>264){var B=Fs[S=T-257];L=Ks(e,u,(1<<B)-1)+Ls[S],u+=B}var D=l[eu(e,u)&C],U=D>>>4;D||iu(3),u+=15&D;F=Us[U];if(U>3){B=zs[U];F+=eu(e,u)&(1<<B)-1,u+=B}if(u>h){a&&iu(0);break}i&&o(c+131072);for(var R=c+L;c<R;c+=4)t[c]=t[c-F],t[c+1]=t[c+1-F],t[c+2]=t[c+2-F],t[c+3]=t[c+3-F];c=R}}n.l=f,n.p=N,n.b=c,n.f=s,f&&(s=1,n.m=d,n.d=l,n.n=p)}while(!s);return c==t.length?t:nu(t,0,c)},ou=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},su=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},uu=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,a=n.slice();if(!i)return[gu,0];if(1==i){var o=new js(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],u=n[1],c=0,f=1,l=2;for(n[0]={s:-1,f:s.f+u.f,l:s,r:u};f!=i-1;)s=n[n[c].f<n[l].f?c++:l++],u=n[c!=f&&n[c].f<n[l].f?c++:l++],n[f++]={s:-1,f:s.f+u.f,l:s,r:u};var d=a[0].s;for(r=1;r<i;++r)a[r].s>d&&(d=a[r].s);var p=new Os(d+1),h=cu(n[f-1],p,0);if(h>t){r=0;var g=0,m=h-t,y=1<<m;for(a.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));r<i;++r){var v=a[r].s;if(!(p[v]>t))break;g+=y-(1<<h-p[v]),p[v]=t}for(g>>>=m;g>0;){var b=a[r].s;p[b]<t?g-=1<<t-p[b]++-1:++r}for(;r>=0&&g;--r){var x=a[r].s;p[x]==t&&(--p[x],++g)}h=t}return[new js(p),h]},cu=function(e,t,n){return-1==e.s?Math.max(cu(e.l,t,n+1),cu(e.r,t,n+1)):t[e.s]=n},fu=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Os(++t),r=0,i=e[0],a=1,o=function(e){n[r++]=e},s=1;s<=t;++s)if(e[s]==i&&s!=t)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=e[s]}return[n.subarray(0,r),t]},lu=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},du=function(e,t,n){var r=n.length,i=tu(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var a=0;a<r;++a)e[i+a+4]=n[a];return 8*(i+4+r)},pu=function(e,t,n,r,i,a,o,s,u,c,f){ou(t,f++,n),++i[256];for(var l=uu(i,15),d=l[0],p=l[1],h=uu(a,15),g=h[0],m=h[1],y=fu(d),v=y[0],b=y[1],x=fu(g),_=x[0],w=x[1],S=new Os(19),A=0;A<v.length;++A)S[31&v[A]]++;for(A=0;A<_.length;++A)S[31&_[A]]++;for(var I=uu(S,7),M=I[0],E=I[1],P=19;P>4&&!M[Cs[P-1]];--P);var j,O,k,F,z=c+5<<3,C=lu(i,Js)+lu(a,Ws)+o,N=lu(i,d)+lu(a,g)+o+14+3*P+lu(S,M)+(2*S[16]+3*S[17]+7*S[18]);if(z<=C&&z<=N)return du(t,f,e.subarray(u,u+c));if(ou(t,f,1+(N<C)),f+=2,N<C){j=Gs(d,p,0),O=d,k=Gs(g,m,0),F=g;var T=Gs(M,E,0);ou(t,f,b-257),ou(t,f+5,w-1),ou(t,f+10,P-4),f+=14;for(A=0;A<P;++A)ou(t,f+3*A,M[Cs[A]]);f+=3*P;for(var L=[v,_],B=0;B<2;++B){var D=L[B];for(A=0;A<D.length;++A){var U=31&D[A];ou(t,f,T[U]),f+=M[U],U>15&&(ou(t,f,D[A]>>>5&127),f+=D[A]>>>12)}}}else j=Ys,O=Js,k=Xs,F=Ws;for(A=0;A<s;++A)if(r[A]>255){U=r[A]>>>18&31;su(t,f,j[U+257]),f+=O[U+257],U>7&&(ou(t,f,r[A]>>>23&31),f+=Fs[U]);var R=31&r[A];su(t,f,k[R]),f+=F[R],R>3&&(su(t,f,r[A]>>>5&8191),f+=zs[R])}else su(t,f,j[r[A]]),f+=O[r[A]];return su(t,f,j[256]),f+O[256]},hu=new ks([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),gu=new js(0),mu=function(e,t,n,r,i,a){var o=e.length,s=new js(r+o+5*(1+Math.ceil(o/7e3))+i),u=s.subarray(r,s.length-i),c=0;if(!t||o<8)for(var f=0;f<=o;f+=65535){var l=f+65535;l>=o&&(u[c>>3]=a),c=du(u,c+1,e.subarray(f,l))}else{for(var d=hu[t-1],p=d>>>13,h=8191&d,g=(1<<n)-1,m=new Os(32768),y=new Os(g+1),v=Math.ceil(n/3),b=2*v,x=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<b)&g},_=new ks(25e3),w=new Os(288),S=new Os(32),A=0,I=0,M=(f=0,0),E=0,P=0;f<o;++f){var j=x(f),O=32767&f,k=y[j];if(m[O]=k,y[j]=O,E<=f){var F=o-f;if((A>7e3||M>24576)&&F>423){c=pu(e,u,0,_,w,S,I,M,P,f-P,c),M=A=I=0,P=f;for(var z=0;z<286;++z)w[z]=0;for(z=0;z<30;++z)S[z]=0}var C=2,N=0,T=h,L=O-k&32767;if(F>2&&j==x(f-L))for(var B=Math.min(p,F)-1,D=Math.min(32767,f),U=Math.min(258,F);L<=D&&--T&&O!=k;){if(e[f+C]==e[f+C-L]){for(var R=0;R<U&&e[f+R]==e[f+R-L];++R);if(R>C){if(C=R,N=L,R>B)break;var q=Math.min(L,R-2),$=0;for(z=0;z<q;++z){var V=f-L+z+32768&32767,G=V-m[V]+32768&32767;G>$&&($=G,k=V)}}}L+=(O=k)-(k=m[O])+32768&32767}if(N){_[M++]=268435456|Bs[C]<<18|Rs[N];var J=31&Bs[C],W=31&Rs[N];I+=Fs[J]+zs[W],++w[257+J],++S[W],E=f+C,++A}else _[M++]=e[f],++w[e[f]]}}c=pu(e,u,a,_,w,S,I,M,P,f-P,c),!a&&7&c&&(c=du(u,c+1,gu))}return nu(s,0,r+tu(c)+i)},yu=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&-306674912)^n>>>1;e[t]=n}return e}(),vu=function(){var e=-1;return{p:function(t){for(var n=e,r=0;r<t.length;++r)n=yu[255&n^t[r]]^n>>>8;e=n},d:function(){return~e}}},bu=function(e,t,n,r,i){return mu(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!i)},xu=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},_u=function(e,t,n){for(var r=e(),i=e.toString(),a=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<r.length;++o){var s=r[o],u=a[o];if("function"==typeof s){t+=";"+u+"=";var c=s.toString();if(s.prototype)if(-1!=c.indexOf("[native code]")){var f=c.indexOf(" ",8)+1;t+=c.slice(f,c.indexOf("(",f))}else for(var l in t+=c,s.prototype)t+=";"+u+".prototype."+l+"="+s.prototype[l].toString();else t+=c}else n[u]=s}return[t,n]},wu=[],Su=function(e,t,n,r){var i;if(!wu[n]){for(var a="",o={},s=e.length-1,u=0;u<s;++u)a=(i=_u(e[u],a,o))[0],o=i[1];wu[n]=_u(e[s],a,o)}var c=xu({},wu[n][1]);return function(e,t,n,r,i){var a=new Worker(Ps[t]||(Ps[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return a.onmessage=function(e){var t=e.data,n=t.$e$;if(n){var r=new Error(n[0]);r.code=n[1],r.stack=n[2],i(r,null)}else i(null,t)},a.postMessage(n,r),a}(wu[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,c,function(e){var t=[];for(var n in e)e[n].buffer&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t}(c),r)},Au=function(){return[js,Os,ks,Fs,zs,Cs,Ls,Us,Hs,Zs,qs,ru,Gs,Qs,Ks,eu,tu,nu,iu,au,Uu,Pu,ju]},Iu=function(){return[js,Os,ks,Fs,zs,Cs,Bs,Rs,Ys,Js,Xs,Ws,qs,hu,gu,Gs,ou,su,uu,cu,fu,lu,du,pu,tu,nu,mu,bu,Du,Pu]},Mu=function(){return[Nu,Bu,Cu,vu,yu]},Eu=function(){return[Tu,Lu]},Pu=function(e){return postMessage(e,[e.buffer])},ju=function(e){return e&&e.size&&new js(e.size)},Ou=function(e,t,n,r,i,a){var o=Su(n,r,i,(function(e,t){o.terminate(),a(e,t)}));return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},ku=function(e,t){return e[t]|e[t+1]<<8},Fu=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},zu=function(e,t){return Fu(e,t)+4294967296*Fu(e,t+4)},Cu=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Nu=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Cu(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}},Tu=function(e){31==e[0]&&139==e[1]&&8==e[2]||iu(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},Lu=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Bu=function(e){return 10+(e.filename&&e.filename.length+1||0)};function Du(e,t){return bu(e,t||{},0,0)}function Uu(e,t){return au(e,t)}function Ru(e,t,n){return n||(n=t,t={}),"function"!=typeof n&&iu(7),Ou(e,t,[Iu,Mu,function(){return[qu]}],(function(e){return Pu(qu(e.data[0],e.data[1]))}),2,n)}function qu(e,t){t||(t={});var n=vu(),r=e.length;n.p(e);var i=bu(e,t,Bu(t),8),a=i.length;return Nu(i,t),Cu(i,a-8,n.d()),Cu(i,a-4,r),i}function $u(e,t,n){return n||(n=t,t={}),"function"!=typeof n&&iu(7),Ou(e,t,[Au,Eu,function(){return[Vu]}],(function(e){return Pu(Vu(e.data[0]))}),3,n)}function Vu(e,t){return au(e.subarray(Tu(e),-8),t||new js(Lu(e)))}var Gu=function(e,t,n,r){for(var i in e){var a=e[i],o=t+i,s=r;Array.isArray(a)&&(s=xu(r,a[1]),a=a[0]),a instanceof js?n[o]=[a,s]:(n[o+="/"]=[new js(0),s],Gu(a,o,n,r))}},Ju="undefined"!=typeof TextEncoder&&new TextEncoder,Wu="undefined"!=typeof TextDecoder&&new TextDecoder;try{Wu.decode(gu,{stream:!0}),1}catch(Xb){}var Yu=function(e){for(var t="",n=0;;){var r=e[n++],i=(r>127)+(r>223)+(r>239);if(n+i>e.length)return[t,nu(e,n-1)];i?3==i?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&i?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}};function Hu(e,t){if(t){for(var n=new js(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}if(Ju)return Ju.encode(e);var i=e.length,a=new js(e.length+(e.length>>1)),o=0,s=function(e){a[o++]=e};for(r=0;r<i;++r){if(o+5>a.length){var u=new js(o+8+(i-r<<1));u.set(a),a=u}var c=e.charCodeAt(r);c<128||t?s(c):c<2048?(s(192|c>>6),s(128|63&c)):c>55295&&c<57344?(s(240|(c=65536+(1047552&c)|1023&e.charCodeAt(++r))>>18),s(128|c>>12&63),s(128|c>>6&63),s(128|63&c)):(s(224|c>>12),s(128|c>>6&63),s(128|63&c))}return nu(a,0,o)}function Xu(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(Wu)return Wu.decode(e);var i=Yu(e),a=i[0];return i[1].length&&iu(8),a}var Zu=function(e,t){return t+30+ku(e,t+26)+ku(e,t+28)},Qu=function(e,t,n){var r=ku(e,t+28),i=Xu(e.subarray(t+46,t+46+r),!(2048&ku(e,t+8))),a=t+46+r,o=Fu(e,t+20),s=n&&4294967295==o?Ku(e,a):[o,Fu(e,t+24),Fu(e,t+42)],u=s[0],c=s[1],f=s[2];return[ku(e,t+10),u,c,i,a+ku(e,t+30)+ku(e,t+32),f]},Ku=function(e,t){for(;1!=ku(e,t);t+=4+ku(e,t+2));return[zu(e,t+12),zu(e,t+4),zu(e,t+20)]},ec=function(e){var t=0;if(e)for(var n in e){var r=e[n].length;r>65535&&iu(9),t+=r+4}return t},tc=function(e,t,n,r,i,a,o,s){var u=r.length,c=n.extra,f=s&&s.length,l=ec(c);Cu(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(a<0&&8),e[t++]=i&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),p=d.getFullYear()-1980;if((p<0||p>119)&&iu(10),Cu(e,t,p<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,-1!=a&&(Cu(e,t,n.crc),Cu(e,t+4,a<0?-a-2:a),Cu(e,t+8,n.size)),Cu(e,t+12,u),Cu(e,t+14,l),t+=16,null!=o&&(Cu(e,t,f),Cu(e,t+6,n.attrs),Cu(e,t+10,o),t+=14),e.set(r,t),t+=u,l)for(var h in c){var g=c[h],m=g.length;Cu(e,t,+h),Cu(e,t+2,m),e.set(g,t+4),t+=4+m}return f&&(e.set(s,t),t+=f),t},nc=function(e,t,n,r,i){Cu(e,t,101010256),Cu(e,t+8,n),Cu(e,t+10,n),Cu(e,t+12,r),Cu(e,t+16,i)};function rc(e,t,n){n||(n=t,t={}),"function"!=typeof n&&iu(7);var r={};Gu(e,"",r,t);var i=Object.keys(r),a=i.length,o=0,s=0,u=a,c=new Array(a),f=[],l=function(){for(var e=0;e<f.length;++e)f[e]()},d=function(e,t){ic((function(){n(e,t)}))};ic((function(){d=n}));var p=function(){var e=new js(s+22),t=o,n=s-o;s=0;for(var r=0;r<u;++r){var i=c[r];try{var a=i.c.length;tc(e,s,i,i.f,i.u,a);var f=30+i.f.length+ec(i.extra),l=s+f;e.set(i.c,l),tc(e,o,i,i.f,i.u,a,s,i.m),o+=16+f+(i.m?i.m.length:0),s=l+a}catch(e){return d(e,null)}}nc(e,o,c.length,n,t),d(null,e)};a||p();for(var h=function(e){var t=i[e],n=r[t],u=n[0],h=n[1],g=vu(),m=u.length;g.p(u);var y=Hu(t),v=y.length,b=h.comment,x=b&&Hu(b),_=x&&x.length,w=ec(h.extra),S=0==h.level?0:8,A=function(n,r){if(n)l(),d(n,null);else{var i=r.length;c[e]=xu(h,{size:m,crc:g.d(),c:r,f:y,m:x,u:v!=t.length||x&&b.length!=_,compression:S}),o+=30+v+w+i,s+=76+2*(v+w)+(_||0)+i,--a||p()}};if(v>65535&&A(iu(11,0,1),null),S)if(m<16e4)try{A(null,Du(u,h))}catch(e){A(e,null)}else f.push(function(e,t,n){return n||(n=t,t={}),"function"!=typeof n&&iu(7),Ou(e,t,[Iu],(function(e){return Pu(Du(e.data[0],e.data[1]))}),0,n)}(u,h,A));else A(null,u)},g=0;g<u;++g)h(g);return l}var ic="function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout?setTimeout:function(e){e()};function ac(e,t,n){n||(n=t,t={}),"function"!=typeof n&&iu(7);var r=[],i=function(){for(var e=0;e<r.length;++e)r[e]()},a={},o=function(e,t){ic((function(){n(e,t)}))};ic((function(){o=n}));for(var s=e.length-22;101010256!=Fu(e,s);--s)if(!s||e.length-s>65558)return o(iu(13,0,1),null),i;var u=ku(e,s+8);if(u){var c=u,f=Fu(e,s+16),l=4294967295==f||65535==c;if(l){var d=Fu(e,s-12);(l=101075792==Fu(e,d))&&(c=u=Fu(e,d+32),f=Fu(e,d+48))}for(var p=t&&t.filter,h=function(t){var n=Qu(e,f,l),s=n[0],c=n[1],d=n[2],h=n[3],g=n[4],m=n[5],y=Zu(e,m);f=g;var v=function(e,t){e?(i(),o(e,null)):(t&&(a[h]=t),--u||o(null,a))};if(!p||p({name:h,size:c,originalSize:d,compression:s}))if(s)if(8==s){var b=e.subarray(y,y+c);if(c<32e4)try{v(null,Uu(b,new js(d)))}catch(e){v(e,null)}else r.push(function(e,t,n){return n||(n=t,t={}),"function"!=typeof n&&iu(7),Ou(e,t,[Au],(function(e){return Pu(Uu(e.data[0],ju(e.data[1])))}),1,n)}(b,{size:d},v))}else v(iu(14,"unknown compression type "+s,1),null);else v(null,nu(e,y,y+c));else v(null,null)},g=0;g<c;++g)h()}else o(null,{});return i}function oc(){return"undefined"!=typeof window&&void 0!==window.document}var sc=Object.freeze({__proto__:null,runningInBrowser:oc});function uc(e){return e.length>2&&e.buffer instanceof ArrayBuffer&&31==e[0]&&139==e[1]}function cc(e,t){return"string"==typeof e&&(e=Hu(e)),oc()?qu(e,t):require("zlib").gzipSync(e,t)}async function fc(e,n){return"string"==typeof e&&(e=Hu(e)),(oc()?t.promisify(Ru):t.promisify(require("zlib").gzip))(e,n)}async function lc(e,n){e instanceof ArrayBuffer&&(e=new Uint8Array(e)),n=n||{};var r=oc()?t.promisify($u):t.promisify(require("zlib").gunzip),i=await r(e,n);return n.filename&&!Uc(n.filename)&&(i=Xu(i)),i}function dc(e,t){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var n=Vu(e);return t&&!Uc(t)&&(n=Xu(n)),n}var pc=Object.freeze({__proto__:null,isGzipped:uc,gzipSync:cc,gzipAsync:fc,gunzipAsync:lc,gunzipSync:dc});async function hc(e){var t=e.getFields(),n=e.getRecords(),r=[],i=await Promise.all(t.map((function(e){var t=Cr(e,n);return r.push(t),async function(e,t,n){if("number"==t||"string"==t)return fc(JSON.stringify(Br(n,e)),{level:2,consume:!0});return Br(n,e)}(e,t,n)})));return{fields:t,types:r,data:i,size:n.length}}function gc(e){return t=e,Array.isArray(t.fields)&&Array.isArray(t.types)&&Array.isArray(t.data)&&t.fields.length==t.types.length&&t.fields.length==t.data.length&&t.size>=0?function(e){for(var t=e.size,n=[],r=0;r<t;r++)n[r]={};for(var i=0,a=e.fields.length;i<a;i++)mc(e.fields[i],e.types[i],e.data[i],n),e.data[i]=null;return n}(e):uc(e)?JSON.parse(Xu(dc(e))):Array.isArray(e)?e:void dt("Unknown packed table format");var t}function mc(e,t,n,r){var i;uc(n)?i=JSON.parse(Xu(dc(n))):Array.isArray(n)?i=n:dt("Unexpected packed table format");for(var a=0,o=r.length;a<o;a++)r[a][e]=i[a]}var yc="msx";async function vc(e,t){return[{content:bc(await xc(e,t)),filename:t.file||"mapshaper_snapshot."+yc}]}function bc(e){return Is(e,{})}async function xc(e,t){var n={version:1,created:(new Date).toISOString(),datasets:await Promise.all(e.map(wc))};return t.compact&&await _c(n),n}async function _c(e,t){var n=[];e.datasets.forEach((e=>{e.arcs&&n.push(async function(e,t){var n=Object.assign({level:1,consume:!1},t),r=[fc(e.nn,n),fc(e.xx,n),fc(e.yy,n)];e.zz&&r.push(fc(e.zz,n));var i=await Promise.all(r);e.nn=i.shift(),e.xx=i.shift(),e.yy=i.shift(),e.zz&&(e.zz=i.shift())}(e.arcs,t))})),await Promise.all(n)}async function wc(e,t){return{arcs:e.arcs?(n=e.arcs,r=n.getVertexData(),{nn:Sc(r.nn),xx:Sc(r.xx),yy:Sc(r.yy),zz:r.zz?Sc(r.zz):null,zlimit:n.getRetainedInterval()}):null,info:e.info?Ic(e.info):null,layers:await Promise.all((e.layers||[]).map(Ac))};var n,r}function Sc(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async function Ac(e){var t=null;return e.data&&(t=await hc(e.data)),{name:e.name||null,geometry_type:e.geometry_type||null,shapes:e.shapes||null,data:t,menu_order:e.menu_order||null,pinned:e.pinned||!1,active:e.active||!1}}function Ic(e){return!(e=Object.assign({},e)).crs||e.crs_string||e.prj||(e.crs_string=Ri(e.crs)),delete e.crs,e}var Mc=Object.freeze({__proto__:null,PACKAGE_EXT:yc,exportPackedDatasets:vc,pack:bc,exportDatasetsToPack:xc,applyCompression:_c,exportDataset:wc,exportInfo:Ic});function Ec(e){var t=to(e||"").toLowerCase(),n=null;return"dbf"==t||"shp"==t||"prj"==t||"shx"==t||"kml"==t||"cpg"==t?n=t:/json$/.test(t)?n="json":"csv"==t||"tsv"==t||"txt"==t||"tab"==t?n="text":t==yc&&(n=yc),n}function Pc(e){var n=null;return t.isString(e)?n=(Oc(e)?"json":kc(e)&&"kml")||"text":(t.isObject(e)&&e.type||t.isArray(e))&&(n="json"),n}function jc(e,t){return Ec(e)||Pc(t)}function Oc(e){return/^\s*[{[]/.test(String(e))}function kc(e){return(e=String(e)).includes("<kml ")&&e.includes('xmlns="http://www.opengis.net/kml/')}function Fc(e){var t=to(e).toLowerCase();return/csv|tsv|txt$/.test(t)}function zc(e){var t=Ec(e);return!!t&&"gz"!=t&&"zip"!=t}function Cc(e){return e.endsWith("."+yc)}function Nc(e){return/\.zip$/i.test(e)}function Tc(e){return/\.kmz$/i.test(e)}function Lc(e){return/\.gz/i.test(e)}function Bc(e){return["geojson","topojson","json","dsv","dbf","shapefile","svg","kml",yc].indexOf(e)>-1}function Dc(e){var t=to(e).toLowerCase();return"shp"==t||"shx"==t||"dbf"==t||t==yc}function Uc(e){var t=Ec(e);return Dc(e)||Nc(e)||Lc(e)||Tc(e)||Cc(e)||"json"==t||"text"==t}function Rc(e){return/\.(shx|prj|xls|xlsx|gdb|sbn|sbx|xml)$/i.test(e)}var qc=Object.freeze({__proto__:null,guessInputFileType:Ec,guessInputContentType:Pc,guessInputType:jc,stringLooksLikeJSON:Oc,stringLooksLikeKML:kc,couldBeDsvFile:Fc,looksLikeImportableFile:function(e){return!!Ec(e)},looksLikeContentFile:zc,isPackageFile:Cc,isZipFile:Nc,isKmzFile:Tc,isGzipFile:Lc,isSupportedOutputFormat:Bc,getFormatName:function(e){return{geojson:"GeoJSON",topojson:"TopoJSON",json:"JSON records",dsv:"CSV",dbf:"DBF",kml:"KML",kmz:"KMZ",[yc]:"Snapshot file",shapefile:"Shapefile",svg:"SVG"}[e]||""},isSupportedBinaryInputType:Dc,isImportableAsBinary:Uc,filenameIsUnsupportedOutputType:Rc});function $c(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),!oc())return function(e){var t=new require("adm-zip")(e),n={};return t.getEntries().forEach((function(e){var t=io(e.name);Wc(t)&&(n[t]=e.getData())})),n}(e);var t=function(e,t){for(var n={},r=e.length-22;101010256!=Fu(e,r);--r)(!r||e.length-r>65558)&&iu(13);var i=ku(e,r+8);if(!i)return{};var a=Fu(e,r+16),o=4294967295==a||65535==i;if(o){var s=Fu(e,r-12);(o=101075792==Fu(e,s))&&(i=Fu(e,s+32),a=Fu(e,s+48))}for(var u=t&&t.filter,c=0;c<i;++c){var f=Qu(e,a,o),l=f[0],d=f[1],p=f[2],h=f[3],g=f[4],m=f[5],y=Zu(e,m);a=g,u&&!u({name:h,size:d,originalSize:p,compression:l})||(l?8==l?n[h]=Uu(e.subarray(y,y+d),new js(p)):iu(14,"unknown compression type "+l):n[h]=nu(e,y,y+d))}return n}(e,{filter:Gc});return Jc(t)}function Vc(e){return oc()?function(e,t){t||(t={});var n={},r=[];Gu(e,"",n,t);var i=0,a=0;for(var o in n){var s=n[o],u=s[0],c=s[1],f=0==c.level?0:8,l=(S=Hu(o)).length,d=c.comment,p=d&&Hu(d),h=p&&p.length,g=ec(c.extra);l>65535&&iu(11);var m=f?Du(u,c):u,y=m.length,v=vu();v.p(u),r.push(xu(c,{size:u.length,crc:v.d(),c:m,f:S,m:p,u:l!=o.length||p&&d.length!=h,o:i,compression:f})),i+=30+l+g+y,a+=76+2*(l+g)+(h||0)+y}for(var b=new js(a+22),x=i,_=a-i,w=0;w<r.length;++w){var S=r[w];tc(b,S.o,S,S.f,S.u,S.c.length);var A=30+S.f.length+ec(S.extra);b.set(S.c,S.o+A),tc(b,i,S,S.f,S.u,S.c.length,S.o,S.m),i+=16+A+(S.m?S.m.length:0)}return nc(b,i,r.length,_,x),b}(Yc(e)):function(e){var t=new require("adm-zip")();return e.forEach((function(e){var n=e.content;n instanceof ArrayBuffer?n=new Uint8Array(n):n instanceof Buffer||n instanceof Uint8Array||(n=Buffer.from(e.content)),t.addFile(e.filename,n)})),t.toBuffer()}(e)}function Gc(e){return Wc(e.name)}function Jc(e){return Object.keys(e).reduce((function(t,n){var r=Ka(n).filename,i=e[n];return Uc(r)||(i=Xu(i)),t[r]=i,t}),{})}function Wc(e){var t=Ka(e);return zc(e)&&!/^__MACOSX/.test(e)&&"."!=t.filename[0]}function Yc(e){var t={};return e.forEach((function(e){"string"==typeof e.content?e.content=Hu(e.content):e.content instanceof ArrayBuffer&&(e.content=new Uint8Array(e.content)),t[e.filename]=e.content})),t}var Hc=Object.freeze({__proto__:null,unzipSync:$c,unzipAsync:function(e,t){oc()||dt("Async unzipping only supported in the browser"),e instanceof ArrayBuffer&&(e=new Uint8Array(e)),ac(e,{filter:Gc},(function(e,n){e&&t(e),t(null,Jc(n))}))},zipSync:Vc,zipAsync:function(e,t){rc(Yc(e),{},t)},isImportableZipPath:Wc}),Xc={};function Zc(e,t,n){return Qc(e,t,n=n||function(){})}Xc.isFile=function(e,t){if(t&&e in t)return!0;if(oc())return!1;var n=Xc.statSync(e);return n&&n.isFile()||!1},Xc.checkCommandEnv=function(e){oc()&&["i","include","require","external"].includes(e)&&pt("The -"+e+" command cannot be run in the browser")},Xc.isDirectory=function(e){if(oc())return!1;var t=Xc.statSync(e);return t&&t.isDirectory()||!1},Xc.readFile=function(e,t,n){var r;return n&&e in n?(r=n[e],delete n[e]):"/dev/stdin"==e?r=pr("rw").readFileSync(e):((i("input_files")||[]).push(e),r=pr("fs").readFileSync(e)),t&&s.isBuffer(r)&&(r=Er(Ir(r,t))),r},Xc.createDirIfNeeded=function(e){var t=Ka(e).directory;if(t&&!Xc.isDirectory(t)&&"/dev/stdout"!=e)try{pr("fs").mkdirSync(t,{recursive:!0}),gt("Created output directory:",t)}catch(e){pt("Unable to create output directory:",t)}},Xc.writeFile=function(e,t,n){var r=pr("rw");Xc.createDirIfNeeded(e),n?r.writeFile(e,t,n):r.writeFileSync(e,t)},Xc.convertArrayBuffer=function(e){for(var n=new Uint8Array(e),r=t.createBuffer(n.length),i=0,a=n.length;i<a;i++)r[i]=n[i];return r},Xc.expandDirectoryName=function(e){var n=Ka(e);if(!n.filename.includes("*"))return[e];var r=t.wildcardToRegExp(n.filename),i=[];return pr("fs").readdirSync(n.directory||".").forEach((function(e){var t=n.directory?pr("path").join(n.directory,e):e;r.test(e)&&Xc.isDirectory(t)&&i.push(t)})),i},Xc.expandFileName=function(e){var n=Ka(e),r=t.wildcardToRegExp(n.filename),i=Xc.expandDirectoryName(n.directory||"."),a=[];try{i.forEach((function(e){pr("fs").readdirSync(e).forEach((function(t){var n=pr("path").join(e,t);r.test(t)&&Xc.isFile(n)&&a.push(n)}))}))}catch(e){}return 0===a.length&&pt("No files matched ("+e+")"),a},Xc.expandInputFiles=function(e){return e.reduce((function(e,t){return t.indexOf("*")>-1?e=e.concat(Xc.expandFileName(t)):e.push(t),e}),[])},Xc.validateOutputDir=function(e){Xc.isDirectory(e)||oc()||dt("Output directory not found:",e)},Xc.checkFileExists=function(e,t){Xc.isFile(e,t)||"/dev/stdin"==e||pt("File not found ("+e+")")},Xc.statSync=function(e){var t=null;try{t=pr("fs").statSync(e)}catch(e){}return t};var Qc=function(e,n,r){if(e.length>0==!1)gt("No files to save");else if(n.dry_run);else{if(n.stdout)return Xc.writeFile("/dev/stdout",e[0].content,r);n.zip&&(e=[{filename:n.zipfile||"output.zip",content:Vc(e)}]);var a=Kc(t.pluck(e,"filename"),n),o=i("input_files");e.forEach((function(e,t){var r=a[t];e.content instanceof ArrayBuffer&&(e.content=Xc.convertArrayBuffer(e.content)),n.output?n.output.push({filename:r,content:e.content}):(!n.force&&o.indexOf(r)>-1&&pt('Need to use the "-o force" option to overwrite input files.'),Xc.writeFile(r,e.content),gt("Wrote "+r))}))}r&&r(null)};function Kc(e,t){var n=t.directory;return n&&(e=e.map((function(e){return pr("path").join(n,e)}))),e}var ef=Object.freeze({__proto__:null,writeFiles:Zc,replaceWriteFiles:function(e){Qc=e},getOutputPaths:Kc});function tf(e){var t,n;if(!e.length)return function(){return[]};function r(t){return e[t]}return n=pr("flatbush"),t=new n(e.length),e.forEach((function(e){var n=e.bounds;t.add(n.xmin,n.ymin,n.xmax,n.ymax)})),t.finish(),function(e,n,i,a){return t.search(e,n,i,a).map(r)}}function nf(e,t){!function(e,t,n){function r(e,n){var r=t[e];t[e]=t[n],t[n]=r}for(var i=0,a=t.length;i<a;i+=2)e[t[i]]>e[t[i+1]]&&r(i,i+1)}(e,t),af(e,t,0,t.length-2)}function rf(e,t,n,r){for(var i,a,o=n+2;o<=r;o+=2){i=t[o],a=t[o+1];for(var s=o-2;s>=n&&e[i]<e[t[s]];s-=2)t[s+2]=t[s],t[s+3]=t[s+1];t[s+2]=i,t[s+3]=a}}function af(e,t,n,r){for(var i,a,o=n,s=r;o<r;){for(i=e[t[n+r>>2<<1]];o<=s;){for(;e[t[o]]<i;)o+=2;for(;e[t[s]]>i;)s-=2;o<=s&&(a=t[o],t[o]=t[s],t[s]=a,a=t[o+1],t[o+1]=t[s+1],t[s+1]=a,o+=2,s-=2)}if(s-n<40?rf(e,t,n,s):af(e,t,n,s),r-o<40)return void rf(e,t,o,r);n=o,s=r}}function of(e,t,n){var r,i,a,o,s,u,c=t.getVertexData(),f=t.getMultiShapeBounds(e);function l(e,t,n){var r,u,f,l=s[n],d=0,p=c.xx,h=c.yy;r=n==o?i.length-l:s[n+1]-l;for(var g=0;g<r;g++)u=i[g+l],f=a[g+l],d+=$n.testRayIntersection(e,t,p[u],h[u],p[f],h[f]);return d}function d(e){var t=Math.floor((e-r)/u);return t<0&&(t=0),t>=o&&(t=o-1),t}!function(){var n,f,l,p,h,g,m,y,v,b,x=c.xx,_=0,w=0,S=-1;Kn(e,t,(function(){_++})),f=new Uint32Array(2*_),m=0,Kn(e,t,(function(e,t,n,r){f[m++]=e,f[m++]=t})),nf(x,f),i=new Uint32Array(_),a=new Uint32Array(_),o=function(e){var t=Math.pow(e,.75)/10;return Math.ceil(t)}(_),s=new Uint32Array(o+1),r=x[f[0]],u=(x[f[f.length-2]]-r)/o,l=0,p=_-1;for(;w<_;){for(h=f[y=2*w],g=f[y+1],v=x[h],b=x[g],n=S,S=d(v);S>n;)n++,s[n]=l;b-v>=0==!1&&dt("Invalid segment"),d(b)-S>1?(i[p]=h,a[p]=g,p--):(i[l]=h,a[l]=g,l++),w++}s[o]=l,l!=p+1&&dt("Segment indexing error")}(),this.pointInPolygon=function(e,t){if(!f.containsPoint(e,t))return!1;var n=d(e),r=l(e,t,n);return n>0&&(r+=l(e,t,n-1)),r+=l(e,t,o),isNaN(r)?-1:r%2==1?1:0}}function sf(e,n){var r=tf(function(e,t){var n=[];return e.forEach((function(e,r){for(var i=e?e.length:0,a=0;a<i;a++)n.push({ids:e[a],id:r,bounds:t.getSimpleShapeBounds(e[a])})})),n}(e,n)),i=Yn(e,n).area();function a(e,t){return!!t.bounds.containsPoint(e[0],e[1])&&(!t.index&&t.bounds.area()>.01*i&&(t.index=new of([t.ids],n)),t.index?t.index.pointInPolygon(e[0],e[1]):$n.testPointInRing(e[0],e[1],t.ids,n))}function o(e,t){var n=!1,r=!1;return t.forEach((function(t){var i=a(e,t);-1==i?n=!0:1==i&&(r=!r)})),n||r}function s(e){var t,n,r=[];if(e.length>0){e.sort((function(e,t){return e.id-t.id}));for(var i=0;i<e.length;i++)n=e[i],0!==i&&n.id==e[i-1].id||r.push(t=[]),t.push(n)}return r}function u(e,t){var n=t>0?t:0;return e[0],e[1],r(e[0]-n,e[1]-n,e[0]+n,e[1]+n)}function c(e){var t=e[0],r=n.getVertex(t,0),i=n.getVertex(t,1);return[(r.x+i.x)/2,(r.y+i.y)/2]}this.findEnclosingShapes=function(e){var t=[];return s(u(e)).forEach((function(n){o(e,n)&&t.push(n[0].id)})),t},this.findEnclosingShape=function(e){var t=-1;return s(u(e)).forEach((function(n){o(e,n)&&(t=n[0].id)})),t},this.findShapesEnclosingArc=function(e){var t=c([e]);return this.findEnclosingShapes(t)},this.findPointEnclosureCandidates=function(e,n){var r=u(e,n);return t.pluck(r,"id")},this.pointIsEnclosed=function(e){return o(e,u(e))},this.findSmallestEnclosingPolygon=function(e){var t,r=n.getSimpleShapeBounds(e),i=c(e);return u(i).forEach((function(e){!e.bounds.contains(r)||e.bounds.sameBounds(r)||t&&t.bounds.area()<e.bounds.area()||a(i,e)&&(t=e)})),t?t.id:-1},this.arcIsEnclosed=function(e){return this.pointIsEnclosed(c([e]))},this.pathIsEnclosed=function(e){return this.pointIsEnclosed(c(e))},this.findEnclosedPaths=function(e){var t,i=n.getSimpleShapeBounds(e),a=r(i.xmin,i.ymin,i.xmax,i.ymax),o=[];return a.length>6&&(t=new of([e],n)),a.forEach((function(r){var a=c(r.ids);i.containsPoint(a[0],a[1])&&i.contains(r.bounds)&&(t?t.pointInPolygon(a[0],a[1]):$n.testPointInRing(a[0],a[1],e,n))&&o.push(r.ids)})),o.length>0?o:null},this.findPathsInsideShape=function(e){var t=[];return e.forEach((function(e){var n=this.findEnclosedPaths(e);n&&(t=function(e,t){var n,r=[];for(n=0;n<e.length;n++)-1==t.indexOf(e[n])&&r.push(e[n]);for(n=0;n<t.length;n++)-1==e.indexOf(t[n])&&r.push(t[n]);return r}(t,n))}),this),t.length>0?t:null}}function uf(e,t){e.shapes=e.shapes.map((function(e){return e?function(e,t){var n=ir(e,t,"polygon");return n.sort((function(e,t){return Math.abs(t.area)-Math.abs(e.area)})),n.forEach((function(e,r){for(var i,a,o,s=!0,u=r;--u>=0;)if(cf(e,i=n[u],t)){s=!(i.area>0);break}o=s,(a=e).area>0!=o&&(a.area=-a.area,Hn(a.ids))})),n.map((function(e){return e.ids}))}(e,t):null}))}function cf(e,t,n){if(!1===t.bounds.contains(e.bounds))return!1;var r=function(e,t){var n=t.getVertex(e,0),r=t.getVertex(e,1);return{x:(n.x+r.x)/2,y:(n.y+r.y)/2}}(e.ids[0],n);return 1==$n.testPointInRing(r.x,r.y,t.ids,n)}function ff(e,t,n){var r,i=[],a=[],o=n?-1:1;return(e||[]).forEach((function(e){e.area*o>0?a.push([e]):e.area*o<0&&i.push(e)})),0===i.length||(r=tf(a.map((function(e,t){return{bounds:e[0].bounds,idx:t}}))),i.forEach((function(e){for(var n,i,s,u,c=-1,f=0,l=e.area*-o,d=e.bounds,p=r(d.xmin,d.ymin,d.xmax,d.ymax),h=0,g=p.length;h<g;h++)i=p[h].idx,s=(n=a[i][0]).area*o,(u=n.bounds.contains(e.bounds)&&s>l)&&p.length>1&&!cf(e,n,t)||u&&(0===f||s<f)&&(f=s,c=i);-1==c?xt("[groupPolygonRings()] polygon hole is missing a containing ring, dropping."):a[c].push(e)}))),a}function lf(e){var t;return e&&0!==e.length?{bounds:(t={points:e,pointCount:e.length,bounds:$n.getPathBounds(e)}).bounds,pathData:[t],partCount:1,pointCount:t.pointCount}:{partCount:0,pointCount:0}}function df(e,t,n){if("point"==n)return lf(e);var r=0,i=new kt,a=[];return!e||"polyline"!=n&&"polygon"!=n||e.forEach((function(e,o){var s=function(e){var t,n,r,i,a=[],o=0;for(;e.hasNext();)t=e.x,n=e.y,0!==o&&r==t&&i==n||(a.push([t,n]),o++),r=t,i=n;return{points:a,pointCount:a.length}}(t.getShapeIter(e)),u=!0;s.ids=e,"polygon"==n?(s.area=$n.getPlanarPathArea2(s.points),u=s.pointCount>3&&0!==s.area):"polyline"==n&&(u=s.pointCount>1),u?(r+=s.pointCount,s.bounds=$n.getPathBounds(s.points),i.mergeBounds(s.bounds),a.push(s)):bt("Skipping a collapsed",n,"path")})),{pointCount:r,pathData:a,pathCount:a.length,bounds:i}}var pf=Object.freeze({__proto__:null,exportPointData:lf,exportPathData:df});function hf(e){return JSON.stringify(e).replace(/\n/g,"\n").replace(/\r/g,"\r")}function gf(e){var n=t.arrayToIndex(e),r="á€€â¿•Ì",i=new RegExp('"á€€â¿•Ì|á€€â¿•Ì"',"g");function a(e,i){if(e in n&&t.isArray(i)){var a=JSON.stringify(i);if(a.indexOf(!1))return r+a.replace(/,/g,", ")+r}return i}return function(e){return JSON.stringify(e,a,"  ").replace(i,"")}}var mf=Object.freeze({__proto__:null,stringifyAsNDJSON:hf,getFormattedStringify:gf});function yf(e,t){return t.getArcLength(e)>1}function vf(e,t,n){var r=t.arcs,i=r.getVertexData(),a=i.xx,o=i.yy,s=t.getConnectedArcs(e),u=e;if(n&&(s=s.filter(n)),!yf(e,r)||0===s.length)return e;var c,f,l,d,p=r.indexOfVertex(e,-1),h=a[p],g=o[p],m=r.indexOfVertex(e,-2),y=a[m],v=o[m];for(d=0;d<s.length;d++)yf(f=s[d],r)&&(l=r.indexOfVertex(f,-2),u!=e?2==bf(y,v,h,g,a[c],o[c],a[l],o[l])&&(c=l,u=f):(c=l,u=f));return u==e&&dt("Pathfinder error"),u}function bf(e,t,n,r,i,a,o,s){var u,c=$n.signedAngle(e,t,n,r,i,a),f=$n.signedAngle(e,t,n,r,o,s);return c<=0||f<=0?(xt("[chooseRighthandPath()] 0 angle(s):",c,f),c<=0&&xt("  A orient2D:",$n.orient2D(e,t,n,r,i,a)),f<=0&&xt("  B orient2D:",$n.orient2D(e,t,n,r,o,s)),u=c>0?1:f>0?2:0):c<f?u=1:f<c?u=2:isNaN(c)||isNaN(f)?dt("Invalid node geometry"):xt("[chooseRighthandPath()] equal angles:",c,"fallback test:",u=xf(i-n,a-r,o-n,s-r)),u}function xf(e,t,n,r){var i=$n.orient2D(e,t,0,0,n,r);return i>0?2:i<0?1:0}var _f=Object.freeze({__proto__:null,getRightmostArc:vf,chooseRighthandVector:xf}),wf=8,Sf=128;function Af(e,t,n){return e&~n|t&n}function If(e,t,n){var r,i=Lt(t);i==t?r=-4:(r=-49,e<<=4),n[i]&=e|r}function Mf(e,t){var n=Lt(e),r=t[n];return n!=e&&(r>>=4),7&r}function Ef(e,t){Qn(e,(function(e){e<0?t[~e]|=Sf:t[e]|=wf}))}function Pf(e,t,n,r,i,a,o){Qn(e,(function(e){var s=e<0,u=s?~e:e,c=n[u],f=s?i:r,l=s?r:i,d=c;t.arcIsLollipop(e)?(xt("lollipop"),d=0):(f&&(d|=3),l&&(d|=48),o>0&&(d|=o),a&&34==(34&d)&&(d&=-18)),n[u]=d}))}function jf(e,t,n,r,i,a){Qn(e,(function(e){var t=e<0,o=t?~e:e,s=n[o],u=255;(t?i:r)&&(a&&(u&=-2),u^=2),(t?r:i)&&(a&&(u&=-17),u^=32),n[o]=s&u}))}function Of(e,t,n){var r=null;return n&&(r=function(e){return n(~e)}),function(n){var i,a,o=[],s=n;if(a=n,e.arcs.getArcLength(a)>1==0)return null;do{if(!t(s))return null;if(o.push(s),(s=~vf(i=s,e,r))==~i)return xt("Pathfinder warning: dead-end path"),null}while(s!=n);return 0===o.length?null:o}}function kf(e,t){var n=e.arcs,r=Of(e,(function(e){var n=Mf(e,t),r=!1;3==n&&(r=!0,If(1,e,t));return r}),(function(e){var n=Mf(e,t);return 1==(1&n)}));return t=t||new Uint8Array(n.size()),function(e,i){var a,o="dissolve"==i,s="flatten"==i;return e.length>0?(a=[],Pf(e,n,t,true,s,o),ur(e,(function(e){for(var t,n=0,i=e.length;n<i;n++)(t=r(e[n]))&&a.push(t)})),jf(e,0,t,true,s,!0)):a=e,a}}var Ff=Object.freeze({__proto__:null,setBits:Af,andBits:function(e,t,n){return e&(~n|t)},setRouteBits:If,getRouteBits:Mf,markPathsAsUsed:Ef,openArcRoutes:Pf,closeArcRoutes:jf,getPathFinder:Of,getRingIntersector:kf});function zf(e,t){return+e.toPrecision(t)}function Cf(e,t){return+e.toFixed(t)}function Nf(e,t){var n=1;if(!e&&0!==e)return e;for(t|=0;t-- >0;)n*=10;return Math.round(e*n)/n}function Tf(e){return Math.round(10*e)/10}function Lf(e){t.isNumber(e)&&0!==e||dt("Rounding increment must be a non-zero number.");var n=1/e;return n>1&&(n=Math.round(n)),function(e){return Math.round(e*n)/n}}function Bf(e){for(var t=Math.abs(e[2]-e[0]),n=Math.abs(e[3]-e[1]),r=Math.max(t,n)+1e-8,i=0;r<2e3;)r*=10,i++;return i}function Df(e,t){return e.map((function(e){return e.toFixed(t)})).join(",")}function Uf(e,t){var n=Lf(t);return Za(e,(function(e,t){return[n(e),n(t)]})),e}var Rf=Object.freeze({__proto__:null,roundToSignificantDigits:zf,roundToDigits:Cf,roundToDigits2:Nf,roundToTenths:Tf,getRoundingFunction:Lf,getBoundsPrecisionForDisplay:Bf,getRoundedCoordString:Df,getRoundedCoords:function(e,t){return Df(e,t).split(",").map(parseFloat)},roundPoints:function(e,t){Nt(e.shapes,(function(e){e[0]=t(e[0]),e[1]=t(e[1])}))},setCoordinatePrecision:Uf}),qf={m:"meters",meter:"meters",meters:"meters",mi:"miles",mile:"miles",miles:"miles",km:"kilometers",ft:"feet",feet:"feet"},$f={meters:1,kilometers:1e3,feet:.3048,miles:1609.344};function Vf(e,t){var n,r=0,i=0;return t&&(t.is_latlong?i=1:t.to_meter>0?i=t.to_meter:dt("Invalid CRS")),e&&((r=$f[e])||dt("Unknown units:",e)),r&&i?n=r/i:r||i?r&&!i?pt("Unable to convert",e,"to unknown coordinates"):!r&&i&&(n=1/i):n=1,n}function Gf(e){var t=Jf(e);return isNaN(t.value)&&pt("Invalid parameter:",e),t}function Jf(e){var n=t.isString(e)?e:"",r=/(sq|)([a-z]+)(2|)$/i.exec(n),i={};return t.isNumber(e)?i.value=e:""===n?i.value=NaN:r?(i.units=qf[r[2].toLowerCase()],i.areal=!(!r[1]&&!r[3]),i.value=Number(n.substring(0,n.length-r[0].length)),i.units||isNaN(i.value)||pt("Unknown units: "+r[0])):i.value=Number(n),i}function Wf(e,t){var n=Gf(e),r=Vf(n.units,t);return n.value*r*r}function Yf(e,t){var n=Gf(e),r=Vf(n.units,t);return n.areal&&pt("Expected a distance, received an area:",e),n.value*r}function Hf(e,t){var n=Gf(e),r=Vf(n.units,t);return n.units&&t&&t.is_latlong&&pt("Parameter does not support distance units with latlong datasets"),n.areal&&pt("Expected a distance, received an area:",e),n.value*r}function Xf(e,t){var n,r;return Array.isArray(e)&&2==e.length||pt("Expected two distance parameters, received",e),n=Gf(e[0]),r=Gf(e[1]),(n.units&&!r.units||r.units&&!n.units)&&pt("Both parameters should have units:",e),[Hf(e[0],t),Hf(e[1],t)]}function Zf(e,t,n){var r=e.split(",");return 1==r.length?r=[r[0],r[0],r[0],r[0]]:4!=r.length&&pt("Expected a distance parameter or a list of four params"),r.map((function(r,i){return r.indexOf("%")>0?(parseFloat(r)/100||0)*(1==i||3==i?n.height():n.width()):Hf(e,t)}))}function Qf(e,t){var n=t&&t.to_meter?e*t.to_meter*t.to_meter:e,r=n/1e6;return r<.01?Math.round(n)+" sqm":r+" sqkm"}var Kf=Object.freeze({__proto__:null,getIntervalConversionFactor:Vf,parseMeasure:Gf,parseMeasure2:Jf,convertAreaParam:Wf,convertDistanceParam:Yf,convertIntervalParam:Hf,convertIntervalPair:Xf,convertFourSides:Zf,getAreaLabel:Qf});function el(e,t,n){var r=n.min_gap_area||n.min_area||n.gap_fill_area;if(0==+r)return{filter:function(){return!1},threshold:0};var i=n.sliver_control>=0?n.sliver_control:0,a=Qi(t),o=r&&"auto"!=r?Wf(r,a):rl(e,t.arcs),s=i>0?tl(t.arcs,o,i):function(e,t){var n=t.arcs.isPlanar()?$n.getPlanarPathArea:$n.getSphericalPathArea;return function(r){var i=n(r,t.arcs);return Math.abs(i)<e}}(o,t);return{threshold:o,filter:s,label:function(e,t){t&&(e=e.replace(" ","+ ")+" variable");return e+" threshold"}(Qf(o,a),i>0)}}function tl(e,t,n){n>=0==!1&&(n=1),(n>1||t>=0==!1)&&dt("Invalid parameter");var r=nl(e,n);return function(e){return Math.abs(r(e))<t}}function nl(e,t){var n=Math.sqrt(t);return function(t){var r=$n.getPathArea(t,e),i=$n.getPathPerimeter(t,e),a=$n.calcPolsbyPopperCompactness(r,i);return r*(n*a+1-n)}}function rl(e,t){var n=0,r=t.isPlanar()?$n.distance2D:$n.greatCircleDistance,i=0,a=0,o=function(e,t,n,o){var s=r(n[e],o[e],n[t],o[t]);a++,i+=(s-i)/a};cr(e.shapes,(function(e){n++,er(e,t,o)}));var s=a/n||0,u=Math.pow(s,.75),c=i*i/50*u;return c=zf(c,2)}var il=Object.freeze({__proto__:null,getSliverFilter:el,getSliverTest:tl,getSliverAreaFunction:nl,getDefaultSliverThreshold:rl,calcMaxSliverArea:function(e){var t=e.getBounds().width()/2,n=e.getBounds().height()/2,r=0,i=0;return e.forEachSegment((function(e,a,o,s){var u=Math.abs(o[e]-o[a]),c=Math.abs(s[e]-s[a]);u<t&&c<n&&(i+=(Math.sqrt(u*u+c*c)-i)/++r)})),i*i}});var al={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ol=/^rgba?\(([^)]+)\)/,sl=/^#([a-f0-9]{3,8})/i;function ul(e){e=e?String(e):"";var t,n,r=sl.test(e)?e:al[e.toLowerCase().replace(/[ -]+/g,"")],i=null;return r?i=function(e){var t=sl.exec(e)[1];3!=t.length&&4!=t.length||(t=t.split("").map((function(e){return e+e})));return 6!=t.length&&8!=t.length?null:{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8==t.length?parseInt(t.substr(7,2),16)/255:1}}(r):ol.test(e)&&(i=function(e){var t=ol.exec(e)[1],n=t.split(",").map((function(e){return parseFloat(e)}));return{r:n[0],g:n[1],b:n[2],a:n[3]>=0?n[3]:1}}(e)),!i||(t=i)&&fl(t.r)&&fl(t.g)&&fl(t.b)&&((n=t.a)>=0&&n<=1)||(i=null),i}function cl(e){return ul(e)||pt("Unsupported color:",e),!0}function fl(e){return e>=0&&e<256}function ll(e){return e.a<1?function(e){var n=dl(e.r)+","+dl(e.g)+","+dl(e.b);return e.a<1?"rgba("+n+","+(r=e.a,r=+r||0,r=Math.round(1e3*r)/1e3,t.clamp(r,0,1)+")"):"rgb("+n+")";var r}(e):function(e){return"#"+pl(e.r)+pl(e.g)+pl(e.b)}(e)}function dl(e){return Math.round(t.clamp(+e||0,0,255))}function pl(e){return dl(e).toString(16).padStart(2,"0")}function hl(e,n){var r,i,a;if(Array.isArray(e))r=e,i=n;else{r=[],i=[],a=Array.from(arguments);for(var o=0;o<a.length;o+=2)r.push(a[o]),i.push(a[o+1])}if(i=function(e){var n=t.sum(e);if(n>0==!1)return null;return e.map((function(e){return e/n}))}(i),!i)return"#eee";var s=r.reduce((function(e,t,n){var r=cl(t)&&ul(t),a=+i[n]||0;return e.r+=r.r*a,e.g+=r.g*a,e.b+=r.b*a,e}),{r:0,g:0,b:0});return ll(s)}function gl(e,t){var n=t?function(e){if(e in ml)return ml[e];var t=e;t=t.replace("[-]","(?<prefix>-)?"),t=t.replace(/\[[NSEW, +-]{2,}\]/,"(?<prefix>$&)"),t=t.replace(/D+(\.D+)?/,((e,t)=>{var n="[0-9]+";return t&&(n+="\\.[0-9]+"),`(?<d>${n})`})),t=t.replace(/(MM?)(\.M+)?/,((e,t,n)=>{var r=1==t.length?"[0-9]+":"[0-9][0-9]";return n&&(r+="\\.[0-9]+"),`(?<m>${r})`})),t=t.replace(/(SS?)(\.S+)?/,((e,t,n)=>{var r=1==t.length?"[0-9]+":"[0-9][0-9]";return n&&(r+="\\.[0-9]+"),`(?<s>${r})`})),t="^"+t+"$";try{ml[e]=new RegExp(t)}catch(t){pt("Invalid DMS format string:",e)}return ml[e]}(t):/^(?<prefix>[nsew+-]?)(?<d>[0-9.]+)[dÂ°]? ?(?<m>[0-9.]*)['â€²]? ?(?<s>[0-9.]*)["â€³]? ?(?<suffix>[nsew]?)$/i,r=n.exec(e.trim()),i=NaN;return r&&(i=+(r.groups.d||"0")+ +(r.groups.m||"0")/60+ +(r.groups.s||"0")/3600,(/[sw-]/i.test(r.groups.prefix||"")||/[sw]/i.test(r.groups.suffix||""))&&(i=-i)),i}var ml={};function yl(e,t){t||(t="[-]DÂ°M'S.SSS");var n,r,i,a=t,o=/(D+)[^M]*(M+)?[^S[\]]*(S+)?/.exec(t),s=o&&!!o[3],u=o&&!!o[2];(!o||s&&!u)&&pt("Invalid DMS format string:",t);var c=s&&o[3].length||u&&o[2].length||o[1].length,f=s&&/S\.(S+)/||u&&/M\.(M+)/||/D\.(D+)/,l=f.test(t)?f.exec(t)[1].length:0;if(u){var d=Math.pow(10,l),p=s?3600*d:60*d,h=Math.floor(Math.abs(e)*p+.5),g=function(e,t,n){var r=e.toFixed(n),i=r.split(".");return i.length>0&&(i[0]=i[0].padStart(t,"0"),r=i.join(".")),r}(h/d%60,c,l);s?(h=Math.floor(h/(60*d)),i=g,r=String(h%60).padStart(o[2].length,"0")):(h=Math.floor(h/d),r=g),n=String(Math.floor(h/60)).padStart(o[1].length,"0")}else n=Math.abs(e).toFixed(l);return a=(a=(a=(a=(a=a.replace(/\[-\]/,(t=>e<0?"-":""))).replace(/\[[+-]+\]/,(t=>e<0?"-":"+"))).replace(/\[[NS, ]+\]/,(t=>e<0?"S":"N"))).replace(/\[[EW, ]+\]/,(t=>e<0?"W":"E"))).replace(/D+(\.D+)?/,n),u&&(a=a.replace(/M+(\.M+)?/,r)),s&&(a=a.replace(/S+(\.S+)?/,i)),a}function vl(e){return e.replace(/\\\n/g," ")}function bl(e,n){if(!e||!n||e.length!=n.length-1)return null;for(var r,i,a,o=t.sum(e),s=Math.floor(o/2),u=0,c=1;c<n.length;c++){if(i=n[c-1],a=n[c],s<=(r=u+e[c-1]))return i+(s-u)/(r-u)*(a-i);u=r}return null}function xl(e,t){Object.keys(t).forEach((function(n){var r=t[n],i="function"==typeof r?{get:r}:{value:r,writable:!1};Object.defineProperty(e,n,i)}))}function _l(e,t,n){if(!e||!n)return null;var r=[],i=[],a=[],o=[];return e.forEach((function(e){for(var s=wl(e,t,n,r,i);s<4&&s>0;)r.pop(),i.pop(),s--;s>0&&(o.push([a.length]),a.push(s))})),{shape:o.length>0?o:null,arcs:new ma(a,r,i)}}function wl(e,t,n,r,i){for(var a,o,s,u,c=t.getShapeIter(e),f=0;c.hasNext();)s=c.x,u=c.y,(0===f||$n.distance2D(s,u,a,o)>n)&&(r.push(s),i.push(u),a=s,o=u,f++);return s==a&&u==o||(r.push(s),i.push(u),f++),f}var Sl=Object.freeze({__proto__:null,simplifyArcsFast:function(e,t){for(var n,r=[],i=[],a=[],o=0,s=e.size();o<s;o++)1==(n=wl([o],e,t,r,i))&&(n=0,r.pop(),i.pop()),a.push(n);return new ma(a,r,i)},simplifyPolygonFast:_l});function Al(e,t){var n,r=e&&$n.getMaxPath(e,t),i=r&&t.getSimpleShapeBounds(r);return i&&i.hasBounds()&&0!==i.area()&&(n=_l(e,t,.01*Math.sqrt(i.area()))).shape?function(e,t){var n,r,i,a,o,s,u,c=$n.getMaxPath(e,t),f=t.getSimpleShapeBounds(c),l=$n.getPathCentroid(c,t),d=function(e,t){var n=Math.max(t.width(),t.height())/2;return function(t,r){var i=$n.distance2D(e.x,e.y,t,r);return 1-Math.min(.6*i/n,.25)}}(l,f),p=$n.getPlanarPathArea(c,t);1==e.length&&1.2*p>f.area()?(a=5,i=.2):1==e.length&&1.7*p>f.area()?(a=7,i=.4):(a=11,i=.5);n=f.width()*i,r=l.x-n/2,o=n/a,s=Ml(e,t,r,r+n,a,d),s?(u=Ml(e,t,s.x-o/2,s.x+o/2,2,d)).distance>s.distance&&(s=u):(bt("[points inner] failed, falling back to centroid"),s=l);return s}(n.shape,n.arcs):null}function Il(e,n,r){var i=n.getBounds().ymin-1;return r.reduce((function(r,a){var o=function(e,n,r,i){var a,o,s,u=function(e,t,n,r){return n?n.reduce((function(n,i){var a=function(e,t,n,r){var i=[];er(n,r,(function(n,r,a,o){var s=$n.getRayIntersection(e,t,a[n],o[n],a[r],o[r]);s>-1/0&&i.push(s)})),i.length%2==1&&(i=[]);return i}(e,t,i,r);return n.concat(a)}),[]):[]}(e,n,r,i),c=[];t.genericSort(u);for(var f=0;f<u.length;f+=2)a=u[f],(s=((o=u[f+1])-a)/2)>0&&c.push({y:(a+o)/2,x:e,interval:s});return c}(a,i,e,n);return r.concat(o)}),[])}function Ml(e,t,n,r,i,a){var o,s,u,c=function(e,t,n){for(var r=(t-e)/(n+1),i=[],a=1;a<=n;a++)i.push(e+r*a);return i}(n,r,i),f=(r-n)/i,l=Il(e,t,c);l.forEach((function(e){e.interval*=a(e.x,e.y)})),l.sort((function(e,t){return t.interval-e.interval}));for(var d=0;d<l.length&&(u=l[d],!(o&&o.distance>u.interval));d++)s=El(u.x,u.y,e,t,f,a),(!o||s.distance>o.distance)&&(o=s);return o}function El(e,t,n,r,i,a){var o={x:e,y:t,distance:$n.getPointToShapeDistance(e,t,n,r)*a(e,t)};return Pl(o,n,r,i,a),Pl(o,n,r,-i,a),o}function Pl(e,t,n,r,i){for(var a,o=e.x,s=e.y,u=e.distance;s+=r,(a=$n.getPointToShapeDistance(o,s,t,n)*i(o,s))>.9*u&&$n.testPointInPolygon(o,s,t,n);)a>u&&(e.distance=u=a,e.y=s)}var jl=Object.freeze({__proto__:null,findAnchorPoint:Al});function Ol(e,t){var n=new Uint8Array(e.size());Qn(t,(function(e){e<0?n[~e]|=2:n[e]|=1})),this.isInnerArc=function(e){var t=Lt(e);return 3==n[t]}}function kl(e){return e.reduce((function(e,t){return t.layers.forEach((function(n){e.push({layer:n,dataset:t.dataset})})),e}),[])}function Fl(e,t,n){var r=Cl(e,t,!0);return n&&(r=r.filter((function(e){return e.layer.geometry_type==n}))),e.forEach((function(e){e.layer.target_id=-1})),r.forEach((function(e,t){e.layer.target_id=t})),zl(r)}function zl(e){var t=[],n=[];return e.forEach((function(e){var r=t.indexOf(e.dataset);-1==r?(t.push(e.dataset),n.push({layers:[e.layer],dataset:e.dataset})):n[r].layers.push(e.layer)})),n}function Cl(e,n,r){var i=[],a=[],o={};return n.split(",").forEach((function(t,n){var r=Nl(t),s=!1;e.forEach((function(e,t){t in o?s=!0:r(e.layer,t+1)&&(i.push(e),o[t]=!0,s=!0)})),0==s&&a.push(t)})),r&&a.length&&pt(t.format("Missing layer%s: %s",1==a.length?"":"s",a.join(","))),i}function Nl(e){var n=t.isInteger(Number(e)),r=n?null:t.wildcardToRegExp(e);return function(t,i){return n?String(i)==e:r.test(t.name||"")}}function Tl(e){return e.reduce((function(e,t){return e+t.layers.length}),0)}var Ll=Object.freeze({__proto__:null,expandCommandTargets:kl,findCommandTargets:Fl,groupLayersByDataset:zl,findMatchingLayers:Cl,getLayerMatch:Nl,countTargetLayers:Tl,getLayerTargetId:function(e,t){var n,r=0;return t.name,e.getLayers().forEach((function(e,i){t.name&&e.layer.name==t.name&&r++,t==e.layer&&(n=String(i+1))})),n||dt("Layer not found"),1==r?t.name:n}});function Bl(e,t){var n={},r=e.data?e.data.getRecords():null;return xl(n,{name:e.name,data:r,type:e.geometry_type,size:ti(e),empty:0===ti(e),bbox:Ul(n,e,t)}),n.field_exists=function(t){return!(!e.data||!e.data.fieldExists(t))},n.field_type=function(t){return e.data&&Cr(t,e.data.getRecords())||null},n.field_includes=function(t,n){return!!e.data&&e.data.getRecords().some((function(e){return e&&e[t]===n}))},n}function Dl(e,t,n){var r;return xl(e,{layer_name:t.name||"",layer:function(){return r||(r=Bl(t,n)),r}}),e}function Ul(e,t,n){var r;return function(){return r||(r=function(e,t){var n=bi(e,t);if(!n)return null;var r=n.toArray();return Object.assign(r,{cx:n.centerX(),cy:n.centerY(),height:n.height(),width:n.width(),left:n.xmin,bottom:n.ymin,top:n.ymax,right:n.xmax}),r}(t,n)),r}}function Rl(e,n,r){var i,a,o,s,u,c,f,l=r||{},d=Qr(e),p=n&&Zr(e),h=e.data?e.data.getRecords():null,g=p&&n.isPlanar(),m={};function y(){var t=e.shapes[f];u||(u=t&&t[0]||null)}function v(){return o=o||$n.getShapeCentroid(c,n)}function b(){return s=s||Al(c,n)}function x(){return a||(a=p?n.getMultiShapeBounds(c):d?zt(e.shapes[f]):new kt)}return xl(m,{id:function(){return f}}),Dl(m,e,n),l.geojson_editor&&Object.defineProperty(m,"geojson",{set:function(e){l.geojson_editor.set(e,f)},get:function(){return l.geojson_editor.get(f)}}),h&&Object.defineProperty(m,"properties",{set:function(e){t.isObject(e)?h[f]=e:pt("Can't assign non-object to $.properties")},get:function(){var e=h[f];return e||(e=h[f]={}),e}}),(p||d)&&xl(m,{partCount:function(){var t=e.shapes[f];return t?t.length:0},isNull:function(){return 0===m.partCount},bounds:function(){return x().toArray()},height:function(){return x().height()},width:function(){return x().width()}}),p?(m.bboxContainsPoint=function(e,t){return n.getMultiShapeBounds(c).containsPoint(e,t)},m.bboxIntersectsRectangle=function(e,t,r,i){var a=n.getMultiShapeBounds(c);return kt.from(e,t,r,i).intersects(a)},m.bboxContainsRectangle=function(e,t,r,i){var a=n.getMultiShapeBounds(c),o=kt.from(e,t,r,i);return a.contains(o)},m.bboxContainedByRectangle=function(e,t,r,i){var a=n.getMultiShapeBounds(c);return kt.from(e,t,r,i).contains(a)},"polyline"==e.geometry_type&&xl(m,{length:function(){return $n.getShapePerimeter(c,n)}}),"polygon"==e.geometry_type&&xl(m,{area:function(){return g?m.planarArea:$n.getSphericalShapeArea(c,n)},perimeter:function(){return $n.getShapePerimeter(c,n)},compactness:function(){return $n.calcPolsbyPopperCompactness(m.area,m.perimeter)},planarArea:function(){return $n.getPlanarShapeArea(c,n)},innerPct:function(){return i||(i=function(e,t){var n,r,i,a=e.isPlanar()?$n.distance2D:$n.greatCircleDistance,o=new Ol(e,t);return function(e){return n=0,r=0,e&&e.forEach(s),r>0?r/(r+n):0};function s(e){e.forEach(u)}function u(t){i=0,e.forEachArcSegment(t,c),o.isInnerArc(t)?r+=i:n+=i}function c(e,t,n,r){i+=a(n[e],r[e],n[t],r[t])}}(n,e.shapes)),i(c)},originalArea:function(){var e,t=n.getRetainedInterval();return n.setRetainedInterval(0),e=m.area,n.setRetainedInterval(t),e},centroidX:function(){var e=v();return e?e.x:null},centroidY:function(){var e=v();return e?e.y:null},innerX:function(){var e=b();return e?e.x:null},innerY:function(){var e=b();return e?e.y:null}})):d&&(Object.defineProperty(m,"coordinates",{set:function(n){!n||t.isArray(n)?e.shapes[f]=n||null:pt("Can't assign non-array to $.coordinates")},get:function(){return e.shapes[f]||null}}),Object.defineProperty(m,"x",{get:function(){return y(),u?u[0]:null},set:function(e){y(),u&&(u[0]=Number(e))}}),Object.defineProperty(m,"y",{get:function(){return y(),u?u[1]:null},set:function(e){y(),u&&(u[1]=Number(e))}})),function(t){return f=t,a=null,p&&(o=null,s=null,c=e.shapes[t]),d&&(u=null),m}}function ql(e,t,n,r){return(r=r||{}).returns=!0,Gl(e,t,n,r)}function $l(e,t,n){var r=Vl(e,t,n);return function(e,t){var n=r(e,t);return!0!==n&&!1!==n&&pt("where expression must return true or false"),n}}function Vl(e,t,n){var r,i=vl(e),a=Hl({}),o=f(t,n),s=f(t,n),u=Jl(i),c="with($$env){with($$record){return "+i+"}}";try{r=new Function("$$record,$$env",c)}catch(e){console.error(e),pt(e.name,"in expression ["+i+"]")}function f(e,t){var n=e.data?e.data.getRecords():[],r=Rl(e,t);function i(){}return function(e){var t;return-1==e?null:(i.prototype=n[e]||{},(t=new i).$=r(e),t)}}return Yl(u,a),function(e,t,n){var c;a.A=o(e),a.B=s(t),n&&Yl(u,n);try{c=r.call(a,n||{},a)}catch(e){pt(e.name,"in expression ["+i+"]:",e.message)}return c}}function Gl(e,n,r,i){var a,o,s=t.extend({},i),u=vl(e||""),c=!s.no_assign,f=Jl(u);return c&&f.length>0&&!n.data&&xi(n),c||(s.context=s.context||{},Yl(f,s.context)),o=n.data?n.data.getRecords():[],a=function(e,t,n,r){var i=Rl(t,n,r),a=Dl({},t,n),o=Hl(t,r.context,r),s=Wl(e,r);return function(t,n){var r;o.$=n>=0?i(n):a,o._=o,o.d=t||null;try{r=s.call(o.$,t,o)}catch(t){pt(t.name,"in expression ["+e+"]:",t.message)}return r}}(u,n,r,s),function(e,t){var n;return n=t||(o[e]||(o[e]={})),c&&Yl(f,n),a(n,e)}}function Jl(e,n){var r=e.match(/[a-z_$][.a-z0-9_$]*(?= *=[^>=])/gi)||[],i=t.uniq(r.filter((function(e){var t=e.indexOf(".");return n?t>-1:-1==t})));return i}function Wl(e,t){var n,r;n="with($$env){with($$record){ "+(n=t.returns?"var $$retn = "+e+"; return $$retn;":e)+"}}";try{r=new Function("$$record,$$env",n)}catch(t){pt(t.name,"in expression ["+e+"]")}return r}function Yl(e,t){for(var n=0;n<e.length;n++)e[n]in t==!1&&(t[e[n]]=null)}function Hl(e,n,r){var a=i("defs"),o=Xl(),s={},u=e.data?e.data.getFields():[];return r=r||{},function(e){Object.assign(e,{round:Nf,int_median:bl,sprintf:t.format,blend:hl,format_dms:yl,parse_dms:gl})}(o),u.length>0&&Yl(u,o),n=t.defaults(n||{},a),o.global=a,Object.keys(n).forEach((function(e){var t=Object.getOwnPropertyDescriptor(n,e);t.get?Object.defineProperty(s,e,{get:t.get}):Object.defineProperty(s,e,{value:n[e]})})),Object.keys(o).reduce((function(e,t){return t in e?r.no_warn||("function"==typeof e[t]&&u.indexOf(t)>-1?gt("Warning: "+t+"() function is hiding a data field with the same name"):gt('Warning: "'+t+'" has multiple definitions')):Object.defineProperty(e,t,{value:o[t]}),e}),s)}function Xl(){var e={globalThis:void 0};return function(){for(var t in this)e[t]=void 0}(),e.console=console,e}var Zl=Object.freeze({__proto__:null,compileValueExpression:ql,compileFeaturePairFilterExpression:$l,compileFeaturePairExpression:Vl,compileFeatureExpression:Gl,getAssignedVars:Jl,getAssignmentObjects:function(e){var n=Jl(e,!0),r=[];return n.forEach((function(e){var t=/^([^.]+)\.[^.]+$/.exec(e),n=t?t[1]:null;n&&"this"!=n&&r.push(n)})),t.uniq(r)},compileExpressionToFunction:Wl,getBaseContext:Xl});function Ql(e){return Kl(e).modes[0]}function Kl(e,t){var n=function(e){var t,n,r=[],i={},a=[];for(t=0;t<e.length;t++)(n=e[t])in i==0?(i[n]=r.length,r.push(n),a.push(1)):a[i[n]]++;return{values:r,counts:a}}(e),r=function(e){var t,n,r=e.counts,i=e.values,a=r.length>0?function(e){var t,n=-1/0;for(t=0;t<e.length;t++)e[t]>n&&(n=e[t]);return n}(r):0,o=0,s=[];for(t=0;t<r.length;t++)(n=r[t])===a?s.push(i[t]):n>o&&(o=n);return{modes:s,margin:s.length>1?0:a-o,count:a}}(n);return t&&(r.counts=n.counts,r.values=n.values),r}var ed=Object.freeze({__proto__:null,getMode:Ql,getModeData:Kl}),td={};function nd(e,n,r){var i=t.extend({},e),a={expression:r.where,invert:!!r.invert,verbose:!1,no_replace:r.no_replace};return td.filterFeatures(i,n,a)}function rd(e,t,n){return id(e,t,n)()}function id(e,n,r){var i,a,o,s=0,u=0,c=-1,f=[],l={count:v,sum:y,sums:b,average:y,mean:y,median:y,quantile:y,iqr:y,quartile1:y,quartile2:y,quartile3:y,min:y,max:y,mode:b,collect:b,collectIds:function(){b(c)},first:function(e){0===s&&(f[u]=e);return u++,e},every:function(e){e=!!e,f[u]=(0===s||f[u])&&e,u++},some:function(e){e=!!e,f[u]=f[u]||e,u++},last:v},d={count:g((function(){return s}),0),sum:g(t.sum,0),sums:g((function(e){var n=e&&e.length?e[0].length:0,r=t.initializeArray(Array(n),0);return e.forEach((function(e){if(e&&e.length)for(var t=0;t<n;t++)r[t]+=+e[t]||0})),r})),median:g(t.findMedian),quantile:(o=t.findQuantile,function(e,t){var n=u++;return s>0?o(f[n],t):null}),iqr:g((function(e){return t.findQuantile(e,.75)-t.findQuantile(e,.25)})),quartile1:g((function(e){return t.findQuantile(e,.25)})),quartile2:g(t.findMedian),quartile3:g((function(e){return t.findQuantile(e,.75)})),min:g((function(e){return t.getArrayBounds(e).min})),max:g((function(e){return t.getArrayBounds(e).max})),average:g(t.mean),mean:g(t.mean),mode:g(Ql),collect:g(h),collectIds:g(h),first:g(h),every:g(h,!1),some:g(h,!1),last:g(h)},p=ti(e);return e.geometry_type&&(l.width=l.height=function(){},d.width=function(){return bi(e,n).width()},d.height=function(){return bi(e,n).height()}),i=Gl(r,e,n,{context:l,no_assign:!0,no_warn:!0}),a=Gl(r,e,n,{returns:!0,context:d,no_warn:!0}),function(e,t){var n;return e?function(e){e.forEach(m)}(e):function(){for(var e=0;e<p;e++)m(e)}(),n=a(void 0,t),c=-1,s=0,u=0,f=[],n};function h(e){return e}function g(e,t){var n=arguments.length>1?t:null;return function(){var t=u++;return s>0?e(f[t]):n}}function m(e){(e<0||e>=p)&&dt("Invalid record index"),c=e,i(e),s++,u=0}function y(e){return isNaN(e)&&e&&pt("Expected a number, received:",e),b(e)}function v(e){return f[u++]=e,e}function b(e){var t;return 0===s&&(f[u]=[]),(t=f[u]).length!=s&&pt("Evaluation failed"),t.push(e),u++,e}}td.calc=function(e,t,n){var r,a,o=n.expression;return n.where&&(e=nd(e,t,n),o+=" where "+n.where),a=i("defs"),gt(o+":  "+(r=id(e,t,n.expression)(null,a))),r};var ad=Object.freeze({__proto__:null,evalCalcExpression:rd,compileCalcExpression:id});function od(e,t){var n=id({data:e},null,t);return function(e,t){e||(e=[]),n(e,t)}}var sd=Object.freeze({__proto__:null,getJoinCalc:od});function ud(e,t){if(!e||0===e.length)return function(){return 0};e.forEach((function(e){ri(t,e)}));var n={},r=0,i=t.getRecords(),a=cd(e);return function(e){var t=a(i[e]);return t in n==!1&&(n[t]=r++),n[t]}}function cd(e){return e.reduce((function(e,t){var n=function(e){return String(e[t])};return e?function(t){return e(t)+"~~"+n(t)}:n}),null)}function fd(e,t,n){var r=function(e,t){for(var n,r=[],i=0;i<t;i++)(n=e(i))in r?r[n].push(i):r[n]=[i];return r}(t,e.length);return dd(e,r,n)}function ld(e,t,n,r){for(var i=[],a=0;a<n;a++)i.push(t(a));return dd(e,i,r)}function dd(e,t,n){var r,i=n.sum_fields||[],a=n.copy_fields||[];function o(t,n){for(var r,i=0,a=0;a<n.length;a++)i+=(r=e[n[a]])&&r[t]||0;return i}return n.fields&&(a=a.concat(n.fields)),n.calc&&(r=od(new Jr(e),n.calc)),t.map((function(t){var n,s,u={};for(s=e[(t=t||[])[0]],n=0;n<i.length;n++)u[i[n]]=o(i[n],t);for(n=0;n<a.length;n++)u[a[n]]=s?s[a[n]]:null;return r&&r(t,u),u}))}var pd=Object.freeze({__proto__:null,getCategoryClassifier:ud,getMultiFieldKeyFunction:cd,aggregateDataRecords:fd,recombineDataRecords:ld});function hd(e,t,n,r){var i=function(e,t){var n=[];return tr(e,(function(e){var r=t(e.shapeId);r in n==!1&&(n[r]=[]),n[r].push(e.arcId)})),n}(e.shapes,t),a=function(e){var t=new Uint8Array(e.size()),n=function(e){return t[Lt(e)]>0},r=function(e){t[Lt(e)]=0},i=new Ca(e);return function(e){e.forEach((function(e){t[Lt(e)]=1}));var a=function(e,t,n){var r=[];return e.forEach((function(e){0===t.getConnectedArcs(e,n).length&&r.push(~e),0===t.getConnectedArcs(~e,n).length&&r.push(e)})),r}(e,i,n),o=gd(a,i,n,r),s=gd(e,i,n,r),u=o.concat(s);return e.forEach((function(e){t[Lt(e)]=0})),u}}(n);return i.map(a)}function gd(e,t,n,r){var i=[];return e.forEach((function(e){for(var a,o=[],s=e;n(s)&&(o.push(s),a=n(s)?t.getConnectedArcs(s,n):[],r(s),a.length>0);)s=~a[0];o.length>0&&i.push(o)})),i}function md(e,n){var r=function(e,n){var r=[],i=[],a=[],o=e.map((function(e,t){return n(t)}));return tr(e,s),i.forEach(g),a;function s(e){var t=e.arcId,n=t<0?~t:t,o=a.length,s=r[n];s||(s=[],r[n]=s),s.push(o),e.group=s,a.push(e),3==s.length&&i.push(s)}function u(e,t){for(var n,r,i=0;i<e.length-1;i++){n=a[e[i]];for(var o=i+1;o<e.length;o++)if(t(n,r=a[e[o]]))return[n.segId,r.segId]}return null}function c(t,n){return yd(t,a,e).arcId===~yd(n,a,e).arcId}function f(t,n){return vd(t,a,e).arcId===~vd(n,a,e).arcId}function l(e,t){return p(e,t)&&c(e,t)&&f(e,t)}function d(e,t){return p(e,t)&&(c(e,t)||f(e,t))}function p(e,t){return e.arcId===~t.arcId&&o[e.shapeId]===o[t.shapeId]}function h(e){e.forEach((function(t){a[t].group=e}))}function g(e){var n=u(e,l)||u(e,d)||u(e,p);n&&(e=e.filter((function(e){return!t.contains(n,e)})),h(e),h(n),e.length>2&&g(e))}}(e,n);return function(e,n,r){var i=[];return e.forEach(a),i;function a(e){e.used||(c(e)||s(e))}function o(e,t){t in i==!1&&(i[t]=[]),i[t].push(e)}function s(e){var t=[e.arcId],n=u(e);for(e.used=!0;n&&n!=e;)t.push(n.arcId),n.used=!0,(n=u(n))&&n!=e&&n.used&&dt("buildRing() topology error");n||dt("buildRing() traversal error"),e.used=!0,o(t,r(e.shapeId))}function u(t,r){var i,a=yd(t,e,n);return r=r||0,a!=t&&(i=c(a))&&(r>100&&dt("deep recursion -- unhandled topology problem"),a=1==n[i.shapeId][i.partId].length?u(a,r+1):u(i,r+1)),a}function c(n){var i,a=r(n.shapeId);return i=t.find(n.group,(function(t){var i=n,o=e[t];return i!=o&&!o.used&&r(o.shapeId)===a&&i.arcId==~o.arcId})),null===i?null:e[i]}}(r,e,n)}function yd(e,t,n){return bd(e,t,n,1)}function vd(e,t,n){return bd(e,t,n,-1)}function bd(e,t,n,r){var i,a=n[e.shapeId][e.partId].length,o=(e.i+r)%a;return o<0&&(o+=a),(i=t[e.segId-e.i+o])&&i.shapeId==e.shapeId||dt("index error"),i}var xd=Object.freeze({__proto__:null,dissolvePolygonGeometry:md});function _d(e,n,r,i){var a,o,s,u,c=null;if(e.data)for(var f=0,l=(c=fd(e.data.getRecords(),r,i)).length;f<l;f++)n&&!n[f]&&(n[f]=null);return a={name:i.no_replace?null:e.name,shapes:n,data:c?new Jr(c):null,geometry_type:e.geometry_type},i.silent||(o=a,s=ti(e),u=ti(o),gt(t.format("Dissolved %,d feature%s into %,d feature%s",s,t.pluralSuffix(s),u,t.pluralSuffix(u)))),a}function wd(e,n){var r=new Int32Array(e.length);t.initializeArray(r,-1);var i=[],a=[];function o(e,t,o){var u=r[t];if(-1!=u&&n.flat){if(!(o&&o(e)>o(u)))return;s(t,u),r[t]=u,u=-1}-1==u?r[t]=e:-2==u?i[t].push(e):(i[t]=[u,e],r[t]=-2),a[e].push(t)}function s(e,t){for(var n=a[t],r=0;r<n.length;r++)if(n[r]===e){n[r]=-1;break}}this.getTileIdsByShapeId=function(e){var t=a[e];return t?t.filter((function(e){return e>=0})):[]},this.getShapeIdByTileId=function(e){var t=r[e];return t>=0?t:-1},this.getShapeIdsByTileId=function(e){var t=r[e];return t>=0?[t]:-1==t?[]:i[e]},this.indexTileIdsByShapeId=function(e,t,n){a[e]=[];for(var r=0;r<t.length;r++)o(e,t[r],n)},this.flatten=function(){i.forEach((function(e,t){!function(e){var t,n=i[e],a=n[0];r[e]=a;for(var o=0;o<n.length;o++)(t=n[o])!=a&&s(e,t)}(t)})),i=[]},this.getUnusedTileIds=function(){for(var e=[],t=0,n=r.length;t<n;t++)-1==r[t]&&e.push(t);return e},this.addTileToShape=function(e,t){e in a!=!1&&-1==r[t]||dt("Internal error"),r[t]=e,a[e].push(t)}}function Sd(e){var t=new Uint8Array(e),n=[];this.setId=function(e){this.hasId(e)||n.push(e),e<0?t[~e]|=2:t[e]|=1},this.clear=function(){var e=this;n.forEach((function(t){e.clearId(t)})),n=[]},this.hasId=function(e){return e<0?2==(2&t[~e]):1==(1&t[e])},this.clearId=function(e){e<0?t[~e]&=1:t[e]&=2},this.getIds=function(){return n},this.setIds=function(e){for(var t=0;t<e.length;t++)this.setId(e[t])}}function Ad(e,t,n){for(var r=0,i=e.length;r<i;r++)e[r]=Id(e[r],t,n)}function Id(e,t,n){return fr(e,(function(e){var r=function(e,t){for(var n=0,r=0,i=e.length;r<i;r++)t.arcIsDegenerate(e[r])&&(n++,e[r]=null);return n>0?e.filter((function(e){return null!==e})):e}(e,t);return"polygon"==n&&r&&(Md(r),0===$n.getPlanarPathArea(r,t)&&(r=null)),r}))}function Md(e){var t=e.length;if(t>=2){if(e[0]==~e[t-1])e.pop(),e.shift();else for(var n=1;n<t;n++)if(e[n-1]==~e[n]){e.splice(n-1,2);break}e.length<t&&Md(e)}}function Ed(e){var t=new Sd(e.arcs.size(),!0),n=function(e){return t.hasId(~e)};return function(e){t.setIds(e);var n=r(e);return t.clear(),n};function r(e){for(var t=null,n=0,r=e.length;n<r-1;n++)if(null!==(t=i(e,e[n])))return t;return Md(e),e.length>0?[e]:[]}function i(r,i){var s,u,c,f=e.getConnectedArcs(i,n);if(f.length<2)return null;s=[];for(var l=0;l<f.length;l++)(c=o(r,u=~f[l]))>-1&&(t.clearId(u),s.push(c));return s.length<2?null:Pd(r,s).reduce(a,null)}function a(e,t){var n=r(t);return null===e?n:(e.push.apply(e,n),e)}function o(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}}function Pd(e,n){var r=[];t.genericSort(n,!0),n[0]>0&&r.push(e.slice(0,n[0]));for(var i=0,a=n.length;i<a;i++)i<a-1?r.push(e.slice(n[i],n[i+1])):r.push(e.slice(n[i]));return r.length>n.length&&t.merge(r[0],r.pop()),r}td.dissolve=function(e,n,r){var i,a;return(r=t.extend({},r)).where?function(e,n,r,i){i&&i.where||dt('Missing required "where" parameter');var a=e(nd(n,r,i),r,t.defaults({where:null},i)),o=nd(n,r,t.defaults({invert:!0},i));return td.mergeLayers([o,a],{verbose:!1,force:!0})[0]}(td.dissolve,e,n,r):(r.field&&(r.fields=[r.field]),a=ud(r.fields,e.data),r.multipart||r.group_points?i=function(e,t){e.shapes&&e.geometry_type||pt("Layer is missing geometry");sr(e.shapes);var n=[];return e.shapes.forEach((function(e,r){var i=t(r);e&&(n[i]?n[i].push.apply(n[i],e):n[i]=e)})),n}(e,a):"polygon"==e.geometry_type?i=md(e.shapes,a):"polyline"==e.geometry_type?i=hd(e,a,n):"point"==e.geometry_type&&(i=function(e,t,n){var r=!n.planar&&Oi(bi(e)),i=n.weight?ql(n.weight,e):null,a=[];return 0!==mi(e.shapes)&&pt("Dissolving multi-part points is not supported"),e.shapes.forEach((function(e,n){var o,s=t(n),u=i?i(n):1,c=e&&e[0];c&&(r&&(o=[],$n.lngLatToXYZ(c[0],c[1],o),c=o),a[s]=function(e,t,n){var r,i,a=t[0],o=t[1];return a==a&&o==o&&n>0&&(e?(r=e.sum+n,i=e.sum/r,e.centroid[0]=i*e.centroid[0]+n*a/r,e.centroid[1]=i*e.centroid[1]+n*o/r,3==t.length&&(e.centroid[2]=i*e.centroid[2]+n*t[2]/r),e.sum=r):e={sum:n,centroid:t.concat()}),e}(a[s],c,u))})),a.map((function(e){var t,n;return e?(r?(t=e.centroid,n=[],$n.xyzToLngLat(t[0],t[1],t[2],n)):n=e.centroid,e?[n]:null):null}))}(e,a,r)),_d(e,i,a,r))};var jd=Object.freeze({__proto__:null,cleanShapes:Ad,removeSpikesInPath:Md,getSelfIntersectionSplitter:Ed,splitPathByIds:Pd});function Od(e,t){cr(e.shapes,(function(e){if($n.getPathArea(e,t)<=0)return null}))}function kd(e,t){var n=Ed(e);return function(r,i,a){var o=t?$n.getSphericalPathArea:$n.getPlanarPathArea;ur(r,(function(t){var r=n(t);0===r.length&&xt("[getRingDivider()] Defective path:",t),r.forEach((function(t,n){var r=o(t,e.arcs);r>0?i.push(t):r<0&&a.push(t)}))}))}}var Fd,zd=Object.freeze({__proto__:null,deleteHoles:Od,getHoleDivider:kd});function Cd(e,n){var r=t.extend({},n),i=e.getBounds();!e.isPlanar()&&$n.containsBounds(ji(),i.toArray());var a,o,s=i.ymin,u=i.ymax-s,c=r.stripes||Dd(e),f=new Uint32Array(c),l=c>1&&u>0?function(e){return Math.floor((c-1)*(e-s)/u)}:function(e){return 0};r.tolerance>=0==!1&&(r.tolerance=Mn(i.toArray())),e.forEachSegment((function(e,t,n,r){for(var i=l(r[e]),a=l(r[t]);f[i]=f[i]+2,i!=a;)i+=a>i?1:-1}));var d,p,h=(d=t.sum(f),p=4*d,(!Fd||Fd.byteLength<p)&&(Fd=new ArrayBuffer(p)),new Uint32Array(Fd,0,d)),g=0,m=[];t.forEach(f,(function(e){var t=g;g+=e,m.push(h.subarray(t,g))})),t.initializeArray(f,0),e.forEachSegment((function(e,t,n,r){for(var i,a,o=l(r[e]),s=l(r[t]);i=f[o],f[o]=i+2,(a=m[o])[i]=e,a[i+1]=t,o!=s;)o+=s>o?1:-1}));var y,v=e.getVertexData(),b=[];for(a=0;a<c;a++)for(y=Ud(m[a],v.xx,v.yy,r),o=0;o<y.length;o++)b.push(y[o]);return Nd(b,r.unique?Ld:null)}function Nd(e,t){var n={},r=t||Td;return e.filter((function(e){var t=r(e);return!(t in n)&&(n[t]=!0,!0)}))}function Td(e){return e.a.join(",")+";"+e.b.join(",")}function Ld(e){return e.x+","+e.y}function Bd(e){var t=e.getFilteredPointCount()-e.size(),n=2*Math.pow(t,.4);return Math.ceil(n)||1}function Dd(e){var t=e.getFilteredPointCount()-e.size(),n=Math.ceil(Math.pow(10*t,.6)/40);return n>0?n:1}function Ud(e,t,n,r){var i,a,o,s,u,c,f,l,d,p,h,g,m,y,v,b,x,_=e.length-2,w=[],S=(r||{}).tolerance;for(nf(t,e),b=0;b<_;){for(i=e[b],a=e[b+1],u=t[i],c=t[a],d=n[i],p=n[a],x=b;x<_&&!(c<(f=t[o=e[x+=2]]));){if(h=n[o],l=t[s=e[x+1]],g=n[s],d>=h){if(d>g&&p>h&&p>g)continue}else if(d<g&&p<h&&p<g)continue;i!=o&&i!=s&&a!=o&&a!=s&&(m=$n.segmentIntersection(u,d,c,p,f,h,l,g,S))&&(y=[i,a],v=[o,s],w.push(Rd(m,y,v,t,n)),4==m.length&&w.push(Rd(m.slice(2),y,v,t,n)))}b+=2}return w}function Rd(e,t,n,r,i){var a,o=e[0],s=e[1];return t=qd(o,s,t[0],t[1],r,i),n=qd(o,s,n[0],n[1],r,i),{x:o,y:s,a:a=t[0]<n[0]?t:n,b:a==t?n:t}}function qd(e,t,n,r,i,a){return i[n]==e&&a[n]==t?[n,n]:i[r]==e&&a[r]==t?[r,r]:n<r?[n,r]:[r,n]}var $d=Object.freeze({__proto__:null,getIntersectionPoints:function(e){return e.map((function(e){return[e.x,e.y]}))},findSegmentIntersections:Cd,sortIntersections:function(e){e.sort((function(e,t){return e.x-t.x||e.y-t.y}))},dedupIntersections:Nd,calcSegmentIntersectionStripeCount2:Bd,calcSegmentIntersectionStripeCount:Dd,intersectSegments:Ud,formatIntersection:Rd,formatIntersectingSegment:qd});function Vd(e,t){var n,r,i=t||{},a=e.arcs,o=a&&a.getBounds();if(!o||!o.hasBounds())return new Ca([]);xt("addIntersectionCuts() snap dist:",n=i.snap_interval?Hf(i.snap_interval,Qi(e)):!i.no_snap&&o.hasBounds()?Mn(o.toArray()):0),a.flatten();var s=function(e,t){var n,r,i,a=e.arcs,o=t>0?{}:{tolerance:0},s=!1;n=Pn(a,t),r=a.dedupCoords(),i=Wd(e,o),(i>0||n>0||r>0)&&(s=!0);i>0&&(i=0,n=Pn(a,t),a.dedupCoords(),n>0&&(i=Wd(e,o)),i>0&&(a.dedupCoords(),xt("Second-pass vertices added:",i,"consider third pass?")));return s}(e,n);return(s||i.rebuild_topology)&&_a(e),e.layers.forEach((function(e){Zr(e)&&Ad(e.shapes,a,e.geometry_type)})),r=function(e){var t,n=new Ca(e.arcs),r=function(e){for(var t,n=new Int32Array(e.arcs.size()),r=0,i=0,a=e.arcs.size();i<a;i++)t=e.findDuplicateArc(i),n[i]=t,i!=t&&r++;return r>0?n:null}(n);r&&Gd(e,r);t=function(e){var t=yi(e.layers,e.arcs),n=e.arcs.size(),r=e.arcs.deleteArcs(t),i=e.arcs.size(),a=n-i;a>0&&Gd(e,r);return a}(e),t>0&&(n=new Ca(e.arcs));return n}(e),r}function Gd(e,t){var n=function(e){for(var n,r,i,a=0;a<e.length;a++)r=Lt(n=e[a]),i=t[r],e[a]=n==r?i:~i;return e};e.layers.forEach((function(e){Zr(e)&&cr(e.shapes,n)}))}function Jd(e,t){return Hd(Kd(e,t),e)}function Wd(e,t){var n=e.arcs.getPointCount(),r=Jd(e.arcs,t),i=e.arcs.getPointCount();return Yd(e,r),i-n}function Yd(e,t){var n=function(e,t){return function(e){for(var t=[],r=0;r<e.length;r++)n(e[r],t);return t};function n(n,r){var i,a=n<0,o=a?~n:n,s=e[o],u=(o>=e.length-1?t:e[o+1])-1;do{a?(i=~u,u--):(i=s,s++),r.push(i)}while(u-s>=0)}}(t,e.arcs.size());e.layers.forEach((function(e){Zr(e)&&cr(e.shapes,n)}))}function Hd(e,t){var n,r,i,a,o=t.getVertexData(),s=o.xx,u=o.yy,c=o.nn,f=0,l=0,d=[],p=t.size(),h=new Uint32Array(p),g=Qd(Zd(e,s,u),t),m=t.getPointCount()+2*g.length,y=new Float64Array(m),v=new Float64Array(m);g.reverse(),a=g.pop();for(var b=0,x=0;b<p;b++){for(i=c[b],h[b]=x,n=0,r=0;n<i;){for(y[l]=s[f],v[l]=u[f],l++,r++;a&&a.i==f;)y[l]=a.x,v[l]=a.y,l++,r++,d[x++]=r,r=0,y[l]=a.x,v[l]=a.y,l++,r++,a=g.pop();n++,f++}d[x++]=r}return l!=m&&dt("[insertCutPoints()] Counting error"),t.updateVertexData(d,y,v,null),h}function Xd(e,t,n,r,i,a){return(r<n||r>n+1)&&dt("Out-of-sequence arc ids:",n,r),{x:e,y:t,i:n}}function Zd(e,t,n){return e.sort((function(e,r){return e.i!=r.i?e.i-r.i:$n.distanceSq(t[e.i],n[e.i],e.x,e.y)-$n.distanceSq(t[r.i],n[r.i],r.x,r.y)})),e}function Qd(e,t){var n=[],r=0;return t.forEach2((function(t,i,a,o){for(var s,u,c=t+i-1,f=a[t],l=o[t],d=a[c],p=o[c];r<e.length&&e[r].i<=c;)s=e[r],u=n[n.length-1],s.x==f&&s.y==l||s.x==d&&s.y==p||u&&u.x==s.x&&u.y==s.y&&u.i==s.i||n.push(s),r++})),n}function Kd(e,t){var n=Cd(e,t),r=e.getVertexData();return function(e,t,n){for(var r,i,a,o=[],s=0,u=e.length;s<u;s++)i=Xd((r=e[s]).x,r.y,r.a[0],r.a[1]),a=Xd(r.x,r.y,r.b[0],r.b[1]),i&&o.push(i),a&&o.push(a);return o}(n,r.xx,r.yy)}var ep=Object.freeze({__proto__:null,addIntersectionCuts:Vd,divideArcs:Jd,cutPathsAtIntersections:Wd,remapDividedArcs:Yd,insertCutPoints:Hd,getCutPoint:Xd,sortCutPoints:Zd,filterSortedCutPoints:Qd,findClippingPoints:Kd}),tp={stack:[],start:function(){tp.stack.push(Date.now())},stop:function(){return Date.now()-tp.stack.pop()+"ms"}};function np(e){tp.start(),e.detachAcyclicArcs();var n=function(e){for(var t=e.arcs,n=[],r=[],i=[],a=[],o=new Uint8Array(t.size()),s=Of(e,l),u=0,c=o.length;u<c;u++)f(u),f(~u);return{cw:n,ccw:r,empty:i,lostArcs:a};function f(e){var o,u;if(d(e)){if(!(o=s(e)))return a.push(e),void xt("Dead-end arc:",e);(u=$n.getPlanarPathArea(o,t))>0?n.push(o):u<0?r.push(o):i.push(o)}}function l(e){return d(e,!0)}function d(e,t){var n=Lt(e),r=n==e?1:2,i=0==(o[n]&r);return t&&i&&(o[n]|=r),i}}(e),r=n.cw.map((function(e){return[e]}));xt("Find mosaic rings",tp.stop()),tp.start();var i=[],a=new sf(r,e.arcs);return n.ccw.forEach((function(e){var t=a.findSmallestEnclosingPolygon(e);t>-1?r[t].push(e):(Hn(e),i.push([e]))})),xt(t.format("Detect holes (holes: %d, enclosures: %d)",n.ccw.length-i.length,i.length),tp.stop()),{mosaic:r,enclosures:i,lostArcs:n.lostArcs}}var rp=Object.freeze({__proto__:null,mosaic:function(e,t){var n,r,i,a,o,s,u,c,f=[];return e.arcs||pt("Dataset is missing path data"),r=np(n=Vd(e,t)),f.push({name:"mosaic",shapes:r.mosaic,geometry_type:"polygon"}),t.debug&&(f.push({geometry_type:"polygon",name:"mosaic-enclosure",shapes:r.enclosures}),r.lostArcs.length>0&&(f=f.concat((i=r.lostArcs,a=n.arcs,o={geometry_type:"polyline",name:"lost-arcs",shapes:[]},s={geometry_type:"point",name:"lost-arc-endpoints",shapes:[]},u=[],c=[],i.forEach((function(e){var t=a.getVertex(e,0),n=a.getVertex(e,-1);u.push({ARCID:e}),o.shapes.push([[e]]),c.push({ARCID:e},{ARCID:e}),s.shapes.push([[t.x,t.y]],[[n.x,n.y]])})),o.data=new Jr(u),s.data=new Jr(c),[o,s])))),f},buildPolygonMosaic:np});function ip(e,n){var r=new Int32Array(e),i=new Int32Array(e),a=this,o=[];t.initializeArray(r,-1),t.initializeArray(i,-1),this.setId=function(e,t){n&&!a.hasId(e)&&o.push(e),e<0?i[~e]=t:r[e]=t},this.clear=function(){n||dt("Index is not clearable"),o.forEach((function(e){a.setId(e,-1)})),o=[]},this.clearId=function(e){a.hasId(e)||dt("Tried to clear an unset id"),a.setId(e,-1)},this.hasId=function(e){return a.getId(e)>-1},this.getId=function(t){var n=t<0?~t:t;return n>=e?-1:t<0?i[n]:r[n]}}function ap(e,t,n,r){var i,a,o,s=n.arcs,u=new Sd(e.length,!0),c=kd(n),f=new Sd(s.size(),!0),l=new Sd(s.size(),!0);function d(e){i=i?i.concat(e):e}function p(t){a=s.getSimpleShapeBounds2(t),f.setIds(t),function(t){var n,r=t.concat();for(;r.length>0;)(n=g(r.pop()))>=0&&h(r,e[n])}(t),f.clear(),u.clear()}function h(e,t){for(var n,r,i,a,o=0,s=t.length;o<s;o++)for(var u=0,c=(r=t[o]).length;u<c;u++)n=r[u],a=void 0,void 0,a=~(i=n),!(f.hasId(i)||f.hasId(a)||l.hasId(i)||l.hasId(a))&&e.push(~n)}function g(e){var n=t.getShapeIdByArcId(e);return-1==n||u.hasId(n)?-1:!1===s.arcIsContained(Lt(e),a)?(xt("Out-of-bounds ring arc",e),-1):(u.setId(n),o.push(n),n)}this.getTilesInShape=function(e,t){var n,a=[],s=[];return o=[],i=[],r.no_holes?c(e,a,s):(c(e,a,s),s.forEach(d),l.setIds(i)),a.forEach(p),n=o,o=null,l.clear(),i=null,n}}var op=Object.freeze({__proto__:null,PolygonTiler:ap});function sp(e,t,n){var r=n||{},i=e.shapes;kd(t);var a=np(t).mosaic,o=new up(a,t.arcs),s=new Sd(a.length,!0),u=new wd(a,r),c=new ap(a,o,t,r),f=null;function l(e,t,n){var r=[],i=n?-1:1;return function(n){var a;return n in r?a=r[n]:(a=i*Math.abs($n.getShapeArea(e[n],t)),r[n]=a),a}}function d(e,t){return a[e]}function p(e){for(var n,r,i,s,c=a[e][0],f=t.arcs,l=-1,d=0,p=0;p<c.length;p++)n=c[p],(i=o.getShapeIdByArcId(~n))<0||(r=u.getShapeIdByTileId(i))<0||(s=$n.getPathPerimeter([n],f))>d&&(l=r,d=s);l>-1&&u.addTileToShape(l,e)}!r.simple&&r.flat&&(f=function(e,t,n){var r;n&&"max-area"!=n?"min-area"==n?r=l(e,t,!0):"max-id"==n?r=function(e){return e}:"min-id"==n?r=function(e){return-e}:pt("Unknown overlap rule:",n):r=l(e,t,!1);return r}(e.shapes,t.arcs,r.overlap_rule)),this.mosaic=a,this.nodes=t,this.getSourceIdsByTileId=u.getShapeIdsByTileId,this.getTileIdsByShapeId=u.getTileIdsByShapeId,i.forEach((function(e,t){var n=c.getTilesInShape(e,t);u.indexTileIdsByShapeId(t,n,f)})),r.flat&&u.flatten(),this.removeGaps=function(e){r.flat||dt("MosaicIndex#removeGaps() should only be called with a flat mosaic");var t=u.getUnusedTileIds(),n=t.filter((function(t){var n=a[t];return e(n[0])}));return n.forEach(p),{removed:n.length,remaining:t.length-n.length}},this.getUnusedTiles=function(){return u.getUnusedTileIds().map(d)},this.getTilesByShapeIds=function(e){return function(e){var t,n,r,i,a=[];for(r=0;r<e.length;r++)for(n=u.getTileIdsByShapeId(e[r]),i=0;i<n.length;i++)t=n[i],s.hasId(t)||(s.setId(t),a.push(t));return s.clear(),a}(e).map(d)}}function up(e,t){var n,r=new ip(t.size());function i(e){for(var t,i=0,a=e.length;i<a;i++)t=e[i],r.setId(t,n)}e.forEach((function(e,t){n=t,e.forEach(i)})),this.getShapeIdByArcId=function(e){return r.getId(e)}}var cp=Object.freeze({__proto__:null,MosaicIndex:sp,ShapeArcIndex:up});function fp(e,n,r){(r=t.extend({},r)).field&&(r.fields=[r.field]);var i=ud(r.fields,e.data),a=function(e,t){return e.shapes.reduce((function(e,n,r){var i=t(r);return i in e==!1&&(e[i]=[]),e[i].push(r),e}),[])}(e,i);return _d(e,dp(a,e,n,r),i,r)}function lp(e,n){var r=n.map((function(e,t){return{tile_id:t}}));return t.defaults({shapes:n,data:new Jr(r)},e)}function dp(e,n,r,i){var a,o,s=Jn(n.shapes,r.arcs),u=new sp(n,new Ca(r.arcs,s),{flat:!i.allow_overlaps,simple:1==e.length,overlap_rule:i.overlap_rule}),c=!i.allow_overlaps&&(i.sliver_control||i.gap_fill_area);c&&(o=el(n,r,t.extend({sliver_control:1},i)),a=u.removeGaps(o.filter));var f,l,d,p=kf(u.nodes),h=e.map((function(e){var t=u.getTilesByShapeIds(e);return i.tiles?t.reduce((function(e,t){return e.concat(t)}),[]):function(e,t){for(var n,r,i=[],a=[],o=0,s=e.length;o<s;o++)r=e[o],i.push(r[0]),r.length>1&&(a=a.concat(r.slice(1)));n=t(i.concat(a),"dissolve"),n.length;return n.length>0?n:null}(t,p)}));if(h=function(e,t){var n=function(e,n){Hn(n);var r=t([n],"flatten");return r.length>1?(r.forEach(Hn),e=e.concat(r)):e.push(Hn(n)),e};return e.map((function(e){return e?e.reduce(n,[]):null}))}(h,p),c&&!i.quiet){var g=(f=a.removed,l=a.remaining,d=o.label,f>0==0?"":t.format("Removed %,d / %,d sliver%s using %s",f,f+l,t.pluralSuffix(f),d));g&&gt(g)}return h}var pp=Object.freeze({__proto__:null,dissolvePolygonLayer2:fp,composeMosaicLayer:lp,dissolvePolygonGroups2:dp});function hp(e,t,n){var r=t.arcs,i=new Ca(r,Jn(e.shapes,r)),a=new ip(r.size(),!0);e.shapes=e.shapes.map((function(e,t){return e?(e=function(e,t){var n=[];return ur(e,r),n;function r(e){for(var r,i=e.length,a=[],o=0;o<i;o++)r=e[o],a.push(r),o<i-1&&t.getConnectedArcs(r).length>1&&(n.push(a),a=[]);a.length>0&&n.push(a)}}(e,i),a.clear(),e=function(e,t){var n=e.reduce((function(e,n){return function(e,t,n){for(var r,i=[],a=0;a<t.length;a++)r=t[a],n.hasId(r)?i.length>0&&(e.push(i),i=[]):i.push(r),n.setId(r,a),n.setId(~r,a);i.length>0&&e.push(i)}(e,n,t),e}),[]);return n.length>0?n:null}(e,a),a.clear(),e=function(e,t,n){return!e||e.length<2?e:(e.forEach((function(e,t){var i=~e[0],a=e[e.length-1];(n.hasId(i)||n.hasId(a))&&dt("Indexing error"),n.setId(i,t),n.setId(a,t),r(i,t),r(a,t)})),e.filter((function(e){return!!e})));function r(r,i){var a,o=0,s=-1,u=n.getId(r);if(t.forEachConnectedArc(r,(function(e){n.hasId(e)&&(s=n.getId(e),a=e),o++})),1==o&&s>-1&&s<i){!function(e,t,n,r,i){var a,o,s=e[t],u=e[r];~n==s[0]?a=!0:n==s[s.length-1]?a=!1:dt("Index error");~i==u[0]?o=!0:i==u[u.length-1]?o=!1:dt("Index error 2");o||(u=Hn(u.concat()));a?function(e,t){t=Hn(t.concat());var n=[0,0].concat(t);e.splice.apply(e,n)}(s,u):function(e,t){e.push.apply(e,t)}(s,u)}(e,s,a,u,r),n.setId(r,s);var c=function(e,t){var n=~e[0],r=e[e.length-1];if(t==n)return r;if(t==r)return n;dt("Indexing error")}(e[u],r);n.setId(c,s),u!=s&&(e[u]=null)}}}(e,i,a),e):null}))}function gp(e,n,r){var i,a=r||{},o=!a.only_arcs,s=t.some(e,Zr);a.debug?Vd(n,a):(e.forEach((function(e){Xr(e)&&("polygon"==e.geometry_type&&a.rewind&&uf(e,n.arcs),o&&(i||(i=Vd(n,a)),"polygon"==e.geometry_type?function(e,t,n){n=Object.assign({gap_fill_area:"auto"},n);var r=e.shapes.map((function(e,t){return[t]}));e.shapes=dp(r,e,t,n)}(e,n,a):"polyline"==e.geometry_type?hp(e,n):"point"==e.geometry_type&&function(e,t,n){var r,i;function a(e){var t=e.join("~");t in r||(r[t]=!0,i.push(e))}e.shapes=e.shapes.map((function(e,t){return e&&e.length>0!=!1?1==e.length?e:(r={},i=[],e.forEach(a),0===i.length?null:i):null}))}(e)),a.allow_empty||td.filterFeatures(e,n.arcs,{remove_empty:!0,verbose:a.verbose}))})),!a.no_arc_dissolve&&s&&n.arcs&&Na(n))}function mp(e){return e.reduce((function(e,n){return null===e?e=n.name||null:e&&n.name&&(e=t.mergeNames(e,n.name)),e}),null)||""}td.cleanLayers=gp,td.mergeAndFlattenLayers=function(e,t,n){if(!n.flatten)return td.mergeLayers(e,n);e.forEach((function(e){ci(e,"the flatten option requires polygon layers")}));var r=td.mergeLayers(e,n);return Ya(t,e,r),gp(r,t,{overlap_rule:"max-id"}),Ya(t,r,e),r},td.mergeLayers=function(e,n){var r=e.filter(ti),i={};return n=n||{},r.length?1==r.length?(gt("Use the target= option to specify multiple layers for merging"),r.concat()):(i.data=function(e,n){var r=t.uniq(e.reduce((function(e,t){return e.concat(t.data?t.data.getFields():[])}),[]));if(0===r.length)return null;var i=e.reduce((function(e,t){var n=t.data?t.data.getRecords():new Jr(ti(t)).getRecords();return e.concat(n)}),[]),a=function(e,n){var r=t.uniq(n.reduce((function(n,r){return n.concat(t.difference(e,r.data?r.data.getFields():[]))}),[]));return r}(r,e);(function(e,t){var n;e.length>0&&(n="["+e.join(", ")+"]",n=(1==e.length?"Field "+n+" is missing":"Fields "+n+" are missing")+" from one or more layers",t.force?!1!==t.verbose&&gt("Warning: "+n):pt(n))})(a,n),function(e,t){e.forEach((function(e){var n=function(e,t){return t.reduce((function(t,n){var r=n.data?Cr(e,n.data.getRecords()):null;return r&&-1==t.indexOf(r)&&t.push(r),t}),[])}(e,t);n.length>1&&pt('Inconsistent data types in "'+e+'" field:',n.join(", "))}))}(r,e),a.length>0&&Fr(i);return new Jr(i)}(r,n),i.name=mp(r),i.geometry_type=function(e){var n=t.uniq(t.pluck(e,"geometry_type")).filter((function(e){return!!e}));n.length>1&&pt("Incompatible geometry types:",n.join(", "));return n[0]||null}(r),i.geometry_type&&(i.shapes=function(e){return e.reduce((function(e,t){for(var n=t.shapes||[],r=ti(t),i=-1;++i<r;)e.push(n[i]||null);return e}),[])}(r)),i.shapes&&i.data&&i.shapes.length!=i.data.size()&&dt("Mismatch between geometry and attribute data"),[i]):null};var yp={};function vp(e,n){return(n=t.extend({},n)).v2=!n.gj2008,bp(e,n)}function bp(e,n){var r,i=(n=n||{}).extension||"json";return(n.precision||n.rfc7946)&&Uf(e=Ra(e),n.precision||1e-6),(n.v2||n.rfc7946)&&(r=_p(e))&&gt(r),n.file&&(i=to(n.file)),(n.combine_layers?[e.layers]:e.layers.map((function(e){return[e]}))).map((function(r){var a=mp(r)||"output";return{content:Sp(t.defaults({layers:r},e),n,"buffer"),filename:a+"."+i}}))}function xp(e,t,n,r,i){var a,o=Pp(e.data,n),s=e.shapes,u=Op(e.data,n);return a=n.ndjson?hf:n.prettify?gf(["bbox","coordinates"]):JSON.stringify,o&&s&&o.length!==s.length&&dt("Mismatch between number of properties and number of shapes"),(s||o||[]).reduce((function(c,f,l){var d=s?s[l]:null,p=yp.exporters[e.geometry_type],h=d?p(d,t.arcs,n):null,g=null;if(r)g=yp.toFeature(h,o?o[l]:null),u&&(g.id=u[l]);else{if(!h)return c;g=h}return i&&(g=a(g),"buffer"==i&&(g=Ar(g,"utf8"))),c.push(g),c}),[])}function _p(e){var t,n=Qi(e);return n&&ta(n)||(t="RFC 7946 warning: non-WGS84 GeoJSON output.",n&&(t+=' Tip: use "-proj wgs84" to convert.')),t}function wp(e,t){var n,r,i,a,o=Qi(e),s=t&&o&&ta(o),u=new kt,c=new kt;return e.layers.forEach((function(t){Zr(t)?tr(t.shapes,null,(function(t){var n=e.arcs.getSimpleShapeBounds(t.arcs);(n.centerX()<0?u:c).mergeBounds(n)})):Qr(t)&&Nt(t.shapes,(function(e){(e[0]<0?u:c).mergePoint(e[0],e[1])}))})),(n=(new kt).mergeBounds(c).mergeBounds(u)).hasBounds()&&(a=n.toArray()),s&&c.hasBounds()&&u.hasBounds()&&(r=c.xmin-u.xmax,i=360+u.xmin-c.xmax,r>0&&r>i&&(a[0]=c.xmin,a[2]=u.xmax)),a||null}function Sp(e,t,n){var r,i,a={},o=e.layers,s=Mp(o,t);return a.type=s?"FeatureCollection":"GeometryCollection",t.gj2008&&Ip(e,a),t.bbox&&(i=wp(e,t.rfc7946||t.v2))&&(a.bbox=i),r=o.reduce((function(r,i,a){var o=xp(i,e,t,s,n);return r.length>0?r.concat(o):o}),[]),"Feature"==t.geojson_type&&1==r.length?r[0]:t.ndjson?yp.formatCollectionAsNDJSON(r):n?yp.formatCollection(a,r):(a[Ap(a.type)]=r,a)}function Ap(e){return"FeatureCollection"==e?"features":"GeometryCollection"==e?"geometries":void dt("Invalid collection type:",e)}function Ip(e,t){var n=e.info||{};!n.crs&&"input_geojson_crs"in n&&(t.crs=n.input_geojson_crs)}function Mp(e,n){var r=n.geojson_type||"";return"Feature"==r||"FeatureCollection"==r||"GeometryCollection"!=r&&(r&&pt("Unsupported GeoJSON type:",n.geojson_type),t.some(e,(function(e){var t=e.data?e.data.getFields():[],r=Ep(t,n),i=!!jp(t,n);return r||i})))}function Ep(e,t){return!(t.drop_table||t.cut_table||0===e.length||1==e.length&&e[0]==yp.ID_FIELD)}function Pp(e,n){var r,i=e?e.getFields():[],a=jp(i,n);return Ep(i,n)?(r=e.getRecords(),a==yp.ID_FIELD?r.map((function(e){return delete(e=t.extend({},e))[a],e})):r):null}function jp(e,n){var r=[],i=n.id_field;return t.isString(i)?r.push(i):t.isArray(i)&&(r=i),r.push(yp.ID_FIELD),t.find(r,(function(n){return t.contains(e,n)}))}function Op(e,t){var n=jp(e?e.getFields():[],t);return n?e.getRecords().map((function(e){return n in e?e[n]:null})):null}yp.ID_FIELD="FID",yp.typeLookup={LineString:"polyline",MultiLineString:"polyline",Polygon:"polygon",MultiPolygon:"polygon",Point:"point",MultiPoint:"point"},yp.translateGeoJSONType=function(e){return yp.typeLookup[e]||null},yp.pathIsRing=function(e){var t=e[0],n=e[e.length-1];return e.length>=4&&t[0]==n[0]&&t[1]==n[1]},yp.toFeature=function(e,t){var n=e?e.type:null;return"Feature"==n?e:n in yp.typeLookup?{type:"Feature",geometry:e,properties:t||null}:{type:"Feature",geometry:null,properties:t||null}},yp.formatCollectionAsNDJSON=function(e){var n=t.createBuffer("\n","utf8"),r=e.reduce((function(e,t,r){return r>0&&e.push(n),e.push(t),e}),[]);return s.concat(r)},yp.formatCollection=function(e,n){var r=JSON.stringify(e).replace(/\}$/,', "'+Ap(e.type)+'": [\n');return t.isString(n[0])?r+n.join(",\n")+"\n]}":yp.joinOutputBuffers(r,"\n]}",n)},yp.joinOutputBuffers=function(e,n,r){var i=t.createBuffer(",\n","utf8"),a=r.reduce((function(e,t,n){return n>0&&e.push(i),e.push(t),e}),[t.createBuffer(e,"utf8")]);return a.push(t.createBuffer(n,"utf8")),s.concat(a)},yp.exportPointGeom=function(e,t){var n=null;return 1==e.length?n={type:"Point",coordinates:e[0]}:e.length>1&&(n={type:"MultiPoint",coordinates:e}),n},yp.exportLineGeom=function(e,t){var n=df(e,t,"polyline");if(0===n.pointCount)return null;var r=n.pathData.map((function(e){return e.points}));return 1==r.length?{type:"LineString",coordinates:r[0]}:{type:"MultiLineString",coordinates:r}},yp.exportPolygonGeom=function(e,t,n){var r=df(e,t,"polygon");if(0===r.pointCount)return null;var i=ff(r.pathData,t,n.invert_y),a=(n.rfc7946||n.v2)&&!n.invert_y,o=i.map((function(e){return e.map((function(e){return a&&e.points.reverse(),e.points}))}));return 1==o.length?{type:"Polygon",coordinates:o[0]}:{type:"MultiPolygon",coordinates:o}},yp.exporters={polygon:yp.exportPolygonGeom,polyline:yp.exportLineGeom,point:yp.exportPointGeom};var kp=Object.freeze({__proto__:null,default:yp,exportGeoJSON2:vp,exportGeoJSON:bp,exportLayerAsGeoJSON:xp,getRFC7946Warnings:_p,getDatasetBbox:wp,exportDatasetAsGeoJSON:Sp,preserveOriginalCRS:Ip,useFeatureCollection:Mp,exportProperties:Pp,getIdField:jp,exportIds:Op}),Fp={};function zp(e){var t=Cp(e);return!!t&&t in Fp}function Cp(e){var t=e.data&&e.data.getReadOnlyRecordAt(0);return t&&t.type||null}function Np(e){return e.data&&e.data.getReadOnlyRecordAt(0)}function Tp(e,t){var n=Fp[e.type];return n||pt("Missing renderer for",e.type,"element"),n(e,t)||[]}var Lp=Object.freeze({__proto__:null,furnitureRenderers:Fp,layerHasFurniture:zp,isFurnitureLayer:function(e){return!!e.furniture},getFurnitureLayerType:Cp,getFurnitureLayerData:Np,importFurniture:Tp});function Bp(e,t){var n,r=qp(e);return n=r?Object.assign({},Dp(r)):function(e,t){var n;t.svg_bbox?(n=new kt(t.svg_bbox),t=Object.assign({margin:0},t)):n=$a(e);var r=Gp(n,t);return{bbox:n.toArray(),width:Math.round(r.width()),height:Math.round(r.height())||1,type:"frame"}}(e,t),n.crs=Qi(e),n}function Dp(e){return e.data&&e.data.getReadOnlyRecordAt(0)}function Up(e,t){var n,r,i=e.width()/e.height();return n=(r=t.pixels?Math.sqrt(+t.pixels*i):+t.width)/i,[Math.round(r),Math.round(n)]}function Rp(e){return"frame"==Cp(e)}function qp(e){return t.find(e.layers,(function(e){return Rp(e)}))}function $p(e){var n=t.find(e.getLayers(),(function(e){return Rp(e.layer)}));return n?n.dataset:null}function Vp(e){var t,n,r=new kt(e.bbox);return e.crs?(t=ea(r.centerX(),r.centerY(),e.crs),n=e.crs.to_meter):(t=1,n=1),r.width()/t*n/e.width}function Gp(e,t){var n,r,i,a,o,s=0,u=0,c=0,f=0,l=e.width(),d=e.height(),p=Jp(t.margin),h=p[0]+p[2],g=p[1]+p[3];return t.fit_bbox?(c=t.fit_bbox[0],f=t.fit_bbox[1],l/d>(n=t.fit_bbox[2]-c)/(r=t.fit_bbox[3]-f)?r=0:n=0,h=g=0):t.svg_scale>0?(n=l/t.svg_scale+h,r=0):+t.pixels?(n=(i=Up(e,t))[0],r=i[1]):(r=t.height||0,n=t.width||(r>0?0:800)),r>0&&(o=(d||l||1)/(r-g)),n>0&&(a=(l||d||1)/(n-h)),n?r||(o=a,r=d>0?g+d/o:n,t.max_height>0&&r>t.max_height&&(o=a*r/t.max_height,r=t.max_height)):(a=o,n=l>0?h+l/a:r),a>o?u=(o=a)*(r-g)-d:o>a&&(s=(a=o)*(n-h)-l),e.padBounds(p[0]*a+.5*s,p[1]*o+.5*u,p[2]*a+.5*s,p[3]*o+.5*u),n>0&&r>0||dt("Missing valid height and width parameters"),a===o&&a>0||dt("Missing valid margin parameters"),new kt(c,f,n+c,r+f)}function Jp(e){var n=(t.isNumber(e)?String(e):e||"").trim().split(/[, ] */);return 1==n.length&&n.push(n[0]),2==n.length&&n.push(n[0],n[1]),3==n.length&&n.push(n[2]),n.map((function(e){var t=parseFloat(e);return isNaN(t)?1:t}))}var Wp=Object.freeze({__proto__:null,getFrameData:Bp,getFrameLayerData:Dp,getFrameSize:Up,findFrameLayerInDataset:qp,findFrameDataset:$p,findFrameLayer:function(e){var n=t.find(e.getLayers(),(function(e){return Rp(e.layer)}));return n&&n.layer||null},getFrameLayerBounds:function(e){return new kt(Dp(e).bbox)},getMapFrameMetersPerPixel:Vp,calcOutputSizeInPixels:Gp,parseMarginOption:Jp});function Yp(e,t,n,r){var i=e*Math.PI/180,a=t*Math.cos(i),o=-t*Math.sin(i);return function(e,t){return[a*(e-r[0])-o*(t-r[1])+n[0]+r[0],o*(e-r[0])+a*(t-r[1])+n[1]+r[1]]}}td.affine=function(e,n,r){var i,a,o,s=r.rotate||0,u=r.scale||1,c=r.shift?Xf(r.shift,Qi(n)):[0,0],f=n.arcs,l=[],d=[],p=[];n.layers.filter(Xr).forEach((function(t){var i,a=[],o=[];-1==e.indexOf(t)?o=t.shapes:r.where?(i=ql(r.where,t,n.arcs),t.shapes.forEach((function(e,t){(i(t)?a:o).push(e)}))):a=t.shapes,"point"==t.geometry_type?p=p.concat(a):(l=l.concat(a),d=d.concat(o))}));var h=function(e,t){var n,r;n=t.anchor?t.anchor:[(r=$a(e)).centerX(),r.centerY()];return n}({arcs:n.arcs,layers:[{geometry_type:"point",shapes:p},{geometry_type:"polyline",shapes:l}]},r);o=Yp(s,u,c,h),l.length>0&&(i=new Uint8Array(f.size()),a=new Uint8Array(f.size()),Wn(l,i),d.length>0&&(Wn(d,a),function(e,t){for(var n=0,r=e.length;n<r;n++)0===t[n]&&(e[n]=0)}(a,i),n.arcs=function(e,n,r){for(var i,a=0,o=0,s=n.getVertexData(),u=[],c=[],f=[],l=[],d=0,p=r.length;d<p;d++)r[d]>0&&(l[d]=n.size()+a,i=s.nn[d],t.copyElements(s.xx,s.ii[d],u,o,i),t.copyElements(s.yy,s.ii[d],c,o,i),f.push(i),o+=i,a++);return Qn(e,(function(e){var t=Lt(e);if(r[t]>0)return e<0?~l[t]:l[t]})),ja([n,new ma(f,u,c)])}(d,f,a)),n.arcs.transformPoints((function(e,t,n){if(n<i.length&&i[n]>0)return o(e,t)}))),Nt(p,(function(e){var t=o(e[0],e[1]);e[0]=t[0],e[1]=t[1]}))};var Hp=Lf(.01);function Xp(e){return" "+Hp(e[0])+" "+Hp(e[1])}function Zp(e){return e.length>2&&"C"==e[2]}function Qp(e){for(var t=[],n=0;n<e.length;n++)t.push(Kp(e[n])+" Z");return t.length>0?t.join(" "):""}function Kp(e){if(0===e.length)return"";var t,n,r,i="M",a=!1;for(n=0,r=e.length;n<r;n++)Zp(t=e[n])?(i+=" C"+Xp(t)+Xp(e[++n])+Xp(e[++n]),a=!0):a?(i+=" L"+Xp(t),a=!1):i+=Xp(t);return i}var eh=Object.freeze({__proto__:null,stringifyPolygonCoords:Qp,stringifyLineStringCoords:Kp});function th(e){if(!e)return null;var t=function(e){var t=/[, ]+(?![^(]*\))/;return String(e).trim().split(t)}(e),n=t[0]||"",r=null;return n.startsWith("dot")?(t[0]="dots",r=ah(t)):n.startsWith("square")?(t[0]="squares",r=ah(t)):n.startsWith("hatch")?(t[0]="hatches",r=rh(t)):n.startsWith("dash")?r=nh(t):isNaN(parseFloat(n))||(t.unshift("hatches"),r=rh(t)),r||gt("Invalid pattern, ignoring:",e),r}function nh(e){e.shift();for(var n,r=[],i=e.pop(),a=parseInt(e.pop());e.length>0;){if(ih(n=e.pop())){e.push(n);break}r.push(n)}var o=parseInt(e.pop()),s=[parseInt(e.pop()),parseInt(e.pop())].reverse(),u=45;return e.length>0&&(u=parseInt(e.pop())),e.length>0||o>0==!1?null:{type:"dashes",tileSize:[r.length*(o+a),t.sum(s)],colors:r,width:o,dashes:s,spacing:a,background:i,rotation:u}}function rh(e){e.shift();for(var n=e.length%2==1?parseInt(e.shift()):45,r=[],i=[],a=0;a<e.length;a+=2)i.push(parseInt(e[a])),r.push(e[a+1]);return Math.min.apply(null,i)>0==!1?null:{tileSize:[t.sum(i),10],type:"hatches",colors:r,widths:i,rotation:n}}function ih(e){return parseInt(e)>0}function ah(e){var t=[],n=e.shift(),r=0;ih(e[1])&&(r=parseInt(e.shift()));for(var i=parseInt(e.shift()),a=e.pop(),o=parseInt(e.pop());e.length>0;)t.push(e.shift());if(i>0==!1||o>=0==!1)return null;if(0===t.length)return null;var s=t.length*(i+o);return{type:n,tileSize:[s,s],colors:t,size:i,spacing:o,background:a,rotation:r}}function oh(e,n){var r=e["fill-pattern"],i=("hash_"+r).replace(/[()# ,_]+/g,"_"),a=t.find(n,(function(e){return e.id==i}));if(delete e["fill-pattern"],!a){if(a=function(e,t){var n,r=th(e);if(!r)return null;"hatches"==r.type?n=function(e){for(var t=e.tileSize[1],n="",r=0,i=0;r<e.widths.length;r++)n+=`<rect x="${i}" y="0" width="${e.widths[r]}" height="${t}" fill="${e.colors[r]}"></rect>`,i+=e.widths[r];return n}(r):"dots"==r.type||"squares"==r.type?n=function(e){for(var t=e.size,n=e.colors.length,r=t+e.spacing,i=n*n,a="squares"==e.type?ch:uh,o="",s=0,u=0,c=0;s<i;s++)o+=a(u,c,t,e.colors[(s+Math.floor(s/n))%n]),0===(u=(s+1)%n*r)&&(c+=r);return o}(r):"dashes"==r.type&&(n=function(e){for(var t="",n=0,r=0;n<e.colors.length;n++)t+=`<rect x="${r}" y="0" width="${e.width}" height="${e.dashes[0]}" fill="${e.colors[n]}"></rect>`,r+=e.width+e.spacing;return t}(r));return{svg:sh(r,t,n),id:t,href:`url(#${t})`}}(r,i),!a)return;n.push(a)}e.fill=a.href}function sh(e,t,n){var r=e.tileSize[0],i=e.tileSize[1],a=`<pattern id="${t}" patternUnits="userSpaceOnUse" width="${r}" height="${i}" patternTransform="rotate(${e.rotation})">`;return e.background&&(a+=`<rect x="0" y="0" width="${r}" height="${i}" fill="${e.background}"></rect>`),a+n+"</pattern>"}function uh(e,t,n,r){const i=n/2;return`<circle cx="${e+i}" cy="${t+i}" r="${i}" fill="${r}"></circle>`}function ch(e,t,n,r){return`<rect x="${e}" y="${t}" width="${n}" height="${n}" fill="${r}"></rect>`}var fh=Object.freeze({__proto__:null,parsePattern:th,parseDashes:nh,parseHatches:rh,parseDots:ah,convertFillPattern:oh}),lh={css:null,class:"classname",dx:"measure",dy:"measure",fill:"color","fill-pattern":"pattern","fill-effect":null,"font-family":null,"font-size":null,"font-style":null,"font-weight":null,"label-text":null,"letter-spacing":"measure","line-height":"measure",opacity:"number",r:"number",stroke:"color","stroke-dasharray":"dasharray","stroke-width":"number","stroke-opacity":"number","stroke-miterlimit":"number","fill-opacity":"number","vector-effect":null,"text-anchor":null},dh=t.extend({type:null,length:"number",rotation:"number",radius:"number",radii:null,flipped:"boolean",rotated:"boolean",direction:"number",sides:"number",points:"number",anchor:null,"head-angle":"number","head-width":"number","head-length":"number","stem-width":"number","stem-curve":"number","stem-taper":"number","stem-length":"number","min-stem-ratio":"number","arrow-scaling":"number",effect:null},lh),ph="css,class,opacity,stroke,stroke-width,stroke-dasharray,stroke-opacity,fill-opacity,vector-effect".split(","),hh={polygon:t.arrayToIndex(ph.concat("fill","fill-pattern","fill-effect")),polyline:t.arrayToIndex(ph.concat("stroke-linecap","stroke-linejoin","stroke-miterlimit")),point:t.arrayToIndex(ph.concat("fill","r")),label:t.arrayToIndex(ph.concat("fill,font-family,font-size,text-anchor,font-weight,font-style,letter-spacing,dominant-baseline".split(",")))};function gh(e,t,n,r){for(var i=vh(Object.keys(n||{}),t),a=0,o=i.length;a<o;a++)r&&!r(i[a])||mh(e,i[a],n[i[a]])}function mh(e,t,n){e.properties||(e.properties={}),e.properties[t]=n,"stroke-dasharray"==t&&n&&(e.properties["stroke-linecap"]="butt")}function yh(e){return e in lh}function vh(e,t){var n=hh[t]||{};return e.filter((function(e){return e in n}))}function bh(e,t){var n={},r=[];return!e.data||e.data.getFields(),Object.keys(t).forEach((function(i){var a=i.replace(/_/g,"-");if(a in dh){var o=t[i];n[a]=_h(o,a,e),r.push(a)}})),function(e){for(var t,i={},a=0;a<r.length;a++)i[t=r[a]]=n[t](e);return i}}function xh(e,t){return(t=t||[]).indexOf(e.trim())>-1||/[(){}./*?:&|=[+-]/.test(e)}function _h(e,t,n){var r,i=String(e).trim(),a=dh[t],o=n.data?n.data.getFields():[],s=null;return a&&-1===o.indexOf(i)&&(s=function(e,t){var n=null;"number"==t?n=Sh(e)?Number(e):null:"color"==t?n=Eh(e)?e:null:"classname"==t?n=wh(e)?e:null:"measure"==t?n=Ih(e)?Mh(e):null:"dasharray"==t?n=/^[0-9]+( [0-9]+)*$/.test(e)?e:null:"pattern"==t?n=function(e){return!!th(e)}(e)?e:null:"boolean"==t&&(n=Ah(e));return n}(i,a)),null===s&&xh(i,o)&&(r=function(e,t){var n;try{(n=ql(e,t,null,{no_warn:!0}))(0)}catch(e){n=null}return n}(i,n)),r||null!==s||a||(s=i),r||(null!==s?function(e){return s}:void pt("Unexpected value for",t+":",i))}function wh(e){return/^( ?[_a-z][-_a-z0-9]*\b)+$/i.test(e)}function Sh(e){return t.isFiniteNumber(e)||t.isString(e)&&/^-?[.0-9]+$/.test(e)}function Ah(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&null}function Ih(e){return t.isFiniteNumber(e)||t.isString(e)&&/^-?[.0-9]+[a-z]*$/.test(e)}function Mh(e){return t.isString(e)&&/[a-z]/.test(e)?e:Number(e)}function Eh(e){return/^[a-z]+$/i.test(e)||/^#[0-9a-f]+$/i.test(e)||/^rgba?\([0-9,. ]+\)$/.test(e)}var Ph=Object.freeze({__proto__:null,applyStyleAttributes:gh,isSupportedSvgStyleProperty:yh,findPropertiesBySymbolGeom:vh,getSymbolDataAccessor:bh,mightBeExpression:xh,getSymbolPropertyAccessor:_h,isSvgClassName:wh,isSvgNumber:Sh,parseBoolean:Ah,isSvgMeasure:Ih,parseSvgMeasure:Mh,isSvgColor:Eh}),jh={Point:kh,Polygon:Bh,LineString:Ch,MultiPoint:function(e,t){for(var n,r=[],i=0;i<e.length;i++)(n=kh(e[i],t))&&("g"==n.tag&&n.children?r=r.concat(n.children):r.push(n));return r.length>0?{tag:"g",children:r}:null},MultiLineString:Nh,MultiPolygon:Th};function Oh(e,t){return t=t||{},e.map((function(e){var n="Feature"==e.type?e.geometry:e,r=n&&n.type,i=yp.translateGeoJSONType(r),a=e.properties||{},o=null;return r&&n.coordinates&&(o=jh[r](n.coordinates,a)),o?("polyline"==i||"polygon"==i?gh(o,i,a):"point"==i&&zh(a)&&gh(o,i,a,Fh),"id"in e&&(o.properties||(o.properties={}),o.properties.id=(t.id_prefix||"")+e.id),o):{tag:"g"}}))}function kh(e,t){if(zh(t=t||{}))return{tag:"circle",properties:{cx:e[0],cy:e[1],r:t.r}};var n=Gh(t);return n&&(n.properties.transform=$h(e)),n}function Fh(e){return"r"!=e}function zh(e){return e&&e.r>0&&!e["svg-symbol"]&&!e["label-text"]}function Ch(e){return{tag:"path",properties:{d:Kp(e)}}}function Nh(e){return{tag:"path",properties:{d:e.map(Kp).join(" ")}}}function Th(e){return Bh(Lh(e))}function Lh(e){return e.reduce((function(e,t){return e.concat(t)}),[])}function Bh(e){if(0===e.length)return null;var t={tag:"path",properties:{d:Qp(e)}};return e.length>1&&(t.properties["fill-rule"]="evenodd"),t}var Dh=Object.freeze({__proto__:null,importGeoJSONFeatures:Oh,importPoint:kh,importLineString:Ch,importMultiLineString:Nh,importMultiPolygon:Th,flattenMultiPolygonCoords:Lh,importPolygon:Bh});function Uh(e){var t=Rh(e);return gh(t,"label",e),t}function Rh(e){var t,n,r,i=(t=e["label-text"])||0===t||!1===t?String(t):"",a=/\n|\\n|<br>/i,o=e.dx||0,s={y:e.dy||0,x:o};return a.test(i)&&(n=i.split(a),i=n.shift()),r={tag:"text",value:i,properties:s},n&&(r.children=[],n.forEach((function(t){var n={tag:"tspan",value:t,properties:{x:o,dy:e["line-height"]||"1.1em"}};r.children.push(n)}))),r}var qh=Object.freeze({__proto__:null,renderStyledLabel:Uh,renderLabel:Rh});function $h(e,t){var n="translate("+Tf(e[0])+" "+Tf(e[1])+")";return t&&1!=t&&(n+=" scale("+t+")"),n}var Vh={line:function(e,t,n){var r,i;return r=[[t,n],[t+(e.dx||0),n+(e.dy||0)]],gh(i=Ch(r),"polyline",e),i},polygon:function(e){var t=Bh(e.coordinates||[]);return gh(t,"polygon",e),t},polyline:function(e){var t=Nh(e.coordinates||[]);return gh(t,"polyline",e),t},circle:Wh,square:function(e,t,n){var r=e.r||0,i={tag:"rect",properties:{x:t-r,y:n-r,width:2*r,height:2*r}};return gh(i,"point",e),i},image:function(e,t,n){var r=e.width||20,i=e.height||20,a={tag:"image",properties:{width:r,height:i,x:(t||0)-r/2,y:(n||0)-i/2,href:e.href||""}};e.fill&&(a.properties.fill=e.fill);return a},group:function(e,t,n){var r={tag:"g",children:[]},i=r.children;return(e.parts||[]).forEach((function(e){var r=Jh(e,t,n);i.push(r),"line"==e.type&&(t+=e.dx||0,n+=e.dy||0),"offset"==e.type&&(i=r.children,t=n=0)})),1!=r.children.length||r.properties?r:r.children[0]},label:function(e,t,n){var r=Uh(e);(t||n)&&(r.properties.transform=$h([t,n]));return r},offset:function(e,t,n){var r=(t||0)+(e.dx||0),i=(n||0)+(e.dy||0);return{tag:"g",properties:{transform:$h([r,i])},children:[]}}};function Gh(e){var t=[];wg(e)&&t.push(function(e){if(e["svg-symbol"])return Jh(e["svg-symbol"]);if(e.r>0)return Wh(e);return{tag:"g",properties:{},children:[]}}(e)),Sg(e)&&t.push(Uh(e));var n=t.length>1?{tag:"g",children:t}:t[0];return n?(n.properties=n.properties||{},n):null}function Jh(e,n,r){if(t.isString(e)&&(e=JSON.parse(e)),e.tag)return e;var i=Vh[e.type];if(!i)return gt(e.type?"Unknown symbol type: "+e.type:"Symbol is missing a type property"),{tag:"g",properties:{},children:[]};var a=i(e,n||0,r||0);return e.opacity&&(a.properties.opacity=e.opacity),a}function Wh(e,t,n){var r={tag:"circle",properties:{cx:t||0,cy:n||0}};return gh(r,"point",e),r}var Yh=Object.freeze({__proto__:null,getTransform:$h,symbolRenderers:Vh,renderPoint:Gh});function Hh(e){var n=t.defaults({type:"scalebar"},e);return{name:e.name||"scalebar",data:new Jr([n])}}function Xh(e,t){var n=function(e){var t={valign:"top",halign:"left",voffs:10,hoffs:10};return+e.left>0&&(t.hoffs=+e.left),+e.top>0&&(t.voffs=+e.top),+e.right>0&&(t.hoffs=+e.right,t.halign="right"),+e.bottom>0&&(t.voffs=+e.bottom,t.valign="bottom"),t}(e),r=Vp(t),i=e.label_text||function(e,t){var n=70*t/1e3;return"1/8 1/5 1/4 1/2 1 2 3 4 5 8 10 15 20 25 30 40 50 75 100 150 200 250 300 350 400 500 750 1,000 1,500 2,000 2,500 3,000 4,000 5,000".split(" ").reduce((function(e,t){if(e)return e;var r=Zh(t);return Qh(r)>n?r:void 0}),null)||""}(t.width,r),a=Qh(i),o=+e.font_size||12,s=Math.round(a/r*1e3),u=Math.round(7+.8*o),c="top"==e.label_position?"top":"bottom",f="left"==n.halign?0:s,l=7,d="right"==n.halign?t.width-s-n.hoffs:n.hoffs,p="bottom"==n.valign?t.height-u-n.voffs:n.voffs;if(!t.crs)return gt("Unable to render a scalebar: unknown CRS."),[];"top"==c&&(l=-4,p+=Math.round(4+.8*o)),s>0==!1&&pt("Null scalebar length");var h={tag:"rect",properties:{fill:"black",x:0,y:0,width:s,height:3}},g={"label-text":i,"font-size":o,"text-anchor":"left"==n.halign?"start":"end","dominant-baseline":"top"==c?"auto":"hanging"};return[{tag:"g",children:[h,Vh.label(g,f,l)],properties:{transform:"translate("+d+" "+p+")"}}]}function Zh(e){return e+(Kh(e)>1?" MILES":" MILE")}function Qh(e){var t=function(e){var t=/miles?$/.test(e.toLowerCase()),n=/(km|kilometers?|kilometres?)$/.test(e.toLowerCase());return(t?"mile":n&&"km")||""}(e),n=Kh(e);return t&&n?"mile"==t?1.60934*n:n:NaN}function Kh(e){var t,n,r=/^([0-9]+) ?\/ ?([0-9]+)/;return e=e.replace(/[\s]/g,"").replace(/,/g,""),(n=r.test(e)?+(t=r.exec(e))[1]/+t[2]:parseFloat(e))>0&&n<1/0?n:NaN}td.scalebar=function(e,t){var n,r=$p(e);r||pt("Missing a map frame"),n=Hh(t),r.layers.push(n)},Fp.scalebar=Xh;var eg=Object.freeze({__proto__:null,getScalebarLayer:Hh,renderScalebar:Xh,formatDistanceLabelAsMiles:Zh,parseScalebarLabelToKm:Qh});function tg(e,t){var n=Bp(e,t);return ng(e,n,t),[n.width,n.height]}function ng(e,t,n){var r=new kt(t.bbox),i=new kt(0,0,t.width,t.height),a=r.getTransform(i,n.invert_y);Za(e,(function(e,t){return a.transform(e,t)}))}var rg=Object.freeze({__proto__:null,transformDatasetToPixels:tg,fitDatasetToFrame:ng});function ig(e){var t,n;return e&&e.tag?(t="<"+e.tag,e.properties&&(t+=ug(e.properties)),e.children||e.value?(t+=">"+(n="text"==e.tag||"tspan"==e.tag?"":"\n"),e.value&&(t+=sg(e.value)),e.children&&(t+=e.children.map(ig).join(n)),t+=n+"</"+e.tag+">"):t+="/>",t):""}var ag=/[&<>"']/g,og={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};function sg(e){return String(e).replace(ag,(function(t,n){var r=og[t];return"&"==t&&e.substr(n,r.length)==r?"&":r}))}function ug(e){return Object.keys(e).reduce((function(n,r){var i=e[r];return i||0===i?("href"==r&&(r="xlink:href"),"css"==r&&(r="style"),n+" "+r+'="'+sg(t.isString(i)?i:JSON.stringify(i))+'"'):n}),"")}var cg=Object.freeze({__proto__:null,stringify:ig,stringEscape:sg,stringifyProperties:ug});function fg(){return{cx:.5,cy:.5,r:.57,fx:.35,fy:.35,stops:[{offset:.3,opacity:0},{offset:.6,opacity:.1},{offset:.78,opacity:.25},{offset:.87,opacity:.45},{offset:.95,opacity:1}]}}function lg(e,n){if("sphere"==e["fill-effect"]){var r="mapshaper_sphere_effect",i=`url(#${r})`,a={cx:.5,cy:.5,r:.57,fx:.35,fy:.35,stops:[{offset:.3,opacity:0},{offset:.6,opacity:.1},{offset:.78,opacity:.25},{offset:.87,opacity:.45},{offset:.95,opacity:1}]},o=a.stops.map((function(e){return`<stop offset="${e.offset}" stop-opacity="${e.opacity}"/>`})),s=`<radialGradient id="${r}" cx="${a.cx}" cy="${a.cy}" r="${a.r}" fx="${a.fx}" fy="${a.fy}">${o.join("")}</radialGradient>`;t.find(n,(function(e){return e.id==r}))||n.push({svg:s,id:r,href:i}),e.fill=i,"opacity"in e==!1&&"fill-opacity"in e==!1&&(e["fill-opacity"]=.35)}}var dg=Object.freeze({__proto__:null,getSphereEffectParams:fg,convertFillEffect:lg}),pg={};function hg(e,n){!function e(r){"path"==r.tag&&r.properties["fill-pattern"]&&oh(r.properties,n);"path"==r.tag&&r.properties["fill-effect"]&&lg(r.properties,n);"image"==r.tag?/\.svg/.test(r.properties.href||"")&&function(e,n){var r=e.properties.href,i=t.find(n,(function(e){return e.href==r}));i||((i={href:r,id:gg(r)}).svg=function(e,t){var n="";try{n=function(e,t){return e=e.replace(/[^]*<svg/,"<svg"),e.replace(/^<svg[^>]*>/,(function(e){return e=(e=e.replace(/ id="[^"]*"/,"")).replace(/<svg/,'<svg id="'+t+'"')}))}(function(e){var t;0===e.indexOf("http")?t=function(e){if(e in pg)return pg[e];var t=pr("sync-request")("GET",e,{timeout:2e3}).getBody().toString();return pg[e]=t,t}(e):pr("fs").existsSync(e)?t=pr("fs").readFileSync(e,"utf8"):pt("Invalid SVG location:",e);return t}(e),t)+"\n",n="\x3c!-- "+e+"--\x3e\n"+n}catch(e){}return n}(r,i.id),n.push(i));i.svg&&(e.tag="use",e.properties.href="#"+i.id)}(r,n):r.children&&r.children.forEach(e)}(e)}function gg(e){return function(e){for(var t,n,r,i,a,o,s,u=0,c=0,f=[],l=[t=1732584193,n=4023233417,~t,~n,3285377520],d=[],p=unescape(encodeURI(e)),h=p.length;c<=h;)d[c>>2]|=(p.charCodeAt(c)||128)<<8*(3-c++%4);for(d[s=h+8>>2|15]=h<<3;u<=s;u+=16){for(t=l,c=0;c<80;t=[0|[(o=((p=t[0])<<5|p>>>27)+t[4]+(f[c]=c<16?~~d[u+c]:o<<1|o>>>31)+1518500249)+((n=t[1])&(r=t[2])|~n&(i=t[3])),a=o+(n^r^i)+341275144,o+(n&r|n&i|r&i)+882459459,a+1535694389][0|c++/20],p,n<<30|n>>>2,r,i])o=f[c-3]^f[c-8]^f[c-14]^f[c-16];for(c=5;c;)l[--c]=l[c]+t[c]|0}for(e="";c<40;)e+=(l[c>>3]>>4*(7-c++%8)&15).toString(16);return e}(e).substr(0,12)}function mg(e,n){var r,i,a,o='xmlns="http://www.w3.org/2000/svg"',s=[],u="";n.crisp_paths&&(u="\n  <style>\n    path {shape-rendering: crispEdges;}\n  </style>"),n.final?e.arcs&&e.arcs.flatten():e=Ua(e),t.extend(n,{invert_y:!0}),r=Bp(e,n),ng(e,r,n),Uf(e,n.precision||1e-4),n.svg_data&&bg(e.layers,n.svg_data),a=e.layers,n.scalebar&&a.push(Hh({})),i=a.map((function(t){var i;return hg(i=zp(t)?yg(t,r,n):vg(t,e,n),s),ig(i)})).join("\n"),s.length>0&&(i="<defs>\n"+t.pluck(s,"svg").join("")+"</defs>\n"+i),i.includes("xlink:")&&(o+=' xmlns:xlink="http://www.w3.org/1999/xlink"');var c=`stroke-linecap="${n.default_linecap||"round"}" stroke-linejoin="round"`;i.includes('stroke-linejoin="miter"')&&(c+=' stroke-miterlimit="2"');var f=`<?xml version="1.0"?>\n  <svg ${o} version="1.2" baseProfile="tiny" width="%d" height="%d" viewBox="%s %s %s %s" ${c}>${u}\n  ${i}\n  </svg>`;return[{content:i=t.format(f,r.width,r.height,0,0,r.width,r.height),filename:n.file||oo(e)+".svg"}]}function yg(e,t,n){var r=_g(e,n);return r.children=Tp(Np(e),t),r}function vg(e,n,r){var i=_g(e,r);return i.children=function(e,n,r){var i=t.defaults({layers:[e]},n),a=Sp(i,r),o=Oh(a.features||a.geometries||(a.type?[a]:[]),r);r.svg_data&&e.data&&function(e,n,r){var i=n.getFields(),a=r.indexOf("*")>-1?i.concat():r,o=t.difference(a,i);o.length>0&&(a=t.difference(a,o));var s=xg(n.getRecords(),a);e.length!=s.length&&dt("Mismatch between number of SVG symbols and data attributes");e.forEach((function(e,n){t.extend(e.properties||{},s[n])}))}(o,e.data,r.svg_data);return o}(e,n,r),i}function bg(e,n){var r=n.reduce((function(n,r){return function(e,n){return t.some(e,(function(e){return e.data&&e.data.fieldExists(n)||!1}))}(e,r)||n.push(r),n}),[]);r.length&&-1==r.indexOf("*")&&pt("Missing data field(s):",r.join(", "))}function xg(e,n){var r=/^[a-z_][a-z0-9_-]*$/i,i=/^xml/,a=n.filter((function(e){return r.test(e)&&!i.test(e)})),o=t.difference(n,a);return o.length>0&&(gt("Unable to add data-* attributes for field(s):",o.join(", ")),gt("data-* names should match pattern [a-z_][a-z0-9_-]*")),e.map((function(e){for(var t,n={},r=0;r<a.length;r++)n["data-"+a[r].toLowerCase()]=(t=e[a[r]],String(t));return n}))}function _g(e,n){var r={tag:"g",properties:{id:(n.id_prefix||"")+(e.name||t.getUniqueName("layer"))},children:[]};return("polyline"==e.geometry_type||Ag(e))&&(r.properties.fill="none"),"polyline"==e.geometry_type&&(r.properties.stroke="black",r.properties["stroke-width"]=1),(Ig(e)||Ag(e)||zp(e))&&(r.properties["font-family"]="sans-serif",r.properties["font-size"]="12",r.properties["text-anchor"]="middle"),r}function wg(e){return!(!e||!e["svg-symbol"]&&!e.r)}function Sg(e){var t=e&&e["label-text"];return t||0===t}function Ag(e){return"point"==e.geometry_type&&e.data&&e.data.fieldExists("svg-symbol")}function Ig(e){return"point"==e.geometry_type&&e.data&&e.data.fieldExists("label-text")}var Mg=Object.freeze({__proto__:null,exportSVG:mg,exportFurnitureForSVG:yg,exportLayerForSVG:vg,validateSvgDataFields:bg,exportDataAttributesForSVG:xg,getEmptyLayerForSVG:_g,featureHasSvgSymbol:wg,featureHasLabel:Sg,layerHasSvgSymbols:Ag,layerHasLabels:Ig});function Eg(e,n){t.isNumber(e)?e=new ArrayBuffer(e):e instanceof ArrayBuffer||("function"==typeof s&&e instanceof s||e instanceof Uint8Array?e=e.buffer&&e.buffer.byteLength==e.length?e.buffer:Eg.copyToArrayBuffer(e):dt("BinArray constructor takes an integer, ArrayBuffer or Buffer argument")),this._buffer=e,this._bytes=new Uint8Array(e),this._view=new DataView(e),this._idx=0,this._le=!1!==n}Eg.bufferToUintArray=function(e,t){return 4==t?new Uint32Array(e):2==t?new Uint16Array(e):1==t?new Uint8Array(e):void dt("BinArray.bufferToUintArray() invalid word length:",t)},Eg.uintSize=function(e){return 1&e||2&e||4},Eg.bufferCopy=function(e,t,n,r,i){r=r||0,i=i||n.byteLength-r,e.byteLength-t<i&&dt("Buffer overflow; tried to write:",i);for(var a=Math.min(Eg.uintSize(i),Eg.uintSize(r),Eg.uintSize(e.byteLength),Eg.uintSize(t),Eg.uintSize(n.byteLength)),o=Eg.bufferToUintArray(n,a),s=Eg.bufferToUintArray(e,a),u=i/a,c=r/a,f=t/a;u--;)s[f++]=o[c++];return i},Eg.copyToArrayBuffer=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e[i];return n},Eg.bufferSize=function(e){return e instanceof ArrayBuffer?e.byteLength:0|e.length},Eg.prototype={size:function(){return this._buffer.byteLength},littleEndian:function(){return this._le=!0,this},bigEndian:function(){return this._le=!1,this},buffer:function(){return this._buffer},bytesLeft:function(){return this._buffer.byteLength-this._idx},skipBytes:function(e){return this._idx+=e+0,this},readUint8:function(){return this._bytes[this._idx++]},writeUint8:function(e){return this._bytes[this._idx++]=e,this},readInt8:function(){return this._view.getInt8(this._idx++)},writeInt8:function(e){return this._view.setInt8(this._idx++,e),this},readUint16:function(){var e=this._view.getUint16(this._idx,this._le);return this._idx+=2,e},writeUint16:function(e){return this._view.setUint16(this._idx,e,this._le),this._idx+=2,this},readUint32:function(){var e=this._view.getUint32(this._idx,this._le);return this._idx+=4,e},writeUint32:function(e){return this._view.setUint32(this._idx,e,this._le),this._idx+=4,this},readInt32:function(){var e=this._view.getInt32(this._idx,this._le);return this._idx+=4,e},writeInt32:function(e){return this._view.setInt32(this._idx,e,this._le),this._idx+=4,this},readFloat64:function(){var e=this._view.getFloat64(this._idx,this._le);return this._idx+=8,e},writeFloat64:function(e){return this._view.setFloat64(this._idx,e,this._le),this._idx+=8,this},readFloat64Array:function(e){var t,n=8*e,r=this._idx,i=this._buffer;if(r%8==0)t=new Float64Array(i,r,e);else if(i.slice)t=new Float64Array(i.slice(r,r+n));else{var a=new ArrayBuffer(n);Eg.bufferCopy(a,0,i,r,n),t=new Float64Array(a)}return this._idx+=n,t},readUint32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.readUint32());return t},peek:function(e){return this._view.getUint8(e>=0?e:this._idx)},position:function(e){return null!=e?(this._idx=e,this):this._idx},readCString:function(e,t){for(var n="",r=e>=0?e:this.bytesLeft();r>0;){var i=this.readUint8();if(r--,0==i)break;if(i>127&&t){n=null;break}n+=String.fromCharCode(i)}return e>0&&r>0&&this.skipBytes(r),n},writeString:function(e,t){var n,r=0,i=e.length;t&&(i=Math.min(i,t));for(var a=0;a<i;a++)(n=e.charCodeAt(a))>127&&(n="?".charCodeAt(0)),this.writeUint8(n),r++;return r},writeCString:function(e,t){var n=t?t-1:null,r=this.writeString(e,n);if(this.writeUint8(0),r++,t)for(;r<t;)this.writeUint8(0),r++;return this},writeBuffer:function(e,t,n){return this._idx+=Eg.bufferCopy(this._buffer,this._idx,e,n,t),this}};var Pg=Object.freeze({__proto__:null,buffersAreIdentical:function(e,t){var n=Eg.bufferSize(e);if(n!=Eg.bufferSize(t))return!1;for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0},BinArray:Eg}),jg={},Og=254;jg.MAX_STRING_LEN=Og,jg.convertValueToString=Fg,jg.convertFieldNames=Cg,jg.discoverFieldType=Lg,jg.getDecimalFormatter=Bg,jg.getNumericFieldInfo=Dg,jg.truncateEncodedString=Rg,jg.getFieldInfo=Tg,jg.exportRecords=function(e,n,r){var i=e.length,a=Vr(e,r),o=n||"utf8",s=br(a.join(""))?"ascii":o,u=function(e,n){return e.map((function(e){for(var r=Ar(e,n),i=r.length,a=t.createBuffer(11),o=0;o<11;o++)a[o]=o<10&&i>=o-1?r[o]:0;return a}))}(Cg(a,s),s),c=a.map((function(t,n){var r=Tg(e,t,o);return r.warning&&gt("["+t+"] "+r.warning),r})),f=(y=c.length,33+32*y),l=(m=t.pluck(c,"size"),t.sum(m)+1),d=f+i*l+1,p=new ArrayBuffer(d),h=new Eg(p).littleEndian(),g=new Date;var m;var y;h.writeUint8(3),h.writeUint8(g.getFullYear()-1900),h.writeUint8(g.getMonth()+1),h.writeUint8(g.getDate()),h.writeUint32(i),h.writeUint16(f),h.writeUint16(l),h.skipBytes(17),h.writeUint8(0),h.skipBytes(2),c.reduce((function(e,t,n){return h.writeBuffer(u[n],11,0),h.writeUint8(t.type.charCodeAt(0)),h.writeUint32(e),h.writeUint8(t.size),h.writeUint8(t.decimals),h.skipBytes(14),e+t.size}),1),h.writeUint8(13),h.position()!=f&&dt("Dbf#exportRecords() header size mismatch; expected:",f,"written:",h.position());e.forEach((function(e,t){var n=h.position();h.writeUint8(32);for(var r=0,i=c.length;r<i;r++)c[r].write(t,h);h.position()-n!=l&&dt("#exportRecords() Error exporting record:",e)})),h.writeUint8(26),h.position()!=d&&dt("Dbf#exportRecords() file size mismatch; expected:",d,"written:",h.position());return p};var kg=new function(){var e,t;function n(){e=new Uint8Array(5e3),t=0}return n(),{reserve:function(r){return t+r>5e3&&n(),t+=r,e.subarray(t-r,t)},putBack:function(e){t-=e}}};function Fg(e){return null==e?"":String(e)}function zg(e,t,n,r){var i="ascii"==r?Ug:function(e){return function(t){var n=Ug(t,!0);return null===n&&(n=Ar(String(t),e)),n}}(r),a=1,o=0,s=t.map((function(e){var t=Fg(e[n]),s=i(t);return s.length>Og&&(s="ascii"==r?s.subarray(0,Og):Rg(s,r,Og),o++),a=Math.max(a,s.length),s}));e.size=a,e.write=function(e,t){var n,r=s[e],i=Math.min(a,r.length),o=t._bytes,u=t.position();for(n=0;n<i;n++)o[n+u]=r[n];t.position(u+a)},o>0&&(e.warning="Truncated "+o+" string"+(1==o?"":"s")+" to fit the 254-byte limit")}function Cg(e,t){var n=Lr(e.map(Ng),10,t);return n.forEach((function(t,n){e[n]!=t&&gt('Changed field name from "'+e[n]+'" to "'+t+'"')})),n}function Ng(e){return e.replace(/[-\s]+/g,"_")}function Tg(e,n,r){var i=Lg(e,n),a={type:i,decimals:0};return"N"==i?function(e,n,r){var i,a;i=Dg(n,r),e.decimals=i.decimals,(a=Math.max(i.max.toFixed(e.decimals).length,i.min.toFixed(e.decimals).length))>18&&(a=18,e.decimals-=a-18,e.decimals<0&&dt("Dbf#getFieldInfo() Out-of-range error.")),e.size=a;var o=Bg(a,e.decimals);e.write=function(e,i){var s=n[e],u=o(s[r]);u.length<a&&(u=t.lpad(u,a," ")),i.writeString(u,a)}}(a,e,n):"C"==i?zg(a,e,n,r):"L"==i?function(e,t,n){e.size=1,e.write=function(e,r){var i,a=t[e][n];i=!0===a?"T":!1===a?"F":"?",r.writeString(i)}}(a,e,n):"D"==i?function(e,n,r){e.size=8,e.write=function(e,i){var a,o=n[e][r];a=o instanceof Date==0?"00000000":t.lpad(o.getUTCFullYear(),4,"0")+t.lpad(o.getUTCMonth()+1,2,"0")+t.lpad(o.getUTCDate(),2,"0"),i.writeString(a)}}(a,e,n):(a.size=0,a.type="N",i&&(a.warning="Unable to export "+i+"-type data, writing null values"),a.write=function(){}),a}function Lg(e,n){for(var r,i=0,a=e.length;i<a;i++){if(r=e[i][n],t.isString(r))return"C";if(t.isNumber(r))return"N";if(t.isBoolean(r))return"L";if(r instanceof Date)return"D";if(r)return typeof r}return null}function Bg(e,n){return function(r){var i=t.isFiniteNumber(r)?r.toFixed(n):String(" ");return t.lpad(i,e," ")}}function Dg(e,n){for(var r,i=0,a=0,o=1,s=1,u=0,c=1e-15,f=0,l=e.length;f<l;f++)if(r=e[f][n],t.isFiniteNumber(r)){if(r<i||r>a)for(r<i&&(i=r),r>a&&(a=r);Math.abs(r)>=s;)s*=10,c*=10;for(;Math.abs(Math.round(r*o)-r*o)>c&&15!=u;)u++,c*=10,o*=10}return{decimals:u,min:i,max:a}}function Ug(e,t){var n,r,i=String(e),a=i.length,o=kg.reserve(a);for(n=0;n<a;n++){if((r=i.charCodeAt(n))>127){if(t){o=null,n=0;break}r="?".charCodeAt(0)}o[n]=r}return kg.putBack(a-n),o?o.subarray(0,n):null}function Rg(e,t,n){for(var r,i,a=e.slice(0,n),o=n;o>0&&o>=n-3;){if("ï¿½"!=(i=Ir(r=o==n?a:e.slice(0,o),t)).charAt(i.length-1)){a=r;break}o--}return a}function qg(e,n,r){var i,a=e.data;return(!a||r.cut_table||r.drop_table)&&(a=new Jr(e.shapes?e.shapes.length:0)),a.isEmpty()&&a.addIdField(),i=a.exportAsDbf?a.exportAsDbf(r):jg.exportRecords(a.getRecords(),r.encoding,r.field_order),t.isInteger(r.ldid)&&(new Uint8Array(i)[29]=r.ldid),[{content:i,filename:e.name+".dbf"}]}function $g(e,t,n){var r,i,a=[],o=e.length,s=t.length;for(a.push(e),r=0;r<s;r++)i=Vg(t[r][e],n),o=Math.max(o,i.length),a.push(i);for(r=0;r<a.length;r++)a[r]=a[r].padEnd(o," ");return a}function Vg(e,n){return null==e?"":t.isString(e)?e:t.isNumber(e)?n.decimal_comma?t.formatIntlNumber(e):t.formatNumber(e):t.isObject(e)?JSON.stringify(e):e+""}function Gg(e){var n=function(e){var n=t.splitLines(e);n.length>2&&n.pop();for(var r,i,a,o,s=function(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(t,e[n].length);return t}(n),u=n[0],c=[],f=0,l=!1,d=!1,p=0;p<=s;p++){if(i=Yg(u,p),r=!Hg(n,p),(a=i&&!d)&&l)return null;(p==s||p>0&&a)&&(o=p==s?void 0:p-1,c.push({name:Jg(u,f,o),end:o,start:f}),f=p),l=r,d=i}return c.length>0?c:null}(e.substring(0,2e3));if(!n)return[];var r=t.splitLines(e);""===r[r.length-1]&&r.pop();for(var i=[],a=1;a<r.length;a++)i.push(Wg(r[a],n));return i}function Jg(e,t,n){return e.substring(t,n).trim()}function Wg(e,t){for(var n,r={},i=0;i<t.length;i++)r[(n=t[i]).name]=Jg(e,n.start,n.end);return r}function Yg(e,t){return t<e.length&&" "!==e[t]}function Hg(e,t){for(var n=0;n<e.length;n++)if(Yg(e[n],t))return!1;return!0}function Xg(e,t){var n=function(e,t){var n=",",r=t.file?to(t.file):"";t.delimiter?n=t.delimiter:"tsv"==r?n="\t":"csv"==r?n=",":e.input_delimiter&&(n=e.input_delimiter);return n}(e.info,t),r=function(e,t){var n="txt";t.file?n=to(t.file):"\t"==e?n="tsv":","==e&&(n="csv");return n}(n,t);return e.layers.reduce((function(e,i){return i.data&&e.push({content:Zg(i,n,t),filename:(i.name||"output")+"."+r}),e}),[])}function Zg(e,t,n){var r=n||{},i=r.encoding||"utf8",a=e.data.getRecords(),o=Vr(a,r.field_order);if(" "==t)return function(e,t,n){for(var r,i=[],a=0;a<e.length;a++)if(r=$g(e[a],t,n),0===a)i=r;else for(var o=0;o<i.length;o++)i[o]+=" "+r[o];return i.join("\n")}(o,a,r);var u=function(e,t,n){var r=Kg(t,n);return function(n){return e.map((function(e){return r(n[e])})).join(t)}}(o,t,r);return xr(i)&&!r.to_buffer&&(a.length<1e4||r.to_string)?function(e,t,n){var r=Qg(e,n);return t.length?r+"\n"+t.map(n).join("\n"):r}(o,a,u):function(e,t,n,r){var i=Qg(e,n),a=[Ar(i,r)],o=[],u=t.length,c=0;for(;c<u;)o.push(n(t[c])),++c%1e3!=0&&c!=u||(i="\n"+o.join("\n"),o=[],a.push(Ar(i,r)));return s.concat(a)}(o,a,u,i)}function Qg(e,t){var n=e.reduce((function(e,t){return e[t]=t,e}),{});return t(n)}function Kg(e,n){var r=new RegExp('["\n\r'+e+"]"),i=n&&n.decimal_comma||!1;function a(e){return r.test(e)&&(e='"'+e.replace(/"/g,'""')+'"'),e}return function(e){return null==e?"":t.isString(e)?a(e):t.isNumber(e)?i?t.formatIntlNumber(e):t.formatNumber(e):t.isObject(e)?a(JSON.stringify(e)):e+""}}var em=Object.freeze({__proto__:null,exportDelim:Xg,exportLayerAsDSV:Zg,getDelimValueFormatter:Kg}),tm={NULL:0,POINT:1,POLYLINE:3,POLYGON:5,MULTIPOINT:8,POINTZ:11,POLYLINEZ:13,POLYGONZ:15,MULTIPOINTZ:18,POINTM:21,POLYLINEM:23,POLYGONM:25,MULIPOINTM:28,MULTIPATCH:31};function nm(e,n){return e.layers.reduce((function(r,i){var a=function(e,t){var n=t.info||{},r=n.prj;if(!r)try{r=qi(Qi(t))}catch(e){}r||gt("Unable to generate .prj file for",e.name+".shp");return r?{content:r,filename:e.name+".prj"}:null}(i,e);return r=r.concat(function(e,n,r){var i,a=e.shapes||t.initializeArray(new Array(ti(e)),null),o=new kt,s=function(e){var t,n=e.geometry_type;t="point"==n?lr(e.shapes||[])<=1?tm.POINT:tm.MULTIPOINT:"polygon"==n?tm.POLYGON:"polyline"==n?tm.POLYLINE:tm.NULL;return t}(e),u=100,c=100+8*a.length,f=new Eg(c).bigEndian().position(100),l=a.map((function(t,r){var i=function(e,t,n){var r=tm.isMultiPartType(n),i=!r&&!tm.isMultiPointType(n),a=e.pointCount>0==!1,o=a?null:e.bounds,s=null;if(a)s=new Eg(12,!1).writeInt32(t).writeInt32(2).littleEndian().writeInt32(0);else if(i)s=new Eg(28,!1).writeInt32(t).writeInt32(10).littleEndian().writeInt32(n).writeFloat64(e.pathData[0].points[0][0]).writeFloat64(e.pathData[0].points[0][1]);else{var u=52,c=r?u+4*e.pathCount:48,f=c+16*e.pointCount,l=0;s=new Eg(f,!1).writeInt32(t).writeInt32((f-8)/2).littleEndian().writeInt32(n).writeFloat64(o.xmin).writeFloat64(o.ymin).writeFloat64(o.xmax).writeFloat64(o.ymax),r&&s.writeInt32(e.pathCount),s.writeInt32(e.pointCount),e.pathData.forEach((function(e,t){r&&s.position(u+4*t).writeInt32(l),s.position(c+16*l);for(var n=0,i=e.points.length;n<i;n++)s.writeFloat64(e.points[n][0]),s.writeFloat64(e.points[n][1]);l+=n})),e.pointCount!=l&&dt("Shp record point count mismatch; pointCount:",l,"data.pointCount:",e.pointCount)}return{bounds:o,buffer:s.buffer()}}(df(t,n.arcs,e.geometry_type),r+1,s),a=i.buffer.byteLength;return f.writeInt32(u/2),f.writeInt32(a/2-4),u+=a,i.bounds&&o.mergeBounds(i.bounds),i.buffer}));i=new Eg(u,!1).writeInt32(9994).skipBytes(20).writeInt32(u/2).littleEndian().writeInt32(1e3).writeInt32(s),o.hasBounds()?i.writeFloat64(o.xmin||0).writeFloat64(o.ymin||0).writeFloat64(o.xmax||0).writeFloat64(o.ymax||0):i.skipBytes(32);return i.skipBytes(32),l.forEach((function(e){i.writeBuffer(e)})),f.position(0).writeBuffer(i.buffer(),100).position(24).writeInt32(c/2),[{content:i.buffer(),filename:e.name+".shp"},{content:f.buffer(),filename:e.name+".shx"}]}(i,e)),r=r.concat(qg(i,0,n)),a&&r.push(a),r}),[])}tm.isPolygonType=function(e){return 5==e||15==e||25==e},tm.isPolylineType=function(e){return 3==e||13==e||23==e},tm.isMultiPartType=function(e){return tm.isPolygonType(e)||tm.isPolylineType(e)},tm.isMultiPointType=function(e){return 8==e||18==e||28==e},tm.isZType=function(e){return[11,13,15,18].includes(e)},tm.isMType=function(e){return tm.isZType(e)||[21,23,25,28].includes(e)},tm.hasBounds=function(e){return tm.isMultiPartType(e)||tm.isMultiPointType(e)};var rm=Object.freeze({__proto__:null,exportShapefile:nm}),im={};function am(e){var t=1e4/e;return function(e){return e===1/0?0:Math.ceil(e*t)}}function om(e,t,n){return ff(ir(e,t,"polygon"),t,n).map((function(e){return e.map((function(e){return e.ids}))}))}im.forEachShapePart=function(e,t){var n={GeometryCollection:function(e){e.geometries.forEach(r)},LineString:function(e){var n=t(e.arcs);n&&(e.arcs=n)},MultiLineString:function(e){i(e.arcs)},Polygon:function(e){i(e.arcs)},MultiPolygon:function(e){e.arcs.forEach(i)}};function r(e){e.type in n&&n[e.type](e)}function i(e){for(var n,r=0;r<e.length;r++)(n=t(e[r]))&&(e[r]=n)}r(e)},im.forEachArc=function(e,n){im.forEachShapePart(e,(function(e){for(var r,i=0;i<e.length;i++)r=n(e[i]),t.isInteger(r)&&(e[i]=r)}))},td.explodeFeatures=function(e,n,r){var i,a,o,s=e.data?e.data.getRecords():null,u=s?[]:null,c=[],f=t.extend({},e);return e.shapes.forEach((function(i,a){var o,f;if(i?(o="polygon"==e.geometry_type&&i.length>1?r&&r.naive?function(e,t){var n=ir(e,t,"polygon");return n.map((function(e){return e.area<0&&Hn(e.ids),[e.ids]}))}(i,n):om(i,n):function(e){return e.map((function(e){return[e.concat()]}))}(i),t.merge(c,o)):c.push(null),null!==u)for(var l=0,d=o?o.length:1;l<d;l++)u.push((f=s[a],Object.assign({},f)))})),f.shapes=c,null!==u&&(f.data=new Jr(u)),i=f,a=ti(e),o=ti(i),gt(t.format("Exploded %,d feature%s into %,d feature%s",a,t.pluralSuffix(a),o,t.pluralSuffix(o))),f};var sm=Object.freeze({__proto__:null,explodePolygon:om});function um(e,n){var r="."+(n.extension||"json"),i=!n.final||Ga(e)&&e.arcs.getRetainedInterval()>0,a=JSON.stringify;return i&&(e=Ra(e)),n.prettify&&(a=gf("coordinates,arcs,bbox,translate,scale".split(","))),n.width>0||n.height>0?tg(e,n=t.defaults({invert_y:!0},n)):n.fit_bbox&&tg(e,{fit_bbox:n.fit_bbox}),n.precision&&Uf(e,n.precision),n.singles?Ba(e).map((function(e){return{content:a(im.exportTopology(e,n)),filename:(e.layers[0].name||"output")+r}})):[{filename:n.file||oo(e)+r,content:a(im.exportTopology(e,n))}]}im.getPresimplifyFunction=am,im.exportTopology=function(e,t){var n={type:"Topology",arcs:[]},r=Ga(e),i=$a(e);return t.bbox&&i.hasBounds()&&(n.bbox=i.toArray()),r&&t.presimplify&&!e.arcs.getVertexData().zz&&td.simplify(e,t),t.no_quantization||!t.quantization&&!r||(n.transform=im.transformDataset(e,i,t)),r&&(Na(e),n.arcs=im.exportArcs(e.arcs,i,t),n.transform&&im.deltaEncodeArcs(n.arcs)),n.objects=e.layers.reduce((function(n,r,i){return n[r.name||"layer"+(i+1)]=im.exportLayer(r,e.arcs,t),n}),{}),t.metadata&&(n.metadata=function(e){var t=Qi(e),n=null;return t&&(n=Ri(t)),{proj4:n}}(e)),n},im.transformDataset=function(e,t,n){var r=im.calcExportBounds(t,e.arcs,n),i=t.getTransform(r),a=i.invert();function o(e,t){var n=i.transform(e,t);return[Math.round(n[0]),Math.round(n[1])]}return e.arcs&&e.arcs.transformPoints(o),n.no_point_quantization||e.layers.filter(Qr).forEach((function(e){ei(e,o)})),{scale:[a.mx,a.my],translate:[a.bx,a.by]}},im.exportArcs=function(e,t,n){var r=null,i=[];return n.presimplify&&(r=am(t.width())),e.forEach2((function(e,t,n,a,o){for(var s,u=[],c=e+t;e<c;e++)s=[n[e],a[e]],r&&s.push(r(o[e])),u.push(s);i.push(u.length>1?u:null)})),i},im.deltaEncodeArcs=function(e){e.forEach((function(e){for(var t,n,r,i,a,o=0,s=e.length;o<s;o++)r=(a=e[o])[0],i=a[1],o>0&&(a[0]=r-t,a[1]=i-n),t=r,n=i}))},im.calcExportResolution=function(e,t){var n=Gn(e);return[n[0]*t,n[1]*t]},im.calcExportBounds=function(e,t,n){var r;return r=n.topojson_precision>0?im.calcExportResolution(t,n.topojson_precision):n.quantization>0?[e.width()/(n.quantization-1),e.height()/(n.quantization-1)]:n.precision>0?[n.precision,n.precision]:im.calcExportResolution(t,.02),new kt(0,0,Math.ceil(e.width()/r[0])||0,Math.ceil(e.height()/r[1])||0)},im.exportProperties=function(e,t,n){var r=Pp(t,n),i=Op(t,n);e.forEach((function(e,t){r&&(e.properties=r[t]),i&&(e.id=i[t])}))},im.exportLayer=function(e,t,n){for(var r,i=ti(e),a=[],o=im.exporters[e.geometry_type]||null,s=0;s<i;s++)r=o&&e.shapes[s],a[s]=r?o(r,t,n):{type:null};return e.data&&im.exportProperties(a,e.data,n),{type:"GeometryCollection",geometries:a}},im.exportPolygonGeom=function(e,t,n){var r={};return(e=rr(e,t))&&0!==e.length?e.length>1?(r.arcs=om(e,t,n.invert_y),1==r.arcs.length?(r.arcs=r.arcs[0],r.type="Polygon"):r.type="MultiPolygon"):(r.arcs=e,r.type="Polygon"):r.type=null,r},im.exportLineGeom=function(e,t){var n={};return(e=rr(e,t))&&0!==e.length?1==e.length?(n.type="LineString",n.arcs=e[0]):(n.type="MultiLineString",n.arcs=e):n.type=null,n},im.exporters={polygon:im.exportPolygonGeom,polyline:im.exportLineGeom,point:yp.exportPointGeom};var cm=Object.freeze({__proto__:null,exportTopoJSON:um});function fm(e){return Fr(e),{layers:[{data:new Jr(e)}],info:{}}}function lm(e,t){return e.layers.reduce((function(e,n){return n.data&&e.push({content:dm(n,t),filename:(n.name||"output")+".json"}),e}),[])}function dm(e,t){t=t||{};var n=e.data.getRecords();return t.ndjson?n.map(hf).join("\n"):t.prettify?gf([])(n):JSON.stringify(n)}var pm=Object.freeze({__proto__:null,importJSONTable:fm,exportJSON:lm,exportJSONTable:dm});function hm(e,t){var n=t.file||null,r=e.info&&e.info.input_formats&&e.info.input_formats[0],i=null;return t.format?t.format:(n?i=gm(n,r):r&&(i=r),"json"==i&&Va(e)&&(i="geojson"),i||null)}function gm(e,t){var n=to(e).toLowerCase(),r=null;return"gz"==n?gm(ro(e,""),t):(n==yc?r=yc:"shp"==n?r="shapefile":"dbf"==n?r="dbf":"svg"==n?r="svg":"kml"==n||"kmz"==n?r="kml":/json$/.test(n)?(r="geojson","topojson"==n||"topojson"==t&&"geojson"!=n?r="topojson":"json"==n&&"json"==t&&(r="json")):Fc(e)?r="dsv":t&&(r=t),r)}var mm=Object.freeze({__proto__:null,getOutputFormat:hm,inferOutputFormat:gm});async function ym(e,n){var r=e.map((function(e){return t.defaults({layers:e.layers},e.dataset)}));return async function(e,n){var r,i=hm(e[0],n);if(i==yc)return vc(e,n=t.defaults({compact:!0},n));"kml"==i||"svg"==i||"topojson"==i||"geojson"==i&&n.combine_layers?e.length>1&&(e=[Ia(e)],"topojson"==i&&_a(e[0]),n=t.defaults({final:!0},n)):function(e){var t=e.reduce((function(e,t){return e.concat(t.layers)}),[]);xm(t)}(e=e.map(qa));r=e.reduce((function(e,r){return oc()?t.sortOn(r.layers,"menu_order",!0):t.sortOn(r.layers,"target_id",!0),e.concat(vm(r,n))}),[]),_m(r),n.gzip&&r.forEach((function(e){e.filename+=".gz",e.content=cc(e.content)}));return r}(r,n)}function vm(e,n){var r,i,a=n.format=hm(e,n),o=bm[a],s=[];return a?o||dt("Unknown output format:",a):dt("Missing output format"),e=t.defaults({layers:e.layers.map((function(e){return t.extend({},e)}))},e),n.file&&"topojson"!=a&&"svg"!=a&&"kml"!=a&&e.layers.forEach((function(e){e.name=eo(n.file)})),xm(e.layers),n.precision&&"svg"!=a&&"geojson"!=a&&"topojson"!=a&&Uf(e=Ra(e),n.precision),n.cut_table&&(s=(r=e.layers,i=[],r.forEach((function(e){e.data&&i.push({content:JSON.stringify(e.data),filename:(e.name?e.name+"-":"")+"table.json"})})),i).concat(s)),n.extension&&(n.extension=n.extension.replace(/^\.+/,"")),function(e){e.forEach((function(e){e.geometry_type?(t.contains(["polygon","polyline","point"],e.geometry_type)||dt("A layer has an invalid geometry type:",e.geometry_type),e.shapes||dt("A layer is missing shape data")):e.shapes&&t.some(e.shapes,(function(e){return!!e}))&&dt("A layer contains shape records and a null geometry type")}))}(e.layers),s=o(e,n).concat(s),n.bbox_index&&s.push(function(e){var t=e.layers.map((function(t){return{bbox:bi(t,e.arcs).toArray(),name:t.name}}));return{content:JSON.stringify(t),filename:"bbox-index.json"}}(e)),function(e){var t={};e.forEach((function(e,n){var r=e.filename;r||dt("Missing a filename for file"+n),r in t&&dt("Duplicate filename",r),t[r]=!0}))}(s),s}var bm={geojson:vp,topojson:um,shapefile:nm,dsv:Xg,dbf:function(e,t){return e.layers.reduce((function(n,r){return r.data&&(n=n.concat(qg(r,e,t))),n}),[])},json:lm,svg:mg,kml:function(e,t){return[{content:(0,require("@placemarkio/tokml").toKML)(Sp(e,Object.assign({combine_layers:!0,geojson_type:"FeatureCollection"},t))),filename:t.file||oo(e)+".kml"}]}};function xm(e){var n=e.map((function(e){return e.name||"layer"})),r=t.uniqifyNames(n);e.forEach((function(e,t){e.name=r[t]}))}function _m(e){var n=e.map((function(e){return e.filename})),r=t.uniqifyNames(n,wm);e.forEach((function(e,t){e.filename=r[t]}))}function wm(e,n){var r,i,a=e.split(".");return a.length<2?t.formatVersionedName(e,n):(r=a.pop(),i=a.join("."),t.formatVersionedName(i,n)+"."+r)}var Sm=Object.freeze({__proto__:null,exportTargetLayers:ym,exportFileContent:vm,assignUniqueLayerNames:xm,assignUniqueFileNames:_m,formatVersionedFileName:wm});function Am(e,t){return Sr(e.readSync(0,Math.min(t||1e3,e.size())))}function Im(e){var t=0;this.position=function(){return t},this.remaining=function(){return Math.max(e.size()-t,0)},this.advance=function(e){t+=e},this.readSync=function(){return e.readSync(t)},this.expandBuffer=function(){e.expandBuffer()}}function Mm(e){var n,r,i=e.byteLength||e.length;function a(){return r||(r=t.toBuffer(e)),r}this.readToBinArray=function(t,r){return i<t+r&&dt("Out-of-range error"),n||(n=new Eg(e)),n.position(t),n},this.toString=function(e){return Sr(a(),e)},this.readSync=function(e,t){return a().slice(e,t?e+t:i)},this.findString=Em.prototype.findString,this.expandBuffer=function(){return this},this.size=function(){return i},this.close=function(){}}function Em(e,n){var r,a,o,s,u=pr("fs"),c=u.statSync(e).size,f=n&&n.cacheSize||16777216,l=n&&n.bufferSize||262144;function d(n,i){var s,l,d=c-n;return(d<i||d<0)&&dt("Tried to read past end-of-file"),!(o&&n>=a&&a+o.length>=n+i)&&(d<(l=Math.max(f,i))&&(l=d),o&&l==o.length||(o=t.createBuffer(l)),r||(r=u.openSync(e,"r")),s=u.readSync(r,o,0,l,n),a=n,s!=l&&dt("Error reading file"),!0)}(i("input_files")||[]).push(e),this.expandBuffer=function(){return 2*(l*=2)>f&&(f=2*l),this},this.readToBinArray=function(e,t){return d(e,t)&&(s=new Eg(o)),s.position(e-a),s},this.readSync=function(e,n){return n>0==!1&&(n=l),e+n>c&&(n=c-e),0===n?t.createBuffer(0):(d(e,n),o.slice(e-a,e-a+n))},this.size=function(){return c},this.toString=function(t){return Xc.readFile(e,t||"utf8")},this.close=function(){r&&(u.closeSync(r),r=null,o=null)}}Em.prototype.findString=function(e,t){var n,r=Math.min(this.size(),t||this.size()),i=this.readSync(0,r),a=e.length,o=i.length-a,s=e.charCodeAt(0);for(n=0;n<o;n++)if(i[n]==s&&i.toString("utf8",n,n+a)==e)return{offset:n+a,text:i.toString("utf8",0,n)};return null};var Pm=Object.freeze({__proto__:null,readFirstChars:Am,Reader2:Im,BufferReader:Mm,FileReader:Em});function jm(e,t,n){var r=n||{};if(" "==t)return function(e,t){return Gg(e.toString(t.encoding||"ascii"))}(e,r);var i,a,o=new Im(e),s=zm(Nm(o,function(e){var t=e.csv_skip_lines||0;e.csv_field_names||t++;return t}(r),r.encoding),t,r),u=Fm(s.import_fields),c=r.batch_size||1e3,f=[];if(0===s.import_fields.length)return[];for(;i=Nm(o,c,r.encoding);)if(a=Tm(i,t,u,s.column_filter||!1,s.row_filter||!1),f.push.apply(f,a),r.csv_lines&&f.length>=r.csv_lines)return f.slice(0,r.csv_lines);return f}function Om(e,t,n){if(" "==t)return Gg(e);var r=zm(e,t,n);if(0===r.import_fields.length||!r.remainder)return[];var i=Fm(r.import_fields),a=Tm(r.remainder,t,i,r.column_filter,r.row_filter);return n.csv_lines>0&&(a=a.slice(0,n.csv_lines)),a}function km(e,t){var n=/\r\n|[\r\n]|.$/g,r=1;if(1===t)return 0;if(t>1==!1)return-1;for(;n.exec(e);)if(++r<t==!1)return n.lastIndex;return-1}function Fm(e){return new Function("arr","return {"+e.map((function(e,t){return JSON.stringify(e)+": arr["+t+'] || ""'})).join(",")+"}")}function zm(e,n,r){var i,a,o,s,u={headers:[],import_fields:[]},c={};if(e=e||"",r.csv_skip_lines>0){if(-1===(i=km(e,r.csv_skip_lines+1)))return u;e=e.substr(i)}if(r.csv_field_names)c.headers=r.csv_field_names;else{if(-1===(i=km(e,2)))return u;c.headers=Tm(e.slice(0,i),n)[0],e=e.substr(i)}return r.csv_dedup_fields&&(c.headers=t.uniqifyNames(c.headers)),r.csv_filter&&(c.row_filter=(a=r.csv_filter,o=Wl(a,{returns:!0}),s=Xl(),function(e){var t;try{t=o.call(null,e,s)}catch(e){pt(e.name,"in expression ["+a+"]:",e.message)}return!0!==t&&!1!==t&&pt("Filter expression must return true or false"),t})),r.csv_fields?(c.column_filter=Cm(c.headers,r.csv_fields),c.import_fields=c.headers.filter((function(e,t){return c.column_filter(t)}))):c.import_fields=c.headers,c.remainder=e,c}function Cm(e,n){var r=t.arrayToIndex(n),i=e.map((function(e){return e in r})),a=t.difference(n,e);if(a.length>0){var o=[""].concat(e).join("\n  "),s=[""].concat(a).join("\n  ");pt("csv-fields option has",1==a.length?"a name":a.length+" names","not found in the file\nFields:",o,"\nMissing:",s)}return function(e){return i[e]}}function Nm(e,t,n){var r,i=e.readSync(),a=function(e,t){var n,r,i=13,a=10,o=34,s=!1,u=0,c=e.length;for(u++,n=0;n<c&&u<=t;n++)(r=e[n])==o?s=!s:r!=i&&r!=a||s||(r==i&&n+1<c&&e[n+1]==a&&n++,u++);return{bytesRead:n,buffer:e.slice(0,n)}}(i,t);return a.bytesRead==i.length&&a.bytesRead<e.remaining()?(e.expandBuffer(),Nm(e,t,n)):(r=a.bytesRead>0?Ir(a.buffer,n):"",0===e.position()&&(r=Er(r)),e.advance(a.bytesRead),r)}function Tm(e,t,n,r,i){var a,o,s,u,c,f=t.charCodeAt(0),l=!1,d=!1,p=-1,h=[];function g(){var e=n?n(c):c;i&&!i(e)||h.push(e),p=-1}function m(e){a=e,0===++p&&(c=[]),r&&!r(p)||(d=!0)}function y(t,n){var r;d&&(d=!1,r=t===n?"":34==e.charCodeAt(t)?e.slice(t+1,n-1).replace(/""/g,'"'):e.slice(t,n),c.push(r))}for(n||(n=function(e){return e}),m(0),o=0,u=e.length;o<u;o++)34==(s=e.charCodeAt(o))?l=!l:l||(s==f?(y(a,o),m(o+1)):13!=s&&10!=s||(y(a,o),g(),13==s&&10==e.charCodeAt(o+1)&&o++,o+1<u&&m(o+1)));return p>-1&&(d&&y(a,o),g()),h}var Lm=Object.freeze({__proto__:null,readDelimRecords:jm,readDelimRecordsFromString:Om,indexOfLine:km,getRowConverter:Fm,parseDelimHeaderSection:zm,getDelimFieldFilter:Cm,readLinesAsString:Nm,parseDelimText:Tm});function Bm(e){var t=function(e){var t=Dm("utf8",e),n=1-(t.match(/\ufffd/g)||[]).length/t.length;return(1==n?2:n>.97&&1)||0}(e),n=function(e){var t="abcdefghijklmnopqrstuvwxyz0123456789.()'\"?+-\n,:;/|_$% ",n="ÃŸÃ Ã¡Ã¢Ã£Ã¤Ã¥Ã¦Ã§Ã¨Ã©ÃªÃ«Ã¬Ã­Ã®Ã¯Ã°Ã±Ã²Ã³Ã´ÃµÃ¶Ã¸Ã¹ÃºÃ»Ã¼Ã½Ã¿Â°â€“Â±â€™â€˜Â ",r=Dm("win1252",e),i=Um(r,t),a=Um(r,n+t);return(a>.98&&i>=.8?2:a>.97&&i>=.6&&1)||0}(e);return{encoding:2==t||t>n?"utf8":n>0?"win1252":"latin1",confidence:Math.max(t,n)}}function Dm(e,t){return t.map((function(t){return Ir(t,e).trim()})).join("\n")}function Um(e,t){var n={},r=0;e=e.toLowerCase();for(var i=0,a=t.length;i<a;i++)n[t[i]]=1;for(i=0,a=e.length;i<a;i++)r+=n[e[i]]||0;return r/e.length}function Rm(e,n){var r,i,a,o,u,c,f,l=!e.content&&""!==e.content,d=e.content;return n=n||{},l?r=new Em(e.filename):d instanceof ArrayBuffer||d instanceof s||d instanceof Uint8Array?(r=new Mm(d),d=null):t.isString(d)||dt("Unexpected object type"),r&&(c=r.readSync(0,Math.min(r.size(),3)),"utf16be"==(u=(f=c.length)>=2&&254==c[0]&&255==c[1]?"utf16be":f>=2&&255==c[0]&&254==c[1]?"utf16le":f>=3&&239==c[0]&&187==c[1]&&191==c[2]?"utf8":"")||"utf16le"==u?(d=Er(r.toString(u)),r=null):n.encoding&&!_r(n.encoding)&&(d=r.toString(n.encoding),r=null)),0===(i=r?jm(r,a=Vm(Am(r,2e3)),n):Om(d,a=Vm(d),n)).length&&gt("Unable to read any data records"),Jm(i,n),Nr(o=new Jr(i),Tr),{layers:[{data:o}],info:{input_delimiter:a}}}var qm=["|","\t",",",";"," "];function $m(e){return t.contains(qm,e)}function Vm(e){return t.find(qm,(function(n){var r=function(e){var n="^[^\\n\\r]+"+t.regexEscape(e);return new RegExp(n)}(n);return r.test(e)}))||","}function Gm(e){var t={};return(e=e||{}).string_fields&&e.string_fields.forEach((function(e){t[e]="string"})),e.field_types&&e.field_types.forEach((function(e){var n,r,i;-1!=e.indexOf(":")?(r=(n=e.split(":"))[0],i=function(e){var t=e.toLowerCase(),n=null;"n"==t[0]?n="number":"s"==t[0]&&(n="string");return n}(n[1])):"+"===e[0]&&(r=e.substr(1),i="number"),i?t[r]=i:gt("Invalid type hint (expected :str or :num) ["+e+"]")})),t}function Jm(e,n){var r=n||{},i=Gm(r),a=i["*"],o=Object.keys(e[0]||[]),s=[],u=r.decimal_comma?t.parseIntlNumber:t.parseNumber,c={};o.forEach((function(t){var n=i[t],r=null;"number"==n||"number"==a?r=function(e,t,n){for(var r=[],i=0,a=t.length;i<a;i++)r.push(n(t[i][e]));return r}(t,e,u):"string"==n||"string"==a?r=null:(r=function(e,t,n){for(var r,i,a,o=[],s=0,u=0,c=t.length;u<c;u++){if(null===(a=n(r=t[u][e]))){if((i=r?r.trim():"").length>0&&"NA"!=i&&"NaN"!=i)return null}else s++;o.push(a)}return s>0?o:null}(t,e,u),r&&s.push(t)),r&&(c[t]=r)})),Object.keys(c).length>0&&function(e,t,n){var r="return {"+e.map((function(e){var t=JSON.stringify(e);return t+": "+(n[e]?"replacements["+t+"][i]":"rec["+t+"]")})).join(", ")+"}",i=new Function("rec","replacements","i",r);t.forEach((function(e,r){t[r]=i(e,n,r)}))}(o,e,c),s.length>0&&gt(t.format("Auto-detected number field%s: %s",1==s.length?"":"s",s.join(", ")))}var Wm=Object.freeze({__proto__:null,importDelim:function(e,t){return Rm({content:e},t)},importDelim2:Rm,isSupportedDelimiter:$m,guessDelimiter:Vm,getFieldTypeHints:Gm,adjustRecordTypes:Jm});function Ym(e){var t=e.options,n=e._;n.length>0&&!t.files&&(t.files=n),t.files&&(t.files=Xc.expandInputFiles(t.files),"-"!=t.files[0]&&"/dev/stdin"!=t.files[0]||(delete t.files,t.stdin=!0)),"precision"in t&&t.precision>0==!1&&dt("precision= option should be a positive number"),t.encoding&&(t.encoding=vr(t.encoding))}function Hm(e){var n=e.options,r=e._[0];r&&(/^[0-9.]+%?$/.test(r)?n.percentage=t.parsePercent(r):dt("Unparsable option:",r)),n.interval||n.percentage||n.resolution||dt("Command requires an interval, percentage or resolution parameter")}function Xm(e){var t=e._;t.length>0&&!e.options.crs&&(e.options.crs=t.join(" "),t=[]),t.length>0&&dt("Received one or more unexpected parameters: "+t.join(", ")),e.options.crs||e.options.match||e.options.init||pt("Missing projection data")}function Zm(e){var t=e.options;if(1==e._.length){var n=e._[0].split(",");t.cols=parseInt(n[0],10),t.rows=parseInt(n[1],10)||t.cols}}function Qm(e){e.options.expression||dt("Command requires a JavaScript expression")}function Km(e){var t=e._,n=e.options,r=t[0]||"",i=Ka(r);t.length>1&&dt("Command takes one file or directory argument"),"-"==r||"/dev/stdout"==r?n.stdout=!0:r&&!i.extension?(Xc.isDirectory(r)||dt("Unknown output option:",r),n.directory=r):r&&(i.directory&&(n.directory=i.directory),/gz/i.test(i.extension)?(Ka(i.basename).extension?n.file=i.basename:n.file=i.filename,n.gzip=!0):/zip/i.test(i.extension)?(n.file=null,n.zipfile=i.filename,n.zip=!0):n.file=i.filename,Rc(n.file)&&dt("Output file looks like an unsupported file type:",n.file)),n.format&&(n.format=n.format.toLowerCase(),"csv"==n.format?(n.format="dsv",n.delimiter=n.delimiter||","):"tsv"==n.format&&(n.format="dsv",n.delimiter=n.delimiter||"\t"),Bc(n.format)||dt("Unsupported output format:",n.format)),n.delimiter&&(n.delimiter=n.delimiter.replace(/^["']?\\t["']?$/,"\t"),$m(n.delimiter)||dt("Unsupported delimiter:",n.delimiter)),n.encoding&&(n.encoding=vr(n.encoding)),n.field_order&&"ascending"!=n.field_order&&dt("Unsupported field order:",n.field_order),"quantization"in n&&n.quantization>0==!1&&dt("quantization= option should be a nonnegative integer"),"topojson_precision"in n&&n.topojson_precision>0==!1&&dt("topojson-precision= option should be a positive number")}var ey=/^([a-z0-9_+-]+)=(?!=)(.*)$/i;function ty(e){var n=new RegExp("(([^'\"\\s])+|'((\\\\'|[^'])*?)'|\"((\\\\\"|[^\"])*?)\")*","g");return(e.match(n)||[]).filter((function(e){return!!e&&"\\"!=e})).map(t.trimQuotes)}function ny(e){return e.split(",").map(parseFloat)}function ry(e){var t=oy(e,",");return 1==t.length&&(t=oy(t[0],",")),t}function iy(e){var t=oy(e.replace(/[ ,] *(?=[^(]*\))/g,"~~~"),", ");return 1==t.length&&(t=oy(t[0],", ")),t=t.map((function(e){return e.replace(/~~~/g,",")}))}function ay(e){return e=(e=e.map((function(e){return/= $/.test(e)||(e=t.rtrim(e)),e=t.ltrim(e)}))).filter((function(e){return""!==e}))}function oy(e,n){for(var r,i=new RegExp("^("+("([^"+n+"'\"][^"+n+"]*)")+"|'((\\\\'|[^'])*?)'|\"((\\\\\"|[^\"])*?)\")(["+n+"]+|$)"),a=[];null!==(r=i.exec(e));)a.push(r[1]),e=e.substr(r[0].length);return a.filter((function(e){return!!e&&"\\"!=e})).map(t.trimQuotes)}function sy(e){return ey.test(e)}function uy(e){var n=ey.exec(e);return[n[1],t.trimQuotes(n[2])]}var cy=Object.freeze({__proto__:null,splitShellTokens:ty,parseNumberList:ny,parseStringList:ry,parseColorList:iy,cleanArgv:ay,formatOptionValue:function(e){return(e=String(e)).indexOf(" ")>-1&&(e=JSON.stringify(e)),e},isAssignment:sy,splitAssignment:uy});function fy(){var e,n=/^--?([a-z][\w-]*)$/i,r=/^--?[a-z][\w-]*[=]/i,i="",a=[],o=[],s=null;if(this instanceof fy==!1)return new fy;function u(){return o.map((function(e){return e.done()}))}function c(e){return!!f(e,u())}function f(e,n){return t.find(n,(function(t){return t.name===e||t.alias===e||t.old_alias===e}))}function l(e,n){return t.find(n.options,(function(t){return t.name===e||t.alias===e||t.old_alias===e}))}this.usage=function(e){return i=e,this},this.note=function(t){return e=t,this},this.default=function(e){s=e},this.example=function(e){a.push(e)},this.command=function(e){var t=new ly(e);return t.option("verbose",{type:"flag"}),t.option("debug",{type:"flag"}),o.push(t),t},this.section=function(e){return this.command("").title(e)},this.isCommandName=c,this.parseArgv=function(e){var t,i,a,o=u(),d=[],p=ay(e);for(1==p.length&&c(p[0])?p.unshift("-help"):p.length>0&&!h(p[0])&&s&&p.unshift("-"+s);p.length>0;){for((i=v(p))||pt("Invalid command:",p[0]),(a=f(i,o))||(a={name:i,options:[],multi_arg:!0}),t={name:a.name,options:{},_:[]};p.length>0&&!h(p[0]);)g(t,p,a);try{t._.length>0&&a.no_arg&&dt("Received one or more unexpected parameters:",t._.join(" ")),t._.length>1&&!a.multi_arg&&dt("Command expects a single value. Received:",t._.join(" ")),a.default&&1==t._.length&&y(t,a),a.validate&&a.validate(t)}catch(e){pt("["+i+"] "+e.message)}d.push(t)}return d;function h(e){return r.test(e)&&pt("Invalid command syntax:",e),n.test(e)}function g(e,t,n){var r,i,a,o=t.shift();sy(o)?(i=l((a=uy(o))[0],n))&&("flag"==i.type||i.assign_to?pt("-"+n.name+" "+a[0]+" option doesn't take a value"):t.unshift(a[1])):i=l(o,n),i?(i.alias_to&&(i=l(i.alias_to,n)),r=(r=i.name).replace(/-/g,"_"),i.assign_to?e.options[i.assign_to]=i.name:"flag"==i.type?e.options[r]=!0:e.options[r]=m(t,i)):e._.push(o)}function m(e,t){return(0===e.length||h(e[0]))&&pt("Missing value for "+t.name+" option"),function(e,t){var n,r,i=t.type;n="number"==i?Number(e):"integer"==i?Math.round(Number(e)):"colors"==i?iy(e):"strings"==i?ry(e):"bbox"==i||"numbers"==i?ny(e):e;n!=n&&(r="Invalid numeric value");r&&pt(r+" for "+t.name+" option");return n}(e.shift(),t)}function y(e,t){var n=l(t.default,t);e.options[t.default]=m(e._,n)}function v(e){var t=n.exec(e[0]);return t?(e.shift(),t[1]):null}},this.getHelpMessage=function(n){var r,o,s;return n?((o=f(n,u()))||pt(n,"is not a known command"),s=function(e){var t=[];t.push("COMMAND",c(e)),e.options.length>0&&(t.push("","OPTIONS"),e.options.forEach((function(n){t=t.concat(function(e,t){var n,r=[],i=e.describe;i&&(e.label?r.push([e.label,i]):e.name==t.default?(n=e.name+"=",r.push(["<"+e.name+">","shortcut for "+n]),r.push([n,i])):(n=e.name,e.alias&&(n+=", "+e.alias),"flag"==e.type||e.assign_to||(n+="="),r.push([n,i])));return r}(n,e))})));e.examples&&(t.push("","EXAMPLE"+(e.examples.length>1?"S":"")),e.examples.forEach((function(e,n){n>0&&t.push(""),e.split("\n").forEach((function(e,n){t.push("  "+e)}))})));return t}(o)):(r=u().filter((function(e){return e.name&&e.describe||e.title})),s=function(t){var n=[];i&&n.push(i);t.forEach((function(e){e.title?n.push("",e.title):n.push(c(e))})),a.length>0&&(n.push("","Examples"),a.forEach((function(e){n.push("",e)})));e&&n.push("",e);return n}(r)),function(e){var n=function(e){var t=0;return e.forEach((function(e){Array.isArray(e)&&(t=Math.max(t,e[0].length))})),t}(e),r=oc()?"":"  ",i=e.map((function(e){return Array.isArray(e)&&(e=r+t.rpad(e[0],n," ")+"  "+e[1]),e})).join("\n");return i}(s);function c(e){var t=e.name?"-"+e.name:"";return e.alias&&(t+=", -"+e.alias),[t,e.describe||"(undocumented command)"]}}}function ly(e){var n={name:e,options:[]};this.validate=function(e){return n.validate=e,this},this.describe=function(e){return n.describe=e,this},this.example=function(e){return n.examples||(n.examples=[]),n.examples.push(e),this},this.alias=function(e){return n.alias=e,this},this.oldAlias=function(e){return n.old_alias=e,this},this.title=function(e){return n.title=e,this},this.flag=function(e){return n[e]=!0,this},this.option=function(e,r){return r=t.extend({},r),t.isString(e)&&e||dt("Missing option name"),t.isObject(r)||dt("Invalid option definition:",r),r.DEFAULT&&(n.default=e),r.name=e,n.options.push(r),this},this.options=function(e){return Object.keys(e).forEach((function(t){this.option(t,e[t])}),this),this},this.done=function(){return n}}function dy(){var e={describe:"layer(s) to target (comma-sep. list)"},t={describe:"rename the edited layer(s)"},n={alias:"+",type:"flag",label:"+, no-replace",describe:"retain both input and output layer(s)"},r={type:"flag"},i={describe:"text encoding (applies to .dbf and delimited text files)"},a={describe:"snapping distance in source units (default is tiny)",type:"distance"},o={describe:"boost gap-fill-area of slivers (0-1, default is 1)",type:"number"},s={describe:"use a JS expression to aggregate data values"},u={describe:"fields to sum when dissolving  (comma-sep. list)",type:"strings"},c={describe:"fields to copy when dissolving (comma-sep. list)",type:"strings"},f={DEFAULT:!0,type:"strings",describe:"(optional) field(s) to dissolve on (comma-sep. list)"},l={describe:"type hints for csv source files, e.g. FIPS:str,ZIPCODE:str",type:"strings"},d={describe:"csv field(s) to import as strings, e.g. FIPS,ZIPCODE",type:"strings"},p={type:"bbox",describe:"comma-sep. bounding box: xmin,ymin,xmax,ymax"},h={type:"flag",describe:"retain only features that would have been deleted"},g={describe:"use a JS expression to select a subset of features"},m={describe:"filter polygon boundaries using a JS expression (with A and B)"},y={describe:"aspect ratio as a number or range (e.g. 2 0.8,1.6 ,2)"},v={describe:"padding as distance or pct of h/w (single value or list)",type:"distance"},b=new fy;b.usage("Usage:  mapshaper -<command> [options] ..."),b.note("Enter mapshaper -help <command> to view options for a single command"),b.section("I/O commands"),b.default("i"),b.command("i").describe("input one or more files").validate(Ym).flag("multi_arg").option("files",{DEFAULT:!0,type:"strings",describe:"one or more files to import, or - to use stdin"}).option("combine-files",{describe:"import files to separate layers with shared topology",type:"flag"}).option("merge-files",{type:"flag"}).option("no-topology",{describe:"treat each shape as topologically independent",type:"flag"}).option("precision",{describe:"coordinate precision in source units, e.g. 0.001",type:"number"}).option("snap",{type:"flag",describe:"snap nearly identical points to fix minor topology errors"}).option("auto-snap",{alias_to:"snap"}).option("snap-interval",a).option("encoding",i).option("id-field",{describe:"import Topo/GeoJSON id property to this field"}).option("string-fields",d).option("field-types",l).option("name",{describe:"Rename the imported layer(s)"}).option("geometry-type",{}).option("json-path",{}).option("csv-skip-lines",{type:"integer",describe:"[CSV] number of lines to skip at the beginning of the file"}).option("csv-lines",{type:"integer",describe:"[CSV] number of data records to read"}).option("csv-field-names",{type:"strings",describe:"[CSV] comma-sep. list of field names to assign each column"}).option("csv-dedup-fields",{type:"flag",describe:"[CSV] rename fields with duplicate names"}).option("csv-filter",{describe:"[CSV] JS expression for filtering records"}).option("csv-fields",{type:"strings",describe:"[CSV] comma-sep. list of fields to import"}).option("decimal-comma",{type:"flag",describe:"[CSV] import numbers formatted like 1.000,01 or 1 000,01"}).option("json-path",{old_alias:"json-subtree",describe:"[JSON] path to JSON input data; separator is /"}).option("single-part",{type:"flag"}),b.command("o").describe("output edited content").validate(Km).option("_",{label:"<file|directory>",describe:"(optional) name of output file or directory, - for stdout"}).option("format",{describe:"options: shapefile,geojson,topojson,json,dbf,csv,tsv,svg"}).option("target",e).option("force",{describe:"allow overwriting input files",type:"flag"}).option("gzip",{describe:"apply gzip compression to output files",type:"flag"}).option("zip",{describe:"save all output files in a single .zip file",type:"flag"}).option("dry-run",{type:"flag"}).option("ldid",{type:"number"}).option("precision",{describe:"coordinate precision in source units, e.g. 0.001",type:"number"}).option("bbox-index",{describe:"export a .json file with bbox of each layer",type:"flag"}).option("cut-table",{describe:"detach data attributes from shapes and save as a JSON file",type:"flag"}).option("drop-table",{describe:"remove data attributes from output",type:"flag"}).option("encoding",{describe:"[Shapefile/CSV] text encoding (default is utf8)"}).option("field-order",{describe:"[Shapefile/CSV] field-order=ascending sorts columns A-Z"}).option("id-field",{describe:"[Topo/GeoJSON/SVG] field to use for id property",type:"strings"}).option("bbox",{type:"flag",describe:"[Topo/GeoJSON] add bbox property"}).option("extension",{describe:'[Topo/GeoJSON] set file extension (default is ".json")'}).option("prettify",{type:"flag",describe:"[Topo/GeoJSON/JSON] format output for readability"}).option("singles",{describe:"[TopoJSON] save each target layer as a separate file",type:"flag"}).option("quantization",{describe:"[TopoJSON] specify quantization (auto-set by default)",type:"integer"}).option("no-quantization",{describe:"[TopoJSON] export coordinates without quantization",type:"flag"}).option("metadata",{type:"flag"}).option("no-point-quantization",{type:"flag"}).option("presimplify",{describe:"[TopoJSON] add per-vertex data for dynamic simplification",type:"flag"}).option("topojson-precision",{type:"number"}).option("rfc7946",{type:"flag"}).option("gj2008",{describe:"[GeoJSON] use original GeoJSON spec (not RFC 7946)",type:"flag"}).option("combine-layers",{describe:"[GeoJSON] output layers as a single file",type:"flag"}).option("geojson-type",{describe:"[GeoJSON] FeatureCollection, GeometryCollection or Feature"}).option("ndjson",{describe:"[GeoJSON/JSON] output newline-delimited features or records",type:"flag"}).option("width",{describe:"[SVG/TopoJSON] pixel width of output (SVG default is 800)",type:"number"}).option("height",{describe:"[SVG/TopoJSON] pixel height of output (optional)",type:"number"}).option("max-height",{describe:"[SVG/TopoJSON] max pixel height of output (optional)",type:"number"}).option("margin",{describe:"[SVG/TopoJSON] space betw. data and viewport (default is 1)"}).option("pixels",{describe:"[SVG/TopoJSON] output area in pix. (alternative to width=)",type:"number"}).option("fit-bbox",{type:"bbox",describe:"[TopoJSON] scale and shift coordinates to fit a bbox"}).option("svg-scale",{describe:"[SVG] source units per pixel (alternative to width= option)",type:"number"}).option("svg-bbox",{describe:"[SVG] bounding box of SVG map in projected map units",type:"bbox"}).option("point-symbol",{describe:"[SVG] circle or square (default is circle)"}).option("svg-data",{type:"strings",describe:"[SVG] fields to export as data-* attributes"}).option("id-prefix",{describe:"[SVG] prefix for namespacing layer and feature ids"}).option("scalebar",{type:"flag"}).option("delimiter",{describe:"[CSV] field delimiter"}).option("decimal-comma",{type:"flag",describe:"[CSV] export numbers with decimal commas not points"}).option("final",{type:"flag"}).option("metadata",{type:"flag"}),b.section("Editing commands"),b.command("affine").describe("transform coordinates by shifting, scaling and rotating").flag("no_args").option("shift",{type:"strings",describe:"x,y offsets in source units (e.g. 5000,-5000)"}).option("scale",{type:"number",describe:"scale (default is 1)"}).option("rotate",{type:"number",describe:"angle of rotation in degrees (default is 0)"}).option("anchor",{type:"numbers",describe:"center of rotation/scaling (default is center of selected shapes)"}).option("where",g).option("target",e),b.command("buffer").option("radius",{describe:"radius of buffer, as an expression or a constant",DEFAULT:!0}).option("tolerance",{}).option("vertices",{type:"integer"}).option("backtrack",{type:"integer"}).option("type",{}).option("planar",{type:"flag"}).option("v2",{type:"flag"}).option("debug-division",{type:"flag"}).option("debug-mosaic",{type:"flag"}).option("no-cleanup",{type:"flag"}).option("units",{describe:"distance units (meters|miles|km|feet) (default is meters)"}).option("name",t).option("target",e).option("no-replace",n),b.command("classify").describe("assign colors or values using one of several methods").option("field",{describe:"name of field to classify",DEFAULT:!0}).option("save-as",{describe:"name of output field (default is fill|stroke|class)"}).option("colors",{describe:"list of CSS colors or color scheme name (see -colors)",type:"colors"}).option("values",{describe:"values to assign to classes (alternative to colors=)",type:"strings"}).option("color-scheme",{}).option("non-adjacent",{describe:"assign non-adjacent colors to a polygon layer",assign_to:"method"}).option("stops",{describe:"a pair of values (0-100) for limiting a color ramp",type:"numbers"}).option("range",{type:"numbers"}).option("null-value",{describe:"value (or color) to use for invalid or missing data"}).option("method",{describe:"quantile, nice, equal-interval, categorical, etc."}).option("quantile",{assign_to:"method"}).option("equal-interval",{assign_to:"method"}).option("hybrid",{assign_to:"method"}).option("nice",{assign_to:"method"}).option("breaks",{describe:"user-defined sequential class breaks",type:"numbers"}).option("classes",{describe:"number of classes (can be inferred from other options)",type:"integer"}).option("invert",{describe:"reverse the order of colors/values",type:"flag"}).option("continuous",{describe:"output continuous interpolated values (experimental)",type:"flag"}).option("index-field",{describe:"apply pre-calculated classes (0 ... n-1, -1)"}).option("precision",{describe:"round data values before classification (e.g. 0.1)",type:"number"}).option("categories",{describe:"list of data values for categorical color scheme",type:"strings"}).option("other",{describe:"default value for categorical scheme"}).option("key",{type:"flag"}).option("key-style",{describe:"one of: simple, gradient, dataviz"}).option("key-name",{describe:"name of output SVG file"}).option("key-width",{describe:"width of key in pixels",type:"number"}).option("key-font-size",{describe:"label size in pixels",type:"number"}).option("key-tile-height",{describe:"height of color tiles in pixels",type:"number"}).option("key-tic-length",{describe:"length of tic mark in pixels"}).option("key-label-suffix",{describe:"string to append to each label"}).option("key-last-suffix",{describe:"string to append to last label"}).option("target",e),b.command("clean").describe("fixes geometry issues, such as polygon overlaps and gaps").option("gap-fill-area",{old_alias:"min-gap-area",describe:"threshold for filling gaps, e.g. 1.5km2 (default is small)",type:"area"}).option("sliver-control",o).option("snap-interval",a).option("no-snap",r).option("allow-overlaps",{describe:"allow polygons to overlap (disables gap fill)",type:"flag"}).option("overlap-rule",{describe:"how to resolve overlaps: min-id|max-id|min-area|[max-area]"}).option("allow-empty",{describe:"keep null geometries (removed by default)",type:"flag"}).option("rewind",{describe:"fix errors in the CW/CCW winding order of polygon rings",type:"flag"}).option("arcs",{alias_to:"only-arcs"}).option("only-arcs",{describe:"delete unused arcs but don't remove gaps and overlaps",type:"flag"}).option("no-arc-dissolve",{type:"flag"}).option("target",e),b.command("clip").describe("use a polygon layer to clip another layer").example("$ mapshaper states.shp -clip land_area.shp -o clipped.shp").option("source",{DEFAULT:!0,describe:"file or layer containing clip polygons"}).option("remove-slivers",{describe:"remove sliver polygons created by clipping",type:"flag"}).option("bbox",p).option("bbox2",{type:"bbox",describe:"experimental fast bbox clipping"}).option("name",t).option("no-snap",r).option("target",e).option("no-replace",n),b.command("colorizer").describe("define a function to convert data values to color classes").flag("no_arg").option("colors",{describe:"comma-separated list of CSS colors",type:"colors"}).option("breaks",{describe:"ascending-order list of breaks for sequential color scheme",type:"numbers"}).option("categories",{describe:"comma-sep. list of keys for categorical color scheme",type:"strings"}).option("random",{describe:"randomly assign colors",type:"flag"}).option("other",{describe:"default color for categorical scheme (default is nodata color)"}).option("nodata",{describe:"color to use for invalid or missing data (default is white)"}).option("name",{describe:"function name to use in -each and -svg-style commands"}).option("precision",{describe:"rounding precision to apply before classification (e.g. 0.1)",type:"number"}).example("Define a sequential color scheme and use it to create a new field\n$ mapshaper data.json -colorizer name=getColor nodata=#eee breaks=20,40 \\\n  colors=#e0f3db,#a8ddb5,#43a2ca -each 'fill = getColor(RATING)' -o output.json"),b.command("dashlines").describe("split lines into sections, with or without a gap").oldAlias("split-lines").option("dash-length",{type:"distance",describe:"length of split-apart lines (e.g. 200km)"}).option("gap-length",{type:"distance",describe:"length of gaps between dashes (default is 0)"}).option("scaled",{type:"flag",describe:"scale dashes and gaps to prevent partial dashes"}).option("planar",{type:"flag",describe:"use planar geometry"}).option("where",g).option("target",e),b.command("define").option("expression",{DEFAULT:!0,describe:"one or more assignment expressions (comma-sep.)"}),b.command("dissolve").describe("merge features within a layer").example("Dissolve all polygons in a feature layer into a single polygon\n$ mapshaper states.shp -dissolve -o country.shp").example("Generate state-level polygons by dissolving a layer of counties\n(STATE_FIPS, POPULATION and STATE_NAME are attribute field names)\n$ mapshaper counties.shp -dissolve STATE_FIPS copy-fields=STATE_NAME sum-fields=POPULATION -o states.shp").option("field",{}).option("fields",f).option("calc",s).option("sum-fields",u).option("copy-fields",c).option("multipart",{type:"flag",describe:"make multipart features instead of dissolving"}).option("where",g).option("group-points",{type:"flag",describe:"[points] group points instead of converting to centroids"}).option("weight",{describe:"[points] field or expression to use for weighting centroid"}).option("planar",{type:"flag",describe:"[points] use 2D math to find centroids of latlong points"}).option("name",t).option("target",e).option("no-replace",n),b.command("dissolve2").describe("merge adjacent polygons (repairs overlaps and gaps)").option("field",{}).option("fields",f).option("calc",s).option("sum-fields",u).option("copy-fields",c).option("gap-fill-area",{describe:"threshold for filling gaps, e.g. 1.5km2",type:"area"}).option("sliver-control",o).option("allow-overlaps",{describe:"allow dissolved polygons to overlap (disables gap fill)",type:"flag"}).option("name",t).option("no-snap",r).option("target",e).option("no-replace",n),b.command("divide").describe("divide lines by polygons, copy polygon data to lines").option("fields",{describe:"fields to copy (comma-sep.) (default is all but key field)",type:"strings"}).option("calc",{describe:"use a JS expression to assign values (for many-to-one joins)"}).option("force",{describe:"replace values from same-named fields",type:"flag"}).option("source",{DEFAULT:!0,describe:"file or layer containing polygons"}).option("target",e),b.command("dots").describe("fill polygons with dots of one or more colors").option("fields",{DEFAULT:!0,describe:"one or more fields containing numbers of dots",type:"strings"}).option("colors",{describe:"one or more colors",type:"strings"}).option("values",{describe:"values to assign to dot classes (alternative to colors=)",type:"strings"}).option("save-as",{describe:"name of color/value output field (default is fill)"}).option("progressive",{type:"flag"}).option("r",{describe:"radius of each dot in pixels",type:"number"}).option("evenness",{describe:"(0-1) dot spacing, from random to even (default is 1)",type:"number"}).option("per-dot",{describe:"number for scaling data values (e.g. 10 per dot)",type:"number"}).option("copy-fields",{describe:"list of fields to copy from polygons to dots",type:"strings"}).option("multipart",{describe:"combine groups of same-color dots into multi-part features",type:"flag"}).option("target",e).option("name",t).option("no-replace",n),b.command("drop").describe("delete layer(s) or elements within the target layer(s)").flag("no_arg").option("geometry",{describe:"delete all geometry from the target layer(s)",type:"flag"}).option("holes",{describe:"delete holes from polygons",type:"flag"}).option("fields",{type:"strings",describe:"delete a list of attribute data fields, e.g. 'id,name' '*'"}).option("target",e),b.command("each").describe("create/update/delete data fields using a JS expression").example("Add two calculated data fields to a layer of U.S. counties\n$ mapshaper counties.shp -each 'STATE_FIPS=CNTY_FIPS.substr(0, 2), AREA=$.area'").option("expression",{DEFAULT:!0,describe:"JS expression to apply to each target feature"}).option("where",g).option("target",e),b.command("erase").describe("use a polygon layer to erase another layer").example("$ mapshaper land_areas.shp -erase water_bodies.shp -o erased.shp").option("source",{DEFAULT:!0,describe:"file or layer containing erase polygons"}).option("remove-slivers",{describe:"remove sliver polygons created by erasing",type:"flag"}).option("bbox",p).option("name",t).option("no-snap",r).option("target",e).option("no-replace",n),b.command("explode").describe("divide multi-part features into single-part features").option("naive",{type:"flag"}).option("target",e),b.command("filter").describe("delete features using a JS expression").option("expression",{DEFAULT:!0,describe:"delete features that evaluate to false"}).option("bbox",{describe:"delete features outside bbox (xmin,ymin,xmax,ymax)",type:"bbox"}).option("invert",h).option("remove-empty",{type:"flag",describe:"delete features with null geometry"}).option("keep-shapes",{type:"flag"}).option("ids",{type:"numbers"}).option("cleanup",{type:"flag"}).option("name",t).option("target",e).option("no-replace",n),b.command("filter-fields").describe("retain a subset of data fields").option("fields",{DEFAULT:!0,type:"strings",describe:"fields to retain (comma-sep.), e.g. 'fips,name'"}).option("invert",{type:"flag",describe:"retain only fields that would have been deleted"}).option("target",e),b.command("filter-geom").describe("").option("bbox",{type:"bbox",describe:"remove non-intersecting geometry (xmin,ymin,xmax,ymax)"}).option("target",e),b.command("filter-islands2").option("min-area",{type:"area",describe:"remove small-area islands (e.g. 10km2)"}).option("min-vertices",{type:"integer",describe:"remove low-vertex-count islands"}).option("keep-shapes",{type:"flag",describe:"only filter smaller parts of multipart polygons"}).option("remove-empty",{type:"flag",describe:"delete features with null geometry"}).option("target",e),b.command("filter-islands").describe("remove small detached polygon rings (islands)").option("min-area",{type:"area",describe:"remove small-area islands (e.g. 10km2)"}).option("min-vertices",{type:"integer",describe:"remove low-vertex-count islands"}).option("remove-empty",{type:"flag",describe:"delete features with null geometry"}).option("target",e),b.command("filter-slivers").describe("remove small polygon rings").option("min-area",{type:"area",describe:"area threshold (e.g. 2sqkm)"}).option("sliver-control",{describe:"boost area threshold of slivers (0-1, default is 1)",type:"number"}).option("weighted",{type:"flag"}).option("target",e),b.command("graticule").describe("create a graticule layer").option("interval",{describe:"size of grid cells in degrees (options: 5 10 15 30 45, default is 10)",type:"number"}).option("polygon",{describe:"create a polygon to match the outline of the graticule",type:"flag"}).option("name",t),b.command("grid").describe("create a grid of square or hexagonal polygons").option("type",{describe:"square, hex or hex2 (default is square)"}).option("interval",{describe:"side length (e.g. 500m, 12km)",type:"distance"}).option("name",t).option("target",e).option("no-replace",n),b.command("include").describe("import JS data and functions for use in JS expressions").option("file",{DEFAULT:!0,describe:"file containing a JS object with key:value pairs to import"}),b.command("inlay").describe("inscribe a polygon layer inside another polygon layer").option("source",{DEFAULT:!0,describe:"file or layer containing polygons to inlay"}).option("target",e),b.command("innerlines").describe("convert polygons to polylines along shared edges").flag("no_arg").option("where",m).option("name",t).option("target",e).option("no-replace",n),b.command("join").describe("join data records from a file or layer to a layer").example("Join a csv table to a Shapefile (don't auto-convert FIPS column to numbers)\n$ mapshaper states.shp -join data.csv keys=STATE_FIPS,FIPS string-fields=FIPS -o joined.shp").validate((function(e){e.options.source||dt("Command requires the name of a layer or file to join")})).option("source",{DEFAULT:!0,describe:"file or layer containing data records"}).option("keys",{describe:"join by matching target,source key fields, e.g. keys=FID,id",type:"strings"}).option("calc",{describe:"use a JS expression to assign values (for many-to-one joins)"}).option("where",{describe:"use a JS expression to filter source records"}).option("fields",{describe:"fields to copy (comma-sep.) (default is all but key field)",type:"strings"}).option("prefix",{describe:"prefix for renaming fields joined from the source table"}).option("interpolate",{describe:"(polygon-polygon join) list of area-interpolated fields",type:"strings"}).option("point-method",{describe:"(polygon-polygon join) join polygons via inner points",type:"flag"}).option("largest-overlap",{describe:"(polygon-polygon join) use max overlap to join one polygon",type:"flag"}).option("max-distance",{describe:"(point-point join) join source points within this radius",type:"distance"}).option("planar",{type:"flag"}).option("duplication",{describe:"duplicate target features on many-to-one joins",type:"flag"}).option("string-fields",d).option("field-types",l).option("sum-fields",{describe:"fields to sum in a many-to-one join (or use calc= for this)",type:"strings"}).option("force",{describe:"replace values from same-named fields",type:"flag"}).option("unjoined",{describe:'copy unjoined records from source table to "unjoined" layer',type:"flag"}).option("unmatched",{describe:'copy unmatched records in target table to "unmatched" layer',type:"flag"}).option("encoding",i).option("target",e),b.command("lines").describe("convert a polygon or point layer to a polyline layer").option("fields",{DEFAULT:!0,describe:"field(s) to create a hierarchy of boundary lines",type:"strings"}).option("where",m).option("each",{describe:"apply a JS expression to each polygon boundary (with A and B)"}).option("segments",{describe:"convert paths to segments, for debugging",type:"flag"}).option("callouts",{type:"flag"}).option("arcs",{describe:"convert paths to arcs, for debugging",type:"flag"}).option("groupby",{describe:"field for grouping point input into multiple lines"}).option("name",t).option("target",e).option("no-replace",n),b.command("merge-layers").describe("merge multiple layers into as few layers as possible").flag("no_arg").option("force",{type:"flag",describe:"merge layers with inconsistent data fields"}).option("flatten",{describe:"remove polygon overlaps; higher-id polygons take priority",type:"flag"}).option("name",t).option("target",e),b.command("mosaic").describe("convert a polygon layer with overlaps into a flat mosaic").option("calc",s).option("name",t).option("target",e).option("no-replace",n),b.command("point-grid").describe("create a rectangular grid of points").validate(Zm).option("-",{label:"<cols,rows>",describe:"size of the grid, e.g. -point-grid 100,100"}).option("interval",{describe:"distance between adjacent points, in source units",type:"distance"}).option("cols",{type:"integer"}).option("rows",{type:"integer"}).option("bbox",{type:"bbox",describe:"xmin,ymin,xmax,ymax (default is bbox of data)"}).option("name",t).option("target",e).option("no-replace",n),b.command("points").describe("create a point layer from a different layer type").flag("no_arg").option("x",{describe:"field containing x coordinate"}).option("y",{describe:"field containing y coordinate"}).option("inner",{describe:"create an interior point for each polygon's largest ring",type:"flag"}).option("centroid",{describe:"create a centroid point for each polygon's largest ring",type:"flag"}).option("vertices",{describe:"capture unique vertices of polygons and polylines",type:"flag"}).option("vertices2",{describe:"like vertices, but without removal of duplicate coordinates",type:"flag"}).option("endpoints",{describe:"capture unique endpoints of polygons and polylines",type:"flag"}).option("midpoints",{describe:"find the (planar) midpoint of each polyline",type:"flag"}).option("intersections",{type:"flag"}).option("interpolated",{describe:"interpolate points along polylines; requires interval=",type:"flag"}).option("interval",{describe:"distance between interpolated points (meters or projected units)",type:"distance"}).option("name",t).option("target",e).option("no-replace",n),b.command("polygons").describe("convert polylines to polygons").option("gap-tolerance",{describe:"specify gap tolerance in source units",type:"distance"}).option("from-rings",{describe:"do simple conversion from a layer of closed paths",type:"flag"}).option("target",e),b.command("proj").describe("project your data (using Proj.4)").flag("multi_arg").option("crs",{DEFAULT:!0,describe:"set destination CRS using a Proj.4 definition or alias"}).option("projection",{alias_to:"crs"}).option("match",{describe:"set destination CRS using a .prj file or layer id"}).option("source",{alias_to:"match"}).option("from",{alias_to:"init",describe:"(deprecated) alias for init="}).option("init",{describe:"set source CRS (if unset) using a string, .prj or layer id"}).option("densify",{type:"flag",describe:"add points along straight segments to approximate curves"}).option("clip-angle",{describe:"use a custom clipping radius (for azimuthal projections)",type:"number"}).option("clip-bbox",{describe:"clip to a lat-long bounding box before projecting",type:"bbox"}).option("target",e).validate(Xm),b.command("rectangle").describe("create a rectangle from a bbox or target layer extent").option("bbox",{describe:"rectangle coordinates (xmin,ymin,xmax,ymax)",type:"bbox"}).option("offset",v).option("aspect-ratio",y).option("source",{describe:"name of layer to enclose"}).option("name",t).option("target",e).option("no-replace",n),b.command("rectangles").describe("create a rectangle around each feature in a layer").option("offset",v).option("aspect-ratio",y).option("name",t).option("target",e).option("no-replace",n),b.command("rename-fields").describe("rename data fields").option("fields",{DEFAULT:!0,type:"strings",describe:"list of replacements (comma-sep.), e.g. 'fips=STATE_FIPS,st=state'"}).option("target",e),b.command("rename-layers").describe("assign new names to layers").option("names",{DEFAULT:!0,type:"strings",describe:"list of replacements (comma-sep.)"}).option("target",e),b.command("simplify").validate(Hm).example("Retain 10% of removable vertices\n$ mapshaper input.shp -simplify 10%").describe("simplify the geometry of polygon and polyline features").option("percentage",{DEFAULT:!0,alias:"p",type:"percent",describe:"percentage of removable points to retain, e.g. 10%"}).option("dp",{alias:"rdp",describe:"use Ramer-Douglas-Peucker simplification",assign_to:"method"}).option("visvalingam",{describe:'use Visvalingam simplification with "effective area" metric',assign_to:"method"}).option("weighted",{describe:"use weighted Visvalingam simplification (default)",assign_to:"method"}).option("method",{}).option("weighting",{type:"number",describe:"weighted Visvalingam coefficient (default is 0.7)"}).option("resolution",{describe:"output resolution as a grid (e.g. 1000x500)"}).option("interval",{describe:"output resolution as a distance (e.g. 100)",type:"distance"}).option("variable",{describe:"JS expr. assigning to one of: interval= percentage= resolution=",type:"flag"}).option("planar",{describe:"simplify decimal degree coords in 2D space (default is 3D)",type:"flag"}).option("cartesian",{alias_to:"planar"}).option("keep-shapes",{describe:"prevent small polygon features from disappearing",type:"flag"}).option("lock-box",{type:"flag"}).option("no-repair",{describe:"don't remove intersections introduced by simplification",type:"flag"}).option("stats",{describe:"display simplification statistics",type:"flag"}).option("target",e),b.command("slice").option("source",{DEFAULT:!0,describe:"file or layer containing clip polygons"}).option("id-field",{describe:"slice id field (from source layer)"}).option("name",t).option("no-snap",r).option("target",e).option("no-replace",n),b.command("snap").describe("snap together nearby vertices").option("interval",{describe:"snap together vertices within a tolerance (default is small)",DEFAULT:!0,type:"distance"}).option("endpoints",{describe:"only snap together the endpoints of lines",type:"flag"}).option("precision",{describe:"round all coordinates to a given decimal precision (e.g. 0.000001)",type:"number"}).option("target",e),b.command("sort").describe("sort features using a JS expression").option("expression",{DEFAULT:!0,describe:"JS expression to generate a sort key for each feature"}).option("ascending",{describe:"sort in ascending order (default)",type:"flag"}).option("descending",{describe:"sort in descending order",type:"flag"}).option("target",e),b.command("split").describe("split a layer into single-feature or multi-feature layers").option("field",{alias_to:"expression"}).option("expression",{DEFAULT:!0,describe:"expression or field for grouping features and naming split layers"}).option("ids",{type:"numbers"}).option("apart",{describe:"save output layers to independent datasets",type:"flag"}).option("target",e).option("no-replace",n),b.command("split-on-grid").describe("split features into separate layers using a grid").validate(Zm).option("-",{label:"<cols,rows>",describe:"size of the grid, e.g. -split-on-grid 12,10"}).option("cols",{type:"integer"}).option("rows",{type:"integer"}).option("id-field",{describe:"assign each feature a cell id instead of splitting layer"}).option("target",e),b.command("style").oldAlias("svg-style").describe("set SVG style properties using JS or literal values").option("where",g).option("class",{describe:"name of CSS class or classes (space-separated)"}).option("fill",{describe:"fill color; examples: #eee pink rgba(0, 0, 0, 0.2)"}).option("fill-pattern",{describe:'pattern fill, ex: "hatches 2px grey 2px blue"'}).option("fill-effect",{describe:'use "sphere" on a circle for a 3d globe effect'}).option("fill-opacity",{describe:"fill opacity"}).option("fill-hatch",{alias_to:"fill-pattern"}).option("stroke",{describe:"stroke color"}).option("stroke-width",{describe:"stroke width"}).option("stroke-dasharray",{describe:'stroke dashes. Examples: "4" "2 4"'}).option("stroke-opacity",{describe:"stroke opacity"}).option("opacity",{describe:"opacity; example: 0.5"}).option("r",{describe:"symbol radius (set this to export points as circles)"}).option("label-text",{describe:"label text (set this to export points as labels)"}).option("text-anchor",{describe:"label alignment; one of: start, end, middle (default)"}).option("dx",{describe:"x offset of labels (default is 0)"}).option("dy",{describe:"y offset of labels (default is 0/baseline-aligned)"}).option("font-size",{describe:"size of label text (default is 12)"}).option("font-family",{describe:"CSS font family of labels (default is sans-serif)"}).option("font-weight",{describe:"CSS font weight property of labels (e.g. bold, 700)"}).option("font-style",{describe:"CSS font style property of labels (e.g. italic)"}).option("letter-spacing",{describe:"CSS letter-spacing property of labels"}).option("line-height",{describe:"line spacing of multi-line labels (default is 1.1em)"}).option("target",e),b.command("symbols").describe("symbolize points as arrows, circles, stars, polygons, etc.").option("type",{describe:"types: arrow, circle, square, star, polygon, ring"}).option("stroke",{}).option("stroke-width",{}).option("fill",{describe:"symbol fill color (filled symbols only)"}).option("stroke",{describe:"symbol line color (linear symbols only)"}).option("stroke-width",{describe:"symbol line width (linear symbols only)"}).option("opacity",{describe:"symbol opacity"}).option("geographic",{old_alias:"polygons",describe:"make geographic shapes instead of SVG objects",type:"flag"}).option("pixel-scale",{describe:"set symbol scale in meters per pixel (geographic option)",type:"number"}).option("rotated",{type:"flag",describe:"symbol is rotated to an alternate orientation"}).option("rotation",{describe:"rotation of symbol in degrees"}).option("scale",{describe:"scale symbols by a multiplier",type:"number"}).option("radius",{describe:"distance from center to farthest point on the symbol",type:"distance"}).option("sides",{describe:"(polygon) number of sides of a (regular) polygon symbol",type:"number"}).option("points",{describe:"(star) number of points"}).option("point-ratio",{old_alias:"star-ratio",describe:"(star) ratio of minor to major radius of star",type:"number"}).option("radii",{describe:"(ring) comma-sep. list of concentric radii, ascending order"}).option("arrow-style",{describe:"(arrow) options: stick, standard (default is standard)"}).option("length",{old_alias:"arrow-length",describe:"(arrow) length of arrow in pixels"}).option("direction",{old_alias:"arrow-direction",describe:"(arrow) angle off of vertical (-90 = left-pointing)"}).option("head-angle",{old_alias:"arrow-head-angle",describe:"(arrow) angle of tip of arrow (default is 40 degrees)"}).option("head-width",{old_alias:"arrow-head-width",describe:"(arrow) width of arrow head from side to side"}).option("head-length",{old_alias:"arrow-head-width",describe:"(arrow) length of head (alternative to head-angle)"}).option("head-shape",{}).option("stem-width",{old_alias:"arrow-stem-width",describe:"(arrow) width of stem at its widest point"}).option("stem-length",{old_alias:"arrow-stem-length",describe:"(arrow) alternative to length"}).option("stem-taper",{old_alias:"arrow-stem-taper",describe:"(arrow) factor for tapering the width of the stem (0-1)"}).option("stem-curve",{old_alias:"arrow-stem-curve",describe:"(arrow) curvature in degrees (default is 0)"}).option("min-stem-ratio",{old_alias:"arrow-min-stem",describe:"(arrow) minimum ratio of stem to total length",type:"number"}).option("anchor",{describe:"(arrow) takes one of: start, middle, end (default is start)"}).option("effect",{}).option("name",t).option("target",e).option("no-replace",n),b.command("target").describe("set active layer (or layers)").option("target",{DEFAULT:!0,describe:"name or index of layer to target"}).option("type",{describe:"type of layer to target (polygon|polyline|point)"}).option("name",{describe:"rename the target layer"}),b.command("union").describe("create a flat mosaic from two or more polygon layers").option("fields",{type:"strings",describe:"fields to retain (comma-sep.) (default is all fields)"}).option("name",t).option("target",{describe:"specify layers to target (comma-sep. list)"}).option("no-replace",n),b.command("uniq").describe("delete features with the same id as a previous feature").option("expression",{DEFAULT:!0,describe:"JS expression to obtain the id of a feature"}).option("max-count",{type:"number",describe:"max features with the same id (default is 1)"}).option("index",{type:"flag"}).option("invert",h).option("verbose",{describe:"print each removed feature",type:"flag"}).option("target",e),b.section("Experimental commands (may give unexpected results)"),b.command("add-shape").describe("").option("geojson",{}).option("coordinates",{}).option("properties",{}).option("name",t).option("target",e).option("no-replace",n),b.command("alpha-shapes").option("interval",{describe:"alpha parameter",type:"number"}).option("keep-points",{type:"flag"}).option("name",t).option("target",e).option("no-replace",n),b.command("cluster").describe("group polygons into compact clusters").option("id-field",{describe:'field name of cluster id (default is "cluster")'}).option("pct",{alias:"p",type:"percent",describe:"percentage of shapes to retain, e.g. 50%"}).option("max-width",{describe:"max width of cluster bounding box",type:"number"}).option("max-height",{describe:"max height of cluster bounding box",type:"number"}).option("max-area",{describe:"max area of a cluster",type:"number"}).option("group-by",{describe:"field name; only same-value shapes will be grouped"}).option("target",e),b.command("data-fill").describe("fill in missing values in a polygon layer").option("field",{describe:"name of field to fill in"}).option("postprocess",{alias_to:"contiguous"}).option("contiguous",{describe:"remove non-contiguous data islands",type:"flag"}).option("weight-field",{describe:"use field values to calculate data island weights"}),b.command("external").option("module",{DEFAULT:!0,describe:"name of Node module containing the command"}),b.command("filter-points").option("group-interval",{type:"number"}),b.command("frame").option("bbox",{describe:"frame coordinates (xmin,ymin,xmax,ymax)",type:"bbox"}).option("offset",v).option("width",{describe:"pixel width of output (default is 800)"}).option("height",{describe:"pixel height of output (may be a range)"}).option("pixels",{describe:"area of output in pixels (alternative to width and height)",type:"number"}).option("source",{describe:"name of layer to enclose"}).option("name",t),b.command("fuzzy-join").describe("join points to polygons, with data fill and fuzzy match").option("source",{DEFAULT:!0,describe:"file or layer containing data records"}).option("field",{describe:"field to join"}).option("dedup-points",{describe:"uniqify points with the same location and field value",type:"flag"}).option("no-dropouts",{describe:"try to retain all values from the point layer",type:"flag"}).option("postprocess",{alias_to:"contiguous"}).option("contiguous",{describe:"remove non-contiguous data islands",type:"flag"}).option("target",e),b.command("point-to-grid").option("interval",{type:"number"}).option("radius",{type:"number"}).option("circles",{type:"flag"}).option("cell-margin",{type:"number"}).option("aligned",{type:"flag"}).option("calc",s).option("name",t).option("target",e).option("no-replace",n),b.command("require").describe("require a Node module for use in -each expressions").option("module",{DEFAULT:!0,describe:"name of Node module or path to module file"}).option("alias",{describe:"Set the module name to an alias"}).option("init",{describe:"JS expression to run after the module loads"}),b.command("rotate").option("rotation",{DEFAULT:!0,type:"numbers"}).option("invert",{type:"flag"}),b.command("run").describe("create commands on-the-fly and run them").option("expression",{DEFAULT:!0,describe:"JS expression to generate command(s)"}).option("commands",{alias_to:"expression"}).option("target",e),b.command("scalebar").option("top",{}).option("right",{}).option("bottom",{}).option("left",{}).option("font-size",{}).option("label-position",{}).option("label-text",{}),b.command("shape").describe("create a polyline or polygon from coordinates").option("coordinates",{describe:"list of vertices as x,y,x,y...",type:"numbers"}).option("offsets",{describe:"list of vertices as offsets from coordinates list",type:"numbers"}).option("closed",{describe:"close an open path to create a polygon",type:"flag"}).option("type",{DEFAULT:!0}).option("center",{type:"numbers"}).option("radius",{type:"number"}).option("radius-angle",{type:"number"}).option("bbox",{type:"numbers"}).option("geometry",{}).option("rotation",{type:"numbers"}).option("name",t),b.command("subdivide").describe("recursively split a layer using a JS expression").validate(Qm).option("expression",{DEFAULT:!0,describe:"boolean JS expression"}).option("target",e),b.section("Control flow commands");var x={expression:{DEFAULT:!0,describe:"JS expression"},layer:{describe:"name or id of layer to test (default is current target)"},target:e};return b.command("if").describe("run the following commands if a condition is met").options(x),b.command("elif").describe("test an alternate condition; used after -if").options(x),b.command("else").describe("run commands if all preceding -if/-elif conditions are false"),b.command("endif").describe("mark the end of an -if sequence"),b.command("ignore").option("empty",{describe:"ignore empty files",type:"flag"}).option("target",e),b.command("stop").describe("stop processing (skip remaining commands)"),b.section("Informational commands"),b.command("calc").describe("calculate statistics about the features in a layer").example("Calculate the total area of a polygon layer\n$ mapshaper polygons.shp -calc 'sum($.area)'").example("Count census blocks in NY with zero population\n$ mapshaper ny-census-blocks.shp -calc 'count()' where='POPULATION == 0'").validate(Qm).option("expression",{DEFAULT:!0,describe:"functions: sum() average() median() max() min() count()"}).option("where",g).option("target",e),b.command("colors").describe("print list of color scheme names"),b.command("comment").describe("add a comment to the sequence of commands").flag("multi_arg"),b.command("encodings").describe("print list of supported text encodings (for .dbf import)"),b.command("help").alias("h").describe("print help; takes optional command name").option("command",{DEFAULT:!0,describe:"view detailed information about a command"}),b.command("info").describe("print information about data layers").option("save-to",{describe:"name of file to save info in JSON format"}).option("target",e),b.command("inspect").describe("print information about a feature").option("expression",{DEFAULT:!0,describe:"boolean JS expression for selecting a feature"}).option("target",e).validate(Qm),b.command("print").describe("print a message to stdout").flag("multi_arg"),b.command("projections").describe("print list of supported projections"),b.command("quiet").describe("inhibit console messages"),b.command("verbose").describe("print verbose processing messages"),b.command("version").alias("v").describe("print mapshaper version"),b.command("debug"),b}var py=[1,"437",2,"850",3,"1252",8,"865",9,"437",10,"850",11,"437",13,"437",14,"850",15,"437",16,"850",17,"437",18,"850",19,"932",20,"850",21,"437",22,"850",23,"865",24,"437",25,"437",26,"850",27,"437",28,"863",29,"850",31,"852",34,"852",35,"852",36,"860",37,"850",38,"866",55,"850",64,"852",77,"936",78,"949",79,"950",80,"874",87,"1252",88,"1252",89,"1252",100,"852",101,"866",102,"865",103,"861",106,"737",107,"857",108,"863",120,"950",121,"949",122,"936",123,"932",124,"874",134,"737",135,"852",136,"857",200,"1250",201,"1251",202,"1254",203,"1253",204,"1257"],hy={932:"Japanese",936:"Simplified Chinese",950:"Traditional Chinese",1252:"Western European",949:"Korean",874:"Thai",1250:"Eastern European",1251:"Russian",1254:"Turkish",1253:"Greek",1257:"Baltic"},gy='To set the text encoding, re-import using the "encoding=" option.\nTo list the supported encodings, run the "encodings" command.';function my(e,t,n){for(var r,i=e.position(),a=0,o=0;o<t&&0!==(r=e.readUint8());o++)(a>0||32!=r)&&(n[a++]=r);for(;a>0&&32==n[a-1];)a--;return e.position(i+t),a}function yy(e){var n=e||"ascii",r=wr(n),i=t.createBuffer(256);return!("object"==typeof module)||"utf8"!=r&&"ascii"!=r?function(e,t){var r,a,o=my(e,t,i),s="";for(r=0;r<o;r++){if((a=i[r])>127)return Sr(i,n,0,o);s+=String.fromCharCode(a)}return s}:function(e,t){var n=my(e,t,i);return i.toString(r,0,n)}}function vy(e,t){for(var n=0;n<t;n++)if(e[n]>=128)return!0;return!1}function by(e,t){return e.readInt32()}function xy(e,t){var n=e.readCString(t),r=null;return/[ty]/i.test(n)?r=!0:/[fn]/i.test(n)&&(r=!1),r}function _y(e,t){var n=e.readCString(t),r=n.substr(0,4),i=n.substr(4,2),a=n.substr(6,2);return new Date(Date.UTC(+r,+i-1,+a))}function wy(e,n){var r,i,a=t.isString(e)?new Em(e,{cacheSize:33554432,bufferSize:4194304}):new Mm(e),o=function(e){var t=e.readToBinArray(0,Math.min(8193,e.size()));t.position(0).littleEndian();var n,r={version:t.readInt8(),updateYear:t.readUint8(),updateMonth:t.readUint8(),updateDay:t.readUint8(),recordCount:t.readUint32(),dataOffset:t.readUint16(),recordSize:t.readUint16(),incompleteTransaction:t.skipBytes(2).readUint8(),encrypted:t.readUint8(),mdx:t.skipBytes(12).readUint8(),ldid:t.readUint8()},i=1;t.skipBytes(2),r.fields=[];for(;13!=t.peek()&&10!=t.peek()&&t.position()<r.dataOffset-1;)(n=u(t)).columnOffset=i,r.fields.push(n),i+=n.size;i!=r.recordSize&&dt("Record length mismatch; header:",r.recordSize,"detected:",i);13!=t.peek()&&gt("Found a non-standard DBF header terminator ("+t.peek()+"). DBF file may be corrupted.");return r}(a);function s(){if(!r){var e="ascii";l(),g().length>0&&(e=d()),r=o.fields.map((function(n){var r=t.extend({},n);return r.name=Ir(n.namebuf,e),r})),Lr(t.pluck(r,"name")).forEach((function(e,t){r[t].name=e}))}}function u(e){var n=t.createBuffer(11),r=my(e,11,n);return{namebuf:t.createBuffer(n.slice(0,r)),type:String.fromCharCode(e.readUint8()),address:e.readUint32(),size:e.readUint8(),decimals:e.readUint8(),id:e.skipBytes(2).readUint8(),position:e.skipBytes(2).readUint8(),indexFlag:e.skipBytes(7).readUint8()}}function c(){return s(),t.pluck(r,"name")}function f(e){return o.dataOffset+o.recordSize*e}function l(){i||(i=n||function(){var e,n,r=o.ldid,i=function(e){var t=py.indexOf(e);return-1==t?null:py[t+1]}(r),s=function(){var e,n,r,i,s,u,c=[],l=o.fields.filter((function(e){return"C"==e.type})),d=l.length,p=Math.min(o.recordCount,1e4),h=50,m=t.createBuffer(256),y={};c=g();for(var v=0;v<p;v++){u=(s=a.readToBinArray(f(v),o.recordSize)).position();for(var b=0;b<d&&!(c.length>=h);b++)e=l[b],s.position(u+e.columnOffset),(n=my(s,e.size,m))>0&&vy(m,n)&&(i=(r=t.createBuffer(m.slice(0,n))).toString("hex"))in y==!1&&(y[i]=!0,c.push(r))}return c}(),u=0===s.length;i&&87!=r?e=i:u&&(e="ascii");if(!e){var c=Bm(s);e=c.encoding,c.confidence<2&&(n="Warning: Unable to auto-detect the text encoding of a DBF file with high confidence.",n+="\n\nDefaulting to: "+e+(e in hy?" ("+hy[e]+")":""),n+="\n\nSample of how non-ascii text was imported:",n+="\n"+It(Dm(e,s).split("\n")),n+=Dm(e,s),gt(n+="\n\n"+gy+"\n"))}return e}())}function d(){return l(),i}function p(){s();var e,t=r.map(h),n=(e=c().map((function(e,t){return JSON.stringify(e)+": arguments["+t+"]"})),new Function("return {"+e.join(",")+"};")),i=[];return function(e){var s,u,c=a.readToBinArray(f(e),o.recordSize),l=c.position();(c.bytesLeft()<o.recordSize||c.bytesLeft()==o.recordSize&&26==c.peek(c.size()-1))&&pt("Invalid DBF file: encountered end-of-file while reading data");for(var d=0,p=r.length;d<p;d++)s=l+(u=r[d]).columnOffset,c.position(s),i[d]=t[d](c,u.size);return n.apply(null,i)}}function h(e){var t=e.type,n=null;return"I"==t?n=by:"F"==t||"N"==t?n=function(){var e=yy("ascii");return function(t,n){var r,i=e(t,n);return i.indexOf(",")>=0&&(i=i.replace(",",".")),r=parseFloat(i),isNaN(r)?null:r}}():"L"==t?n=xy:"D"==t?n=_y:"C"==t?n=yy(d()):(gt('Field "'+e.name+'" has an unsupported type ('+e.type+") -- converting to null values"),n=function(){return null}),n}function g(){var e=[];return o.fields.forEach((function(t){vy(t.namebuf,t.namebuf.length)&&e.push(t.namebuf)})),e}this.size=function(){return o.recordCount},this.readRow=function(e){return p()(e)},this.getFields=c,this.getBuffer=function(){return a.readSync(0,a.size())},this.deleteField=function(e){s(),r=r.filter((function(t){return t.name!=e}))},this.readRows=function(){for(var e=p(),t=[],n=0,r=this.size();n<r;n++)t.push(e(n));return t}}function Sy(e,t){return new Ay(e,(t||{}).encoding)}function Ay(e,t){var n,r=new wy(e,t),i=!1;function a(){return n||(n=new Jr(r.readRows()),r=null,e=null),n}this.exportAsDbf=function(e){if(!(!r||i||e.field_order||e.encoding))try{return r.getBuffer()}catch(e){}return jg.exportRecords(a().getRecords(),e.encoding,e.field_order)},this.getReadOnlyRecordAt=function(e){return r?r.readRow(e):n.getReadOnlyRecordAt(e)},this.deleteField=function(e){n?n.deleteField(e):(i=!0,r.deleteField(e))},this.getRecords=function(){return a().getRecords()},this.getFields=function(){return r?r.getFields():n.getFields()},this.isEmpty=function(){return r?0===this.size():n.isEmpty()},this.size=function(){return r?r.size():n.size()}}Object.assign(Ay.prototype,Jr.prototype);var Iy=Object.freeze({__proto__:null,importDbfTable:Sy,ShapefileTable:Ay});function My(e){return[tm.POLYGON,tm.POLYGONM,tm.POLYGONZ].includes(e)?"polygon":[tm.POLYLINE,tm.POLYLINEM,tm.POLYLINEZ].includes(e)?"polyline":[tm.POINT,tm.POINTM,tm.POINTZ,tm.MULTIPOINT,tm.MULTIPOINTM,tm.MULTIPOINTZ].includes(e)?"point":null}function Ey(e){return[0,1,3,5,8,11,13,15,18,21,23,25,28].includes(e)}var Py=Object.freeze({__proto__:null,translateShapefileType:My,isSupportedShapefileType:Ey});function jy(e){var t,n,r=tm.hasBounds(e),i=tm.isMultiPartType(e),a=tm.isZType(e),o=tm.isMType(e),s=!r,u=s?0:16;t=function(t,n){var r=t.position();if(this.id=t.bigEndian().readUint32(),this.type=t.littleEndian().skipBytes(4).readUint32(),0===this.type||0===e)return{id:this.id,isNull:!0,pointCount:0,partCount:0,byteLength:12};(n>0!=!0||this.type!=e&&0!==this.type)&&dt("Unable to read a shape -- .shp file may be corrupted"),this.byteLength=n,s?(this.pointCount=1,this.partCount=1):(t.skipBytes(32),this.partCount=i?t.readUint32():1,this.pointCount=t.readUint32()),this._data=function(){return t.position(r)}};var c={_xypos:function(){var e=12;return s||(e+=4),r&&(e+=32),i&&(e+=4*this.partCount+4),e},readCoords:function(){if(0===this.pointCount)return null;var e=this.readPartSizes(),t=this._data().skipBytes(this._xypos());return e.map((function(e){return t.readFloat64Array(2*e)}))},readXY:function(){return 0===this.pointCount?new Float64Array(0):this._data().skipBytes(this._xypos()).readFloat64Array(2*this.pointCount)},readPoints:function(){for(var e,t=this.readXY(),n=a?this.readZ():null,r=o&&this.hasM()?this.readM():null,i=[],s=0,u=t.length/2;s<u;s++)e=[t[2*s],t[2*s+1]],n&&e.push(n[s]),r&&e.push(r[s]),i.push(e);return i},readPartSizes:function(){var e,t,n,r=[];if(0===this.pointCount);else if(1==this.partCount)r.push(this.pointCount);else{t=0,n=this._data().skipBytes(56);for(var i=0,a=this.partCount;i<a;i++)(e=(i<a-1?n.readUint32():this.pointCount)-t)>0&&(r.push(e),t+=e)}return r}},f={read:function(){var e=2;return a&&e++,this.hasM()&&e++,this._data().skipBytes(12).readFloat64Array(e)},stream:function(e){var t=this._data().skipBytes(12);e.addPoint(t.readFloat64(),t.readFloat64()),e.endPath()}},l={readBounds:function(){return this._data().skipBytes(12).readFloat64Array(4)},stream:function(e){for(var t,n=this.readPartSizes(),r=this.readXY(),i=0,a=0;i<n.length;){for(t=n[i];t-- >0;)e.addPoint(r[a++],r[a++]);e.endPath(),i++}r.length!=a&&dt("Counting error")},stream2:function(e){for(var t,n=this.readPartSizes(),r=this._data().skipBytes(this._xypos()),i=0;i<n.length;){for(t=n[i];t-- >0;)e.addPoint(r.readFloat64(),r.readFloat64());e.endPath(),i++}},read:function(){for(var e=[],t=this.readPartSizes(),n=this.readPoints(),r=0,i=t.length-1;r<i;r++)e.push(n.splice(0,t[r]));return e.push(n),e}},d={_mpos:function(){var e=this._xypos()+16*this.pointCount;return a&&(e+=8*this.pointCount+u),e},readMBounds:function(){return this.hasM()?this._data().skipBytes(this._mpos()).readFloat64Array(2):null},readM:function(){return this.hasM()?this._data().skipBytes(this._mpos()+u).readFloat64Array(this.pointCount):null},hasM:function(){var e=this._mpos(),t=e+8*this.pointCount+u;return this.byteLength!=e&&(this.byteLength==t||void dt("#hasM() Counting error"))}},p={_zpos:function(){return this._xypos()+16*this.pointCount},readZBounds:function(){return this._data().skipBytes(this._zpos()).readFloat64Array(2)},readZ:function(){return this._data().skipBytes(this._zpos()+u).readFloat64Array(this.pointCount)}};return n=0===e?{}:s?Object.assign(c,f):Object.assign(c,l),a&&Object.assign(n,p),o&&Object.assign(n,d),t.prototype=n,n.constructor=t,t}function Oy(e,n){if(this instanceof Oy==!1)return new Oy(e,n);var r,i,a=t.isString(e)?new Em(e):new Mm(e),o=function(e){var t={signature:e.bigEndian().readUint32(),byteLength:2*e.skipBytes(20).readUint32(),version:e.littleEndian().readUint32(),type:e.readUint32(),bounds:e.readFloat64Array(4),zbounds:e.readFloat64Array(2),mbounds:e.readFloat64Array(2)};9994!=t.signature&&dt("Not a valid .shp file");Ey(t.type)||dt("Unsupported .shp type:",t.type);t.byteLength!=a.size()&&dt("File size of .shp doesn't match size in header");return t}(a.readToBinArray(0,100)),s=o.type,u=100,c=0,f=0,l=new jy(s);function d(e,t){var n=e.size();if(t+12>n)return null;var r=e.readToBinArray(t,12);r.bigEndian().readUint32();var i=2*r.readUint32()+8,a=r.littleEndian().readUint32();return t+i<=n&&i>=12&&(0===a||a==s)?(r=e.readToBinArray(t,i),new l(r,i)):null}n&&(i=t.isString(n)?new Em(n):new Mm(n),r=i.readToBinArray(0,i.size()).bigEndian()),this.header=function(){return o},this.forEachShape=function(e){for(var t=this.nextShape();t;)e(t),t=this.nextShape()},this.nextShape=function(){var e;return a||dt("Tried to read from a used ShpReader"),e=function(e){return r?function(e,t,n){if(t.size()<=100+8*n)return null;t.position(100+8*n);var r=n+1,i=2*t.readUint32();t.readUint32();var a=d(e,i);a||pt("Index of Shapefile record",r,"in the .shx file is invalid.");a.id!=r&&(f++,bt(`Warning: A feature has a different record number in .shx (${r}) and .shp (${a.id}).`));return a}(a,r,e):function(e,t,n){var r,i,a,o=n+1,c=t,f=e.size(),l=null;for(;c+12<=f;)if(i=(r=e.readToBinArray(c,12)).bigEndian().readUint32(),!((a=r.littleEndian().skipBytes(4).readUint32())==s||0===a)||i!=o&&0===a)c+=4;else{if(!(l=d(e,c)))break;if(u=c+l.byteLength,i==o)break;i<o?(gt("Found a Shapefile record with the same id as a previous record ("+l.id+") -- skipping."),c+=l.byteLength):pt("Shapefile contains an out-of-sequence record. Possible data corruption -- bailing.")}l&&c>t&&bt("Skipped over "+(c-t)+" non-data bytes in the .shp file.");return l}(a,u,e)}(c),e?(c++,e):(a.close(),a=i=r=null,f>0&&gt(`Warning: ${f}/${c} features have non-standard record numbers in the .shp file.`),null)}}function ky(e,t){var n,r=e.arcs;(t.snap||t.auto_snap||t.snap_interval)&&(t.snap_interval&&(n=Hf(t.snap_interval,Qi(e))),r&&En(r,n)),e.layers.forEach((function(e){Zr(e)&&Ad(e.shapes,r,e.geometry_type)}))}function Fy(e){return e[0]>-1e38&&e[1]>-1e38}function zy(e){var n=1e4,r=new Float64Array(n),i=new Float64Array(n),a=0;this.endPath=function(){e(r,i,a),a=0},this.addPoint=function(e,o){a>=n&&(n=Math.ceil(1.3*n),r=t.extendBuffer(r,n),i=t.extendBuffer(i,n)),r[a]=e,i[a]=o,a++}}function Cy(e){var n=e.reserved_points>0?e.reserved_points:2e4,r=new Float64Array(n),i=new Float64Array(n),a=[],o=[],s=[],u=[],c=e.type||null,f=null,l=-1,d=-1,p=0,h=0,g=0;function m(e){var t=d<u.length?u[d]:null;t?t!=e&&pt("Unable to import mixed-geometry features"):(u[d]=e,c?e!=c&&(c="mixed"):c=e)}function y(e){if(e>r.length){var n=Math.max(e,Math.ceil(1.5*r.length));r=t.extendBuffer(r,n,p),i=t.extendBuffer(i,n,p)}}function v(e){(a[d]||(a[d]=[])).push(e)}e.precision&&(f=Lf(e.precision)),t.extend(this,new zy((function(e,t,n){var a,o,u,d,m=0;y(p+n);for(var b=0;b<n;b++)a=e[b],o=t[b],f&&(a=f(a),o=f(o)),b>0&&a==u&&o==d?h++:(r[p]=a,i[p]=o,p++,m++),d=o,u=a;"polygon"==c&&m>0&&(e[0]==e[n-1]&&t[0]==t[n-1]||(y(p+1),r[p]=e[0],i[p]=t[0],g++,p++,m++));!function(e){l++,s[l]=e,v([l])}(m)}))),this.startShape=function(e){a[++d]=null,e&&(o[d]=e)},this.importLine=function(e){e.length<2?bt("Skipping a defective line"):(m("polyline"),this.importPath(e))},this.importPoints=function(e){m("point"),e=e.filter(Fy),f&&e.forEach((function(e){e[0]=f(e[0]),e[1]=f(e[1])})),e.forEach(v)},this.importRing=function(e,t){var n=$n.getPlanarPathArea2(e);!n||e.length<4?bt("Skipping a defective ring"):(m("polygon"),(!0===t&&n>0||!1===t&&n<0)&&e.reverse(),this.importPath(e))},this.importPath=function(e){for(var t,n=0,r=e.length;n<r;n++)t=e[n],this.addPoint(t[0],t[1]);this.endPath()},this.done=function(){var e,n,f={name:""};return h>0&&bt(t.format("Removed %,d duplicate point%s",h,t.pluralSuffix(h))),g>0&&gt(t.format("Closed %,d open polygon ring%s",g,t.pluralSuffix(g))),p>0&&(p<r.length&&(r=r.subarray(0,p),i=i.subarray(0,p)),e=new ma(s,r,i)),"mixed"==c?n=li(a,o,u):(f={geometry_type:c},c&&(f.shapes=a),o.length>0&&(f.data=new Jr(o)),n=[f]),n.forEach((function(e){e.data&&Fr(e.data.getRecords())})),{arcs:e||null,info:{},layers:n}}}Oy.prototype.type=function(){return this.header().type};var Ny=Object.freeze({__proto__:null,cleanPathsAfterImport:ky,pointHasValidCoords:Fy,PathImporter:Cy});function Ty(e,n,r){var i=new Oy(e,n),a=i.type(),o=My(a),s=new Cy(t.defaults({type:o,reserved_points:Math.round(i.header().byteLength/16)},r));return Ey(a)||pt("Unsupported Shapefile type:",a),tm.isZType(a)?bt("Warning: Shapefile Z data will be lost."):tm.isMType(a)&&bt("Warning: Shapefile M data will be lost."),i.forEachShape((function(e){s.startShape(),e.isNull||("point"==o?s.importPoints(e.readPoints()):e.stream(s))})),s.done()}var Ly=Object.freeze({__proto__:null,importShp:Ty});function By(e,n){var r,i,a=n||{},o=Object.keys(yp.pathImporters),s=t.isString(e)?JSON.parse(e):e,u=new Dy(a);return((r="Feature"==s.type?{type:"FeatureCollection",features:[s]}:o.includes(s.type)?{type:"GeometryCollection",geometries:[s]}:s).features||r.geometries||[]).forEach(u.parseObject),Ry(i=u.done(),s),i}function Dy(e){var t=e.id_field||yp.ID_FIELD,n=new Cy(e);this.parseObject=function(r){var i,a;r&&r.type?"Feature"==r.type?(i=r.geometry,a=r.properties||{},"id"in r&&(a[t]=r.id)):i=r:i=null,i&&"GeometryCollection"==i.type?yp.importComplexFeature(n,i,a,e):e.single_part&&function(e){return e&&e.type&&0===e.type.indexOf("Multi")}(i)?yp.importMultiAsSingles(n,i,a,e):yp.importSimpleFeature(n,i,a,e)},this.done=function(){return n.done()}}function Uy(e,t){return t=t||{},e.forEach((function(e){if(e){var n=yp.translateGeoJSONType(e.type);n?(n in t==!1&&(t[n]=[]),t[n].push(e)):"GeometryCollection"==e.type&&Uy(e.geometries||[],t)}})),Object.values(t)}function Ry(e,t){"crs"in t&&(e.info.input_geojson_crs=t.crs)}yp.importComplexFeature=function(e,t,n,r){var i=Uy(t.geometries||[]);0!==i.length?i.forEach((function(t,i){e.startShape(Or(n)),t.forEach((function(t){yp.importSimpleGeometry(e,t,r)}))})):e.startShape(n)},yp.importSimpleFeature=function(e,t,n,r){e.startShape(n),yp.importSimpleGeometry(e,t,r)},yp.importMultiAsSingles=function(e,t,n,r){t.coordinates.forEach((function(i,a){var o={type:t.type.substr(5),coordinates:i},s=0===a?n:Or(n);yp.importSimpleFeature(e,o,s,r)}))},yp.importSimpleGeometry=function(e,t,n){var r=t?t.type:null;if(null===r);else if(r in yp.pathImporters){if(n.geometry_type&&n.geometry_type!=yp.translateGeoJSONType(r))return;yp.pathImporters[r](t.coordinates,e)}else bt("Unsupported geometry type:",t.type)},yp.pathImporters={LineString:function(e,t){t.importLine(e)},MultiLineString:function(e,t){for(var n=0;n<e.length;n++)yp.pathImporters.LineString(e[n],t)},Polygon:function(e,t){for(var n=0;n<e.length;n++)t.importRing(e[n],n>0)},MultiPolygon:function(e,t){for(var n=0;n<e.length;n++)yp.pathImporters.Polygon(e[n],t)},Point:function(e,t){t.importPoints([e])},MultiPoint:function(e,t){t.importPoints(e)}};var qy=Object.freeze({__proto__:null,importGeoJSON:By,GeoJSONParser:Dy,importCRS:Ry});function $y(e,n){var r,i,a;return t.isString(e)&&(e=JSON.parse(e)),e.arcs&&e.arcs.length>0&&(e.transform&&im.decodeArcs(e.arcs,e.transform),n&&n.precision&&im.roundCoords(e.arcs,n.precision),i=new ma(e.arcs)),a=Object.keys(e.objects).reduce((function(t,r){for(var a,o=im.importObject(e.objects[r],i,n),s=0,u=o.length;s<u;s++)(a=o[s]).name=r,t.push(a);return t}),[]),a.forEach((function(t){Zr(t)&&Ad(t.shapes,i,t.geometry_type),"point"==t.geometry_type&&e.transform&&im.decodePoints(t.shapes,e.transform),t.data&&Fr(t.data.getRecords())})),Ry(r={layers:a,arcs:i,info:{}},e),e.metadata&&function(e,t){t.proj4&&Xi(e,Wi(t.proj4))}(r,e.metadata),r}im.decodePoints=function(e,t){Nt(e,(function(e){e[0]=e[0]*t.scale[0]+t.translate[0],e[1]=e[1]*t.scale[1]+t.translate[1]}))},im.decodeArcs=function(e,t){var n=t.scale[0],r=t.scale[1],i=t.translate[0],a=t.translate[1];e.forEach((function(e){for(var t,o,s,u=0,c=0,f=0,l=e.length;f<l;f++)o=(t=e[f])[0]+u,s=t[1]+c,t[0]=o*n+i,t[1]=s*r+a,u=o,c=s}))},im.roundCoords=function(e,t){var n,r=Lf(t);e.forEach((function(e){for(var t=0,i=e.length;t<i;t++)(n=e[t])[0]=r(n[0]),n[1]=r(n[1])}))},im.importObject=function(e,t,n){var r=new im.GeometryImporter(t,n);return("GeometryCollection"==e.type?e.geometries:[e]).forEach(r.addGeometryObject,r),r.done()},im.GeometryImporter=function(e,t){var n,r=t&&t.id_field||yp.ID_FIELD,i=[],a=[],o=[],s=0,u=null;this.addGeometryObject=function(e){var t=e.properties||null;n=a.length,a[n]=null,"id"in e&&((t=t||{})[r]=e.id),i[n]=t,t||s++,e.type&&this.addShape(e)},this.addShape=function(t){var r,i=a[n],o=yp.translateGeoJSONType(t.type);"GeometryCollection"==t.type?t.geometries.forEach(this.addShape,this):o?(this.setGeometryType(o),(r=im.shapeImporters[t.type](t,e))&&r.length&&(Array.isArray(r[0])?a[n]=i?i.concat(r):r:pt("Invalid TopoJSON",t.type,"geometry"))):t.type&&pt("Invalid TopoJSON geometry type:",t.type)},this.setGeometryType=function(e){var t=n<o.length?o[n]:null;t?t!=e&&pt("Unable to import mixed-type TopoJSON geometries"):(o[n]=e,this.updateCollectionType(e))},this.updateCollectionType=function(e){u?e&&u!=e&&(u="mixed"):u=e},this.done=function(){return"mixed"==u?li(a,i,o):[{geometry_type:u,shapes:u?a:null,data:s<a.length?new Jr(i):null}]}},im.importPolygonArcs=function(e,t){var n,r=e[0],i=null;if(t||pt("Invalid TopoJSON file: missing arc data."),!(n=r?$n.getPlanarPathArea(r,t):null))return null;n<0&&Hn(r),i=[r];for(var a=1;a<e.length;a++)r=e[a],(n=$n.getPlanarPathArea(r,t))&&(n>0&&Hn(r),i.push(r));return i},im.shapeImporters={Point:function(e){return[e.coordinates]},MultiPoint:function(e){return e.coordinates},LineString:function(e){return[e.arcs]},MultiLineString:function(e){return e.arcs},Polygon:function(e,t){return im.importPolygonArcs(e.arcs,t)},MultiPolygon:function(e,t){return e.arcs.reduce((function(e,n){var r=im.importPolygonArcs(n,t);return r&&(e=e?e.concat(r):r),e}),null)}};var Vy,Gy=Object.freeze({__proto__:null,importTopoJSON:$y}),Jy=123,Wy=125,Yy=91,Hy=93,Xy=34,Zy=44,Qy=4096,Ky=1e7,ev=5e6;function tv(e,t,n){var r=_v(e,t);for(!function(e){var t=e.getChar(),n=0;for(;t!=Vy&&n<Qy;){if(n++,t==Jy)return e.back(),!0;t=e.getChar()}}(r);r.peek()==Jy;)n(pv(r)),fv(r,Zy)}function nv(e,t){t>=0&&(e+=" at position "+t),pt(e)}function rv(e,t){if(e==Vy)return nv("Unexpected end of JSON input");nv(e==Xy?"Unexpected string in JSON":e<33||e>126?"Unexpected token in JSON":"Unexpected token "+String.fromCharCode(e)+" in JSON",t)}function iv(e,t){t==Vy&&nv("Unterminated string in JSON",e),nv("Too-long string in JSON",e)}function av(e){return 32==e||10==e||13==e||9==e}function ov(e){for(;av(e.peek());)e.advance()}function sv(e){var t,n,r,i,a=e.index();if(e.getChar()==Yy&&vv(e.peek())&&(t=xv(e),r=e.getChar(),ov(e),r==Zy&&vv(e.peek()))){if(n=xv(e),(i=e.getChar())==Hy)return[t,n];if(i==Zy)return function(e,t){ov(e);do{e.refresh(),t.push(lv(e))}while(dv(e,Zy,Hy)==Zy);return t}(e,[t,n])}return e.index(a),lv(e)}function uv(e,t){for(var n=0;n<t.length;n++)cv(e,t.charCodeAt(n));return!0}function cv(e,t){var n=e.getChar();n!=t&&rv(n,e.index()-1)}function fv(e,t){return ov(e),e.peek()===t?(e.advance(),ov(e),t):null}function lv(e){var t,n=e.peek();return vv(n)?t=xv(e):n==Yy?t=function(e){var t,n=[];for(cv(e,Yy),t=fv(e,Hy);t!=Hy;)e.refresh(),n.push(sv(e)),t=dv(e,Zy,Hy);return n}(e):n==Xy?t=gv(e):n==Jy?t=pv(e):110==n?t=uv(e,"null")&&null:116==n?t=uv(e,"true")&&!0:102==n?t=uv(e,"false")&&!1:rv(n,e.index()),t}function dv(e,t,n){ov(e);var r=e.getChar();return r!=t&&r!=n&&rv(r,e.index()-1),ov(e),r}function pv(e){var t,n,r={};for(cv(e,Jy),n=fv(e,Wy);n!=Wy;)e.refresh(),t=hv(e),ov(e),cv(e,58),ov(e),r[t]="type"==t&&e.peek()==Xy?hv(e):lv(e),n=dv(e,Zy,Wy);return r}function hv(e){var t=e.index(),n=e.cache,r=!1,i=0;cv(e,Xy);for(var a=e.getChar();a!=Xy||!0===r;)++i>2e3&&iv(t,a),r?r=!1:92==a&&(r=!0),n[a]||(n[a]=[]),n=n[a],a=e.getChar();return n[0]||(e.index(t),n[0]=gv(e)),n[0]}function gv(e){var t=e.index();cv(e,Xy);for(var n=0,r="",i=e.getChar();i!=Xy;){if(++n>256||92==i||i<32||i>126)return e.index(t),mv(e);r+=String.fromCharCode(i),i=e.getChar()}return r}function mv(e){e.refresh();var t=Qy-2,n=e.index(),r=0,i=!1;cv(e,Xy);for(var a,o=e.getChar();o!=Xy||!0===i;){if(++r>t)return o!=Vy&&(Qy*=2)<=ev||iv(n,o),e.index(n),mv(e);i?i=!1:92==o&&(i=!0),o=e.getChar()}return a=JSON.parse(e.toString(n,r+2)),e.refresh(),a}function yv(e){return e>=48&&e<=57}function vv(e){return e>=48&&e<=57||45==e}function bv(e){return e>=48&&e<=57||45==e||46==e||43==e||69==e||101==e}function xv(e){var t,n,r=e.index(),i=0,a=1,o=1,s=!1,u=!1,c=e.getChar();for(45===c&&(o=-1,c=e.getChar()),t=c;yv(c);)i=10*i+(n=c-48),c=e.getChar();if(i>0&&48===t&&(u=!0),46==c){for(;yv(c=e.getChar());)a*=10,i=10*i+(n=c-48);1!=a&&46!=t||(u=!0)}return 0===i&&48!=t&&(u=!0),u&&nv("Invalid number in JSON",r),a>1e22&&(s=!0),i>=9007199254740992&&(i>=0x40000000000000||1==(1&n))&&(s=!0),s||69==c||101==c?(e.index(r),function(e){for(var t=e.index(),n=0;bv(e.getChar());)n++;e.back();var r=e.toString(t,n),i=Number(r);return isNaN(i)&&nv("Invalid number in JSON",t),i}(e)):(e.back(),o*i/a)}function _v(e,t){var n=e.size(),r=t,i=e.readSync(r,Ky),a=0,o={peek:function(){return i[a]},getChar:function(){return i[a++]},advance:function(){a++},back:function(){a--},toString:function(e,t){var n=e-r;return i.toString("utf8",n,n+t)},index:function(e){if(e>=0==!1)return a+r;a=e-r},refresh:s,cache:[]};return s(),o;function s(){i.length-a>=Qy||r+i.length>=n||(r+=a,a=0,i=e.readSync(r,Ky))}}function wv(e){this.readObjects=function(t){var n=e.findString('"features"',5e3)||e.findString('"geometries"',5e3),r=n?n.offset:0;tp.start(),tv(e,r,t),xt("Parse GeoJSON",tp.stop())}}function Sv(e,t){var n=null;return e.length>1e3&&(e=e.substr(0,1e3)),e=e.replace(/\s/g,""),t&&t.json_path||/^\[[{\]]/.test(e)?n="json":/"arcs":\[|"objects":\{|"transform":\{/.test(e)?n="topojson":/^\{"/.test(e)&&(n="geojson"),n}function Av(e){var n=null;return e&&("Topology"==e.type?n="topojson":e.type?n="geojson":t.isArray(e)&&(n="json")),n}function Iv(e,t){var n=new Dy(t);return new wv(e).readObjects(n.parseObject),n.done()}function Mv(e,n){var r,i,a=e.content,o=e.filename,u={filename:o};if(a?(a instanceof ArrayBuffer||a instanceof s||a instanceof Uint8Array)&&((a.byteLength||a.length)<1e7?a=Sr(t.createBuffer(a)):(r=new Mm(a),a=null)):r=new Em(o),r&&(e=function(e,t){var n;return n="geojson"==Sv(Am(e,1e3),t)?{dataset:Iv(e,t),format:"geojson"}:{content:e.toString("utf8")},e.close(),n}(r,n),e.dataset?(u.dataset=e.dataset,u.format=e.format):a=e.content),a){if(t.isString(a))try{a=JSON.parse(a)}catch(e){pt("JSON parsing error:",e.message)}n.json_path?(i=Av(a=function(e,t){var n,r,i,a=/(.*)\[([0-9]+)\]$/,o=t.indexOf("/")>0?"/":".",s=t.split(o);for(;s.length>0;)if(n=s.shift(),!(e=(i=a.exec(n))?(r=e[i[1]])&&r[+i[2]]||null:e[n]))return null;return e}(a,n.json_path)))||pt("Unexpected object type at JSON path:",n.json_path):i=Av(a),"topojson"==i?u.dataset=$y(a,n):"geojson"==i?u.dataset=By(a,n):"json"==i?u.dataset=fm(a):pt("Unknown JSON format"),u.format=i}return u}var Ev=Object.freeze({__proto__:null,identifyJSONString:Sv,identifyJSONObject:Av,importGeoJSONFile:Iv,importJSON:Mv});function Pv(e,n){var r,i,a;return n=n||{},e.json?(i=(a=Mv(e.json,n)).format,ky(r=a.dataset,n)):e.text?(i="dsv",r=Rm(a=e.text,n)):e.shp?(i="shapefile",a=e.shp,r=function(e,n){var r,i=e.shp.content||e.shp.filename,a=e.shx?e.shx.content||e.shx.filename:null,o=Ty(i,a,n),s=o.layers[0];e.dbf&&(r=jv(e,n),t.extend(o.info,r.info),s.data=r.layers[0].data,s.shapes&&s.data.size()!=s.shapes.length&&gt("Mismatched .dbf and .shp record count -- possible data loss."));e.prj&&(o.info.prj=e.prj.content);e.cpg&&(o.info.cpg=e.cpg.content,"string"!=typeof o.info.cpg&&dt("Invalid encoding argument, expected a string"));return o}(e,n),ky(r,n)):e.dbf?(i="dbf",a=e.dbf,r=jv(e,n)):e.prj?(i="prj",r={layers:[],info:{prj:(a=e.prj).content}}):e.kml&&(i="kml",r=function(e,t){var n=pr("@tmcw/togeojson"),r="undefined"==typeof DOMParser?pr("@xmldom/xmldom").DOMParser:DOMParser;return By(n.kml((new r).parseFromString(e,"text/xml")),t||{})}((a=e.kml).content,n)),r||pt("Missing an expected input type"),r.arcs&&!n.no_topology&&"topojson"!=i&&_a(r),"topojson"!=i&&r.layers.forEach((function(e){e.name||(e.name=function(e){var t="layer1",n=Ka(e);n.basename&&n.extension&&(t=n.basename);return t}(a.filename||""))})),a.filename&&(r.info.input_files=[a.filename]),r.info.input_formats=[i],r}function jv(e,n){return n=t.extend({},n),e.cpg&&!n.encoding&&(n.encoding=e.cpg.content),{info:{},layers:[{data:Sy(e.dbf.content||e.dbf.filename,n)}]}}var Ov=Object.freeze({__proto__:null,importContent:Pv,importFileContent:function(e,t,n){var r={};return r[jc(t,e)]={filename:t,content:e},Pv(r,n)}});async function kv(e){return Fv(rs(e,{}))}async function Fv(e){(function(e){if(!Array.isArray(e.datasets))return!1;return!0})(e)||pt("Invalid mapshaper session data object");var t=await Promise.all(e.datasets.map(zv));return Object.assign(e,{datasets:t})}async function zv(e){var t=null;return e.arcs&&(t=await async function(e){if(uc(e.xx)){var t=[];t.push(lc(e.nn)),t.push(lc(e.xx)),t.push(lc(e.yy)),e.zz&&t.push(lc(e.zz));var n=await Promise.all(t);e.nn=n.shift(),e.xx=n.shift(),e.yy=n.shift(),e.zz&&(e.zz=n.shift())}var r=Cv(e.nn,Uint32Array),i=Cv(e.xx,Float64Array),a=Cv(e.yy,Float64Array),o=new ma(r,i,a);e.zz&&(o.setThresholds(Cv(e.zz,Float64Array)),o.setRetainedInterval(e.zlimit));return o}(e.arcs)),{info:Nv(e.info||{}),layers:(e.layers||[]).map(Tv),arcs:t}}function Cv(e,t){return new t(Eg.copyToArrayBuffer(e))}function Nv(e){return e.crs_string?e.crs=Yi(e.crs_string):e.prj&&(e.crs=aa(e.prj)),e}function Tv(e){var t=e.data;return t&&(t=gc(t)),Object.assign(e,{data:e.data?new Jr(t):null})}var Lv=Object.freeze({__proto__:null,unpackSessionData:kv,restoreSessionData:Fv});function Bv(e,t){var n;e in t?n=t[e]:(n=e,Xc.checkFileExists(e));var r=$c(n);return Object.assign(t,r),function(e){return Object.keys(e).filter((function(t){var n=Ec(t);return("dbf"!=n||!(ro(t,"shp")in e))&&("text"==n||"json"==n||"shp"==n||"dbf"==n||"kml"==n)}))}(r)}function Dv(e,t){return Uv(e,t)}td.importFiles=async function(e,t){var n,r=t.files||[];return Xc.checkCommandEnv("i"),t.stdin?(n=Dv("/dev/stdin",t),e.addDataset(n),n):(r.length>0==!1&&pt("Missing input file(s)"),bt("Importing: "+r.join(" ")),(t=Object.assign({},t)).input=Object.assign({},t.input),r=function(e,t){var n=[];return e.forEach((function(e){var r;r=Nc(e)?Bv(e,t):Tc(e)?function(e,t){var n=Bv(e,t),r=ro(Ka(e).filename,"kml");"doc.kml"==n[0]&&(n[0]=r,t[r]=t["doc.kml"]);return n}(e,t):[e],n=n.concat(r)})),n}(r,t.input),0===r.length&&pt("Missing importable files"),r.some(Cc)?(r.length>1&&pt("Expected a single package file"),n=await async function(e,t,n){var r=Xc.readFile(e,null,n.input),i=await kv(r);return i.datasets.forEach(t.addDataset,t),i.target}(r[0],e,t),n):(n=1==r.length?Dv(r[0],t):Rv(r,t),t.merge_files&&r.length>1&&(n.layers=td.mergeLayers(n.layers)),e.addDataset(n),n))};var Uv=function(e,n){var r,i=Ec(e),a={},o=n&&n.encoding||null,s=n&&n.input||null,u=s&&e in s;if(Xc.checkFileExists(e,s),"shp"!=i&&"json"!=i&&"text"!=i&&"dbf"!=i||u)if(i&&Dc(e))r=Xc.readFile(e,null,s),t.isString(r)&&pt("Expected binary content, received a string");else if(i)r=Xc.readFile(e,o||"utf-8",s);else if("gz"==to(e)){var c=e;(i=Ec(e=c.replace(/\.gz$/,"")))||pt("Unrecognized file type:",e),r=dc(Xc.readFile(c,null,s),e)}else"text"==(i=Pc(r=Xc.readFile(e,o||"utf-8",s)))&&r.indexOf("ï¿½")>-1&&(i=null);else r=null;return i||pt(function(e){var t=to(e),n="Unable to import "+e;"zip"==t.toLowerCase()?n+=" (ZIP files must be unpacked before running mapshaper)":n+=" (unknown file type)";return n}(e)),a[i]={filename:e,content:r},r=null,"shp"!=i&&"dbf"!=i||function(e,t,n){var r=ro(e,"dbf"),i=ro(e,"shx"),a=ro(e,"cpg"),o=ro(e,"prj");Xc.isFile(o,n)&&(t.prj={filename:o,content:Xc.readFile(o,"utf-8",n)});Xc.isFile(i,n)&&(t.shx={filename:i,content:Xc.readFile(i,null,n)});!t.dbf&&Xc.isFile(r,n)&&(t.dbf={filename:r,content:n&&r in n?Xc.readFile(r,null,n):null});t.dbf&&Xc.isFile(a,n)&&(t.cpg={filename:a,content:Xc.readFile(a,"utf-8",n).trim()})}(e,a,s),"shp"!=i||a.dbf||gt(t.format("[%s] .dbf file is missing - shapes imported without attribute data.",e)),Pv(a,n)};function Rv(e,n){var r=!1,i=Ea(e.map((function(e){var i=Dv(e,t.defaults({no_topology:!0,snap:!1,snap_interval:null,files:[e]},n));return i.arcs&&i.arcs.size()>0&&"topojson"!=i.info.input_formats[0]&&(r=!0),i})));return r&&!n.no_topology&&(ky(i,n),_a(i)),i}var qv=Object.freeze({__proto__:null,replaceImportFile:function(e){Uv=e},importFile:Dv,importFilesTogether:Rv});function $v(e,t){return function(e){return/[$][{]/.test(e)}(e)?((t.length>1||1!=t[0].layers.length)&&pt("Interpolated names are not compatible with multiple targets."),Vv(e,t[0].layers[0])):e}function Vv(e,t){var n={target:t.name||""},r="with($$ctx) { return `"+e+"`; }";try{e=new Function("$$ctx",r)(n)}catch(t){pt("Unable to interpolate ["+e+"]")}return e}function Gv(e,n,r){var i,a=n.findSingleLayer(e);return a||((i=Dv(e,t.defaults({no_topology:!0},r)))?i.layers.length>1&&pt("Multiple-layer sources are not supported"):pt(t.format("Unable to find source [%s]",e)),a={dataset:i,layer:i.layers[0],disposable:!0}),a}var Jv=Object.freeze({__proto__:null,convertSourceName:$v,convertInterpolatedName:Vv,findCommandSource:Gv});function Wv(){var e=[],t=[];function n(e,t){return{layer:e,dataset:t}}function r(e,t){var n=-1;return t.forEach((function(t,r){t.layer==e&&(n=r)})),n}this.forEachLayer=function(t){var n=0;e.forEach((function(e){e.layers.forEach((function(r){t(r,e,n++)}))}))},this.deleteLayer=function(e,n){this.getActiveLayer().layer==e&&(t=[]),n.layers.splice(n.layers.indexOf(e),1),0===n.layers.length&&this.removeDataset(n),t=t.filter((function(t){var n=t.layers.indexOf(e);return-1==n||(t.layers.splice(n,1),t.layers.length>0)}))},this.findLayer=function(e){var t="function"==typeof e?e:null,r=null;return this.forEachLayer((function(i,a){(t?t(i,a):i==e)&&(r=n(i,a))})),r},this.findCommandTargets=function(e,t){return e?Fl(this.getLayers(),e,t):this.getDefaultTargets()||[]},this.findSingleLayer=function(e){var t=Cl(this.getLayers(),e);return t.length>1&&pt("Ambiguous pattern (multiple layers were matched):",e),t[0]||null},this.clear=function(){e=[],t=[]},this.removeDataset=function(n){t=t.filter((function(e){return e.dataset!=n})),e=e.filter((function(e){return e!=n}))},this.getDatasets=function(){return e},this.getLayers=function(){var e=[];return this.forEachLayer((function(t,r){e.push(n(t,r))})),e},this.addDataset=function(e){return this.setDefaultTarget(e.layers,e),this},this.addDatasets=function(e){e.forEach((function(e){this.addDataset(e)}),this)},this.findNextLayer=function(e){var t=this.getLayers(),n=r(e,t);return n>-1?t[(n+1)%t.length]:null},this.findPrevLayer=function(e){var t=this.getLayers(),n=r(e,t);return n>-1?t[(n-1+t.length)%t.length]:null},this.isEmpty=function(){return 0===e.length},this.getDefaultTargets=function(){return 0!==t.length||this.isEmpty()||(t=[{dataset:e[0],layers:e[0].layers.slice(0,1)}]),t},this.setDefaultTarget=function(e,t){this.setDefaultTargets([{layers:e.concat(),dataset:t}])},this.setDefaultTargets=function(n){n.forEach((function(t){-1==e.indexOf(t.dataset)&&e.push(t.dataset)})),t=n},this.getActiveLayer=function(){var e=(this.getDefaultTargets()||[])[0],t=e.layers[e.layers.length-1];return e?{layer:t,dataset:e.dataset}:null}}function Yv(e){var t=[];return e.forEachLayer((function(e,n,r){t.push("  ["+(r+1)+"]  "+(e.name||"[unnamed]"))})),t.length>0?t.join("\n"):"[none]"}var Hv=Object.freeze({__proto__:null,Catalog:Wv,getFormattedLayerList:Yv});function Xv(e){var t,n={catalog:e||new Wv,defs:{},settings:{},input_files:[],initSettings:function(e){n.settings=e,Zv(n,{})},startCommand:function(e){t=e,Zv(n,e)},endCommand:function(){t=null,a()},resumeCommand:function(){Zv(n,t)}};return n}function Zv(e,t){a(),r("current_command",t.name),r("DEBUG",e.settings.DEBUG||t.debug),r("VERBOSE",e.settings.VERBOSE||t.verbose),r("QUIET",e.settings.QUIET||t.quiet),r("defs",e.defs),r("input_files",e.input_files)}function Qv(e,n){var r=t.toArray(arguments).slice(2);return n.reduce((function(n,i){var a=e.apply(null,[i].concat(r));return t.isArray(a)?n=n.concat(a):a&&n.push(a),n}),[])}function Kv(e){return"string"==typeof e?JSON.parse(e):e}function eb(e){return e?Kv(e):null}function tb(e){return e.length>=2&&e.every(t.isNumber)}function nb(e){return e.every(rb)}function rb(e){return e&&2==e.length&&tb(e)}td.addShape=function(e,t,n){e.length>1&&pt("Command expects a single target layer");var r=e[0],i=!n.no_replace&&r&&r.geometry_type||null,a=By(function(e,t){if(e.geojson)return Kv(e.geojson);var n=e.coordinates&&function(e){"string"==typeof e&&((e=e.trim()).startsWith("[")||e.endsWith("]")||(e="["+e+"]"));var t=Kv(e);if(rb(t))return{type:"Point",coordinates:t};tb(t)&&(t=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);nb(t)||pt("Unable to parse x,y,x,y... coordinates");return t}(t));if(function(e){return nb(e)&&e.length>3&&(t=e[0],n=e[e.length-1],t[0]==n[0]&&t[1]==n[1]);var t,n}(t))return{type:"Polygon",coordinates:[t]};if(nb(t))return{type:"LineString",coordinates:t};pt("Unable to import coordinates")}(e.coordinates)||null;n||pt("Missing required shape coordinates");"point"==t&&"Point"!=n.type&&pt("Expected point coordinates, received",n.type);"polygon"==t&&"Polygon"!=n.type&&pt("Expected polygon coordinates, received",n.type);"polyline"==t&&("Polygon"==n.type?(n.coordinates=n.coordinates[0],n.type="LineString"):pt("Expected polyline coordinates, received",n.type));return{type:"Feature",properties:eb(e.properties),geometry:n}}(n,i)),o=Aa(t,[a])[0];if(n.no_replace||!r)return pi(o,r&&r.name,null,n),[o];return td.mergeLayers([r,o],{force:!0})};const ib=11102230246251565e-32,ab=134217729,ob=(3+8*ib)*ib;function sb(e,t,n,r,i){let a,o,s,u,c=t[0],f=r[0],l=0,d=0;f>c==f>-c?(a=c,c=t[++l]):(a=f,f=r[++d]);let p=0;if(l<e&&d<n)for(f>c==f>-c?(o=c+a,s=a-(o-c),c=t[++l]):(o=f+a,s=a-(o-f),f=r[++d]),a=o,0!==s&&(i[p++]=s);l<e&&d<n;)f>c==f>-c?(o=a+c,u=o-a,s=a-(o-u)+(c-u),c=t[++l]):(o=a+f,u=o-a,s=a-(o-u)+(f-u),f=r[++d]),a=o,0!==s&&(i[p++]=s);for(;l<e;)o=a+c,u=o-a,s=a-(o-u)+(c-u),c=t[++l],a=o,0!==s&&(i[p++]=s);for(;d<n;)o=a+f,u=o-a,s=a-(o-u)+(f-u),f=r[++d],a=o,0!==s&&(i[p++]=s);return 0===a&&0!==p||(i[p++]=a),p}function ub(e){return new Float64Array(e)}const cb=22204460492503146e-32,fb=11093356479670487e-47,lb=ub(4),db=ub(8),pb=ub(12),hb=ub(16),gb=ub(4);function mb(e,t,n,r,i,a){const o=(t-a)*(n-i),s=(e-i)*(r-a),u=o-s;if(0===o||0===s||o>0!=s>0)return u;const c=Math.abs(o+s);return Math.abs(u)>=33306690738754716e-32*c?u:-function(e,t,n,r,i,a,o){let s,u,c,f,l,d,p,h,g,m,y,v,b,x,_,w,S,A;const I=e-i,M=n-i,E=t-a,P=r-a;x=I*P,d=ab*I,p=d-(d-I),h=I-p,d=ab*P,g=d-(d-P),m=P-g,_=h*m-(x-p*g-h*g-p*m),w=E*M,d=ab*E,p=d-(d-E),h=E-p,d=ab*M,g=d-(d-M),m=M-g,S=h*m-(w-p*g-h*g-p*m),y=_-S,l=_-y,lb[0]=_-(y+l)+(l-S),v=x+y,l=v-x,b=x-(v-l)+(y-l),y=b-w,l=b-y,lb[1]=b-(y+l)+(l-w),A=v+y,l=A-v,lb[2]=v-(A-l)+(y-l),lb[3]=A;let j=function(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}(4,lb),O=cb*o;if(j>=O||-j>=O)return j;if(l=e-I,s=e-(I+l)+(l-i),l=n-M,c=n-(M+l)+(l-i),l=t-E,u=t-(E+l)+(l-a),l=r-P,f=r-(P+l)+(l-a),0===s&&0===u&&0===c&&0===f)return j;if(O=fb*o+ob*Math.abs(j),j+=I*f+P*s-(E*c+M*u),j>=O||-j>=O)return j;x=s*P,d=ab*s,p=d-(d-s),h=s-p,d=ab*P,g=d-(d-P),m=P-g,_=h*m-(x-p*g-h*g-p*m),w=u*M,d=ab*u,p=d-(d-u),h=u-p,d=ab*M,g=d-(d-M),m=M-g,S=h*m-(w-p*g-h*g-p*m),y=_-S,l=_-y,gb[0]=_-(y+l)+(l-S),v=x+y,l=v-x,b=x-(v-l)+(y-l),y=b-w,l=b-y,gb[1]=b-(y+l)+(l-w),A=v+y,l=A-v,gb[2]=v-(A-l)+(y-l),gb[3]=A;const k=sb(4,lb,4,gb,db);x=I*f,d=ab*I,p=d-(d-I),h=I-p,d=ab*f,g=d-(d-f),m=f-g,_=h*m-(x-p*g-h*g-p*m),w=E*c,d=ab*E,p=d-(d-E),h=E-p,d=ab*c,g=d-(d-c),m=c-g,S=h*m-(w-p*g-h*g-p*m),y=_-S,l=_-y,gb[0]=_-(y+l)+(l-S),v=x+y,l=v-x,b=x-(v-l)+(y-l),y=b-w,l=b-y,gb[1]=b-(y+l)+(l-w),A=v+y,l=A-v,gb[2]=v-(A-l)+(y-l),gb[3]=A;const F=sb(k,db,4,gb,pb);x=s*f,d=ab*s,p=d-(d-s),h=s-p,d=ab*f,g=d-(d-f),m=f-g,_=h*m-(x-p*g-h*g-p*m),w=u*c,d=ab*u,p=d-(d-u),h=u-p,d=ab*c,g=d-(d-c),m=c-g,S=h*m-(w-p*g-h*g-p*m),y=_-S,l=_-y,gb[0]=_-(y+l)+(l-S),v=x+y,l=v-x,b=x-(v-l)+(y-l),y=b-w,l=b-y,gb[1]=b-(y+l)+(l-w),A=v+y,l=A-v,gb[2]=v-(A-l)+(y-l),gb[3]=A;const z=sb(F,pb,4,gb,hb);return hb[z-1]}(e,t,n,r,i,a,c)}const yb=Math.pow(2,-52),vb=new Uint32Array(512);class bb{static from(e,t=Ib,n=Mb){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new bb(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=1/0,s=1/0,u=-1/0,c=-1/0;for(let t=0;t<a;t++){const n=e[2*t],r=e[2*t+1];n<o&&(o=n),r<s&&(s=r),n>u&&(u=n),r>c&&(c=r),this._ids[t]=t}const f=(o+u)/2,l=(s+c)/2;let d,p,h,g=1/0;for(let t=0;t<a;t++){const n=xb(f,l,e[2*t],e[2*t+1]);n<g&&(d=t,g=n)}const m=e[2*d],y=e[2*d+1];g=1/0;for(let t=0;t<a;t++){if(t===d)continue;const n=xb(m,y,e[2*t],e[2*t+1]);n<g&&n>0&&(p=t,g=n)}let v=e[2*p],b=e[2*p+1],x=1/0;for(let t=0;t<a;t++){if(t===d||t===p)continue;const n=wb(m,y,v,b,e[2*t],e[2*t+1]);n<x&&(h=t,x=n)}let _=e[2*h],w=e[2*h+1];if(x===1/0){for(let t=0;t<a;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];Sb(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e];this._dists[i]>r&&(t[n++]=i,r=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(mb(m,y,v,b,_,w)<0){const e=p,t=v,n=b;p=h,v=_,b=w,h=e,_=t,w=n}const S=function(e,t,n,r,i,a){const o=n-e,s=r-t,u=i-e,c=a-t,f=o*o+s*s,l=u*u+c*c,d=.5/(o*c-s*u),p=e+(c*f-s*l)*d;return{x:p,y:t+(o*l-u*f)*d}}(m,y,v,b,_,w);this._cx=S.x,this._cy=S.y;for(let t=0;t<a;t++)this._dists[t]=xb(e[2*t],e[2*t+1],S.x,S.y);Sb(this._ids,this._dists,0,a-1),this._hullStart=d;let A=3;n[d]=t[h]=p,n[p]=t[d]=h,n[h]=t[p]=d,r[d]=0,r[p]=1,r[h]=2,i.fill(-1),i[this._hashKey(m,y)]=d,i[this._hashKey(v,b)]=p,i[this._hashKey(_,w)]=h,this.trianglesLen=0,this._addTriangle(d,p,h,-1,-1,-1);for(let a,o,s=0;s<this._ids.length;s++){const u=this._ids[s],c=e[2*u],f=e[2*u+1];if(s>0&&Math.abs(c-a)<=yb&&Math.abs(f-o)<=yb)continue;if(a=c,o=f,u===d||u===p||u===h)continue;let l=0;for(let e=0,t=this._hashKey(c,f);e<this._hashSize&&(l=i[(t+e)%this._hashSize],-1===l||l===n[l]);e++);l=t[l];let g,m=l;for(;g=n[m],mb(c,f,e[2*m],e[2*m+1],e[2*g],e[2*g+1])>=0;)if(m=g,m===l){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,u,n[m],-1,-1,r[m]);r[u]=this._legalize(y+2),r[m]=y,A++;let v=n[m];for(;g=n[v],mb(c,f,e[2*v],e[2*v+1],e[2*g],e[2*g+1])<0;)y=this._addTriangle(v,u,g,r[u],-1,r[v]),r[u]=this._legalize(y+2),n[v]=v,A--,v=g;if(m===l)for(;g=t[m],mb(c,f,e[2*g],e[2*g+1],e[2*m],e[2*m+1])<0;)y=this._addTriangle(g,u,m,-1,r[m],r[g]),this._legalize(y+2),r[g]=y,n[m]=m,A--,m=g;this._hullStart=t[u]=m,n[m]=t[v]=u,n[u]=v,i[this._hashKey(c,f)]=u,i[this._hashKey(e[2*m],e[2*m+1])]=m}this.hull=new Uint32Array(A);for(let e=0,t=this._hullStart;e<A;e++)this.hull[e]=t,t=n[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===i)break;e=vb[--i];continue}const u=o-o%3,c=s+(e+1)%3,f=u+(o+2)%3,l=t[a],d=t[e],p=t[c],h=t[f];if(_b(r[2*l],r[2*l+1],r[2*d],r[2*d+1],r[2*p],r[2*p+1],r[2*h],r[2*h+1])){t[e]=h,t[o]=l;const r=n[f];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===f){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,f);const s=u+(o+1)%3;i<vb.length&&(vb[i++]=s)}else{if(0===i)break;e=vb[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function xb(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function _b(e,t,n,r,i,a,o,s){const u=e-o,c=t-s,f=n-o,l=r-s,d=i-o,p=a-s,h=f*f+l*l,g=d*d+p*p;return u*(l*g-h*p)-c*(f*g-h*d)+(u*u+c*c)*(f*p-l*d)<0}function wb(e,t,n,r,i,a){const o=n-e,s=r-t,u=i-e,c=a-t,f=o*o+s*s,l=u*u+c*c,d=.5/(o*c-s*u),p=(c*f-s*l)*d,h=(o*l-u*f)*d;return p*p+h*h}function Sb(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,a=r;Ab(e,n+r>>1,i),t[e[n]]>t[e[r]]&&Ab(e,n,r),t[e[i]]>t[e[r]]&&Ab(e,i,r),t[e[n]]>t[e[i]]&&Ab(e,n,i);const o=e[i],s=t[o];for(;;){do{i++}while(t[e[i]]<s);do{a--}while(t[e[a]]>s);if(a<i)break;Ab(e,i,a)}e[n+1]=e[a],e[a]=o,r-i+1>=a-n?(Sb(e,t,i,r),Sb(e,t,n,a-1)):(Sb(e,t,n,a-1),Sb(e,t,i,r))}}function Ab(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Ib(e){return e[0]}function Mb(e){return e[1]}function Eb(e,t){return na(e)?function(e){return function(t,n){return Qt(t[0],t[1],n[0],n[1])<=e}}(t):function(e){return function(t,n){return Jt(t[0],t[1],n[0],n[1])<=e}}(t)}function Pb(e){var t=1e-4,n=e[0],r=e[1];return[[[n,r],[n,r+t],[n+t,r+t],[n+t,r],[n,r]]]}function jb(e,t){var n,r=t||{},i=e.layers[0],a=Vd(e,{});if(r.debug_division)return function(e,t){var n=kd(t),r=[],i=[];return e.shapes.forEach(a),e.shapes=r,e.data=new Jr(i),e;function a(e){var t=[],a=[];n(e,t,a),t.forEach((function(e){r.push([e]),i.push({type:"ring"})})),a.forEach((function(e){r.push([Hn(e)]),i.push({type:"hole"})}))}}(i,a);var o=new sp(i,a,{flat:!1,no_holes:!1});if(r.debug_mosaic)return n=lp(i,o.mosaic),i.shapes=n.shapes,void(i.data=n.data);var s=kf(o.nodes),u=i.shapes.map((function(e,t){for(var n=o.getTilesByShapeIds([t]),r=[],i=0;i<n.length;i++)r.push(n[i][0]);return s(r,"dissolve")}));i.shapes=u,r.no_dissolve||Na(e)}function Ob(e,t){return Jf(e).value&&Yf(e,t)||null}function kb(e,t){var n=Qi(e),r=t.tolerance?Ob(t.tolerance,n):0;return function(e){return r||(r||.01*e)}}function Fb(e,t,n){n.radius||pt("Missing expected radius parameter");var r=n.units||"",i=Qi(t),a=Ob(n.radius+r,i);if(a)return function(){return a};var o=ql(n.radius,e,null,{});return function(e){var t=o(e);return t&&Ob(t+r,i)||0}}td.alphaShapes=function(e,t,n){oi(e),n.interval>0==!1&&pt("Expected a non-negative interval parameter");var r=function(e,t,n){var r=function(e,t,n){for(var r,i,a,o,s,u,c=Ct(e),f=bb.from(c),l=n.keep_points?new Uint8Array(c.length):null,d=f.triangles,p={type:"MultiPolygon",coordinates:[]},h=0,g=d.length;h<g;h+=3)o=d[h],s=d[h+1],u=d[h+2],r=c[o],i=c[s],a=c[u],t(r,i)&&t(i,a)&&t(r,a)&&(p.coordinates.push([[a,i,r,a]]),l&&(l[o]=1,l[s]=1,l[u]=1));l&&function(e,t,n){for(var r=0,i=n.length;r<i;r++)0===n[r]&&e.coordinates.push(Pb(t[r]))}(p,c,l);return By(p)}(e,t,n);_a(r),n.debug||gp(r.layers,r,{quiet:!0});return r}(e,Eb(t,n.interval),n),i=Ea([t,r]),a=i.layers.pop();return t.arcs=i.arcs,pi(a,e,null,n),a};var zb=Object.freeze({__proto__:null,dissolveBufferDataset:jb,getBufferToleranceFromCircleSegments:function(e){return 1-Math.cos(Math.PI/e)},getArcDegreesFromTolerancePct:function(e){return 360*Math.acos(1-e)/Math.PI},getBufferToleranceFromCircleSegments2:function(e){return 1/Math.cos(Math.PI/e)-1},getArcDegreesFromTolerancePct2:function(e){return 360*Math.acos(1/(e+1))/Math.PI},parseConstantBufferDistance:Ob,getBufferToleranceFunction:kb,getBufferDistanceFunction:Fb});function Cb(e,t,n,r){var i=function(e,t,n,r){var i=r.backtrack>=0?r.backtrack:50,a=new fa(e),o=r.cap_style||"round";function s(e,n,r,a,o,s){for(var u=10,c=a+o,f=a+u;f<c;)h(e,t(n,r,f,s),i),f+=u}function u(e,t,n,r,i){return $n.distance2D(e,t,n,r)<i}function c(e,t,n){var r=e[e.length-1];return u(r[0],r[1],t,n,1e-6)}function f(e,t){var n=e[e.length-1];u(n[0],n[1],t[0],t[1],1e-10)||e.push(t)}function l(e,t,n,r){return"flat"==o?[[e,t]]:d(e,t,n,r)}function d(e,n,r,i){for(var a=[],o=10,s=r-90,u=o;u<180;)a.push(t(e,n,s+u,i)),u+=o;return a}function p(e,t){var n=t-e;return n>180&&(n-=360),n<-180&&(n+=360),n}function h(e,t,n){for(var r,i,a,o,s=0,u=e.length-3;s<n&&u>=0;s++,u--)if(a=e[e.length-1],r=e[u],i=e[u+1],o=Nb(r[0],r[1],i[0],i[1],a[0],a[1],t[0],t[1])){for(;e.length>u+1;)e.pop();f(e,o)}f(e,t)}return function(e,r){var o,u,f,d,g,m,y,v,b,x,_,w,S=[],A=0;for(a.init(e);a.hasNext();)a.x===g&&a.y===m||(f=g,d=m,g=a.x,m=a.y,A>=1&&(x=b,b=n(f,d,g,m),y=t(f,d,b-90,r),v=t(g,m,b-90,r)),1==A&&(_=b,o=f,u=d,S.push(y,v)),A>1&&(w=p(x,b),c(S,y[0],y[1])?h(S,v,i):w>0?(s(S,f,d,x-90,w,r),h(S,y,i),h(S,v,i)):(h(S,y,i),h(S,v,i))),A++);return g==o&&m==u?(w=p(b,_))>0&&s(S,g,m,b-90,w,r):S.push.apply(S,l(g,m,b,r)),S}}(e,t,n,r),a=r.geometry_type,o="polyline"==r.output_geometry?"polyline":"polygon";function s(e,t){var n,r=i(e,t);return"polyline"==a&&(n=Hn(e.concat()),r=r.concat(i(n,t))),r.push(r[0]),"polyline"==o?r:[r]}return function(e,t){for(var n={type:"polyline"==o?"MultiLineString":"MultiPolygon",coordinates:[]},r=0;r<e.length;r++)n.coordinates.push(s(e[r],t));return 0==n.coordinates.length?null:n}}function Nb(e,t,n,r,i,a,o,s){return e<i&&e<o&&n<i&&n<o||e>i&&e>o&&n>i&&n>o||t<a&&t<s&&r<a&&r<s||t>a&&t>s&&r>a&&r>s?null:$n.segmentIntersection(e,t,n,r,i,a,o,s)}var Tb=Object.freeze({__proto__:null,getPolylineBufferMaker:Cb,addBufferVertex:function(e,t,n){for(var r,i,a,o,s=0,u=e.length-3;s<n&&u>=0;s++,u--)if(a=e[e.length-1],r=e[u],i=e[u+1],o=Nb(r[0],r[1],i[0],i[1],a[0],a[1],t[0],t[1])){for(o.length;e.length>u+1;)e.pop();e.push(o)}e.push(t)},bufferIntersection:Nb});function Lb(e,t,n,r){var i=function(e,t,n,r){var i,a,o,s,u=r.backtrack>=0?r.backtrack:50,c=new fa(e);function f(e,n,r,i,a){for(var o=10,s=r+i,u=r+o;u<s;)g(t(e,n,u,a)),u+=o}function l(e,t,n,r,i){return $n.distance2D(e,t,n,r)<i}function d(e,t,n){var r=e[e.length-1];return l(r[0],r[1],t,n,1e-6)}function p(e,t){var n=e[e.length-1];l(n[0],n[1],t[0],t[1],1e-10)||e.push(t)}function h(e,t){var n=t-e;return n>180&&(n-=360),n<-180&&(n+=360),n}function g(e){var t,n,r,i,o,c=a;i=r=c[c.length-1];for(var f=0,l=c.length-3;l>=0;f++,l--){if(t=c[l],n=c[l+1],o=Nb(t[0],t[1],n[0],n[1],r[0],r[1],e[0],e[1])){if(1==Rn(t,n,r,e)){m();break}for(;c.length>l+1;)c.pop();p(c,o),r=o}if(f>=u){s||(s=new kt).mergePoint(t[0],t[1]),s.mergePoint(n[0],n[1]),dn(i,e,s)&&m();break}}p(c,e)}function m(){var e=a[a.length-1],t=o[o.length-1],n=[];y(n,a),o.reverse(),y(n,o),n.push(n[0]),i.push(n),a.push(e),o.push(t)}function y(e,t){for(t.reverse();t.length>0;)e.push(t.pop())}return function(e,r){var s,u,l,p,y,v,b,x,_;for(i=[],a=[],o=[],c.init(e);c.hasNext();)c.x===l&&c.y===p||(s=l,u=p,l=c.x,p=c.y,x=b,b=n(s,u,l,p),y=t(s,u,b-90,r),v=t(l,p,b-90,r),0===o.length?(a.push(y,v),o.push([s,u],[l,p])):(_=h(x,b),d(a,y[0],y[1])?g(v):_>0?(f(s,u,x-90,_,r),g(y),g(v)):(g(y),g(v)),o.push([l,p])));return o.length>1&&m(),i}}(e,t,n,r),a=r.geometry_type;function o(e){return[e]}function s(t,n){var s,u,c;return function(e,t){return"polyline"==a?"right"!=r.type:"outer"==r.type?1==$n.getPathWinding(e,t):"inner"!=r.type||-1==$n.getPathWinding(e,t)}(t,e)&&(s=i(t,n)),"polyline"==a&&"left"!=r.type&&(c=Hn(t.concat()),u=i(c,n)),(s||[]).concat(u||[]).map(o)}return function(e,t){for(var n={type:"MultiPolygon",coordinates:[]},r=0;r<e.length;r++)n.coordinates=n.coordinates.concat(s(e[r],t));return 0==n.coordinates.length?null:n}}function Bb(e){ta(e)||dt("Expected an unprojected CRS");var t=e.es/(1+Math.sqrt(e.one_es));return new(pr("mproj").internal.GeographicLib.Geodesic.Geodesic)(e.a,t)}function Db(e,t,n,r,i){var a=1-i;return[e*a+n*i,t*a+r*i]}function Ub(e){if(!(e&&ta(e)))return Db;var t=Bb(e);return function(e,n,r,i,a){var o=t.Inverse(n,e,i,r),s=o.s12*a,u=t.Direct(n,e,o.azi1,s);return[u.lon2,u.lat2]}}function Rb(e,t,n,r){var i=n/180*Math.PI;return[e+Math.sin(i)*r,t+Math.cos(i)*r]}function qb(e,t,n,r){var i=Math.PI/180,a=Math.cos(t*i),o=2*a*a-1,s=2*a*o-a,u=2*a*s-o,c=1e3*(111.41513*a-.09455*s+12e-5*(2*a*u-s)),f=1e3*(111.13209-.56605*o+.0012*u),l=n*i,d=t+Math.cos(l)*r/f;return[e+Math.sin(l)*r/c,d]}function $b(e){if(!ta(e))return Rb;var t=Bb(e);return function(e,n,r,i){var a=t.Direct(n,e,r,i);return[a.lon2,a.lat2]}}function Vb(e){return ta(e)?qb:Rb}function Gb(e,t,n,r){return 180*$n.bearing(e,t,n,r)/Math.PI}function Jb(e,t,n,r){return 180*$n.bearing2D(e,t,n,r)/Math.PI}function Wb(e){return ta(Qi(e))?Gb:Jb}var Yb=Object.freeze({__proto__:null,interpolatePoint2D:Db,getInterpolationFunction:Ub,getPlanarSegmentEndpoint:Rb,getGeodeticSegmentFunction:$b,getFastGeodeticSegmentFunction:Vb,bearingDegrees:Gb,bearingDegrees2D:Jb,getBearingFunction:Wb});function Hb(e,t,n){var r=Fb(e,t,n);kb(t,n);var i=Vb(Qi(t)),a=Wb(t),o=Object.assign({geometry_type:e.geometry_type},n),s=(n.v2?Lb:Cb)(t.arcs,i,a,o);e.data&&e.data.getRecords();var u=e.shapes.map((function(t,n){var i=r(n);return i&&t?s(t,i,e.geometry_type):null}));return{type:"GeometryCollection",geometries:u}}var Xb=1e-10,Zb=90-Xb,Qb=-180+Xb,Kb=-90+Xb,ex=180-Xb;function tx(e){return e[e.length-1]}function nx(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]}function rx(e){return nx(e[0],tx(e))}function ix(e){e[0]<=Qb&&(e[0]=-180),e[0]>=ex&&(e[0]=180),e[1]<=Kb&&(e[1]=-90),e[1]>=Zb&&(e[1]=90)}function ax(e){return e[1]>=Zb||e[1]<=Kb}function ox(e,t){return ax(e)||ax(t)||e[0]<=Qb&&t[0]<=Qb||e[0]>=ex&&t[0]>=ex}function sx(e){return e[1]<=Kb||e[1]>=Zb||e[0]<=Qb||e[0]>=ex}function ux(e){if(!function(e){for(var t=0,n=e.length;t<n;t++)if(sx(e[t]))return!0;return!1}(e))return e;var t,n,r,i=[],a=!1;e.pop(),t=e[e.length-1],n=e[0];for(var o=1,s=e.length;o<=s;o++)(r=o==s?i[0]:e[o])&&((a||ox(t,n))&&ox(n,r)?a=!0:(!0===a&&(a=!1),i.push(n),t=n),n=r);return i.length>0&&i.push(i[0].concat()),i}function cx(e){return hx(e)}function fx(e){return-180==e[0]||180==e[0]}function lx(e){for(var n,r=[],i=[],a=0;a<e.length;a++)rx(n=e[a])||dt("Received an open path"),0===px(n)?r.push(n):i=i.concat(hx(n));return i.length>0&&(r=r.concat(function(e){var n=function(e){var n=e.map((function(e){return e[0][1]}));return t.genericSort(n,!0)}(e),r=[],i=[];return e.forEach((function(e,t){if(!i[t]){(function(e){var t=tx(e)[0],n=e[0][0];return!(180!=t&&-180!=t||180!=n&&-180!=n)})(e)||dt("Geometry error");var n=a(e,[]);n&&(rx(n)||dt("Generated an open ring"),r.push(n))}})),r;function a(t,r){var o=tx(t),s=e.indexOf(t);if(i[s])return xt("Tried to use a previously used path"),null;i[s]=!0,r=r.concat(t);var u=function(e,t,n){var r,i=t[0],a=t[1],o=n.indexOf(a),s=-180==i?180:-180,u=180==i,c=u?o-1:o+1;if(180!=i&&-180!=i)return xt("Unexpected error"),null;if(-1==o)return xt("Point missing from intersection table:",t),null;r=c<0||c>=n.length?[s,a]:[i,n[c]];return r}(0,o,n);if(!u)return null;if(o[0]!=u[0]){var c=180==o[0]?-90:90;r.push([o[0],c],[0,c],[u[0],c])}var f=function(e,t){for(var n=0;n<e.length;n++)if(nx(e[n][0],t))return e[n];return null}(e,u);return f?nx(r[0],f[0])?(r.push(r[0]),r):a(f,r):null}}(i))),r}function dx(e,t){t.length>1&&e.push(t)}function px(e){for(var t,n,r=0,i=0,a=e.length;i<a;i++)n=e[i],i>0&&Math.abs(t[0]-n[0])>180&&r++,t=n;return r}function hx(e){for(var t,n,r,i=[],a=[],o=e[0],s=nx(o,tx(e)),u=0,c=e.length;u<c;u++)t=e[u],u>0&&gx(n,t)&&(mx(a,n,r=yx(n,t)),dx(i,a),mx(a=[],t,r)),a.push(t),n=t;return dx(i,a),s&&i.length>1&&!fx(o)&&((a=i.pop()).pop(),i[0]=a.concat(i[0])),i}function gx(e,t){return Math.abs(e[0]-t[0])>180}function mx(e,t,n){var r=t[0]<0?-180:180;fx(t)||e.push([r,n])}function yx(e,t){var n,r;return t[0]-e[0]>0?(n=e[0]+180,r=180-t[0]):(n=180-e[0],r=t[0]+180),0===n?e[1]:0===r?t[1]:(r*e[1]+n*t[1])/(n+r)}function vx(e,t,n){var r=function(e,t,n){var r=n.vertices||72,i=Fb(e,t,n),a=Qi(t),o=ta(a),s=$b(a),u=e.shapes.map((function(e,t){var n=i(t);return n&&e?xx(e,n,r,s,o):null}));return{type:"GeometryCollection",geometries:u}}(e,t,n);return By(r,{})}function bx(e,t,n,r){var i=n||360,a=$b(Yi("wgs84"));return r.inset&&(t-=r.inset),"polyline"==r.geometry_type?function(e,t,n,r){var i,a=[];if(!e||!e.length)return null;for(var o=0;o<e.length;o++)for(i=cx(i=_x(e[o],t,n,r));i.length>0;)a.push(i.pop());return 1==a.length?{type:"LineString",coordinates:a[0]}:{type:"MultiLineString",coordinates:a}}([e],t,i,a):xx([e],t,i,a,!0)}function xx(e,t,n,r,i){var a,o,s=[];if(!e||!e.length)return null;for(var u=0;u<e.length;u++)if(a=_x(e[u],t,n,r),i)if(px(a)>0)for(o=lx([a]);o.length>0;)s.push([o.pop()]);else xn(new sa(a))<0?s.push([[[180,90],[180,-90],[0,-90],[-180,-90],[-180,90],[0,90],[180,90]],a]):s.push([a]);else s.push([a]);return{type:"MultiPolygon",coordinates:s}}function _x(e,t,n,r){for(var i,a=[],o=360/n,s=0;s<n;s++)i=(s+.5)*o%360,a.push(r(e[0],e[1],i,t));return a.push(a[0].concat()),a}td.buffer=function(e,t,n){var r;"point"==e.geometry_type?r=vx(e,t,n):"polyline"==e.geometry_type?r=function(e,t,n){var r=By(Hb(e,t,n),{});return jb(r,n),r}(e,t,n):"polygon"==e.geometry_type?r=function(e,t,n){var r=By(Hb(e,t,n),{});return jb(r),r}(e,t,n):pt("Unsupported geometry type");return[Xa(e,t,r,n)]};var wx=[10,12,15,18,20,22,25,30,35,40,45,50,60,70,80,90,100],Sx=[10,2,5,2,10,2,5,10,5,10,5,50,10,10,10,10,10];function Ax(e){var t=wx.indexOf(e);return Sx[t]||dt("Unknown error")}function Ix(e,t){return(t>=50?1:t>=10&&.9)||t>=5&&.8||.7}function Mx(e,n){var r=dw(e,n),i=function(e,t,n){var r=[],i=Math.max(Math.abs(e),Math.abs(t)),a=n>=2?(t-e)/(n-1):i,o=function(e){var t=1;e>1e-4!=!1&&e<1e9!=!1||pt("Data range error");for(;e>100;)e/=10,t/=10;for(;e<10;)e*=10,t*=10;return t}(a),s=Ox(o*a);return s.forEach((function(t){var i=Ax(t),a=Px(t,o),s=Px(i,o),u=function(e,t){var n=Lf(t)(e),r=n+(e>n?t:-t),i=n<r?[n,r]:[r,n];return i}(e,s);u.forEach((function(e){r.push({interval:a,precision:s,roundness:Ix(0,i),breaks:jx(e,a,n)})}))})),r}(r[0],r[r.length-1],n);return i.forEach((function(n){var r,i,a,o;pw(n.breaks,e),n.distribution=pw(n.breaks,e),n.quality=n.roundness*(r=n.distribution,i=t.sum(r)/r.length,a=r[0],o=r[r.length-1],(Ex(i,a)+Ex(i,o))/2)})),t.sortOn(i,"quality",!1),i[0].breaks}function Ex(e,t){return t>e?e/t:e/(2*e-t)}function Px(e,t){return t<1?e*Math.round(1/t):e/t}function jx(e,t,n){for(var r=[e],i=1;i<n;i++)r.push(e+t*i);return r}function Ox(e){for(var t,n,r=wx,i=1;i<r.length;i++)if(t=r[i-1],n=r[i],e>=t&&e<=n)return[t,n];dt("Range error")}function kx(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Fx(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function zx(){}var Cx=.7,Nx=1/Cx,Tx="\\s*([+-]?\\d+)\\s*",Lx="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Bx="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Dx=/^#([0-9a-f]{3,8})$/,Ux=new RegExp(`^rgb\\(${Tx},${Tx},${Tx}\\)$`),Rx=new RegExp(`^rgb\\(${Bx},${Bx},${Bx}\\)$`),qx=new RegExp(`^rgba\\(${Tx},${Tx},${Tx},${Lx}\\)$`),$x=new RegExp(`^rgba\\(${Bx},${Bx},${Bx},${Lx}\\)$`),Vx=new RegExp(`^hsl\\(${Lx},${Bx},${Bx}\\)$`),Gx=new RegExp(`^hsla\\(${Lx},${Bx},${Bx},${Lx}\\)$`),Jx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Wx(){return this.rgb().formatHex()}function Yx(){return this.rgb().formatRgb()}function Hx(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Dx.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Xx(t):3===n?new e_(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Zx(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Zx(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Ux.exec(e))?new e_(t[1],t[2],t[3],1):(t=Rx.exec(e))?new e_(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=qx.exec(e))?Zx(t[1],t[2],t[3],t[4]):(t=$x.exec(e))?Zx(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Vx.exec(e))?o_(t[1],t[2]/100,t[3]/100,1):(t=Gx.exec(e))?o_(t[1],t[2]/100,t[3]/100,t[4]):Jx.hasOwnProperty(e)?Xx(Jx[e]):"transparent"===e?new e_(NaN,NaN,NaN,0):null}function Xx(e){return new e_(e>>16&255,e>>8&255,255&e,1)}function Zx(e,t,n,r){return r<=0&&(e=t=n=NaN),new e_(e,t,n,r)}function Qx(e){return e instanceof zx||(e=Hx(e)),e?new e_((e=e.rgb()).r,e.g,e.b,e.opacity):new e_}function Kx(e,t,n,r){return 1===arguments.length?Qx(e):new e_(e,t,n,null==r?1:r)}function e_(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function t_(){return`#${a_(this.r)}${a_(this.g)}${a_(this.b)}`}function n_(){const e=r_(this.opacity);return`${1===e?"rgb(":"rgba("}${i_(this.r)}, ${i_(this.g)}, ${i_(this.b)}${1===e?")":`, ${e})`}`}function r_(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function i_(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function a_(e){return((e=i_(e))<16?"0":"")+e.toString(16)}function o_(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new u_(e,t,n,r)}function s_(e){if(e instanceof u_)return new u_(e.h,e.s,e.l,e.opacity);if(e instanceof zx||(e=Hx(e)),!e)return new u_;if(e instanceof u_)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new u_(o,s,u,e.opacity)}function u_(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function c_(e){return(e=(e||0)%360)<0?e+360:e}function f_(e){return Math.max(0,Math.min(1,e||0))}function l_(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}kx(zx,Hx,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Wx,formatHex:Wx,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return s_(this).formatHsl()},formatRgb:Yx,toString:Yx}),kx(e_,Kx,Fx(zx,{brighter(e){return e=null==e?Nx:Math.pow(Nx,e),new e_(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Cx:Math.pow(Cx,e),new e_(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new e_(i_(this.r),i_(this.g),i_(this.b),r_(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:t_,formatHex:t_,formatHex8:function(){return`#${a_(this.r)}${a_(this.g)}${a_(this.b)}${a_(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:n_,toString:n_})),kx(u_,(function(e,t,n,r){return 1===arguments.length?s_(e):new u_(e,t,n,null==r?1:r)}),Fx(zx,{brighter(e){return e=null==e?Nx:Math.pow(Nx,e),new u_(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Cx:Math.pow(Cx,e),new u_(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new e_(l_(e>=240?e-240:e+120,i,r),l_(e,i,r),l_(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new u_(c_(this.h),f_(this.s),f_(this.l),r_(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=r_(this.opacity);return`${1===e?"hsl(":"hsla("}${c_(this.h)}, ${100*f_(this.s)}%, ${100*f_(this.l)}%${1===e?")":`, ${e})`}`}}));const d_=Math.PI/180,p_=180/Math.PI;var h_=-.14861,g_=1.78277,m_=-.29227,y_=-.90649,v_=1.97294,b_=v_*y_,x_=v_*g_,__=g_*m_-y_*h_;function w_(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof S_)return new S_(e.h,e.s,e.l,e.opacity);e instanceof e_||(e=Qx(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(__*r+b_*t-x_*n)/(__+b_-x_),a=r-i,o=(v_*(n-i)-m_*a)/y_,s=Math.sqrt(o*o+a*a)/(v_*i*(1-i)),u=s?Math.atan2(o,a)*p_-120:NaN;return new S_(u<0?u+360:u,s,i,e.opacity)}(e):new S_(e,t,n,null==r?1:r)}function S_(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}kx(S_,w_,Fx(zx,{brighter(e){return e=null==e?Nx:Math.pow(Nx,e),new S_(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Cx:Math.pow(Cx,e),new S_(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*d_,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new e_(255*(t+n*(h_*r+g_*i)),255*(t+n*(m_*r+y_*i)),255*(t+n*(v_*r)),this.opacity)}}));var A_=e=>()=>e;function I_(e,t){return function(n){return e+n*t}}function M_(e){return 1==(e=+e)?E_:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):A_(isNaN(t)?n:t)}}function E_(e,t){var n=t-e;return n?I_(e,n):A_(isNaN(e)?t:e)}var P_=function e(t){var n=M_(t);function r(e,t){var r=n((e=Kx(e)).r,(t=Kx(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=E_(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);var j_,O_=(j_=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return function(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}((n-r/t)*t,o,i,a,s)}},function(e){var t,n,r=e.length,i=new Array(r),a=new Array(r),o=new Array(r);for(t=0;t<r;++t)n=Kx(e[t]),i[t]=n.r||0,a[t]=n.g||0,o[t]=n.b||0;return i=j_(i),a=j_(a),o=j_(o),n.opacity=1,function(e){return n.r=i(e),n.g=a(e),n.b=o(e),n+""}});function k_(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function F_(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=D_(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function z_(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function C_(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function N_(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=D_(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var T_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,L_=new RegExp(T_.source,"g");function B_(e,t){var n,r,i,a=T_.lastIndex=L_.lastIndex=0,o=-1,s=[],u=[];for(e+="",t+="";(n=T_.exec(e))&&(r=L_.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,u.push({i:o,x:C_(n,r)})),a=L_.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function D_(e,t){var n,r=typeof t;return null==t||"boolean"===r?A_(t):("number"===r?C_:"string"===r?(n=Hx(t))?(t=n,P_):B_:t instanceof Hx?P_:t instanceof Date?z_:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?k_:Array.isArray(t)?F_:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?N_:C_)(e,t)}function U_(e){return function t(n){function r(t,r){var i=e((t=w_(t)).h,(r=w_(r)).h),a=E_(t.s,r.s),o=E_(t.l,r.l),s=E_(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=o(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}U_((function(e,t){var n=t-e;return n?I_(e,n>180||n<-180?n-360*Math.round(n/360):n):A_(isNaN(e)?t:e)}));var R_=U_(E_);function q_(e,t){for(var n,r=$_(e,null),i=e.length,a=function(e){var t=e[0]/100,n=e[1]/100;return 2!=e.length&&pt("Only two stops are currently supported"),t>=0&&n<=1&&t<n||pt("Invalid gradient stops:",e),function(e){return e*(n-t)+t}}(t),o=[],s=0;s<i;s++)n=r(a(s/(i-1))*(i-1)),o.push(n);return o}function $_(e,t){for(var n=[],r=e.length-1,i=1;i<e.length;i++)n.push(D_(e[i-1],e[i]));return function(e){if(-1==e)return t;!1==(e>=0&&e<=r)&&dt("Range error");var i=e==r?r-1:Math.floor(e),a=e==r?1:e%1;return n[i](a)}}function V_(e,t,n){var r=e.length;return function(i){return i>=0&&i<r?e[i]:-2==i?void 0===n?t:n:t}}function G_(e,t,n){return n.continuous?$_(e,t):V_(e,t,n.other)}function J_(e,t){return{width:t.key_width||"dataviz"==e&&500||300,tileHeight:t.key_tile_height||10,labelSuffix:t.key_label_suffix||"",lastSuffix:t.key_last_suffix||"",chartHeight:90,chartColor:"#ddd",ticColor:"rgba(0,0,0,0.3)",ticLen:t.key_tic_length>=0?+t.key_tic_length:6,fontFamily:"sans-serif",fontSize:t.key_font_size||13,textColor:"#555"}}function W_(e,t,n,r,i){var a,o,s,u=J_("simple",i),c=function(e,t,n){for(var r=[],i=0;i<n.length;i++)r.push(sw(i*e,0,e,t,n[i]));return iw(r)}(u.width/e.length,u.tileHeight,e),f=[c];e.length==t.length+1?(a=nw(t,s=Q_(t.length,u.width),0,u.width,u),o=K_(s,0,u.width,u),f.push(o,a)):e.length==t.length+2&&(u.ticLen=2,a=function(e,t){var n,r=[],i=Z_(e,t);ew(t);for(var a=0;a<i.length;a++)n=(a+.5)*t.width/i.length,r.push(aw(i[a],n,t));return iw(r)}(tw(t,n,r),u),f.push(a)),rw(i.key_name||"simple-key",f,u.width)}function Y_(e,t,n,r){var i=J_("dataviz",r),a=n[0],o=n[n.length-1],s=tw(t,a,o),u=function(e,t){for(var n,r,i=5,a=Math.floor(t.width/i),o=pw(lw(e,a-1),e),s=Math.max.apply(o,o),u=[],c=t.tileHeight,f=0;f<a;f++)(n=o[f])&&(r=n/s*t.chartHeight,u.push(sw(f*i,c,i,r,t.chartColor)));return iw(u)}(n,i),c=function(e,t,n,r,i){for(var a,o,s=tw(t,n,r),u=X_(i.width,n,r),c=[],f=0;f<s.length;f++)a=u(s[f]),o=u(s[f+1])-a,c.push(sw(a,0,o,i.tileHeight,e[f]));return iw(c)}(e,t,a,o,i),f=nw(s,s,a,o,i),l=K_(s,a,o,i);rw(r.key_name||"dataviz-key",[u,c,l,f],i.width)}function H_(e,t,n,r,i){var a=J_("gradient",i),o=function(e,t,n){for(var r=[],i=function(e,t){var n=e.length-1,r=t/n;return function(t){var i=Math.min(Math.floor(t/r),n-1),a=(t-i*r)/r;return e[i]*(1-a)+e[i+1]*a}}(t,n.width),a=2,o=0;o<n.width;o+=a)r.push(sw(o,0,a,n.tileHeight,e(i(o))));return iw(r)}(e,tw(t,n,r),a),s=Q_(t.length,a.width),u=nw(t,s,0,a.width,a),c=[o,K_(s,0,a.width,a),u];rw(i.key_name||"gradient-key",c,a.width)}function X_(e,t,n){return function(r){return(r-t)/(n-t)*e}}function Z_(e,t){var n=function(e){var t=e[0],n=e[e.length-1],r=(n-t)/e.length,i=0;r<1?i=2:r<10&&(i=1);return i}(e);return e.map((function(r,i){var a=i==e.length-1&&t.lastSuffix||t.labelSuffix||"";return Cf(r,n)+a}))}function Q_(e,t){for(var n=[],r=0;r<e;r++)n.push((r+1)/(e+1)*t);return n}function K_(e,t,n,r){for(var i=X_(r.width,t,n),a=[],o=0;o<e.length;o++)a.push(ow(i(e[o]),r));return iw(a)}function ew(e){return e.labelSuffix?3:0}function tw(e,t,n){return[t].concat(e,n)}function nw(e,t,n,r,i){for(var a=Z_(e,i),o=X_(i.width,n,r),s=[],u=0;u<t.length;u++)s.push(aw(a[u],o(t[u]),i));return iw(s)}function rw(e,t,n){var r={width:n,crisp_paths:!0,default_linecap:"butt"},i=e+(e.endsWith(".svg")?"":".svg"),a=mg(1==t.length?t[0]:Ea(t),r);a[0].filename=i,Zc(a,{})}function iw(e){return By({type:"FeatureCollection",features:e})}function aw(e,t,n){var r,i=-(n.ticLen+.7*n.fontSize+4);return t<=0?r="start":t>=n.width?r="end":(r="middle",t+=ew(n)),{type:"Feature",properties:{"label-text":e,"font-family":n.fontFamily,"font-size":n.fontSize,"text-anchor":r,fill:n.textColor},geometry:{type:"Point",coordinates:[t,i]}}}function ow(e,t){var n=t.tileHeight,r=t.tileHeight+t.ticLen;return{type:"Feature",properties:{stroke:t.ticColor},geometry:{type:"LineString",coordinates:[[e,n],[e,n-r]]}}}function sw(e,t,n,r,i){var a=function(e,t,n,r){return[[e,t],[e,t+r],[e+n,t+r],[e+n,t],[e,t]]}(e,t,n,r);return{type:"Feature",properties:{fill:i},geometry:{type:"Polygon",coordinates:[a]}}}function uw(e,n,r,i,a){var o,s,u,c,f=e.length,l=(a.continuous?f-1:f)-1,d=a.precision?Lf(a.precision):null;d&&(r=r.map(d));var p,h=(p=r.filter(t.isFiniteNumber),t.genericSort(p,!0),p);a.range&&(h=function(e,t){var n=t[0],r=t[1];r>n==!1&&pt("Invalid data range:",t);var i=e.map((function(e){return e<n&&(e=n),e>r&&(e=r),e}));i[0]<n&&i.unshift(n);i[i.length-1]<r&&i.push(r);return i}(h,a.range));var g=r.length-h.length,m=h[0],y=h[h.length-1],v=a.range?function(e){return e<a.range[0]&&(e=a.range[0]),e>a.range[1]&&(e=a.range[1]),e}:null;return a.range&&(m=a.range[0],y=a.range[1]),0===l?o=[]:a.breaks?o=a.breaks:"equal-interval"==i?o=lw(h,l):"quantile"==i?o=dw(h,l):"hybrid"==i?o=function(e,t){var n=dw(e,t);if(t<3)return n;var r=n[0],i=n[n.length-1],a=e.filter((function(e){return e>=r&&e<i})),o=lw(a,t-2),s=[r].concat(o).concat(i);return s}(h,l):"nice"==i?gt("Nice breaks:",o=Mx(h,l)):pt("Unknown classification method:",i),function(e,t,n){var r=pw(t,e),i=function(e,t){for(var n,r,i,a,o=[],s=0,u=0;s<=e.length;s++)(n=cw(t,r=0===s?-1/0:e[s-1],i=s<e.length?e[s]:1/0,u))?(a=[t[n[0]],t[n[1]]],u=n[1]):a=0===s?[i,i]:s<e.length?[r,i]:[r,r],o.push(a);return o}(t,e).map((function(e,t){return[`${e[0]} - ${e[1]}`,`(${r[t]})`]}));i.push(["null or non-numeric values",`(${n})`]),gt("Data ranges and (feature counts):\n"+At(i,["left","right"]))}(h,o,g),u=a.continuous?function(e,n,r){return function(i){var a,o,s=e.length;if(!t.isValidNumber(i)||i<n||i>r)return-1;for(var u=0;u<=s;u++)if(o=u===s?r:e[u],u===s||i<o)return u+(i-(a=0===u?n:e[u-1]))/(o-a);dt("Range error")}}(o,m,y):fw(o,d),c=G_(e,n,a),s=function(e){return v&&(e=v(e)),c(u(e))},a.colors&&(a.key||a.key_style)&&("gradient"==a.key_style&&a.continuous?H_(s,o,m,y,a):"dataviz"==a.key_style?Y_(e,o,h,a):(a.key||"simple"==a.key_style)&&W_(e,o,m,y,a)),s}function cw(e,t,n,r){for(var i,a=e.length,o=-1,s=-1;r<a&&!((i=e[r])>=n);)-1==o&&i>=t&&(o=r),s=r,r++;return o>-1&&s>-1?[o,s]:null}function fw(e,n){var r,i=!1;return hw(r=e,t.genericSort(r.map(parseFloat)))||(!function(e){return hw(e,t.genericSort(e.map(parseFloat),!1))}(e)?pt("Invalid class breaks:",e.join(",")):(e=e.concat().reverse(),i=!0)),function(t){var r=-1;return Number(t)===t&&(n&&(t=t(n)),r=gw(t,e)),i&&r>-1&&(r=e.length-r),r}}function lw(e,t){var n,r=t+1,i=e[0],a=(e[e.length-1]-i)/r,o=[];for(n=1;n<r;n++)o.push(i+n*a);return o}function dw(e,t){var n,r,i=t+1,a=e.length/i,o=[];for(n=1;n<i;n++)r=Math.floor(n*a),o.push(e[r]);return o}function pw(e,n){var r=t.initializeArray(new Array(e.length+1),0);return n.forEach((function(t){var n=gw(t,e);-1==n?dt("Indexing error"):r[n]++})),r}function hw(e,t){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return e.length==t.length}function gw(e,n){var r=0;if(!t.isValidNumber(e))return-1;for(;r<n.length&&e>=n[r];)r++;return r}function mw(e,t,n){var r=n.categories,i=V_(e,t,n.other);return function(e){var t=r.indexOf(e);return i(t>=0?t:e?-2:-1)}}function yw(e,n){var r=arguments[2]||{},i=!r.reusable,a=n.size(),o=new Int32Array(a),s=new Int32Array(a);return t.initializeArray(o,-1),t.initializeArray(s,-1),tr(e,(function(e){var t=Lt(e.arcId),n=e.shapeId,r=o[t];-1==r?o[t]=n:n<r?(s[t]=r,o[t]=n):s[t]=n})),function(e){return function(t){return function(e,t){var n,a=Lt(e),u=o[a],c=s[a];return-1==u||null===(n=t(u,c))||!1===n?null:(i&&(o[a]=-1,s[a]=-1),r.filter&&!r.filter(u,c)?null:n)}(t,e)}}}var vw=Object.freeze({__proto__:null,getArcClassifier:yw});function bw(e,t){var n,r,i,a=yw(e.shapes,t,{reusable:!0})((function(e,t){return-1==t?-1:e==n?t:e}));function o(e){var t=a(e);-1!=t&&(i?i(t,e):-1==r.indexOf(t)&&r.push(t))}return function(t,a){if(n=t,!a)return r=[],Qn(e.shapes[t],o),r;i=a,Qn(e.shapes[t],o),i=null}}function xw(e,t){var n=yw(e,t)((function(e,t){return t>-1&&e>-1?[e,t]:null})),r=[],i={};return Qn(e,(function(e){var t,a=n(e);a&&(t=a.join("~"))in i==!1&&(r.push(a),i[t]=!0)})),r}var _w=Object.freeze({__proto__:null,getNeighborLookupFunction:bw,findPairsOfNeighbors:xw});function ww(e,n,r){ci(e);var i,a,o,s=bw(e,n.arcs),u=0,c=t.range(ti(e)).map((function(e){var t=s(e)||[];return{nabes:t,colorId:-1,nabeColors:[],uncolored:t.length,saturation:0,common:0}})),f=(i=r.length,a=t.range(i),o=new Uint32Array(i),function(e){return e>=0&&e<i?(o[e]++,t.sortArrayIndex(a,o,!0)):void 0!==e&&dt("Unexpected color index:",e),a}),l=f(),d=function(e){var n=e.concat();function r(t){for(var r;n.length>0;)t(r=n.pop()),Sw(r,n,e)}return t.sortOn(n,"uncolored",!0),{forEach:r}}(c);return d.forEach((function(e){var t=function(e,t,n){for(var r,i=0;i<n.length;i++)if(Mw(e,t,r=n[i]))return r;return-1}(e,c,l);-1==t&&(u++,t=l[0]),e.colorId=t,l=f(t)})),u>0&&gt(`Unable to find non-adjacent colors for ${u} ${1==u?"polygon":"polygons"}`),function(e){return r[c[e].colorId]}}function Sw(e,t,n){for(var r,i=e.nabes,a=0;a<i.length;a++)(r=n[i[a]]).colorId>-1||Aw(r,e.colorId,t)}function Aw(e,t,n){var r,i=function(e,t){var n,r=0,i=t.length;for(;i-r>50;)t[n=Math.floor((r+i)/2)].saturation>=e.saturation?i=n:r=n;return t.indexOf(e,r)}(e,n),a=n.length;for(-1==i&&dt("Indexing error"),e.uncolored--,e.nabeColors.includes(t)?e.common++:(e.saturation++,e.nabeColors.push(t));++i<a&&Iw(e,r=n[i]);)n[i-1]=r,n[i]=e}function Iw(e,t){return e.saturation>t.saturation||!(e.saturation<t.saturation)&&(e.common>t.common||!(e.common<t.common)&&e.uncolored<t.uncolored)}function Mw(e,t,n){for(var r=e.nabes,i=0;i<r.length;i++)if(t[r[i]].colorId===n)return!1;return!0}function Ew(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}var Pw=Ew("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),jw=Ew("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),Ow=Ew("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),kw=Ew("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Fw=Ew("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),zw=Ew("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Cw=Ew("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),Nw=Ew("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Tw=Ew("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),Lw=Ew("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),Bw=e=>O_(e[e.length-1]),Dw=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(Ew),Uw=Bw(Dw),Rw=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(Ew),qw=Bw(Rw),$w=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(Ew),Vw=Bw($w),Gw=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(Ew),Jw=Bw(Gw),Ww=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Ew),Yw=Bw(Ww),Hw=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(Ew),Xw=Bw(Hw),Zw=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(Ew),Qw=Bw(Zw),Kw=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Ew),eS=Bw(Kw),tS=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(Ew),nS=Bw(tS),rS=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Ew),iS=Bw(rS),aS=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Ew),oS=Bw(aS),sS=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Ew),uS=Bw(sS),cS=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Ew),fS=Bw(cS),lS=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Ew),dS=Bw(lS),pS=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Ew),hS=Bw(pS),gS=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Ew),mS=Bw(gS),yS=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Ew),vS=Bw(yS),bS=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Ew),xS=Bw(bS),_S=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Ew),wS=Bw(_S),SS=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Ew),AS=Bw(SS),IS=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Ew),MS=Bw(IS),ES=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Ew),PS=Bw(ES),jS=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Ew),OS=Bw(jS),kS=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Ew),FS=Bw(kS),zS=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Ew),CS=Bw(zS),NS=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Ew),TS=Bw(NS),LS=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Ew),BS=Bw(LS);var DS=R_(w_(300,.5,0),w_(-240,.5,1)),US=R_(w_(-100,.75,.35),w_(80,1.5,.8)),RS=R_(w_(260,.75,.35),w_(80,1.5,.8)),qS=w_();var $S=Kx(),VS=Math.PI/3,GS=2*Math.PI/3;function JS(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}var WS,YS=JS(Ew("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),HS=JS(Ew("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),XS=JS(Ew("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),ZS=JS(Ew("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921")),QS=Object.freeze({__proto__:null,schemeCategory10:Pw,schemeAccent:jw,schemeDark2:Ow,schemePaired:kw,schemePastel1:Fw,schemePastel2:zw,schemeSet1:Cw,schemeSet2:Nw,schemeSet3:Tw,schemeTableau10:Lw,interpolateBrBG:Uw,schemeBrBG:Dw,interpolatePRGn:qw,schemePRGn:Rw,interpolatePiYG:Vw,schemePiYG:$w,interpolatePuOr:Jw,schemePuOr:Gw,interpolateRdBu:Yw,schemeRdBu:Ww,interpolateRdGy:Xw,schemeRdGy:Hw,interpolateRdYlBu:Qw,schemeRdYlBu:Zw,interpolateRdYlGn:eS,schemeRdYlGn:Kw,interpolateSpectral:nS,schemeSpectral:tS,interpolateBuGn:iS,schemeBuGn:rS,interpolateBuPu:oS,schemeBuPu:aS,interpolateGnBu:uS,schemeGnBu:sS,interpolateOrRd:fS,schemeOrRd:cS,interpolatePuBuGn:dS,schemePuBuGn:lS,interpolatePuBu:hS,schemePuBu:pS,interpolatePuRd:mS,schemePuRd:gS,interpolateRdPu:vS,schemeRdPu:yS,interpolateYlGnBu:xS,schemeYlGnBu:bS,interpolateYlGn:wS,schemeYlGn:_S,interpolateYlOrBr:AS,schemeYlOrBr:SS,interpolateYlOrRd:MS,schemeYlOrRd:IS,interpolateBlues:PS,schemeBlues:ES,interpolateGreens:OS,schemeGreens:jS,interpolateGreys:FS,schemeGreys:kS,interpolatePurples:CS,schemePurples:zS,interpolateReds:TS,schemeReds:NS,interpolateOranges:BS,schemeOranges:LS,interpolateCividis:function(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-2710.57*e)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-67.37*e)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-2475.67*e)))))))+")"},interpolateCubehelixDefault:DS,interpolateRainbow:function(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return qS.h=360*e-100,qS.s=1.5-1.5*t,qS.l=.8-.9*t,qS+""},interpolateWarm:US,interpolateCool:RS,interpolateSinebow:function(e){var t;return e=(.5-e)*Math.PI,$S.r=255*(t=Math.sin(e))*t,$S.g=255*(t=Math.sin(e+VS))*t,$S.b=255*(t=Math.sin(e+GS))*t,$S+""},interpolateTurbo:function(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-14825.05*e)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+707.56*e)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-6838.66*e)))))))+")"},interpolateViridis:YS,interpolateMagma:HS,interpolateInferno:XS,interpolatePlasma:ZS}),KS={categorical:[],sequential:[],rainbow:[],diverging:[],all:[]};function eA(){WS||(WS={},nA("categorical","Category10,Accent,Dark2,Paired,Pastel1,Pastel2,Set1,Set2,Set3,Tableau10"),nA("sequential","Blues,Greens,Greys,Purples,Reds,Oranges,BuGn,BuPu,GnBu,OrRd,PuBuGn,PuBu,PuRd,RdPu,YlGnBu,YlGn,YlOrBr,YlOrRd"),nA("rainbow","Cividis,CubehelixDefault,Rainbow,Warm,Cool,Sinebow,Turbo,Viridis,Magma,Inferno,Plasma"),nA("diverging","BrBG,PRGn,PRGn,PiYG,PuOr,RdBu,RdGy,RdYlBu,RdYlGn,Spectral"),function(){function e(e){e.forEach((function(e){QS["scheme"+e]||gt("Warning: missing data for",e)}))}function t(e){e.forEach((function(e){QS["interpolate"+e]||gt("Missing interpolator for",e)}))}e(KS.categorical),e(KS.sequential),e(KS.diverging),t(KS.sequential),t(KS.rainbow),t(KS.diverging)}(),rA("Category20","1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),rA("Category20b","393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),rA("Category20c","3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),rA("Tableau20","4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"),KS.all=[].concat(KS.sequential,KS.rainbow,KS.diverging,KS.categorical))}function tA(e){if(!e)return null;for(var t=e.toLowerCase(),n=0;n<KS.all.length;n++)if(KS.all[n].toLowerCase()==t)return KS.all[n];return null}function nA(e,t){KS[e]=KS[e].concat(t.split(","))}function rA(e,t){KS.categorical.push(e),WS[e]=function(e){for(var t=[],n=0,r=e.length;n<r;n+=6)t.push("#"+e.substr(n,6));return t}(t)}function iA(e,t){var n;return eA(),oA(e=tA(e))?n=sA(e)?WS[e]||QS["scheme"+e]:uA(e,t):pt("Unknown color scheme name:",e),t>n.length?(gt("Color scheme has",n.length,"colors. Using duplication to match",t,"categories."),n=aA(n,t)):n=n.slice(0,t),n}function aA(e,t){for(;e.length>0&&e.length<t;)e=e.concat(e.slice(0,t-e.length));return e}function oA(e){return eA(),KS.all.includes(tA(e))}function sA(e){return eA(),KS.categorical.includes(tA(e))}function uA(e,n,r){eA(),e=tA(e);var i,a=QS["scheme"+e],o=QS["interpolate"+e];return a||o||pt("Unknown color scheme name:",e),KS.categorical.includes(e)&&pt(e," is a categorical color scheme (expected a sequential color scheme)"),i=a&&a[n]?a[n]:function(e,n){n>0!=!1&&t.isInteger(n)||dt("Expected a positive integer");for(var r=[],i=0;i<n;i++)r.push(e(i/(n-1)));return r}(o,n),r&&(i=q_(i,r)),i}function cA(e){return"null_value"in e?function(e){t.isString(e)&&!isNaN(+e)&&(e=+e);"null"===e&&(e=null);return e}(e.null_value):e.colors?"#eee":e.values?null:-1}function fA(e,n,r){var i,a="categorical"==e||"non-adjacent"==e,o=r.colors&&1==r.colors.length?r.colors[0]:null;if("blacki"==e)return[];if("random"==o){if(a)return function(e){eA();var n=iA("Tableau20",20);return t.shuffle(n),(n=aA(n,e)).slice(0,e)}(n);gt("Randomly selected color ramp:",i=function(e){eA();var t=KS[e];return t||dt("Unknown color scheme type:",e),t[Math.floor(Math.random()*t.length)]}("sequential"))}else oA(o)?i=o:o&&!ul(o)?pt("Unrecognized color scheme name:",o):r.colors&&r.colors.forEach(cl);return i?a&&sA(i)?iA(i,n):uA(i,n,r.stops):r.colors||r.values?a?function(e,t){t!=e.length&&pt("Mismatch in number of categories and number of values");return e}(r.colors||r.values,n):function(e,n,r){var i=function(e){var n=e;e.every(t.parseNumber)&&(n=e.map((function(e){return+e})));return n}(e);if(n!=i.length||r.stops)return function(e,t,n){if(e.length==t&&!n)return e;for(var r,i,a,o,s=e.length-1,u=[e[0]],c=1;c<t-1;c++)a=(r=c/(t-1)*s)-(i=Math.floor(r)),o=D_(e[i],e[i+1])(a),u.push(o);return u.push(e[e.length-1]),n&&(u=q_(u,n)),u}(i,n,r.stops);return i}(r.colors||r.values,n,r):function(e){for(var t=[],n=0;n<e;n++)t.push(n);return t}(n)}var lA=["quantile","nice","equal-interval","hybrid","breaks"],dA=["non-adjacent","indexed","categorical","blacki"].concat(lA);function pA(e,t,n,r){var i=new sf(t,n.arcs);return e.map((function(e){return function(e){var t=null;e&&(t=e.reduce(a,[]));return t&&t.length>0?t:null}(e)}));function a(e,t){for(var n,a,o=null,s=0;s<t.length;s++)n=t[s],(a=i.arcIsEnclosed(n))&&"clip"==r||!a&&"erase"==r?(o||e.push(o=[]),o.push(n)):o=null;return e}}td.classify=function(e,n,r){e.data||xi(e);var i,a,o,s,u,c,f,l,d,p,h=r||{},g=e.data&&e.data.getRecords(),m=!!h.colors;h.color_scheme&&pt("color-scheme is not a valid option, use colors instead"),h.index_field?(i=h.index_field,a=Cr(h.field,g)):h.field&&(i=h.field,a=Cr(h.field,g)),i&&ri(e.data,i),p=function(e,t){var n;if(e.method)n=e.method;else if(e.breaks)n="breaks";else if(e.index_field)n="indexed";else if(e.categories||"string"==t)n="categorical";else if("number"==t)n="quantile";else if("date"==t||"object"==t)pt("Data type does not support classification:",t);else{if(null===t)return null;pt(void 0===t?"Expected a data field to classify or the non-adjacent option":"Unable to determine which classification method to use.")}return dA.includes(n)||pt("Not a recognized classification method:",n),lA.includes(n)&&"number"!=t&&null!==t&&pt("The",n,"method requires a numerical data field"),n}(h,a),"non-adjacent"==p?("polygon"!=e.geometry_type&&pt("The non-adjacent option requires a polygon layer"),i&&pt("The non-adjacent option does not accept a data field argument")):i||pt("Missing a data field to classify"),"categorical"==p&&(h.categories&&!h.categories.includes("*")||!i||(h.categories=Dr(g,i))),h.classes?(t.isInteger(h.classes)&&h.classes>1!=!1||pt("Invalid number of classes:",h.classes,"(expected a value greater than 1)"),l=h.classes):l="blacki"==p?999:"indexed"==p&&i?function(e,n){var r=[],i=-1;return e.forEach((function(e){var a=(e||{})[n];!t.isInteger(a)||a<-2?r.push(a):i=Math.max(i,a)})),r.length>0&&pt(`Class index field contains invalid value(s): ${r.slice(0,5)}`),i+1}(g,i):h.breaks?h.breaks.length+1:"categorical"==p&&h.categories?h.categories.length:h.colors&&h.colors.length>1?h.colors.length:h.values&&h.values.length>1?h.values.length:"non-adjacent"==p?5:4,(d=h.continuous?l+1:l)>1==!1&&pt("Missing a valid number of values"),s=fA(p,d,h),h.invert&&(s=s.concat().reverse()),m&&gt("Colors:",function(e){if(e.some((e=>t.isString(e)&&0===e.indexOf("rgb("))))return function(e){return e.map((function(e){var t=Hx(e);return t||pt("Unable to parse color:",e),t.formatHex()}))}(e);return e}(s)),u=cA(h),null===a?f=function(){return u}:"blacki"==p?f=function(e,n){var r=e.data.getRecords(),i={},a=[],o=0;r.forEach((function(e,t){var r,s,u=e[n],c=-1;if(Array.isArray(u))for(var l=0;l<u.length;l++)-1==(r=(s=u[l])in i?i[s]:-1)?(-1==c&&(c=o++),Array.isArray(a[c])?a[c].includes(s)||a[c].push(s):a[c]=[s],i[s]=c):-1==c?c=r:c>r?(f(c,r),c=r):c<r&&f(r,c)}));var s,u=(s=-1,a.map((function(e,t){return null!==e&&s++,s}))),c=r.map((function(e){var t=e[n];return Array.isArray(t)&&0!==t.length?(t[0]in i==0&&dt("Internal error"),u[i[t[0]]]):-1}));return a=null,i=null,function(e){return c[e]};function f(e,n){a[e].forEach((function(e){i[e]=n})),a[n]=t.uniq(a[n].concat(a[e])),a[e]=null}}(e,i):"non-adjacent"==p?f=ww(e,n,s):c="indexed"==p?function(e,n,r){var i=e.length,a=G_(e,n,r);return function(e){var n=t.isInteger(e)&&e>=0&&e<i?e:-1;return a(n)}}(s,u,h):"categorical"==p?mw(s,u,h):uw(s,u,Br(g,i),p,h),c&&(f=function(e){var t=g[e]||{};return c(t[i])}),o=m?"polyline"==e.geometry_type?"stroke":"fill":"class",h.save_as?o=h.save_as:gt(`Output was saved to "${o}" field (use save-as= to change)`),g.forEach((function(e,t){e[o]=f(t)}))},td.filterSlivers=function(e,n,r){return"polygon"!=e.geometry_type?0:function(e,n,r){var i=t.extend({sliver_control:1},r),a=el(e,n,i),o=a.filter,s=0,u=function(e,t,n){if(o(e))return s++,null};return cr(e.shapes,u),gt(t.format("Removed %'d sliver%s using %s",s,t.pluralSuffix(s),a.label)),s}(e,n,r)};var hA=Object.freeze({__proto__:null,clipPolylines:pA});function gA(e,t){t=t&&!e.arcs.isPlanar();var n=new Uint8Array(e.arcs.size()),r=kd(e,t),i=kf(e,n);return function(t){if(!t)return null;var n=[],a=[];r(t,n,a),n=i(n,"flatten"),a.forEach(Hn),(a=i(a,"flatten")).forEach(Hn);var o=function(e,t){for(var n=0,r=t.length;n<r;n++)e.push(t[n]);return e}(n,a),s=i(o,"dissolve");return s.length>1&&(s=function(e,t){if(e.length<=1)return e;var n=ir(e,t,"polygon"),r=new sf(e.map((function(e){return[e]})),t);return e.filter((function(e,t){var i,a=r.findSmallestEnclosingPolygon(e),o=!0;return a>-1&&(i=n[t].area>0,n[a].area>0==i&&(o=!1)),o}))}(s,e.arcs)),s.length>0?s:null}}function mA(e,t,n,r,i){var a=n.arcs,o=i||{},s=new Uint8Array(a.size()),u=new Uint8Array(a.size()),c=0,f=0,l=[],d=Of(n,(function(e){var t,n,i=e>=0,a=i?e:~e,o=u[a],c=s[a];i?(t=o,n=c):(t=o>>4,n=c>>4);n&=3;var d=!1;3==(t&=3)?1==n||2==n&&"erase"==r||(d=!0):0===t&&3==n&&(l.push(e),d=!0);d&&(3==n&&f++,o=i?Af(o,1,3):Af(o,16,48));return o|=i?4:64,u[a]=o,d}),(function(e){var t=e>=0,n=t?e:~e,r=t?1:16,i=u[n],a=s[n];a>0&&c++;return(i&r)>0||(a&r)>0})),p=gA(n);o.bbox2||(e=e.map(p)),Pf(t,a,s,"clip"==r,"erase"==r,!0,17);var h=new sf(t,a),g=e.map((function(e,t){return e?function(e,t,n){var r=[],i="clip"==t,o="erase"==t;Pf(e,a,u,!0,!1,!1),ur(e,(function(e){for(var t,a=0,s=e.length;a<s;a++)if(c=0,f=0,t=d(e[a]))if(0===c||0===f){var u=n.pathIsEnclosed(t);(i&&u||o&&!u)&&r.push(t)}else r.push(t)})),jf(e,0,u,!0,!0,!0),l.length>0&&(jf(l,0,u,!0,!0,!0),l=[]);return 0===r.length?null:r}(e,r,h):null}));Ef(g,u);var m=function(e){return e.map((function(e){var t=[];return ur(e,(function(e){for(var n,r,i,a=!0,o=!1,c=0;c<e.length;c++){if(n=e[c],r=u,i=void 0,void 0,i=Lt(n),0!=(136&r[i])){a=!1;break}!o&&y(e[c],s)&&(o=!0)}a&&o&&t.push(e)})),t.length>0?t:null}))}(t);return jf(t,0,u,!0,!0),h=new sf(m,a),e.forEach((function(e,t){var n=e?function(e,t,n){var r=n.findPathsInsideShape(e),i=[];if(!r)return null;"erase"==t&&r.forEach(Hn);r.length<=1?i=r:(Pf(r,a,u,!0,!1,!0),r.forEach((function(e){for(var t,n=0;n<e.length;n++)(t=d(e[n]))&&i.push(t)})));return i.length>0?i:null}(e,r,h):null;n&&(g[t]=(g[t]||[]).concat(n))})),g;function y(e,t){return(17&t[Lt(e)])>0}}function yA(e,t,n,r){var i=new sf(t,n),a=e.reduce((function(e,t){for(var n,a=t?t.length:0,o=[],s=0;s<a;s++)n=i.findEnclosingShape(t[s])>-1,("clip"==r&&n||"erase"==r&&!n)&&o.push(t[s].concat());return e.push(o.length>0?o:null),e}),[]);return a}var vA=Object.freeze({__proto__:null,clipPoints:yA});function bA(e,n,r,i){t.some(e,Zr);var a,o,s,u=i.bbox||i.bbox2;return r&&r.geometry_type&&(r={dataset:n,layer:r,disposable:!0}),u?(o=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=[[t,n],[t,i],[r,i],[r,n],[t,n]];i>n&&r>t||pt("Invalid bbox (should be [xmin, ymin, xmax, ymax]):",e);return{arcs:new ma([a]),layers:[{shapes:[[[0]]],geometry_type:"polygon"}]}}(u),s=o.layers[0]):r?r.layer&&r.dataset?(s=r.layer,o=t.defaults({layers:[s]},r.dataset)):r.layers&&1==r.layers.length&&(s=r.layers[0],o=r):pt("Command requires a source file, layer id or bbox"),n.arcs!=o.arcs?(r&&!r.disposable&&(o.layers[0]=gi(o.layers[0])),_a(a=Ea([n,o]))):((a=t.extend({},n)).layers=n.layers.filter((function(e){return e!=s})),a.layers.push(s)),a}var xA=Object.freeze({__proto__:null,mergeLayersForOverlay:bA});function _A(e,t){var n=e.arcs,r=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=[],s=[],u=[],c=[];return e.forEachSegment((function(e,t,l,d){var p,h=l[e],g=d[e],m=l[t],y=d[t];wA(h,g,m,y,n,r,i,a)||SA(h,g,m,y,n,r,i,a)||((p=$n.segmentIntersection(n,a,i,a,h,g,m,y))&&f(o,p,e,t,l,d),(p=$n.segmentIntersection(n,r,i,r,h,g,m,y))&&f(u,p,e,t,l,d),(p=$n.segmentIntersection(n,r,n,a,h,g,m,y))&&f(c,p,e,t,l,d),(p=$n.segmentIntersection(i,r,i,a,h,g,m,y))&&f(s,p,e,t,l,d))})),{cutPoints:c.concat(u,s,o),bboxPoints:AA(t,c,o,s,u)};function f(e,t,n,r,i,a){t&&(e.push(l(t[0],t[1],n,r,i,a)),4==t.length&&e.push(l(t[2],t[3],n,r,i,a)))}function l(e,t,n,r,i,a){var o=qd(e,t,n,r,i,a);return Xd(e,t,o[0],o[1])}}(n,t),i=Hd(r.cutPoints,n);n.dedupCoords(),Yd(e,i);var a=function(e){for(var t,n,r=[],i=[],a={geometry_type:"polygon",shapes:[[i]]},o=0,s=e.length-1;o<s;o++)t=e[o],n=e[o+1],r.push([[t.x,t.y],[n.x,n.y]]),i.push(o);return{arcs:new ma(r),layers:[a]}}(r.bboxPoints),o=Ea([e,a]),s=o.layers.pop();return e.arcs=o.arcs,e.layers=o.layers,s}function wA(e,t,n,r,i,a,o,s){return e<i&&n<i||e>o&&n>o||t<a&&r<a||t>s&&r>s}function SA(e,t,n,r,i,a,o,s){return e>i&&n>i&&e<o&&n<o&&t>a&&r>a&&t<s&&r<s}function AA(e,n,r,i,a){var o={x:e[0],y:e[1]},s={x:e[0],y:e[3]},u={x:e[2],y:e[3]},c={x:e[2],y:e[1]};return n=t.sortOn(n.concat([o,s]),"y",!0),r=t.sortOn(r.concat([s,u]),"x",!0),i=t.sortOn(i.concat([u,c]),"y",!1),a=t.sortOn(a.concat([c,o]),"x",!1),n.concat(r,i,a).reduce((function(e,t){var n=e.length>0?e[e.length-1]:null;return null!==n&&n.x==t.x&&n.y==t.y||e.push(t),e}),[])}var IA=Object.freeze({__proto__:null,divideDatasetByBBox:_A,segmentOutsideBBox:wA,segmentInsideBBox:SA});function MA(e,t,n,r,i){var a=EA(e,t,n,r,i);e.forEach((function(e,t){var n=a[t];e.shapes=n.shapes,e.data=n.data})),Na(n)}function EA(e,n,r,i,a){var o,s,u,c=t.some(e,Zr);return(a=a||{no_cleanup:!0}).bbox2&&c?PA(e,r,a):(s=(o=bA(e,r,n,a)).layers[o.layers.length-1],c?(u=Vd(o,a),r.arcs=o.arcs,s=fp(s=t.defaults({data:null},s),o,{quiet:!0,silent:!0})):u=new Ca(o.arcs),jA(e,s,u,i,a))}function PA(e,t,n){return jA(e,_A(t,n.bbox2),new Ca(t.arcs),"clip",n)}function jA(e,t,n,r,i){return ci(t,"Requires a polygon clipping layer"),e.reduce((function(e,a){return"slice"==r?e=e.concat(function(e,t,n,r){var i=td.splitLayer(t,r.id_field,{no_replace:!0});return i.map((function(t,i){var a=OA(e,t,n,"clip",r);return a.name=function(e,t,n){var r=t?e.data.getRecords()[0][t]:n+1;return"slice-"+r}(t,r.id_field,i),a}))}(a,t,n,i)):e.push(OA(a,t,n,r,i)),e}),[])}function OA(e,t,n,r,i){var a,o,s,u=n.arcs,c=e.shapes?e.shapes.length:0,f=0;return 0===c?e:(e===t&&pt("Can't clip a layer with itself"),"point"==e.geometry_type?o=yA(e.shapes,t.shapes,u,r):"polygon"==e.geometry_type?o=mA(e.shapes,t.shapes,n,r,i):"polyline"==e.geometry_type?o=pA(e.shapes,t.shapes,n,r):pt("Invalid target layer:",e.name),s={name:e.name,geometry_type:e.geometry_type,shapes:o,data:e.data},i.remove_slivers&&"polygon"==s.geometry_type&&(f=function(e,t,n){var r=tl(n,rl(e,n),1),i=new Uint8Array(n.size()),a=0;return Wn(t.shapes,i),cr(e.shapes,(function(e){for(var t=0,n=0,o=0,s=e&&e.length||0;o<s;o++)i[Lt(e[o])]>0?n++:t++;if(n>0&&t>0&&r(e))return a++,null})),a}(s,t,u)),td.filterFeatures(s,u,{remove_empty:!0,verbose:!1}),s.data&&(s.data=s.data.clone()),(a=c-s.shapes.length)&&f&&gt(kA(a,f)),s)}function kA(e,n){var r=e?t.format("%,d null feature%s",e,t.pluralSuffix(e)):"",i=n?t.format("%,d sliver%s",n,t.pluralSuffix(n)):"";return r||i?t.format("Removed %s%s%s",r,r&&i?" and ":"",i):""}td.clipLayers=function(e,t,n,r){return EA(e,t,n,"clip",r)},td.eraseLayers=function(e,t,n,r){return EA(e,t,n,"erase",r)},td.clipLayer=function(e,t,n,r){return td.clipLayers([e],t,n,r)[0]},td.eraseLayer=function(e,t,n,r){return td.eraseLayers([e],t,n,r)[0]},td.sliceLayers=function(e,t,n,r){return EA(e,t,n,"slice",r)},td.sliceLayer=function(e,t,n,r){return td.sliceLayers([e],t,n,r)};var FA=Object.freeze({__proto__:null,clipLayersInPlace:MA,clipLayers:EA,clipLayersByBBox:PA,clipLayersByLayer:jA,getClipMessage:kA});function zA(e){var t,n=e.nodata||"white",r=e.precision?Lf(e.precision):null;return e.random||e.colors&&e.colors.length||pt("Missing colors= parameter"),e.random?t=function(e){e&&e.length||(e="#ccc,#888,#444".split(","));return function(t){var n=e.length,r=void 0===t?Math.floor(Math.random()*n):function(e){var t=String(e),n=5381,r=t.length;for(;r>0;)n=33*n^t.charCodeAt(--r);return Math.abs(n)}(t)%n;return e[r]}}(e.colors):e.breaks?(e.colors.length!=e.breaks.length+1&&pt("Number of colors should be one more than number of class breaks"),t=function(e,t,n,r){var i=fw(e,r),a=V_(t,n);return function(e){return a(i(e))}}(e.breaks,e.colors,n,r)):e.categories?(e.colors.length!=e.categories.length&&pt("Number of colors should be equal to the number of categories"),t=mw(e.colors,n,e)):pt("Missing categories= or breaks= parameter"),t}td.cluster=function(e,n,r){ci(e);var i=function(e,n,r){var i,a=function(e){var t=e.max_width||1/0,n=e.max_height||1/0,r=e.max_area||1/0;return function(e,i){var a=e.area+i.area,o=$n.distance2D(e.centroid.x,e.centroid.y,i.centroid.x,i.centroid.y),s=e.bounds.clone().mergeBounds(i.bounds);return(a>r||s.width()>t||s.height()>n)&&(o=-1),o}}(r),o=e.shapes.length,s=r.pct?t.parsePercent(r.pct):1,u=Math.round(o*s),c=r.group_by||null,f=e.shapes.map((function(t,r){var i=c&&e.data.getRecordAt(r)[c]||null;return{ids:[r],area:$n.getShapeArea(t,n),bounds:n.getMultiShapeBounds(t),centroid:$n.getShapeCentroid(t,n),group:i,friends:[]}})),l=[],d={};c&&!e.data&&pt("Missing attribute data table");xw(e.shapes,n).forEach((function(e,t){var n,r,i=f[e[0]],a=f[e[1]];i.group===a.group&&((n={ids:e}).score=g(n),n.score<0||(r=l.length,i.friends.push(r),a.friends.push(r),l.push(n)))}));for(;u-- >0&&(i=h());)p(i);return f.filter(Boolean).reduce((function(e,t,n){for(var r=t.ids,i=0;i<r.length;i++)e[r[i]]=n;return e}),[]);function p(e){var t=y(e.ids),n=f.length;f[n]=t,b(t.friends,e.ids,n)}function h(){var e,t,n,r=-1,i=1/0;for(t=0,n=l.length;t<n;t++)null!==(e=l[t])&&e.score<i&&(i=e.score,r=t);return-1==r?null:(e=l[r],l[r]=null,e)}function g(e){return a(f[e.ids[0]],f[e.ids[1]])}function m(e,t){var n=e.area/(e.area+t.area),r=e.centroid,i=t.centroid;r.x=r.x*n+i.x*(1-n),r.y=r.y*n+i.y*(1-n)}function y(e){var t=f[e[0]],n=f[e[1]];return t.bounds.mergeBounds(n.bounds),t.area+=n.area,t.ids=t.ids.concat(n.ids),m(t,n),f[e[0]]=null,f[e[1]]=null,t.friends=v(t.friends.concat(n.friends)),t}function v(e){for(var t,n={},r=[],i=0;i<e.length;i++)(t=e[i])in n==!1&&null!==l[t]&&(r.push(t),n[t]=!0);return r}function b(e,t,n){for(var r,i,a=0,o=e.length;a<o;a++)i=e[a],_((r=l[i]).ids,t)&&(l[i]=x(r,t,n))}function x(e,t,n){var r,i=e.ids[0],a=e.ids[1];return t[0]!=i&&t[1]!=i||(i=n),t[0]!=a&&t[1]!=a||(a=n),i==a?null:(e.ids=[i,a],(r=w(e))in d?null:(d[r]=!0,e.score=g(e),e.score<0?null:e))}function _(e,t){return e[0]===t[0]||e[0]===t[1]||e[1]===t[0]||e[1]===t[1]}function w(e){var t=e.ids[0],n=e.ids[1];return n<t&&(t=n,n=e.ids[0]),t+","+n}}(e,n,r);return Wr(e,r.id_field||"cluster",i),e},td.colorizer=function(e){var t;e.name||pt("Missing required name= parameter"),t=e.name,/^(stroke|stroke-width|stroke-dasharray|stroke-opacity|fill|fill-opacity|opacity|r|class)$/.test(t)&&pt('"'+e.name+'" is a reserved name'),i("defs")[e.name]=zA(e)};var CA=Object.freeze({__proto__:null,getColorizerFunction:zA});function NA(e){return e.includes("this.geojson")}function TA(e,n){var r=!1,i={},a=xp(hi(e),n,{},!0);return i.get=function(e){return a[e]},i.set=function(e,n){r=!0,t.isString(e)&&(e=JSON.parse(e)),a[n]=yp.toFeature(e)},i.done=function(){if(r)return By({type:"FeatureCollection",features:a})},i}function LA(e,t,n,r){var i=t.data.getRecords(),a=UA(e,t,n,r),o=function(e,t){var n=t.data.getRecords();return function(t){var r=n[t];return!!r&&DA(r[e])}}(e,t),s={},u=0;return t.shapes.forEach((function(e,t){if(o(t)){var n=a(t);n.group&&function(e,t){var n,r=t[e.group];if(!r)return void(t[e.group]={shapes:[e.shape],weights:e.weights,values:e.values});r.shapes.push(e.shape);for(var i=0,a=e.values.length;i<a;i++)n=r.values.indexOf(e.values[i]),r.weights[n]+=e.weights[i]}(n,s)}})),Object.keys(s).forEach((function(t){var n,r,a=s[t],o=BA(a);n=a.shapes,r=o,n.forEach((function(t){u++,i[t][e]=r}))})),u>0&&(u+=LA(e,t,n,r)),u}function BA(e){var t=Math.max.apply(null,e.weights),n=e.weights.indexOf(t);return e.values[n]}function DA(e){return!e&&0!==e}function UA(e,t,n,r){var i,a=n.isPlanar(),o=t.data.getRecords();function s(t,r){var s,u,c=o[t][e];DA(c)||(s=$n.calcPathLen([r],n,!a),-1==(u=i.values.indexOf(c))?(i.values.push(c),i.weights.push(s)):i.weights[u]+=s)}return function(e){return i={shape:e,weights:[],values:[],group:""},r(e,s),i.group=i.values.concat().sort().join("~"),i}}function RA(e,t,n){return function(e,t,n){var r=n.layer||n.target||null,a=t.findCommandTargets(r),o=1==a.length&&1==a[0].layers.length;0===a.length&&r&&pt("Layer not found:",r);var s,u=i("defs")||{};s=o?Bl(a[0].layers[0],a[0].dataset.arcs):function(e){var t={},n=Tl(e);return xl(t,{name:r,data:r,type:r,size:r,empty:r,bbox:r}),t.field_exists=r,t.field_type=r,t.field_includes=r,t;function r(){throw Error(`This expression requires a single target layer; Received ${n} layers.`)}}(a);s.global=u;var c=Object.assign({returns:!0},n),f=Wl(e,c);return s.layer_exists=function(e,n){try{if(t.findCommandTargets(e,n).length>0)return!0}catch(e){}return!1},s.file_exists=function(e){return Xc.isFile(e)},function(){try{return f.call(s,u,s)}catch(t){pt(t.name,"in expression ["+e+"]:",t.message)}}}(e,t,n)}function qA(e,n){var r=function(e,t){var n,r,i,a={isMax:function(e){return e===r.max},isMin:function(e){return e===r.min},isMode:function(e){return r.modes.indexOf(e)>-1}};return Object.defineProperty(a,"target",{get:function(){return i},enumerable:!0}),n=Gl(e,{data:t},null,{context:a,returns:!0}),function(e,t,a){return r=a,i=t,n(e)}}(n,e),i=null;return function(e){return t.some(["isMax","isMin","isMode"],(function(t){return e.indexOf(t)>-1}))}(n)&&(i=function(e,t){var n,r,i,a,o;function s(){r=-1/0,i=1/0,n=null}return a={isMax:function(e){e>r&&(r=e)},isMin:function(e){e<i&&(i=e)},isMode:function(e){n||(n=[]),n.push(e)}},o=Gl(e,{data:t},null,{context:a}),function(e){var t;s();for(var a=0;a<e.length;a++)o(e[a]);return t=n?Kl(n):null,{max:r,min:i,modes:t?t.modes:null,margin:t?t.margin:null}}}(n,e)),function(e,t){var n,a,o=i?i(e):null,s=[];for(a=0;a<e.length;a++)!0===(n=r(e[a],t,o))?s.push(e[a]):!1!==n&&pt('"where" expression must return true or false');return s}}td.comment=function(){},td.dashlines=function(e,t,n){var r=Qi(t),a=i("defs");ui(e),a.splitFeature=function(e,t){var n=t.dash_length?Yf(t.dash_length,e):0,r=t.gap_length?Yf(t.gap_length,e):0;n>0==!1&&pt("Missing required dash-length parameter");r>=0==0&&pt("Invalid gap-length option");var i=function(e,t,n,r){var i,a,o,s,u=!!r.planar,c=Ub(u?null:e),f=ta(e)?Qt:Jt;function l(e){i&&a.push(e),n>0&&(o=s*((i=!i)?t:n))}return function(e){var u,d,p,h=0,g=e[0],m=[g];s=r.scaled?function(e,t,n){var r=n/(e+t),i=Math.floor(r),a=Math.ceil(r),o=n/(i*(e+t)),s=n/(a*(e+t)),u=s;o<1/s&&i>0&&(u=o);return u}(t,n,function(e,t){for(var n=0,r=1,i=e.length;r<i;r++)n+=t(e[r-1][0],e[r-1][1],e[r][0],e[r][1]);return n}(e,f)):1,o=s*((i=!(n>0))?t:n),i||(o*=.5),a=[];for(var y=1,v=e.length;y<v;y++)if(p=g,g=e[y],!((u=f(p[0],p[1],g[0],g[1]))<=0)){for(;h+u>=o;)(d=(o-h)/u)>.999&&y==v-1&&(d=1),p=d<1?c(p[0],p[1],g[0],g[1],d):g,m.push(p),l(m),m=d<1?[p]:[],h=0,u*=1-d;m.push(g),h+=u}return h>0&&m.length>1&&l(m),a}}(e,n,r,t);return function(e){var t=e.geometry;return t?("LineString"==t.type&&(t.type="MultiLineString",t.coordinates=[t.coordinates]),"MultiLineString"!=t.type&&dt("Unexpected geometry:",t.type),t.coordinates=t.coordinates.reduce((function(e,t){try{var n=i(t);e=e.concat(n)}catch(e){throw console.error(e),e}return e}),[]),e):e}}(r,n),td.evaluateEachFeature(e,t,"this.geojson = splitFeature(this.geojson)",n),delete a.splitFeature},td.dataFill=function(e,n,r){var i=r.field;i||pt("Missing required field= parameter"),ri(e,i),"polygon"!=e.geometry_type&&pt("Target layer must be polygon type");var a,o,s,u=bw(e,n),c=(s=e.data.getRecords().map((function(e){return DA(e[i])})),function(e){return s[e]});a=LA(i,e,n,u),function(e,t,n,r,i){var a=UA(e,t,n,r),o=t.data.getRecords(),s=0;t.shapes.forEach((function(t,n){if(i(n)){var r=a(n);if(!(r.values.length<2)){var u=o[n][e],c=BA(r);u!=c&&(o[n][e]=c,s++)}}}))}(i,e,n,u,c),r.contiguous&&(o=function(e,t,n,r,i){var a=t.data.getRecords(),o={},s=new Uint8Array(t.shapes.length),u=null,c=0,f=i.weight_field||null;f&&ri(t,f);t.shapes.forEach((function(e,t){d(t)})),Object.keys(o).forEach((function(e){var t,n,r,i=o[e];i.length<2||(n=-1/0,r=-1,i.forEach((function(e,t){e.weight>n&&(r=t,n=e.weight)})),-1!=(t=r)&&i.filter((function(e,n){return n!=t})).forEach(l))})),c>0&&LA(e,t,n,r);return c;function l(t){c++,t.shapes.forEach((function(t){a[t][e]=null}))}function d(i){if(1!=s[i]){var c=a[i][e],l=!1;if(!DA(c)){if(u){if(c!=u.value)return}else l=!0,u={value:c,shapes:[],weight:0},c in o==!1&&(o[c]=[]),o[c].push(u);u.weight+=f?a[i][f]:$n.getShapeArea(t.shapes[i],n),u.shapes.push(i),s[i]=1,r(i).forEach(d),l&&(u=null)}}}}(i,e,n,u,r)),gt("Filled",a,"empty polygons"+t.pluralSuffix(a)),o>0&&gt("Removed",o,"non-contiguous polygon group"+t.pluralSuffix(o))},td.define=function(e,t){t.expression||pt("Missing an assignment expression");var n=i("defs");Gl(t.expression,{},null,{no_warn:!0})(null,n)},td.dissolve2=function(e,t,n){return e.forEach(ci),Vd(t,n),e.map((function(e){return Zr(e)?fp(e,t,n):e}))};var $A=Object.freeze({__proto__:null,getJoinFilter:qA});function VA(e,t,n,r){return GA({data:e},t,n,r)}function GA(e,n,r,i){var a,o,s,u,c,f,l,d,p,h,g,m,y,v=e.data,b=!!i.duplication,x=n.getRecords(),_=v.getRecords(),w=i.prefix||"",S=[],A=ZA(v.getFields(),n.getFields(),i),I=i.sum_fields||[],M=t.difference(A,I),E=new Uint32Array(x.length),P=0,j=0,O=[],k=0,F={};for(b&&(i.calc&&pt("duplication and calc options cannot be used together"),m=v.clone().getRecords(),y=e.shapes||[]),i.where&&(f=qA(n,i.where)),i.calc&&(l=od(n,i.calc)),h=_.length,d=0;d<h;d++){for(s=_[d],(u=r(d))&&f&&(k+=u.length,k-=(u=f(u,s)).length),p=0,c=0,g=u?u.length:0;p<g;p++)a=x[o=u[p]],c>0&&b&&(s=Or(m[d]),_.push(s),y.push(or(y[d]))),0===c||b?M.length>0&&YA(s,a,M,w):1==c&&(M.length>0&&!w&&XA(s,a,M,O),j++),I.length>0&&HA(s,a,I,w),E[o]++,c++;l&&l(u,s),c>0?P++:s&&(i.unmatched&&S.push(t.extend({},s)),WA(s,M,I,w))}return function(e,n,r,i,a,o,s){var u=n-e;if(e>0==!1)return void gt("No records could be joined");gt(t.format("Joined data from %'d source record%s to %'d target record%s",r,t.pluralSuffix(r),e,t.pluralSuffix(e))),u>0&&gt(t.format("%d target record%s received no data",u,t.pluralSuffix(u)));r<i&&gt(t.format("%d/%d source records could not be joined",i-r,i));a>0&&gt(t.format("%d/%d source records were skipped",a,i));o>0&&(gt(t.format("%d/%d target records were matched by multiple source records (many-to-one relationship)",o,n)),s.length>0&&gt(t.format("Inconsistent values were found in field%s [%s] during many-to-one join. Values in the first joining record were used.",t.pluralSuffix(s.length),s.join(","))))}(P,h,function(e){for(var t=0,n=0,r=e.length;n<r;n++)e[n]>0&&t++;return t}(E),x.length,k,j,O),i.unjoined&&(F.unjoined={name:"unjoined",data:new Jr(x.filter((function(e,t){return 0===E[t]})))}),i.unmatched&&(F.unmatched={name:"unmatched",data:new Jr(S)}),F}function JA(e){e.forEach((function(e){/:(str|num)/.test(e)&&pt("Unsupported use of type hints. Use string-fields= or field-types= options instead")}))}function WA(e,t,n,r){YA(e,{},t,r),HA(e,{},n,r)}function YA(e,t,n,r){var i,a;r=r||"";for(var o=0,s=n.length;o<s;o++)a=r+(i=n[o]),Object.prototype.hasOwnProperty.call(t,i)?e[a]=t[i]:Object.prototype.hasOwnProperty.call(e,a)||(e[a]=null)}function HA(e,t,n,r){var i,a;r=r||"";for(var o=0;o<n.length;o++)e[a=r+(i=n[o])]=(e[a]||0)+(t[i]||0)}function XA(e,t,n,r){for(var i,a=0,o=n.length;a<o;a++)e[i=n[a]]!==t[i]&&-1===r.indexOf(i)&&r.push(i)}function ZA(e,n,r){var i;if(r.fields?r.fields.indexOf("*")>-1?i=n:JA(i=r.fields):r.calc?i=[]:(i=n,r.keys&&(i=t.difference(i,[r.keys[1]]))),!r.force&&!r.prefix){var a=t.intersection(i,e);a.length>0&&(gt('Same-named fields not joined without the "force" flag:',a),i=t.difference(i,a))}return i}var QA=Object.freeze({__proto__:null,joinTables:VA,joinTableToLayer:GA,validateFieldNames:JA,updateUnmatchedRecord:WA,findCollisionFields:XA,getFieldsToJoin:ZA});function KA(){return new eI("max")}function eI(e){var n,r,i,a=t.expandoBuffer(Int32Array),o=t.expandoBuffer(Int32Array),s="max"==e?function(e,t){var i=r[e],a=r[t];return n[i]<n[a]}:function(e,t){var i=r[e],a=r[t],o=n[i],s=n[a];return o>s||o===s&&i>a},u=0;function c(e){for(var t=d(e);t>e;)f(e,t),t=d(e=t)}function f(e,t){var n=r[e];l(e,r[t]),l(t,n)}function l(e,t){i[t]=e,r[e]=t}function d(e){var t=2*e+1,n=t+1,r=u;return t<r&&s(e,t)&&(e=t),n<r&&s(e,n)&&(e=n),e}this.init=function(e){var t;for(n=e,u=e.length,r=a(u),i=o(u),t=0;t<u;t++)l(t,t);for(t=u-2>>1;t>=0;t--)c(t)},this.size=function(){return u},this.updateValue=function(e,t){var r=i[e];n[e]=t,r>=0&&r<u||dt("Out-of-range heap index."),c(function(e){var t;for(;e>0&&!s(e,t=e-1>>1);)f(e,t),e=t;return e}(r))},this.popValue=function(){return n[this.pop()]},this.getValue=function(e){return n[e]},this.peek=function(){return r[0]},this.peekValue=function(){return n[r[0]]},this.pop=function(){var e;return u<=0&&dt("Tried to pop from an empty heap."),e=r[0],l(0,r[--u]),c(0),e}}function tI(e,t,n,r){return 0===n?[]:0===r.evenness?function(e,t,n){for(var r=t.getMultiShapeBounds(e),i=[],a=0;a<n;a++)i.push(nI(e,t,r));return i}(e,t,n):function(e,t,n,r){var i=r.evenness>=0?Math.min(r.evenness,1):1,a=$n.getPlanarShapeArea(e,t);if(a>0==!1)return[];var o=t.getMultiShapeBounds(e),s=Math.round(n*o.area()/a);r.progressive&&(s=Math.ceil(s/6));for(var u=new iI(o,s,i),c=[],f=0;f<n;f++)c.push(rI(e,t,u));return u.done(),c}(e,t,n,r)}function nI(e,t,n){for(var r,i,a=0;++a<100;)if(hn(r=n.xmin+Math.random()*n.width(),i=n.ymin+Math.random()*n.height(),e,t))return[r,i];return null}function rI(e,t,n){for(var r,i=0;++i<100;)if((r=n.getPoint())&&hn(r[0],r[1],e,t))return r;return null}function iI(e,n,r){var i,a,o,s=e.xmin,u=e.ymin,c=e.width(),f=e.height(),l=.9*n*(.5*(r-1)+1),d=Math.round(Math.sqrt(l*c/f))||1,p=Math.ceil(d*f/c),h=c,g=d*p,m=-1,y=function(e){for(var t=[],n=0;n<e;n++)t.push([]);return t}(g),v=h/d*.7*r;function b(){var e;for(i||(i=t.range(g),t.shuffle(i));++m<g;)if(z(e=k(i[m])))return e}function x(e){var t=function(e){var t=N(e),n=T(e)*d+t;return n}(e);return y[t].push(e),e}function _(e,t,n){var r=L(t,n);if(-1!=r){var i=a[r],s=o.getValue(r);O(e,i)<s*s&&w(r)}}function w(e){var t=S(e);o.updateValue(e,t)}function S(e){var t=D(e),n=A(B(e),t,0,0,1);return a[e]=n,n.pop()}function A(e,t,n,r,i){for(var a,o,s,u,c,f=Math.pow(3,i),l=0,d=0;d<3;d++)for(var p=0;p<3;p++)(c=E(l,s=I(e,t,n+d,r+p,f),e,t))>l&&(l=c,u=s,a=d,o=p);return 2==i?(u.push(l),u):A(e,t,3*(n+a),3*(r+o),i+1)}function I(e,t,n,r,i){return[((n+.5)/i+e)/d*c+s,((r+.5)/i+t)/p*f+u]}this.done=function(){},this.getPoint=function(){return 1===r?function(){var e=b();if(e)return x(e);a||function(){var e=[];a=[];for(var t=0;t<g;t++)e.push(S(t));(o=new KA).init(e)}();return function(){var e=o.peek(),t=a[e];return x(t),function(e,t){var n=D(t),r=B(t);w(t),_(e,r+1,n),_(e,r,n+1),_(e,r-1,n),_(e,r,n-1),_(e,r+1,n+1),_(e,r-1,n+1),_(e,r-1,n-1),_(e,r+1,n-1)}(t,e),v=o.peekValue(),t}()}():0===r?F():function(){var e=Math.ceil(Math.pow(g,.8)),t=10*g,n=0,r=b();if(r)return x(r);for(;n++<t;){if(z(r=F()))return x(r);n%e==0&&(v*=.9)}return null}()};var M=[[0,0],[0,-1],[-1,0],[1,0],[0,1],[-1,1],[1,-1],[-1,-1],[1,1]];function E(e,t,n,r){for(var i,a,o,s=1/0,u=0;u<9;u++){if((a=j(t,n+(i=M[u])[0],r+i[1]))<e*e)return 0;a<s&&(s=a)}return o=Math.sqrt(s),o=Math.min(o,P(t,n,r))}function P(e,t,n){if(t>0&&n>0&&t<d-1&&n<p-1)return 1/0;var r=e[0],i=e[1];return 3*Math.min(r-s,s+c-r,i-u,u+f-i)}function j(e,t,n){for(var r,i=1/0,a=L(t,n),o=a>-1?y[a]:[],s=0;s<o.length;s++)(r=O(e,o[s]))<i&&(i=r);return i}function O(e,t){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function k(e){var t=D(e),n=B(e);return[(Math.random()+n)/d*c+s,(Math.random()+t)/p*f+u]}function F(){return k(Math.floor(Math.random()*g))}function z(e){var t=N(e),n=T(e);return!(C(e,t,n)||function(e,t,n){return P(e,t,n)<v}(e,t,n)||C(e,t+1,n)||C(e,t,n+1)||C(e,t-1,n)||C(e,t,n-1)||C(e,t+1,n+1)||C(e,t-1,n+1)||C(e,t-1,n-1)||C(e,t+1,n-1))}function C(e,t,n){var r=L(t,n);return-1!=r&&function(e,t,n){for(var r=n*n,i=0;i<t.length;i++)if(O(e,t[i])<r)return!0;return!1}(e,y[r],v)}function N(e){var t=e[0]-s,n=Math.floor(t/c*d);return n<0&&(n=0),n>=d&&(n=d-1),n}function T(e){var t=e[1]-u,n=Math.floor(t/f*p);return n<0&&(n=0),n>=p&&(n=p-1),n}function L(e,t){return e<0||t<0||e>=d||t>=p?-1:t*d+e}function B(e){return e%d}function D(e){return Math.floor(e/d)}}function aI(e,t,n){var r={},i=n.save_as||"fill",a=n.colors||n.values;if(a?(r[i]=a[e],r.r=n.r||1.3):n.r&&(r.r=n.r),n.copy_fields)for(var o=0;o<n.copy_fields.length;o++)r[n.copy_fields[o]]=t[n.copy_fields[o]];return r}td.divide=function(e,n,r,i){e.forEach(ui);var a=bA(e,n,r,i),o=Vd(a,i),s=a.layers.pop();ci(s),n.arcs=a.arcs,e.forEach((function(e){!function(e,n,r,i){var a,o,s,u=new sf(n.shapes,r.arcs),c=e.data?e.data.getRecords():[],f=[],l=[],d=[];function p(e,t,n){for(var r,i,u=0;u<e.length;u++)i=t[u],-1==(r=o.indexOf(i))?(o.push(i),a.push([e[u]]),s.push(n[u])):a[r].push(e[u])}function h(e){return e.sort().join(",")}function g(e){for(var t,n,r,i,a=[],o=[],s=[],c=null,f=0,l=e.length;f<l;f++)i=e[f],(n=h(t=u.findShapesEnclosingArc(Lt(i))))===c?r.push(i):(r=[i],a.push(r),o.push(n),s.push(t)),c=n;p(a,o,s)}e.shapes.forEach((function(e,n){var r=c[n]||{};if(!e)return f.push(null),void l.push(r);a=[],o=[],s=[],ur(e,g),a.forEach((function(e,n){f.push(e),l.push(n>0?t.extend({},r):r),d.push(s[n])}))})),e.shapes=f,e.data=new Jr(l),VA(e.data,n.data,(function(e){return d[e]||[]}),i)}(e,s,o,i)}))},td.dots=function(e,n,r){ci(e),Array.isArray(r.fields)||pt("Missing required fields parameter"),Hr(e)&&(r.fields.forEach((function(t,n){ri(e,t)})),(r.copy_fields||[]).forEach((function(t){ri(e,t)}))),Array.isArray(r.colors)&&r.colors.forEach(cl);var i=e.data?e.data.getRecords():[],a=[],o=[];e.shapes.forEach((function(e,s){var u=i[s];if(u)for(var c=function(e,n,r,i){var a={shapes:[],attributes:[]};if(!e)return a;var o=i.fields.map((function(e){var t=r[e]||0;return i.per_dot>0&&(t=Math.round(t/i.per_dot)),t})),s=function(e){var t=[];return e.forEach((function(e,n){for(;e-- >0;)t.push(n)})),t}(o),u=function(e,n,r,i){for(var a=e.length>1?om(e,n):[e],o=function(e,n,r){if(1===e.length)return[r];var i=e.map((function(e){return $n.getPlanarShapeArea(e,n)})),a=t.sum(i),o=r;return i.map((function(e,t){var n=e/a,r=Math.round(o*n);return o-=r,a-=e,r}))}(a,n,r),s=[],u=0;u<a.length;u++)s=s.concat(tI(a[u],n,o[u],i));return s}(e,n,s.length,i);t.shuffle(s);for(var c,f,l,d,p=-1,h=!!i.multipart,g=0;g<u.length;g++)(l=u[g])&&(c=s[g],3===l.length&&i.debug&&(c=l.pop()),h&&c==p||(p=c,a.shapes.push(f=[]),d=aI(c,r,i),a.attributes.push(d)),f.push(l));return a}(e,n,u,r),f=0,l=c.shapes.length;f<l;f++)a.push(c.shapes[f]),o.push(c.attributes[f])}));var s={geometry_type:"point",shapes:a,data:new Jr(o)};return pi(s,e,null,r),[s]},td.drop2=function(e,t,n){t.forEach((function(t){td.drop(e,t.layers,t.dataset,n)}))},td.drop=function(e,t,n,r){var i=!1;t.forEach((function(t){var a=t.data&&r.fields,o=a&&zr(a,t.data.getFields()),s=!a&&!r.geometry&&!r.holes||o&&r.geometry;r.geometry&&(i|=Zr(t),delete t.shapes,delete t.geometry_type),r.holes&&"polygon"==t.geometry_type&&Od(t,n.arcs),s?e.deleteLayer(t,n):o?delete t.data:a&&r.fields.forEach(t.data.deleteField,t.data)})),i&&Wa(n)},td.evaluateEachFeature=function(e,t,n,r){var i,a,o=ti(e),s=t.arcs,u={geojson_editor:NA(n)?TA(e,t):null};o>0&&!e.data&&(e.data=new Jr(o)),r&&r.where&&(a=ql(r.where,e,s)),i=Gl(n,e,s,u);for(var c=0;c<o;c++)a&&!a(c)||i(c);var f=u.geojson_editor?u.geojson_editor.done():null;f&&Ha(e,t,f)};var oI={};function sI(e){"function"!=typeof e.command&&pt('Expected "command" parameter function'),e.target||pt('Missing required "target" parameter'),["layer","layers"].includes(e.target)||pt("Unrecognized command target type:",e.target)}function uI(e,t){return t.split(",").map((function(t){var n=Number(t),r=Number(e);return t?r/n:""})).reverse().join(",")}td.registerCommand=function(e,n){var r={name:e,options:n.options||[]};r.options.push({name:"target"}),t.defaults(r,n),sI(r),oI[e]=r},td.runExternalCommand=function(e,t){var n=e.name,r=oI[n];r||pt("Unsupported command:",n);var i,a=r.target,o=function(e,t,n){var r=new fy,i=r.command(e);(t.options||[]).forEach((function(e){i.option(e.name,e)}));var a=r.parseArgv(["-"+e].concat(n));return a[0]}(n,r,e._),s=t.findCommandTargets(o.target||"*"),u=s[0];u||pt("Missing a target"),"layer"==a&&(1!=u.layers.length||s.length>1)&&pt("This command only supports targeting a single layer"),s.length>1&&pt("Targetting layers from multiple datasets is not supported"),"layer"==a?i=r.command(u.layers[0],u.dataset,o.options):"layers"==a&&(i=r.command(u.layers,u.dataset,o.options)),i&&function(e,t,n,r){e.dataset&&e.layers&&e.layers.length>0!=!1||pt("Invalid command output");e.dataset==t.dataset&&pt("External commands are not currently allowed to modify input datasets");e.dataset.layers.length!=e.layers.length&&pt("Currently not supported: targetting a subset of output layers");r.no_replace||t.layers.forEach((function(e){n.deleteLayer(e,t.dataset)}));n.addDataset(e.dataset)}(i,u,t,o)},td.frame=function(e,n,r){var i,a,o,s;+r.width>0==!1&&+r.pixels>0==!1&&pt("Missing a width or area"),r.width&&r.height&&((r=t.extend({},r)).aspect_ratio=uI(r.width,r.height)),Oi(a=$a(o=td.rectangle(n,r)))?pt("Frames require projected, not geographical coordinates"):Qi(o)||gt("Warning: missing projection data. Assuming coordinates are meters and k (scale factor) is 1"),(i=Up(a,r))[0]>0==!1&&pt("Missing a valid frame width"),i[1]>0==!1&&pt("Missing a valid frame height"),s={info:{},layers:[{name:r.name||"frame",data:new Jr([{width:i[0],height:i[1],bbox:a.toArray(),type:"frame"}])}]},e.addDataset(s)},Fp.frame=function(e){var n=.5,r=Bh([[[n,n],[n,e.height-n],[e.width-n,e.height-n],[e.width-n,n],[n,n]]]);return t.extend(r.properties,{fill:"none",stroke:e.stroke||"black","stroke-width":e["stroke-width"]||1}),[r]};var cI=Object.freeze({__proto__:null,getAspectRatioArg:uI});function fI(e,t,n){var r=new kt(e),i="point"==t.geometry_type?function(e){return function(t){return e.containsPoint(t[0],t[1])?t:null}}(r):function(e,t){var n=e.toArray(),r=n[0],i=n[1],a=n[2],o=n[3];return function(n){if(!e.intersects(t.getSimpleShapeBounds(n)))return null;var s,u,c,f,l=!1,d=t.getShapeIter(n);for(d.hasNext()&&(s=d.x,u=d.y);d.hasNext();)if(c=s,f=u,!wA(s=d.x,u=d.y,c,f,r,i,a,o)){if(SA(s,u,c,f,r,i,a,o)){l=!0;break}if($n.segmentIntersection(r,o,a,o,s,u,c,f)||$n.segmentIntersection(r,i,a,i,s,u,c,f)||$n.segmentIntersection(r,i,r,o,s,u,c,f)||$n.segmentIntersection(a,i,a,o,s,u,c,f)){l=!0;break}}return!l&&$n.testPointInRing(r,i,n,t)&&(l=!0),l?n:null}}(r,n);return i}function lI(e,t,n){var r=fI(e,t,n);return function(e){var n=t.shapes[e];if(!n)return!1;for(var i=0;i<n.length;i++)if(r(n[i]))return!0;return!1}}td.filterGeom=function(e,t,n){Xr(e)||pt("Layer is missing geometry"),n.bbox&&function(e,t,n){var r=fI(n.bbox,e,t);cr(e.shapes,r)}(e,t,n),td.filterFeatures(e,t,{remove_empty:!0,verbose:!1})};var dI=Object.freeze({__proto__:null,getBBoxIntersectionTest:lI,findShapesIntersectingBBox:function(e,t,n){for(var r=lI(e,t,n),i=[],a=0;a<t.shapes.length;a++)r(a)&&i.push(a);return i}});function pI(e,t){return e&&t&&function(n){return e(n)&&t(n)}||e||t}function hI(e,t){return function(n){return $n.countVerticesInPath(n,t)<=e}}function gI(e,t,n){for(var r=0,i=e.length;r<i;r++)if(n.arcIntersectsBBox(Lt(e[r]),t))return!0;return!1}function mI(e,t,n){for(var r,i,a=n.getSimpleShapeBounds2(e),o=0,s=t.length;o<s;o++)if((r=t[o])&&r!=e&&gI(r,a,n)&&(i=n.getVertex(r[0],0),$n.testPointInRing(i.x,i.y,e,n)))return!0;return!1}function yI(e){return(e||[]).reduce((function(e,n){var r=n.split("="),i=t.trimQuotes(r[0]),a=r.length>1?t.trimQuotes(r[1]):i;return a&&i||pt("Invalid name assignment:",n),e[a]=i,e}),{})}function vI(e){var t=Object.keys(e);return function(n){for(var r,i={},a=0,o=t.length;a<o;a++)r=t[a],i[e[r]]=n[r];return i}}function bI(e,t,n,r){var i=wI(e,t,n,r);return _I(e,n),GA(e,n.data,i,r)}function xI(e,t,n,r){var i=SI(e,t,n);return _I(e,t),GA(e,t.data,i,r)}function _I(e,t){e.data||(e.data=new Jr(e.shapes.length)),t.data||pt("Can't join a layer that is missing attribute data")}function wI(e,t,n,r){var i=SI(n,e,t),a=[],o=!!r.first_match;return n.shapes.forEach((function(e,t){for(var n,r=i(t),s=r?r.length:0,u=0;u<s&&((n=r[u])in a?a[n].push(t):a[n]=[t],!o);u++);})),function(e){return a[e]||null}}function SI(e,t,n,r){var i=new sf(t.shapes,n),a=e.shapes;return function(e){var t=a[e],n=t?i.findEnclosingShapes(t[0]):[];return n.length>0?n:null}}td.filterFeatures=function(e,n,r){var i,a,o,s=e.data?e.data.getRecords():null,u=e.shapes||null,c=ti(e),f=u?[]:null,l=s?[]:null,d=di(e,r),p=!!r.invert;return r.expression&&(i=ql(r.expression,e,n)),r.ids&&(i=pI(i,(a=r.ids,o=new Set(a),function(e){return o.has(e)}))),r.remove_empty&&(i=pI(i,function(e,t){var n=e.shapes;if("polygon"==e.geometry_type)return function(e,t){return function(n){return!!e[n]&&$n.getPlanarShapeArea(e[n],t)>0}}(n,t);return function(e){return!!n[e]}}(e,n))),r.bbox&&(i=pI(i,lI(r.bbox,e,n))),i||pt("Missing a filter criterion"),t.repeat(c,(function(e){var t=i(e);p&&(t=!t),!0===t?(u&&f.push(u[e]||null),s&&l.push(s[e]||null)):!1!==t&&pt("Expression must return true or false")})),d.shapes=f,d.data=l?new Jr(l):null,r.no_replace&&(d=hi(d)),!1!==r.verbose&&gt(t.format("Retained %,d of %,d features",ti(d),c)),d},td.filterIslands=function(e,n,r){var i=t.extend({sliver_control:0},r),a=n.arcs,o=0;"polygon"==e.geometry_type&&(i.min_area||i.min_vertices?(o+=function(e,t,n){var r=0,i=new Uint8Array(t.size());Wn(e.shapes,i);var a=function(e,a,o){if(1==e.length&&1===i[Lt(e[0])]&&(!n||n(e))&&!mI(e,o,t))return r++,null};return cr(e.shapes,a),r}(e,a,i.min_area?el(e,n,i).filter:hI(i.min_vertices,a)),i.remove_empty&&td.filterFeatures(e,a,{remove_empty:!0,verbose:!1}),gt(t.format("Removed %'d island%s",o,t.pluralSuffix(o)))):gt("Missing a criterion for filtering islands; use min-area or min-vertices"))},td.filterIslands2=function(e,n,r){var i=t.extend({sliver_control:0},r),a=n.arcs,o=0;"polygon"==e.geometry_type&&(i.min_area||i.min_vertices?(o+=function(e,t,n){var r=0,i=new Uint8Array(t.size());Wn(e.shapes,i);var a=function(e,a,o){if(1==e.length&&1===i[Lt(e[0])]&&(!n||n(e))&&!mI(e,o,t))return r++,null};return cr(e.shapes,a),r}(e,a,i.min_area?el(e,n,i).filter:hI(i.min_vertices,a)),i.remove_empty&&td.filterFeatures(e,a,{remove_empty:!0,verbose:!1}),gt(t.format("Removed %'d island%s",o,t.pluralSuffix(o)))):gt("Missing a criterion for filtering islands; use min-area or min-vertices"))},td.filterFields=function(e,t,n){var r=e.data;if(ii(r,t=t||[]),r){var i=yI(t);n.invert&&(i=function(e,t){return t.reduce((function(t,n){return n in e||(t[n]=n),t}),{})}(i,r.getFields())),e.data.update(vI(i))}},td.renameFields=function(e,n){var r=yI(n);ii(e.data,Object.keys(r)),t.defaults(r,yI(e.data.getFields())),e.data.update(vI(r))},td.filterPoints=function(e,n,r){si(e),r.group_interval>0==!1&&pt("Expected a positive group_interval parameter");for(var i,a,o,s,u,c,f=Eb(n,r.group_interval),l=Ct(e),d=bb.from(l).triangles,p=new Uint8Array(l.length),h=0,g=d.length;h<g;h+=3)s=d[h],u=d[h+1],c=d[h+2],i=l[s],a=l[u],o=l[c],f(i,a)&&f(a,o)&&f(i,o)&&(p[s]=1,p[u]=1,p[c]=1);!function(e,n,r){var i=e.data?e.data.getRecords():null,a=e.shapes||null,o=ti(e),s=a?[]:null,u=i?[]:null;t.repeat(o,(function(e){var t=n(e);r&&(t=!t),!0===t?(a&&s.push(a[e]||null),i&&u.push(i[e]||null)):!1!==t&&pt("Expression must return true or false")})),e.shapes=s,e.data=u?new Jr(u):null}(e,(function(e){return 1==p[e]}))};var AI=Object.freeze({__proto__:null,joinPointsToPolygons:bI,joinPolygonsToPoints:xI,prepJoinLayers:_I,getPolygonToPointsFunction:wI});function II(e,t){var n,r=[],i=[],a=[],o=0;return e.forEach((function(e,u){!function(e,t){var u,c,f,l,d=!0,p=0;n=0;for(;e.hasNext();){if(!1===t(s,u=e.x,c=e.y,f,l,p++)){d=!1;break}f=u,l=c}d&&1==n&&(gt("An invalid arc was created"),d=!1);if(d)r.push(n);else{for(;n-- >0;)i.pop(),a.pop();r.push(0),o++}}(e,t)})),e.updateVertexData(r,i,a),o;function s(e){e&&(i.push(e[0]),a.push(e[1]),n++)}}function MI(e){var t=[],n=[];function r(e,t){for(var r=0;r<t.length;r++)e.push([n.length]),n.push(t[r])}function i(t){for(var n=[],r=e.arcs.getShapeIter(t);r.hasNext();)n.push([r.x,r.y]);return n}this.done=function(){e.layers=t,n.length&&(e.arcs=new ma(n),_a(e))},this.editLayer=function(n,a){var o=n.geometry_type;if(e.layers.indexOf(n)!=t.length&&dt("Layer was edited out-of-order"),o){var s=n.shapes.map((function(e,t){for(var n,s,u=[],c=0,f=e?e.length:0;c<f;c++)s="point"==o?e[c]:i(e[c]),n=a(s,c,e),Array.isArray(n)&&("point"==o?u.push(n):"polygon"!=o&&"polyline"!=o||r(u,n||[]));return u.length>0?u:null}));t.push(Object.assign(n,{shapes:s}))}else t.push(n)}}function EI(e,t,n){if(function(e){for(var t,n,r,i=0,a=1,o=e.length;a<o;a++)n=e[a-1],r=e[a],(t=$n.distanceSq(n[0],n[1],r[0],r[1]))>i&&(i=t);return Math.sqrt(i)}(e)<t)return e;n||(n=PI(t));for(var r,i,a=[e[0]],o=1,s=e.length;o<s;o++)r=e[o-1],i=e[o],$n.distance2D(r[0],r[1],i[0],i[1])>t+1e-4&&jI(a,n(r,i)),a.push(i);return a}function PI(e){return function(t,n){for(var r=[],i=$n.distance2D(t[0],t[1],n[0],n[1]),a=Math.round(i/e)-1,o=(n[0]-t[0])/(a+1),s=(n[1]-t[1])/(a+1),u=1;u<=a;u++)r.push([t[0]+o*u,t[1]+s*u]);return r}}function jI(e,t){for(var n=0;n<t.length;n++)e.push(t[n])}function OI(e,n){var r,i=function(e,n){var r=Gn(e),i=e.getBounds(),a=function(e,n,r){for(var i=[.1,.2,.3,.4,.5,.6,.7,.8,.9],a=[],o=0;o<i.length;o++)for(var s=0;s<i.length;s++)a.push([i[o],i[s]]);var u=a.map((function(t){var i=e.xmin+e.width()*t[0],a=e.ymin+e.height()*t[1],o=r(i,a),s=r(i+n[0],a+n[1]);return o&&s?$n.distance2D(o[0],o[1],s[0],s[1]):1/0})).filter((function(e){return e<1/0}));return u.length>0?t.findMedian(u):1/0}(i,r,n),o=function(e,t){var n=t(e.centerX(),e.centerY()),r=t(e.centerX(),e.ymin),i=t(e.xmax,e.centerY()),a=n&&r&&i?($n.distance2D(n[0],n[1],r[0],r[1])+$n.distance2D(n[0],n[1],i[0],i[1]))/5e3:1/0;return a}(i,n),s=Math.min(a,o);s==1/0&&dt("Densification error");return s}(e,n),a=i*i*25;return II(e,(function(e,t,o,s,u,c){var f=r;if(!(r=n(t,o)))return!1;c>0&&$n.distanceSq(r[0],r[1],f[0],f[1])>a&&kI(s,u,f[0],f[1],t,o,r[0],r[1],n,i).forEach(e);e(r)}))}function kI(e,t,n,r,i,a,o,s,u,c,f){var l=(e+i)/2,d=(t+a)/2,p=u(l,d);if(p)return f=f||[],$n.pointSegDistSq2(p[0],p[1],n,r,o,s)>c*c*.25&&$n.distance2D(e,t,i,a)>.01&&(kI(e,t,n,r,l,d,p[0],p[1],u,c,f),f.push(p),kI(l,d,p[0],p[1],i,a,o,s,u,c,f)),f}function FI(e,t,n){var r=Oi(e);return n.offset&&(e=function(e,t,n){var r=Zf(e,n,t);return t.padBounds(r[0],r[1],r[2],r[3]),t}(n.offset,e,t)),e.area()>0==!1?null:(n.aspect_ratio&&(e=zI(n.aspect_ratio,e)),r&&(e=ki(e)),e)}function zI(e,t){var n,r,i=String(e).split(",").map(parseFloat),a=t.width()/t.height();return 1==i.length?i.push(i[0]):i[0]>i[1]&&i.reverse(),n=i[0],r=i[1],n||r?(n||(n=-1/0),r||(r=1/0),a<n?t.fillOut(n):a>r&&t.fillOut(r),t):t}function CI(e,t){var n=t||{},r=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]];return n.interval>0&&(r=EI(r,n.interval)),"polyline"==n.geometry_type?{type:"LineString",coordinates:r}:{type:"Polygon",coordinates:[r]}}td.fuzzyJoin=function(e,n,r,i){var a=r?r.layer:null;a&&Qr(a)||pt("Missing a point layer to join from"),ri(a,i.field),ci(e),i.dedup_points&&td.uniq(a,null,{expression:'this.x + "~" + this.y + "~" + this.properties['+JSON.stringify(i.field)+"]",verbose:!1}),function(e,n,r,i){var a=i.field,o=wI(e,n,r,{first_match:!0}),s=function(e,t){var n=e.data.getRecords();return function(e){for(var r,i=[],a=0;a<e.length;a++)r=n[e[a]],i.push(r[t]);return i}}(r,a),u=[],c=[],f=[];if(e.shapes.forEach((function(e,t){var l=o(t)||[],d=Kl(s(l),!0),p=d.margin>0?d.modes[0]:null;null===p&&d.modes.length>1&&(p=function(e,t,n,r,i,a){var o=e.map((function(){return 0}));n.forEach((function(n){var s=t.shapes[n],u=t.data.getRecordAt(n)[r],c=e.indexOf(u);if(-1!==c){var f=function(e,t,n){var r=e[0];return $n.getPointToShapeDistance(r[0],r[1],t,n)}(s,i,a);o[c]+=f}}));var s=Math.max.apply(null,o);return e[o.indexOf(s)]}(d.modes,r,l,a,e,n)),f[t]=d.count||0,i.no_dropouts&&c.push(d),u.push(p)})),Wr(e,"join-count",f),Wr(e,a,u),td.dataFill(e,n,{field:a,weight_field:"join-count",contiguous:i.contiguous}),i.no_dropouts){var l=function(e,n,r){var i=Dr(n.data.getRecords(),r),a=Dr(e.data.getRecords(),r);return t.difference(i,a)}(e,r,a);l.length>0&&function(e,n,r,i){var a=e.data.getRecords(),o=[],s=[];r.map((function(e){var t=function(e,t){var n=-1,r=0;return t.forEach((function(t,i){var a=t.values.indexOf(e),o=a>-1?t.counts[a]:0;o>r&&(n=i,r=o)})),n}(e,i);t>-1&&-1===s.indexOf(t)?(a[t][n]=e,s.push(t)):o.push(e)})),gt("Restored",s.length,"dropout value"+t.pluralSuffix(s.length)),o.length>0&&gt("Failed to restore dropout value(s):",o.join(", "))}(e,a,l,c)}}(e,n,a,i)},td.rectangles=function(e,n,r){Xr(e)||pt("Layer is missing geometric shapes");var i=Zi(n),a=e.data?e.data.getRecords():null,o={type:"FeatureCollection",features:e.shapes.map((function(t){var a="point"==e.geometry_type?zt(t):n.arcs.getMultiShapeBounds(t);return(a=FI(a,i.crs,r))?CI(a.toArray(),r):null})).map((function(e,n){var i=a&&a[n]||null;return i&&r.no_replace&&(i=t.extend({},i)),{type:"Feature",properties:i,geometry:e}}))},s=By(o,{});Xi(s,i);var u=Aa(n,[s]);return pi(u[0],e,null,r),u},td.rectangle2=function(e,t){var n=e.layers.map((function(n){var r=td.rectangle({layer:n,dataset:e.dataset},t);return pi(r.layers[0],n,null,t),t.no_replace||(r.layers[0].name=n.name||r.layers[0].name),r}));return Aa(e.dataset,n)},td.rectangle=function(e,t){var n,r;e?(n=bi(e.layer,e.dataset.arcs),r=Zi(e.dataset)):t.bbox&&(r=Oi(n=new kt(t.bbox))?Wi("wgs84"):{}),(n=n&&FI(n,r.crs,t))&&n.hasBounds()||pt("Missing rectangle extent");var i=By(CI(n.toArray(),t),{});return i.layers[0].name=t.name||"rectangle",Xi(i,r),i};var NI=Object.freeze({__proto__:null,applyAspectRatio:zI,convertBboxToGeoJSON:CI});function TI(e,t){return t*Math.PI/180*function(e){return e.a*Math.sqrt(1-(e.es||0))}(e)}function LI(e){return e.params.proj.param}function BI(e){return!DI(e,"cassini,gnom,bertin1953,chamb,ob_tran,tpeqd,healpix,rhealpix,ocea,omerc,tmerc,etmerc")&&!function(e){return DI(e,"aeqd,gnom,laea,mil_os,lee_os,gs48,alsk,gs50,nsper,tpers,ortho,qsc,stere,ups,sterea")}(e)}function DI(e,t){return t.split(",").includes(LI(e))}function UI(e,t,n){var r=function(e,t){var n=RI(e,t);return function(e,t){return n([e,t])}}(t,n);e.layers.filter(Qr).forEach((function(e){pM(e,r)})),e.arcs&&hM(e.arcs,r)}function RI(e,t){var n=(e[0]||0)*qt,r=(e[1]||0)*qt,i=(e[2]||0)*qt;return function(e){return e[0]*=qt,e[1]*=qt,(t?$I:qI)(e,n,r,i),e[0]*=$t,e[1]*=$t,e}}function qI(e,t,n,r){return 0!=t&&VI(e,t),0===n&&0===r||GI(e,n,r,!1),e}function $I(e,t,n,r){return 0===n&&0===r||GI(e,n,r,!0),0!=t&&VI(e,-t),e}function VI(e,t){var n=e[0]+t;n>Math.PI?n-=2*Math.PI:n<-Math.PI&&(n+=2*Math.PI),e[0]=n}function GI(e,t,n,r){var i,a=Math.cos(t),o=Math.sin(t),s=Math.cos(n),u=Math.sin(n),c=Math.cos(e[1]),f=Math.cos(e[0])*c,l=Math.sin(e[0])*c,d=Math.sin(e[1]);r?(i=d*s-l*u,e[0]=Math.atan2(l*s+d*u,f*a+i*o),e[1]=Math.asin(i*a-f*o)):(i=d*a+f*o,e[0]=Math.atan2(l*s-i*u,f*a-d*o),e[1]=Math.asin(i*s+l*u))}function JI(e,t){ta(Qi(e))||pt("Command requires a lat-long dataset."),Array.isArray(t.rotation)&&t.rotation.length||pt("Invalid rotation parameter");var n=RI(t.rotation,t.invert),r=new MI(e);e.arcs&&e.arcs.flatten(),e.layers.forEach((function(e){var i=e.geometry_type;r.editLayer(e,function(e,t,n){var r;if("point"==e)return function(e){return e.forEach(t),e};if("polyline"==e)return function(e){return(e=EI(e,.5)).forEach(t),cx(e)};if("polygon"==e)return function(e,i,a){var o,s;if(!function(e){for(var t=0,n=e.length;t<n;t++)if(!sx(e[t]))return!1;return!0}(e)?(e.forEach(ix),(e=EI(e=ux(e),.5,(s=PI(o=.5),function(e,t){var n;return n=ax(e)||ax(t)?[]:ox(e,t)?function(e,t,n){var r,i,a=[],o=e[1]<t[1];e[0]!=t[0]&&dt("Expected an edge segment"),n>0==0&&dt("Expected a positive interval"),o?(r=e[1],i=t[1]):(r=t[1],i=e[1]);for(var s=Math.floor(r/n)*n+n;s<i;)a.push([e[0],s]),s+=n;return o||a.reverse(),a}(e,t,o):gx(e,t)?[]:s(e,t),n}))).forEach(t)):e=EI(e,.5),0===i&&(r=[]),!(e.length<4))return nx(e[0],tx(e))||dt("Open polygon ring"),r.push(e),i==a.length-1?n.debug?r:lx(r):void 0;xt("Short ring",e)};return null}(i,n,t))})),r.done(),t.debug||(_a(e),dM(e))}function WI(e,t){for(var n=t.arcs,r=Jn(e.shapes,n),i=[],a=[],o=0,s=n.size();o<s;o++)r(o)&&(i.push({arcid:o}),a.push([[o]]));return{geometry_type:"polyline",data:new Jr(i),shapes:a}}function YI(e,t){for(var n,r=t.arcs,i={type:"FeatureCollection",features:[]},a=Jn(e.shapes,r),o=0,s=r.size();o<s;o++)a(n=o)&&r.forEachArcSegment(n,u);function u(e,t,r,a){var o=r[e],s=a[e],u=r[t],c=a[t];i.features.push({type:"Feature",properties:{arc:n,i1:e,i2:t,x1:o,y1:s,x2:u,y2:c},geometry:{type:"LineString",coordinates:[[o,s],[u,c]]}})}var c=Ea([t,By(i,{})]);return t.arcs=c.arcs,c.layers.pop()}function HI(e){var t=[];return Nt(e,(function(e){t.push(e.concat())})),{type:"LineString",coordinates:t}}function XI(e,n,r){var i,a=(r=r||{}).where?$l(r.where,e,n):null,o=r.each?function(e,t,n){var r,i=yw(t.shapes,n)(o),a=Vl(e,t,n);function o(e,t){a(e,t,r)}return function(e,t){return r=e,i(t[0][0]),e}}(r.each,e,n):null,s=yw(e.shapes,n,{filter:a}),u=t.isArray(r.fields)?r.fields:[],c=0,f=[],l=[];return u.length>0&&!e.data&&pt("Missing a data table"),d(function(e,t){return KI(e,t((function(e,t){return-1==t?String(e):null})))}(e.shapes,s),"outer"),u.forEach((function(t){var n=e.data.getRecords();ri(e,t),d(KI(e.shapes,s((function(e,r){var i=n[e],a=n[r];return i&&a&&i[t]!==a[t]?e+"-"+r:null}))),t)})),d(QI(e.shapes,s),"inner"),pi(i=ZI(f,l),e,null,r),i;function d(e,n){var r=e.map((function(e,t){var r={RANK:c,TYPE:n};return o&&o(r,e),r}));f=t.merge(e,f),l=t.merge(r,l),c++}}function ZI(e,t){return{geometry_type:"polyline",shapes:e,data:t?new Jr(t):null}}function QI(e,t){return KI(e,t((function(e,t){return t>-1?e+"-"+t:null})))}function KI(e,t){var n,r=[],i={},a=null,o=null;return tr(e,(function(e){var s,u,c=e.arcId,f=t(c);f&&(u=f in i?i[f]:null,s=f==o&&e.shapeId==a.shapeId&&e.partId==a.partId,u?s?u[u.length-1].push(c):u.push([c]):(u=[[c]],i[f]=u,r.push(u)),e.i==n.arcs.length-1&&u.length>1&&u[0][0]==n.arcs[0]&&(u[0]=u.pop().concat(u[0])));a=e,o=f}),(function(e){n=e})),r}td.rotate=JI,td.lines=function(e,n,r){return(r=r||{}).callouts?(oi(e),function(e,t,n){var r=e.data?e.data.getRecords():null,i=bi(e).width()/50,a=function(e){return[e,[e[0]+i,e[1]]]},o={type:"FeatureCollection",features:e.shapes.map((function(e,t){return{type:"Feature",properties:r?r[t]:null,geometry:{type:"MultiLineString",coordinates:e.map(a)}}}))},s=By(o),u=Aa(t,[s]);return pi(u[0],e.name,null,n),u}(e,n,r)):"point"==e.geometry_type?function(e,n,r){var i=r.groupby?function(e,n,r){var i,a=[],o=ud([n],e.data),s=t.defaults({fields:[n]},r),u=fd(e.data.getRecords(),o,s);return e.shapes.forEach((function(e,t){var n=o(t);n in a==!1&&(a[n]=[]),a[n].push(e)})),i=a.map((function(e,t){return{type:"Feature",properties:u[t],geometry:e.length>1?HI(e):null}})),{type:"FeatureCollection",features:i}}(e,r.groupby,r):HI(e.shapes),a=By(i),o=Aa(n,[a]);return pi(o[0],e,null,r),o}(e,n,r):r.segments?[YI(e,n)]:r.arcs?[WI(e,n)]:"polygon"==e.geometry_type?XI(e,n.arcs,r):void ci(e,"Command requires a polygon or point layer")};var eM=Object.freeze({__proto__:null,polygonsToLines:XI,createLineLayer:ZI,extractInnerLines:QI});function tM(e,t,n){var r;return DI(t,"stere,sterea,ups,ortho,gnom,laea,nsper,tpers")||n.clip_angle||t.clip_angle?r=function(e,t,n){var r=n.clip_angle||t.clip_angle||function(e){var t=LI(e);if("nsper"==t)return function(e){var t=parseFloat(e.params.h.param);if(!t||t<0)return 0;var n=180*Math.acos(e.a/(e.a+t))/Math.PI;return n*=.995}(e);if("tpers"==t)return gt("Automatic clipping is not supported for the Tilted Perspective projection"),0;return{gnom:60,laea:179,ortho:89.85,stere:142,sterea:142,ups:10.5}[t]||0}(t);if(!r)return null;bt(`Using clip angle of ${+r.toFixed(2)} degrees`);var i=function(e,t){return TI(e,t)}(e,r),a=function(e){var t=180/Math.PI;return[e.lam0*t,e.phi0*t]}(t);t.clip_angle=r;var o=bx(a,i,null,n);return By(o)}(e,t,n):(function(e){return DI(e,"merc,bertin1953")}(t)||n.clip_bbox)&&(r=rM(t,n)),r||null}function nM(e,t,n){var r=tM(e,t,n);return r||(r=rM(t,{clip_bbox:[-180,-90,180,90]})),lM(r,e,t,{no_clip:!1,quiet:!0}),r}function rM(e,t){var n=t.clip_bbox||iM(e),r=function(e){var t=LI(e);if("bertin1953"==t)return[-16.5,-42];if(("tmerc"==t||"utm"==t||"etmerc"==t)&&0!==e.lam0)return[180*e.lam0/Math.PI];return null}(e);n||dt("Missing expected clip bbox.");var i=By(CI(n,t=Object.assign({interval:.5},t)));return r&&JI(i,{rotation:r,invert:!0}),i}function iM(e){var t=.001,n=[-179,-90,179,90];return{tmerc:n,utm:n,etmerc:n,merc:[-180,-89,180,89],lcc:[-180,-89,180,89],bertin1953:[-180+t,-90+t,180-t,90-t]}[LI(e)]}function aM(e,n,r,i){if(!ta(n)||i.no_clip)return!1;var a,o,s,u=function(e,t,n){var r=Fi(180*n.lam0/Math.PI);if(e.arcs&&(i=n,BI(i)&&0!==i.lam0)&&function(e,t){var n=0;return e.arcs.forEachSegment((function(e,r,i,a){var o=i[e],s=i[r];(o<=t&&s>=t||o>=t&&s<=t)&&n++})),n>0}(e,r))return function(e,t){var n=e.layers.filter(Zr);if(0===n.length)return;var r=1e-8,i=[t-r,-91,t+r,91],a=By(CI(i,{interval:.5}));MA(n,a,e,"erase")}(e,r),Na(e),!0;var i;return!1}(e,0,r),c=!1,f=(DI(o=r,"merc,lcc")&&(s=iM(o)),s);return f?function(e,n){Za(e,(function(e,r){return[t.clamp(e,n[0],n[2]),t.clamp(r,n[1],n[3])]}))}(e,f):a=function(e,t,n){return tM(e,t,n)}(n,r,i),a&&(c=function(e,t){var n=e.layers.filter((function(n){return!function(e,t,n){var r=bi(e,t.arcs),i=!1;return n.layers[0].shapes.forEach((function(e,t){i=i||pn(r,e,n.arcs)})),i}(n,e,t)}));if(n.length>0)return MA(n,t,e,"clip"),!0;return!1}(e,a)),u||c}function oM(e,t){var n,r,i,a,o;return e in pr("mproj").internal.pj_list==!1?e:(i=["lcc","aea"].includes(e),a=["tmerc","etmerc"].includes(e),n="+proj="+e,(i||a)&&(r=function(e){ta(Qi(e))||pt("Expected unprojected data");return $a(e).toArray()}(t),o=Bf(r),gt(`Converted "${e}" to "${n+=" "+(a?uM(r,o):sM(r,o))}"`)),n)}function sM(e,t){var n=(e[0]+e[2])/2,r=e[3]-e[1],i=e[1]+1/6*r,a=e[1]+5/6*r;return`+lon_0=${n.toFixed(t)} +lat_1=${i.toFixed(t)} +lat_2=${a.toFixed(t)}`}function uM(e,t){var n=(e[0]+e[2])/2,r=(e[1]+e[3])/2;return`+lon_0=${n.toFixed(t)} +lat_0=${r.toFixed(t)}`}var cM=Object.freeze({__proto__:null,expandProjDefn:oM,getConicParams:sM,getCenterParams:uM});function fM(e,t){var n,r,i={};return/\.prj$/i.test(e)?((n=Dv(e,{}))&&(i.prj=n.info.prj,i.crs=aa(i.prj)),i):t&&(r=t.findSingleLayer(e))?Zi(n=r.dataset):Wi(e)}function lM(e,t,n,r){var i=Di(t,n),a=0,o=0,s=aM(e,t,n,r);e.layers.forEach((function(e){Qr(e)&&(o+=pM(e,i))})),e.arcs&&(a=r.densify?OI(e.arcs,i):gM(e.arcs,i)),s&&dM(e),a>0&&!r.quiet&&gt(`Removed ${a} ${1==a?"path":"paths"} containing unprojectable vertices.`),o>0&&!r.quiet&&gt(`Removed ${o} unprojectable ${1==o?"point":"points"}.`),e.info.crs=n}function dM(e){gp(e.layers.filter((e=>"polygon"==e.geometry_type)),e,{allow_overlaps:!0,rebuild_topology:!0,no_arc_dissolve:!0,quiet:!0,verbose:!1}),Na(e)}function pM(e,t){var n=0;return cr(e.shapes,(function(e){var r=t(e[0],e[1]);return r||n++,r})),n}function hM(e,t){for(var n,r=e.getVertexData(),i=r.xx,a=r.yy,o=r.zz,s=e.getRetainedInterval(),u=0,c=i.length;u<c;u++)(n=t(i[u],a[u]))||dt("Unprojectable point:",i[u],a[u]),i[u]=n[0],a[u]=n[1];e.updateVertexData(r.nn,i,a,o),e.setRetainedInterval(s)}function gM(e,t){return II(e,(function(e,n,r,i,a,o){var s=t(n,r);if(!s)return!1;e(s)}))}td.proj=function(e,n,r){var i,a;r.init&&((i=fM(r.init,n)).crs||pt("Unknown projection source:",r.init),Xi(e,i)),r.match?a=fM(r.match,n):r.crs&&(a=Wi(oM(r.crs,e))),a&&function(e,n,r){var i=oc(),a=[],o={info:e.info||{}};n.crs||pt("Missing projection data");if(!Va(e))return void Xi(e,n);var s=Zi(e);s.crs||pt("Unable to project -- source coordinate system is unknown");if($i(s.crs,n.crs))return void gt("Source and destination CRS are the same");e.arcs&&(e.arcs.flatten(),o.arcs=i?e.arcs.getCopy():e.arcs);o.layers=e.layers.map((function(e){return i&&(a.push(e),e=gi(e)),e})),lM(o,s.crs,n.crs,r||{}),Xi(o,n),e.arcs=o.arcs,a.forEach((function(e,n){t.extend(e,o.layers[n])}))}(e,a,r)};var mM=Object.freeze({__proto__:null,fetchCrsInfo:fM,projectDataset:lM,cleanProjectedPathLayers:dM,projectPointLayer:pM,projectArcs:hM,projectArcs2:gM});function yM(e,n,r){var i=r.interval||10;[5,10,15,20,30,45].includes(i)||pt("Invalid interval:",i),e.lam0,Math.PI;var a=i>10?1:.5,o=i,s=i,u=Math.round(360/o),c=Math.round(180/s)+1,f=t.range(u,-180+o,o),l=t.range(c,-90,s),d=[],p=[],h=function(e){return BI(e)}(e)?function(e){var t=function(e){return 0===e.lam0?180:Fi(180*e.lam0/Math.PI)}(e),n=2e-8;return 180==t?[-180,180]:[t-n,t+n]}(e):null;return f.forEach((function(e){h&&(g(e,h[0])||g(e,h[1]))||m(e,e%90==0)})),h&&!n&&(m(h[0],!0),m(h[1],!0)),l.forEach((function(e){!function(e){var t=EI([[-180,e],[180,e]],a);p.push(bM(t,{type:"parallel",value:e}))}(e)})),{type:"FeatureCollection",features:d.concat(p)};function g(e,t){return Math.abs(e-t)<i/5}function m(e,t){var n=s<=15?s:0;y(e,-90+n,90-n),t&&n>0&&(y(e,-90,-90+n),y(e,90-n,90))}function y(e,t,n){var r=EI([[e,t],[e,n]],a);d.push(bM(r,{type:"meridian",value:vM(e)}))}}function vM(e){return+e.toFixed(3)||0}function bM(e,t){return{type:"Feature",properties:t,geometry:{type:"LineString",coordinates:e}}}function xM(e){return!!AM(e).inControlBlock}function _M(e){var t=AM(e);t.inControlBlock=!0,t.active=!0,t.complete=!0}function wM(e){var t=AM(e);t.inControlBlock=!0,t.active=!1}function SM(e){return!!AM(e).complete}function AM(e){return e.control||(e.control={})}function IM(e,t){return!!function(e){return!0===AM(e).stopped}(t)||!function(e){return["if","elif","else","endif"].includes(e)}(e)&&(xM(t)&&!function(e){return!!AM(e).active}(t))}function MM(e,t){!SM(e)&&function(e,t){return!t.expression||RA(t.expression,e,t)()}(e.catalog,t)?_M(e):wM(e)}td.graticule=function(e,t){var n,r,i=t.name||t.polygon&&"polygon"||"graticule";return e&&!na(e)?((r=Zi(e)).crs||pt("Coordinate system is unknown, unable to create a graticule"),n=t.polygon?function(e,t){var n=Yi("wgs84");return nM(n,e,t)}(r.crs,t):function(e,t){var n=Yi("wgs84"),r=function(e,t,n){var r=tM(e,t,n);return r&&(lM(r,e,t,{no_clip:!1,quiet:!0}),r.layers[0].geometry_type="polyline"),r||null}(n,e,{}),i=By(yM(e,!!r,t));lM(i,n,e,{no_clip:!1}),r&&(i=function(e,t){var n=Ea([e,t]),r=n.layers.pop(),i=n.layers[0],a=i.data.getRecords();return r.shapes.forEach((function(e){i.shapes.push(e),a.push({type:"outline",value:null})})),n}(i,r));return _a(i),gp(i.layers,i,{verbose:!1}),i}(r.crs,t),Xi(n,r)):(n=t.polygon?function(e){var t=Yi("wgs84");return nM(t,t,e)}(t):function(e){var t=Yi("wgs84"),n=By(yM(t,!1,e));return n}(t),Xi(n,Wi("wgs84"))),n.layers[0].name=i,n},td.printHelp=function(e){vt(dy().getHelpMessage(e.command))},td.if=function(e,t){xM(e)&&pt("Nested -if commands are not supported."),MM(e,t)},td.elif=function(e,t){xM(e)||pt("-elif command must be preceded by an -if command."),MM(e,t)},td.else=function(e){xM(e)||pt("-else command must be preceded by an -if command."),SM(e)?wM(e):_M(e)},td.endif=function(e){xM(e)||pt("-endif command must be preceded by an -if command."),function(e){e.control=null}(e)},td.ignore=function(e,t,n){n.empty&&ni(e)&&ht("Layer is empty, stopping processing")},td.include=function(e){var n,r,a;if(e.file||pt("Missing name of a JS file to load"),Xc.checkFileExists(e.file,e.input),"string"==typeof(n=Xc.readFile(e.file,"utf8",e.input))){/^\s*\{[\s\S]*\}\s*$/.test(n)||pt("Expected a JavaScript object containing key:value pairs");try{(a=Xl()).require=require,r=Function("ctx","with(ctx) {return ("+n+");}").call({},a)}catch(e){pt(e.name,"in JS source:",e.message)}}else"object"==typeof n&&(r=n);t.extend(i("defs"),r)};var EM=50;function PM(e,t){var n=ti(e),r={layer_name:e.name,geometry_type:e.geometry_type,feature_count:n,null_shape_count:0,null_data_count:e.data?zM(e.data.getRecords()):n};return e.shapes&&e.shapes.length>0&&(r.null_shape_count=function(e){for(var t=0,n=0;n<e.length;n++)e[n]&&0!==e[n].length||t++;return t}(e.shapes),r.bbox=bi(e,t.arcs).toArray(),r.proj4=Ui(t)),r.source_file=fi(0,t)||null,r.attribute_data=jM(e),r}function jM(e,t){if(!e.data||0===e.data.size()||0===e.data.getFields().length)return null;var n=qr(e.data.getFields(),"ascending"),r=void 0===t?"first_value":"value";return n.map((function(n){return{field:n,[r]:e.data.getReadOnlyRecordAt(t||0)[n]}}))}function OM(e){if(!e)return"Attribute data: [none]\n";var n="first_value"in e[0]?"first_value":"value",r=[],i=[];e.forEach((function(e){i.push(e.field),r.push(e[n])}));var a=r.reduce((function(e,n){return t.isNumber(n)&&(e=Math.max(e,NM(n))),e}),0),o=["Field"].concat(i),s=r.reduce((function(e,t){return e.push(TM(t,a)),e}),["first_value"==n?"First value":"Value"]),u=CM(o),c=CM(s),f=(t.rpad("",u+2,"-")+"+"+t.rpad("",c+2,"-")).substr(0,EM)+"\n",l="";return o.forEach((function(e,n){var r=kM(e);l+=" "+e+t.rpad("",u-r," ")+" | "+s[n]+"\n",0===n&&(l+=f)})),"\nAttribute data\n"+f+l+f}function kM(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=FM(e.charCodeAt(n));return t}function FM(e){return e>=4352&&(e<=4447||9001==e||9002==e||e>=11904&&e<=42191&&12351!=e||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65135||e>=65280&&e<=65376||e>=65504&&e<=65510||e>=131072&&e<=196605||e>=196608&&e<=262141)?2:1}function zM(e){for(var t=0,n=0;n<e.length;n++)e[n]||t++;return t}function CM(e){return e.reduce((function(e,t){var n=kM(t);return n>e?n:e}),0)}function NM(e){return t.isNumber(e)?(t.formatNumber(e)+".").indexOf("."):0}function TM(e,n){var r;return r=t.isNumber(e)?t.lpad("",n-NM(e)," ")+t.formatNumber(e):t.isString(e)?function(e){var t={"\n":"\\n","\r":"\\r","\t":"\\t"};return e=e.replace(/[\r\t\n]/g,(function(e){return e in t?t[e]:""})),"'"+e+"'"}(e):t.isDate(e)?t.formatDateISO(e)+" (Date)":t.isObject(e)?JSON.stringify(e):String(e),"string"!=typeof r&&(r="["+typeof e+"]"),r}td.info=function(e,n){var r=kl(e).map((function(e){return PM(e.layer,e.dataset)}));(gt(function(e){var n="";return e.forEach((function(e,r){var i="Layer:    "+(e.layer_name||"[unnamed layer]"),a=OM(e.attribute_data),o=function(e){return Math.max.apply(null,e.split("\n").map((function(e){return kM(e)})))}(a),s=Math.min(Math.max(i.length,o),EM);n+="\n",n+=t.lpad("",s,"=")+"\n",n+=i+"\n",n+=t.lpad("",s,"-")+"\n",n+=function(e){var n="";n+="Type:     "+(e.geometry_type||"tabular data")+"\n",n+=t.format("Records:  %,d\n",e.feature_count),e.null_shape_count>0&&(n+=t.format("Nulls:     %'d",e.null_shape_count)+"\n");e.geometry_type&&e.feature_count>e.null_shape_count&&(n+="Bounds:   "+e.bbox.join(",")+"\n",n+="CRS:      "+e.proj4+"\n");return n+="Source:   "+(e.source_file||"n/a")+"\n",n}(e),n+=a})),n}(r)),n.save_to)&&Zc([{filename:n.save_to+(n.save_to.endsWith(".json")?"":".json"),content:JSON.stringify(r,null,2)}],n)},td.printInfo=td.info;var LM=Object.freeze({__proto__:null,getLayerInfo:PM,getAttributeTableInfo:jM,formatAttributeTableInfo:OM,formatTableValue:TM});function BM(e,n,r,i){var a=bA([e],n,r,i),o=Vd(a,i),s=a.layers.pop();n.arcs=a.arcs,_I(e,s);var u=new sp({geometry_type:"polygon",shapes:e.shapes.concat(s.shapes)},o,{flat:!1}),c=t.extend({},i),f=function(e,n,r,i){var a,o=function(e,t){return function(n){for(var r,i=[],a=0;a<n.length;a++)(r=n[a]-e)>=0&&r<t&&i.push(r);return i}}(e.shapes.length,n.shapes.length);i.largest_overlap&&(a=function(e,n,r){var i=r.nodes.arcs,a=e.shapes.length;function o(e){for(var t=0,n=0;n<e.length;n++)t+=$n.getShapeArea(r.mosaic[e[n]],i);return t}return function(e,n){var i=r.getTileIdsByShapeId(e),s=0,u=-1;return n.forEach((function(e,n){var c=r.getTileIdsByShapeId(e+a),f=o(t.intersection(i,c));f>=s&&(u=e,s=f)})),-1==u&&dt("Geometry error"),[u]}}(e,0,r));return function(e){for(var n,s=r.getTileIdsByShapeId(e),u=[],c=0;c<s.length;c++)n=r.getSourceIdsByTileId(s[c]),n=o(n),u=u.length>0?u.concat(n):n;return(u=t.uniq(u)).length>1&&i.largest_overlap&&(u=a(e,u)),u}}(e,s,u,i),l=GA(e,s.data,f,c);return i.interpolate&&(i.duplication&&pt("duplication and interpolate options cannot be used together"),function(e,t,n,r){var i=function(e,t,n,r){var i=r.planar?$n.getPlanarShapeArea:$n.getShapeArea,a=e.shapes.length,o=n.mosaic,s=n.nodes.arcs,u=o.map((function(e,t){return{area:i(e,s),weight:0,sourceId:-1}}));return t.shapes.forEach((function(e,t){for(var r,o=n.getTileIdsByShapeId(t+a),c=i(e,s),f=0;f<o.length;f++)(r=u[o[f]]).sourceId>-1||(r.weight=r.area/c,r.sourceId=t)})),u}(e,t,n,r),a=r.interpolate,o=t.data.getRecords();e.data.getRecords().forEach((function(e,t){var r,s,u=n.getTileIdsByShapeId(t),c=[];for(r=0;r<u.length;r++)c.push(i[u[r]]);for(r=0;r<a.length;r++)e[s=a[r]]=DM(s,c,o)}))}(e,s,u,i)),l}function DM(e,t,n){for(var r,i,a=0,o=0;o<t.length;o++)-1!=(r=t[o]).sourceId&&(i=n[r.sourceId],a+=r.weight*i[e]);return a}function UM(e,t,n){for(var r=n.getVertexData(),i=r.xx,a=r.yy,o=[],s=0,u=i.length;s<u;s++)i[s]==e&&a[s]==t&&o.push(s);return o}function RM(e,t){var n=t.getVertexData();return[n.xx[e],n.yy[e]]}function qM(e,t){for(var n=t.getVertexData(),r=n.ii,i=n.nn,a=0,o=r.length;a<o;a++)if(e===r[a]+i[a]-1)return!0;return!1}function $M(e,t){for(var n=t.getVertexData().ii,r=0,i=n.length;r<i;r++)if(e===n[r])return!0;return!1}function VM(e,t,n,r){var i=r.getVertexData();i.xx[n]=e,i.yy[n]=t}function GM(e,t,n,r,i){for(var a,o,s,u,c=i?$n.greatCircleDistance:$n.distance2D,f=1/0,l=0;l<n.length;l++)for(u=r.getShapeIter(n[l]);u.hasNext();)(s=c(e,t,u.x,u.y))<f&&(f=s,a=u.x,o=u.y);return f<1/0?{x:a,y:o}:null}td.inlay=function(e,t,n,r){var i=bA(e,n,t,r),a=i.layers[i.layers.length-1];ci(a),e.forEach(ci);var o={layer:hi(a),dataset:i},s=td.eraseLayers(e,o,i,r).map((function(e){var t=hi(a),n=td.mergeLayers([e,t],{force:!0})[0];return n.name=e.name,n}));return n.arcs=i.arcs,s},td.innerlines=function(e,t,n){n=n||{},ci(e);var r=n.where?$l(n.where,e,t):null,i=yw(e.shapes,t,{filter:r}),a=QI(e.shapes,i),o=ZI(a,null);return 0===a.length&&gt("No shared boundaries were found"),pi(o,e,null,n),o},td.inspect=function(e,n,r){var i,a=function(e,n,r){var i,a=ti(e),o=[];r.expression||pt("Missing a JS expression for selecting a feature");return i=ql(r.expression,e,n),t.repeat(a,(function(e){var t=i(e);!0===t?o.push(e):!1!==t&&pt("Expression must return true or false")})),o}(e,n,r);i=1==a.length?function(e,n,r){var i="Feature "+e+"\n";return i+=function(e,n,r){var i,a,o=n.shapes?n.shapes[e]:null,s=n.geometry_type;if(!o||!s)return"Geometry: [null]\n";a="Geometry\n  Type: "+s+"\n","point"==s?a+="  Points: "+o.length+"\n":"polyline"==s?a+="  Parts: "+o.length+"\n":"polygon"==s&&(i=function(e,t){for(var n,r={rings:e.length,cw:0,ccw:0,area:0},i=0;i<e.length;i++)(n=$n.getPlanarPathArea(e[i],t))>0?r.cw++:n<0&&r.ccw++,r.area+=n;t.isPlanar()||(r.sph_area=$n.getSphericalShapeArea(e,t));return r}(o,r),a+=t.format("  Rings: %d cw, %d ccw\n",i.cw,i.ccw),a+="  Planar area: "+i.area+"\n",i.sph_area&&(a+="  Spherical area: "+i.sph_area+" sq. meters\n"));return a}(e,n,r),i+=OM(jM(n,e)),i}(a[0],e,n):t.format("Expression matched %d feature%s. Select one feature for details",a.length,t.pluralSuffix(a.length)),gt(i)};var JM=Object.freeze({__proto__:null,findNearestVertices:function(e,t,n){var r=GM(e[0],e[1],t,n);return UM(r.x,r.y,n)},snapVerticesToPoint:function(e,t,n,r){e.forEach((function(e){VM(t[0],t[1],e,n)})),r&&n.transformPoints((function(){}))},snapPointToArcEndpoint:function(e,t,n){var r,i,a;t.forEach((function(e){$M(e,n)?r=RM(e+1,n):qM(e,n)&&(r=RM(e-1,n))})),r&&(i=r[0]-e[0],a=r[1]-e[1],Math.abs(i)>Math.abs(a)?e[1]=r[1]:e[0]=r[0])},findVertexIds:UM,getVertexCoords:RM,vertexIsArcEnd:qM,vertexIsArcStart:$M,setVertexCoords:VM,findNearestVertex:GM});function WM(e,t,n){if(!e)return null;var r=e.map((function(e){return function(e,t,n){var r,i=nn(e,t,!1)/2,a=0;er(e,t,(function(e,t,o,s){var u=o[e],c=s[e],f=o[t],l=s[t];if(!r){if(i>0==!1)return[u,c];var d,p=Jt(u,c,f,l);a+p>=i&&(d=(i-a)/p,n&&(d=d<.5?0:1),r=[(1-d)*u+d*f,(1-d)*c+d*l]),a+=p}})),r||dt("Geometry error");return r}(e,t,!1)}));return r}function YM(e,t,n){var r=!t.isPlanar(),i=e?1==e.length?e[0]:function(e,t,n){var r=0,i=null;return e.forEach((function(e){var a=$n.calcPathLen(e,t,n);a>r&&(r=a,i=e)})),i}(e,t,r):null;if(!i)return null;var a=t.getSimpleShapeBounds(i);return GM(a.centerX(),a.centerY(),[i],t,r)}function HM(e,t,n){var r=n.inner?Al:$n.getShapeCentroid;return e.shapes.map((function(e){var n=r(e,t);return n?[[n.x,n.y]]:null}))}function XM(e){var n;if(t.isFiniteNumber(e))return e;if(t.isString(e)&&""!==e){if(n=+e,t.isFiniteNumber(n))return n;if(n=gl(e),t.isFiniteNumber(n))return n}return NaN}function ZM(e){var n=/^(lng|long?|longitude|x)$/i;return t.find(e,(function(e){return n.test(e)}))}function QM(e){var n=/^(lat|latitude|y)$/i;return t.find(e,(function(e){return n.test(e)}))}function KM(e,t){return e||pt("Layer is missing a data table"),t.x&&t.y&&e.fieldExists(t.x)&&e.fieldExists(t.y)||pt("Missing x,y data fields"),e.getRecords().map((function(e){var n=XM(e[t.x]),r=XM(e[t.y]);return isNaN(n)||isNaN(r)?null:[[n,r]]}))}td.createPointLayer=function(e,n,r){var i=di(e,r),a=n.arcs;r.intersections?(!function(e){var t=e.getFilteredPointCount(),n=e.size(),r=t-n,i=Bd(e),a=Math.ceil(i/10),o=10*i,s=Dd(e);console.log("points:",t,"arcs:",n,"segs:",r),[a,i,o,s].forEach((function(t){console.time(t+" stripes"),Cd(e,{stripes:t}),console.timeEnd(t+" stripes")}))}(a),i=e):r.interpolated?i.shapes=function(e,t,n){var r,i=Hf(n.interval,Qi(t));i>0==!1&&pt("Invalid interpolation interval:",n.interval);"polyline"!=e.geometry_type&&pt("Expected a polyline layer");return e.shapes.map((function(e,t){return r=[],e&&e.forEach(a),r.length>0?r:null}));function a(e){var n=function(e,t,n){var r,i,a,o,s,u=t.getShapeIter(e),c=t.isPlanar()?$n.distance2D:$n.greatCircleDistance,f=[],l=0;u.hasNext()&&(f.push([u.x,u.y]),r=u.x,i=u.y);for(;u.hasNext();){for(a=c(r,i,u.x,u.y);l+a>=n;)o=(n-l)/a,s=Db(r,i,u.x,u.y,o),l=0,f.push(s),a=c(r=s[0],i=s[1],u.x,u.y);l+=a,r=u.x,i=u.y}l>0&&f.push([r,i]);return f}(e,t.arcs,i);r=r.concat(n)}}(e,n,r):r.vertices?i.shapes=function(e,t,n){var r,i;"polygon"!=e.geometry_type&&"polyline"!=e.geometry_type&&pt("Expected a polygon or polyline layer");return e.shapes.map((function(e,t){return r=[],i={},(e||[]).forEach(o),r.length>0?r:null}));function a(e){var t=e.x+"~"+e.y;t in i==!1&&(i[t]=!0,r.push([e.x,e.y]))}function o(e){for(var n=t.getShapeIter(e);n.hasNext();)a(n)}}(e,a):r.vertices2?i.shapes=function(e,t,n){var r;"polygon"!=e.geometry_type&&"polyline"!=e.geometry_type&&pt("Expected a polygon or polyline layer");return e.shapes.map((function(e,t){return r=[],(e||[]).forEach(i),r.length>0?r:null}));function i(e){for(var n=t.getShapeIter(e);n.hasNext();)r.push([n.x,n.y])}}(e,a):r.endpoints?i.shapes=function(e,t){var n,r;"polygon"!=e.geometry_type&&"polyline"!=e.geometry_type&&pt("Expected a polygon or polyline layer");return e.shapes.map((function(e,t){return n=[],r={},(e||[]).forEach(a),n.length>0?n:null}));function i(e){var t=e.x+"~"+e.y;t in r==!1&&(r[t]=!0,n.push([e.x,e.y]))}function a(e){for(var n=0;n<e.length;n++)i(t.getVertex(e[n],0)),i(t.getVertex(e[n],-1))}}(e,a):r.x||r.y?i.shapes=KM(e.data,r):"polygon"==e.geometry_type?i.shapes=HM(e,a,r):r.midpoints?(ui(e),i.shapes=function(e,t,n){return e.shapes.map((function(e){return WM(e,t)}))}(e,a)):"polyline"==e.geometry_type?i.shapes=function(e,t,n){return e.shapes.map((function(e){var n=YM(e,t);return n?[[n.x,n.y]]:null}))}(e,a):e.geometry_type?pt("Expected a polygon or polyline layer"):i.shapes=function(e){var t=e?e.getFields():[],n={x:ZM(t),y:QM(t)};return KM(e,n)}(e.data),i.geometry_type="point";var o=i.shapes.reduce((function(e,t){return t||e++,e}),0);return o>0&&gt(t.format("%,d of %,d points are null",o,i.shapes.length)),e.data&&(i.data=r.no_replace?e.data.clone():e.data),i};var eE=Object.freeze({__proto__:null,pointsFromPolygons:HM,coordinateFromValue:XM,findXField:ZM,findYField:QM});function tE(e,t){return{geometry_type:"point",shapes:HM(e,t.arcs,{inner:!0}),data:e.data}}function nE(e,t,n,r){return r.point_method?function(e,t,n,r){var i,a,o=n.layer,s=n.dataset;return e.shapes.length>o.shapes.length?(a=xI(i=tE(e,t),o,s.arcs,r),e.data=i.data):(i=tE(o,s),a=bI(e,t.arcs,i,r)),a}(e,t,n,r):BM(e,t,n,r)}function rE(e,t){return{geometry_type:"point",shapes:e.shapes.map((function(e){return WM(e,t.arcs)})),data:e.data}}function iE(e){e.point_method||pt('The "point-method" flag is required for polyline-polygon joins')}class aE{constructor(e=[],t=oE){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,r=t[e];for(;e>0;){const i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r}_down(e){const{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;e<r;){let r=1+(e<<1),a=t[r];const o=r+1;if(o<this.length&&n(t[o],a)<0&&(r=o,a=t[o]),n(a,i)>=0)break;t[e]=a,e=r}t[e]=i}}function oE(e,t){return e<t?-1:e>t?1:0}var sE=6371,uE=Math.PI/180;function cE(e,t,n,r){var i=r.minLng,a=r.maxLng,o=r.minLat,s=r.maxLat;if(e>=i&&e<=a)return t<o?lE((t-o)*uE):t>s?lE((t-s)*uE):0;var u=Math.min(lE((e-i)*uE),lE((e-a)*uE)),c=function(e,t){var n=1-2*t;return n<=0?e>0?90:-90:Math.atan(Math.tan(e*uE)/n)/uE}(t,u);return c>o&&c<s?dE(u,n,t,c):Math.min(dE(u,n,t,o),dE(u,n,t,s))}function fE(e,t){return e.dist-t.dist}function lE(e){var t=Math.sin(e/2);return t*t}function dE(e,t,n,r){return t*Math.cos(r*uE)*e+lE((n-r)*uE)}function pE(e,t,n,r,i){return dE(lE((e-n)*uE),i,t,r)}function hE(e,t,n){si(e);var r=Ct(e),i=n.max_distance?Yf(n.max_distance,t):.001,a=function(e,t,n){var r=!!t&&ta(t),i=t&&t.to_meter||1;if(r)return function(t){return function(e,t,n,r,i,a){var o=1,s=[];void 0===r&&(r=1/0),void 0!==i&&(o=lE(i/sE));for(var u,c,f,l=new aE([],fE),d={left:0,right:e.ids.length-1,axis:0,dist:0,minLng:-180,minLat:-90,maxLng:180,maxLat:90},p=Math.cos(n*uE);d;){if((u=d.right)-(c=d.left)<=e.nodeSize)for(var h=c;h<=u;h++)f=e.points[e.ids[h]],a&&!a(f)||l.push({i:e.ids[h],item:f,dist:pE(t,n,e.coords[2*h],e.coords[2*h+1],p)});else{var g=c+u>>1,m=e.coords[2*g],y=e.coords[2*g+1];f=e.points[e.ids[g]],a&&!a(f)||l.push({i:e.ids[g],item:f,dist:pE(t,n,m,y,p)});var v=(d.axis+1)%2,b={left:c,right:g-1,axis:v,minLng:d.minLng,minLat:d.minLat,maxLng:0===d.axis?m:d.maxLng,maxLat:1===d.axis?y:d.maxLat,dist:0},x={left:g+1,right:u,axis:v,minLng:0===d.axis?m:d.minLng,minLat:1===d.axis?y:d.minLat,maxLng:d.maxLng,maxLat:d.maxLat,dist:0};b.dist=cE(t,n,p,b),x.dist=cE(t,n,p,x),l.push(b),l.push(x)}for(;l.length&&l.peek().item;){var _=l.pop();if(_.dist>o)return s;if(s.push(_.i),s.length===r)return s}d=l.pop()}return s}(e,t[0],t[1],1/0,n/1e3)};return function(t){return e.within(t[0],t[1],n/i)}}(new(pr("kdbush"))(r),t,i),o=new Sd(r.length);this.lookupByMultiPoint=function(e){var t,n,r,i,s=[];for(n=0,i=e?e.length:0;n<i;n++)for(t=e[n],s=a(t),r=0;r<s.length;r++)o.setId(s[r]);return s=o.getIds(),o.clear(),s}}function gE(e,t,n,r){var i=function(e,t,n,r){var i=e.shapes,a=new hE(t,n,r);return function(e){var t=a.lookupByMultiPoint(i[e]);return t.length>0?t:null}}(e,t,n,r);return _I(e,t),GA(e,t.data,i,r)}function mE(e,t,n){var r=n.keys,i=r[0],a=r[1],o=function(e,t,n,r){e||pt("Target layer is missing an attribute table");n||pt("Source layer is missing an attribute table");var i,a,o=e.getRecords(),s=n.getRecords(),u=function(e,t){for(var n,r={},i=0,a=e.length;i<a;i++)(n=e[i][t])in r==!1?r[n]=i:Array.isArray(r[n])?r[n].push(i):r[n]=[r[n],i];return r}(s,r);if(0==s.length)return function(e){return[]};ri(n,r,"External table is missing a field named:"),ri(e,t,"Target layer is missing key field:"),i=Cr(r,n.getRecords()),a=Cr(t,o),yE(r,i),yE(t,a),i!=a&&pt("Join keys have mismatched data types:",a,"and",i);return function(e){var n=o[e],r=n?n[t]:null,i=null;return n&&r in u&&(i=u[r],Array.isArray(i)||(i=[i])),i}}(e.data,i,t,a);return JA(r),GA(e,t,o,n)}function yE(e,t){t&&"object"!=t||pt("["+e+"] field has an unsupported data type. Expected string or number.")}td.join=function(e,n,r,i){var a,o,s;r&&r.dataset||pt("Missing a joinable data source"),i.keys?(2!=i.keys.length&&pt("Expected two key fields: a target field and a source field"),r.layer.data||pt("Source layer is missing attribute data"),s=mE(e,r.layer.data,i)):(r.layer.data||xi(r.layer),Ki([n,r.dataset]),a=r.layer.geometry_type,o=e.geometry_type,"point"==a&&"polygon"==o?s=bI(e,n.arcs,r.layer,i):"polygon"==a&&"point"==o?s=xI(e,r.layer,r.dataset.arcs,i):"point"==a&&"point"==o?s=gE(e,r.layer,Qi(n),i):"polygon"==a&&"polygon"==o?s=nE(e,n,r,i):"polyline"==a&&"polygon"==o?s=function(e,t,n,r){iE(r);var i=rE(n.layer,n.dataset);return bI(e,t.arcs,i,r)}(e,n,r,i):"polygon"==a&&"polyline"==o?s=function(e,t,n,r){iE(r);var i=rE(e,t),a=xI(i,n.layer,n.dataset.arcs,r);return e.data=i.data,a}(e,n,r,i):pt(t.format("Unable to join %s geometry to %s geometry",a||"null",o||"null"))),s.unmatched&&n.layers.push(s.unmatched),s.unjoined&&n.layers.push(s.unjoined)};var vE=Object.freeze({__proto__:null,joinAttributesToFeatures:mE});function bE(e,n,r){var i={},a=n?Qi(n):null;return r.interval?i.interval=Hf(r.interval,a):pt("Missing required interval option"),r.bbox?i.bbox=r.bbox:n?(n=t.defaults({layers:e},n),i.bbox=$a(n).toArray()):pt("Missing grid bbox"),i.width=i.bbox[2]-i.bbox[0],i.height=i.bbox[3]-i.bbox[1],i.type=r.type||"square",i}function xE(e){var t=[];return e.forEach((function(e){e.forEach((function(e){t.push({type:"Point",coordinates:e})}))})),{type:"GeometryCollection",geometries:t}}function _E(e){var t,n,r,i,a,o,s,u,c,f,l=[],d=e.length-2;for(s=0;s<d;s++)for(u=(f=s%2==0)?0:2,c=f?0:-1;t=e[s][u],n=e[s+1][u+c],r=e[s+2][u],i=e[s+2][u+1],a=e[s+1][u+2+c],o=e[s][u+1],i&&a;u+=3)l.push({type:"Polygon",coordinates:[[t,n,r,i,a,o,t]]});return{type:"GeometryCollection",geometries:l}}function wE(e){for(var t,n,r=e.interval,i=Math.sqrt(3)*r/2,a=r/2,o=e.width+2*r,s=e.height+2*i,u=-i,c=[];u<s;){for(t=c.length%2==0?0:-a,n=[],c.push(n);t<o;)n.push([t,u]),t+=r;u+=i}return c}function SE(e){for(var t,n,r=0,i=[],a=e.interval,o=e.width+a,s=e.height+a;r<s;){for(t=0,n=[],i.push(n);t<o;)n.push([t,r]),t+=a;r+=a}return i}function AE(e,t){var n=function(e){var t={Point:r,Polygon:n};return e.geometries.reduce((function(e,n){var r=(0,t[n.type])(n);return e?(i(e,r[0],r[1]),i(e,r[2],r[3]),e):r}),null);function n(e){return e.coordinates[0].reduce((function(e,t){return e?(i(e,t[0],t[1]),e):[t[0],t[1],t[0],t[1]]}),null)}function r(e){var t=e.coordinates;return[t[0],t[1],t[0],t[1]]}function i(e,t,n){t<e[0]&&(e[0]=t),n<e[1]&&(e[1]=n),t>e[2]&&(e[2]=t),n>e[3]&&(e[3]=n)}}(e);!function(e,t,n){e.geometries.forEach((function(e){"Point"==e.type&&(e.coordinates=[e.coordinates[0]+t,e.coordinates[1]+n]),"Polygon"==e.type&&(e.coordinates[0]=e.coordinates[0].map((function(e){return[e[0]+t,e[1]+n]})))}))}(e,(t[2]+t[0])/2-(n[2]+n[0])/2,(t[3]+t[1])/2-(n[3]+n[1])/2)}function IE(e){var t=e.interval*Math.sqrt(1/Math.PI);return e.radius>0?e.radius:t}function ME(e,t,n){for(var r,i,a=[],o=0,s=0;s<e.length;s++)(r=t[s])>0!=!1&&(o+=r,a.push(e[s]));return i={weight:o},n&&n(a,i),i}function EE(e,t,n,r,i){for(var a,o=[],s=t*Math.sqrt(1/Math.PI),u=t*t,c=0;c<r.length;c++)a=PE(e,s,n[r[c]],i)/u,o.push(a);return o}function PE(e,t,n,r){var i=Jt(e[0],e[1],n[0],n[1]);if(i>=t+r)return 0;var a=t*t,o=r*r,s=(a-o+i*i)/(2*i),u=i-s;return i<=Math.abs(t-r)?Math.PI*Math.min(a,o):a*Math.acos(s/t)-s*Math.sqrt(a-s*s)+o*Math.acos(u/r)-u*Math.sqrt(o-u*u)}function jE(e,t,n){var r=n.circles?OE(t.idxToPoint(e),n):function(e,t){var n=t.interval*(t.cell_margin||0),r=e[0]+n,i=e[1]+n,a=e[2]-n,o=e[3]-n;return[[r,i],[r,o],[a,o],[a,i],[r,i]]}(t.idxToBBox(e),n);return{type:"Polygon",coordinates:[r]}}function OE(e,t){var n=t.cell_margin>0?t.cell_margin:1e-6;return _x(e,t.interval/2*(1-n),t.vertices||20,Rb)}function kE(e,t,n){var r=pr("flatbush"),i=new Sd(t.cells()),a=new r(e.length),o=[];return e.forEach((function(e){var r=function(e,t){return[e[0]-t,e[1]-t,e[0]+t,e[1]+t]}(e,n);!function(e,t,n){var r=n.pointToIdx(e),i=n.idxToCol(r),a=n.idxToRow(r);FE(i+1,a+1,n,t),FE(i+1,a,n,t),FE(i+1,a-1,n,t),FE(i,a+1,n,t),FE(i,a,n,t),FE(i,a-1,n,t),FE(i-1,a+1,n,t),FE(i-1,a,n,t),FE(i-1,a-1,n,t)}(e,i,t),a.add.apply(a,r)})),a.finish(),function(e){if(!i.hasId(e))return o;var n=t.idxToBBox(e);return a.search.apply(a,n)}}function FE(e,t,n,r){var i=n.colRowToIdx(e,t);i>-1&&r.setId(i)}function zE(e,t,n){return[(Math.floor(e/n)-1)*n,(Math.ceil(t/n)+1)*n]}function CE(e,t,n){var r=t-e,i=(Math.ceil(r/n)*n-r)/2+n;return[e-i,t+i]}function NE(e,t){var n=zE(e[0],e[2],t),r=zE(e[1],e[3],t);return[n[0],r[0],n[1],r[1]]}function TE(e,t){var n=CE(e[0],e[2],t),r=CE(e[1],e[3],t);return[n[0],r[0],n[1],r[1]]}function LE(e,t,n){var r=n&&n.aligned?NE(e,t):TE(e,t),i=r[0],a=r[1],o=r[2]-i,s=r[3]-a,u=Math.round(o/t),c=Math.round(s/t);function f(e){var t=e[0]-i;return Math.floor(t/o*u)}function l(e){var t=e[1]-a;return Math.floor(t/s*c)}function d(e,t){return e<0||t<0||e>=u||t>=c?-1:t*u+e}function p(e){return e%u}function h(e){return Math.floor(e/u)}return{size:function(){return[u,c]},cells:function(){return u*c},pointToCol:f,pointToRow:l,colRowToIdx:d,pointToIdx:function(e){return d(f(e),l(e))},idxToCol:p,idxToRow:h,idxToBBox:function(e){var n=p(e),r=h(e);return[i+n*t,a+r*t,i+(n+1)*t,a+(r+1)*t]},idxToPoint:function(e){return[i+(p(e)+.5)*t,a+(h(e)+.5)*t]}}}td.mosaic=function(e,t,n){var r=e[0];(!r||e.length>1)&&pt("Command takes a single target layer"),ci(r);var i,a=new sp(r,Vd(t,n),{flat:!1}),o=a.mosaic,s={name:"name"in r?r.name:void 0,shapes:o,geometry_type:"polygon"};return n.calc&&(r.data||xi(r),i=ld(r.data.getRecords(),a.getSourceIdsByTileId,o.length,n),s.data=new Jr(i)),[s]},td.polygonGrid=function(e,n,r){Hi(n);var i=function(e,n){var r,i;"square"==e.type?r=function(e){for(var t,n,r,i,a=[],o=0,s=e.length-1;o<s;o++)for(var u=0,c=e[o].length-1;u<c;u++)t=e[o][u],n=e[o+1][u],r=e[o+1][u+1],i=e[o][u+1],a.push({type:"Polygon",coordinates:[[t,n,r,i,t]]});return{type:"GeometryCollection",geometries:a}}(SE(e)):"hex"==e.type?r=_E(wE(e)):"hex2"==e.type?(r=_E(wE(function(e){var n=e.bbox;return t.defaults({width:e.height,height:e.width,bbox:[n[1],n[0],n[3],n[2]]},e)}(e))),r.geometries.forEach((function(e){e.coordinates[0]=e.coordinates[0].map((function(e){return[e[1],e[0]]}))}))):pt("Unsupported grid type");return AE(r,e.bbox),_a(i=By(r,{})),i}(bE(e,n,r));return i.info=n.info,pi(i.layers[0],null,"grid",r),r.debug&&i.layers.push(td.pointGrid2(e,n,r)),i},td.pointGrid2=function(e,t,n){var r,i=bE(e,t,n);"square"==i.type?r=xE(SE(i)):"hex"==i.type?r=xE(wE(i)):pt("Unsupported grid type"),AE(r,i.bbox);var a=By(r,{});return n.name&&(a.layers[0].name=n.name),a.layers[0]},td.pointGrid=function(e,t){var n,r,i=function(e,t){var n={},r=e?Qi(e):null;t.interval?n.interval=Hf(t.interval,r):t.rows>0&&t.cols>0&&(n.rows=t.rows,n.cols=t.cols);t.bbox?n.bbox=t.bbox:n.bbox=e?$a(e).toArray():[-180,-90,180,90];return n}(e,t),a=(n=function(e){var t,n,r,i,a,o,s,u,c,f=e.bbox,l=f[2]-f[0],d=f[3]-f[1],p=[];for(e.interval>0?(i=e.interval,a=e.interval,n=Math.round(l/i)-1,r=Math.round(d/a)-1,o=f[0]+(l-n*i)/2,s=f[1]+(d-r*a)/2):e.rows>0&&e.cols>0&&(i=l/(n=e.cols),a=d/(r=e.rows),o=f[0]+i/2,s=f[1]+a/2),i>0!=0&&a>0!=0||pt("Invalid grid parameters"),c=s;c<=f[3];){for(u=o,p.push(t=[]);u<=f[2];)t.push([u,c]),u+=i;c+=a}return p}(i),r=[],n.forEach((function(e,t){for(var n=0;n<e.length;n++)r.push([e[n]])})),{geometry_type:"point",shapes:r});return pi(a,null,"grid",t),a},td.pointToGrid=function(e,t,n){e.forEach(oi),n.interval>0==!1&&pt("Expected a non-negative interval parameter"),n.radius;var r=$a(t).toArray(),i=[t],a=e.map((function(e){mi(e)>0&&pt("This command requires single points");var t=function(e,t,n){for(var r,i,a=Ct(e),o=n.interval,s=LE(t,o,n),u=IE(n),c=kE(a,s,u),f={type:"FeatureCollection",features:[]},l=n.calc?od(e.data,n.calc):null,d=0,p=s.cells();d<p;d++)(r=c(d)).length&&(i=ME(r,EE(s.idxToPoint(d),o,a,r,u),l)).weight>.05!=!1&&(i.id=d,f.features.push({type:"Feature",properties:i,geometry:jE(d,s,n)}));return By(f,{})}(e,r,n),a=t.layers[0];return i.push(t),pi(a,e,"grid",n),a})),o=Ea(i);return _a(o),t.arcs=o.arcs,a};var BE=Object.freeze({__proto__:null,getPointCircleRadius:IE,calcCellProperties:ME,calcWeights:EE,twoCircleIntersection:PE,makeCellPolygon:jE,makeCircleCoords:OE,getPointIndex:kE,getAlignedGridBounds:NE,getCenteredGridBounds:TE,getGridData:LE});function DE(e,t,n){var r=n.gap_tolerance?Hf(n.gap_tolerance,Qi(t)):0,i=t.arcs,a=Jn(e.shapes,i),o=new Ca(t.arcs,a),s=function(e,t){return e.findDanglingEndpoints().filter((function(n){return $n.calcPathLen([n.arc],e.arcs)>t}))}(o,r);if(0===s.length)return o;var u=function(e,t){for(var n=[],r=0,i=e.size();r<i;r++)n.push(t(r)?[[r]]:null);return n}(i,a),c=new sf(u,i),f=s.reduce((function(e,t){var n=function(e,t,n,r){var i=Lt(e.arc),a=null;return t.forEach((function(t){var o;t!=i&&(o=$n.getPointToPathInfo(e.point[0],e.point[1],[t],n))&&o.distance<=r&&(!a||o.distance<a.distance)&&(a=o)})),a}(t,c.findPointEnclosureCandidates(t.point,r),i,r);return n&&e.push(function(e,t,n){var r=n.getVertex(t,-1),i=[r.x,r.y],a=n.getVertex(t,-2),o=[a.x,a.y],s=e.segment[0],u=e.segment[1],c=$n.findClosestPointOnSeg(i[0],i[1],s[0],s[1],u[0],u[1]);f=c,l=s,d=u,f[0]==l[0]&&f[1]==l[1]||f[0]==d[0]&&f[1]==d[1]||(c=function(e,t){var n=$n.distance2D(e[0],e[1],t[0],t[1]),r=(n+1e-6)/n;return[e[0]+r*(t[0]-e[0]),e[1]+r*(t[1]-e[1])]}(o,c),$n.segmentIntersection(o[0],o[1],c[0],c[1],s[0],s[1],u[0],u[1])||(c=function(e,t,n){return $n.distance2D(e[0],e[1],t[0],t[1])<$n.distance2D(e[0],e[1],n[0],n[1])?t:n}(o,s,u)));var f,l,d;return{arc:t,point:c}}(n,t.arc,i)),e}),[]);return t.arcs=function(e,t){var n=e.getVertexData();return t.forEach((function(t){var r=e.indexOfVertex(t.arc,-1);n.xx[r]=t.point[0],n.yy[r]=t.point[1]})),e.updateVertexData(n.nn,n.xx,n.yy,n.zz),e}(i,f),Vd(t,{})}function UE(e){return Array.isArray(e)&&t.isObject(e[0])?e.map((function(e){return{name:e.name,options:Object.assign({},e.options)}})):(t.isString(e)&&(e=ty(e)),dy().parseArgv(e))}function RE(e){var t=e.replace(/^mapshaper\b/,"").trim();return dy(),t=t.split(/\n+/g).map((function(e){return/^[a-z][\w-]*/i.exec(e=e.trim())&&(e="-"+e),e})).join(" ")}td.polygons=function(e,t,n){return e.forEach(ui),Vd(t,n),e.map((function(e){return"polyline"!=e.geometry_type&&pt("Expected a polyline layer"),n.from_rings?function(e,t){var n=t.arcs,r=0;cr(e.shapes,(function(e){return $n.pathIsClosed(e,n)?e:(r++,null)})),r>0&&gt("Removed",r,"open "+(1==r?"ring":"rings"));return e.geometry_type="polygon",uf(e,n),e}(e,t):function(e,t,n){var r=DE(e,t,n),i=np(r);return{geometry_type:"polygon",name:e.name,shapes:i.mosaic}}(e,t,n)}))},td.print=function(e){vt(e||"")},td.renameLayers=function(e,n,r){n&&n.join("").indexOf("=")>-1?function(e,n){var r=function(e){return(e||[]).reduce((function(e,n){var r=n.split("="),i=t.trimQuotes(r[0]),a=t.trimQuotes(r[1]||"");return a||pt("Invalid name assignment:",n),e[a]=i,e}),{})}(e);n.forEachLayer((function(e){r[e.name]&&(e.name=r[e.name])}))}(n,r):function(e,t){var n=e&&e.length||0,r="",i="";t.forEach((function(a,o){o<n&&(r=e[o]),r&&n<t.length&&o>=n-1&&(i=(i||0)+1),a.name=r+i}))}(n,e)};var qE=Object.freeze({__proto__:null,parseCommands:UE,standardizeConsoleCommands:RE,parseConsoleCommands:function(e){var t=UE(RE(e));return t.forEach((function(e){Xc.checkCommandEnv(e.name)})),t}});function $E(e,n){var r,a,o=Xl();n&&1==n.length&&(a=function(e){var t=e.layers[0],n=PM(t,e.dataset);return n.layer=t,n.dataset=e.dataset,n}(n[0]),Object.defineProperty(o,"target",{value:a})),t.extend(o,i("defs"));try{r=Function("ctx","with(ctx) {return ("+e+");}").call({},o)}catch(e){pt(e.name,"in JS source:",e.message)}return r}function VE(e){var t=2*e.size(),n=new Ca(e).size();return e.getPointCount()-t+n}td.run=function(e,t,n,r){var i;n.expression||pt("Missing expression parameter"),(i=$E(n.expression,t))?(gt(`command: [${i}]`),HP(UE(i),e,r)):r(null)},td.require=function(e,t){var n,r,a,o=i("defs");t.module||pt("Missing module name or path to module"),Xc.isFile(t.module)?n=t.module:Xc.isFile(t.module+".js")?n=t.module+".js":r=t.module,n&&!pr("path").isAbsolute(n)&&(n=pr("path").join(process.cwd(),n));try{if("function"==typeof(a=pr(n||r))){var s=a(fj);s&&function(e){try{return sI(e),!0}catch(e){}return!1}(s)&&td.registerCommand(s.name,s)}}catch(e){pt("Unable to load external module:",e.message,yt(e))}r||t.alias?o[t.alias||r]=a:Object.assign(o,a),t.init&&$E(t.init,e)},td.shape=function(e,t){var n,r;return t.coordinates?n=function(e){var t,n,r,i,a=[],o=e.offsets||[],s=e.coordinates;s.length>=2==!1&&pt("Invalid coordinates parameter.");for(n=0;n<s.length;n+=2)r=s[n],i=s[n+1],a.push([r,i]);for(n=0;n<o.length;n+=2)r+=o[n],i+=o[n+1],a.push([r,i]);yp.pathIsRing(a)?t="Polygon":e.closed&&a.length>=3?(t="Polygon",a.push(a[0])):t="LineString";return{type:t,coordinates:"Polygon"==t?[a]:a}}(t):"circle"==t.type?n=function(e){e.radius>0==!1&&e.radius_angle>0==!1&&pt("Missing required radius parameter.");var t=e.center||[0,0],n=e.radius||TI(Yi("wgs84"),e.radius_angle);return bx(t,n,null,{geometry_type:e.geometry||"polygon"})}(t):"rectangle"==t.type&&t.bbox?n=function(e){var t=e.bbox,n=t[0],r=t[1],i=t[2],a=t[3],o=.5,s=[],u="polyline"==e.geometry?"LineString":"Polygon";return c(n,r,n,a),c(n,a,i,a),c(i,a,i,r),c(i,r,n,r),s.push([n,r]),{type:u,coordinates:"Polygon"==u?[s]:s};function c(e,t,n,r){for(var i=n-e,a=r-t,u=Math.ceil(Math.max(Math.abs(i)/o,Math.abs(a)/o)),c=i/u,f=a/u,l=0;l<u;l++)s.push([e+l*c,t+l*f])}}(t):pt("Missing coordinates parameter"),r=By(n,{}),t.rotation&&UI(r,t.rotation),r.layers[0].name=t.name||t.type||"shape",r};var GE={};function JE(e,n){var r=dP(n),i={dp:"Ramer-Douglas-Peucker",visvalingam:"Visvalingam",weighted_visvalingam:"Weighted Visvalingam"}[r]||"Unknown",a=fP(e,n),o=function(e,n){var r,i=n?function(e,t,n,r,i,a){var o=[],s=[],u=[];return $n.convLngLatToSph([e,n,i],[t,r,a],o,s,u),$n.pointSegDistSq3D(o[0],s[0],u[0],o[1],s[1],u[1],o[2],s[2],u[2])}:$n.pointSegDistSq,a=n?$n.signedAngleSph:$n.signedAngle,o=0,s=0,u=0,c=0,f=0,l=-1,d=-1,p=[],h=[],g=e.getVertexData().zz;return e.forEachSegment((function(e,t,n,r){var m,y,v,b,x,_,w,S,A;if(m=n[e],y=r[e],v=n[t],b=r[t],e==d&&((S=a(n[l],r[l],m,y,v,b))>Math.PI&&(S=2*Math.PI-S),isNaN(S)||h.push(180*S/Math.PI)),l=e,d=t,g[e]<1/0&&s++,!((w=t-e-1)<1))if(o+=w,m==v&&y==b)u++;else{for(x=0;++e<t;)A=i(n[e],r[e],m,y,v,b),x=Math.max(x,A);_=Math.sqrt(x),f+=_,p.push(_),c=Math.max(c,_)}})),r={angleMean:0,displacementMean:0,displacementMax:c,collapsedRings:u,removed:o,retained:s,uniqueCount:VE(e),removableCount:o+s},h.length>0&&(r.angleMean=t.sum(h)/h.length,r.angleQuartiles=[t.findValueByPct(h,.75),t.findValueByPct(h,.5),t.findValueByPct(h,.25)]),p.length>0&&(r.displacementMean=f/p.length,r.displacementQuartiles=[t.findValueByPct(p,.75),t.findValueByPct(p,.5),t.findValueByPct(p,.25)]),r}(e,a),s=(o.removed+o.collapsedRings)/o.uniqueCount||0,u=o.removed/o.removableCount||0,c=o.angleQuartiles,f=o.displacementQuartiles,l=["Simplification statistics"];l.push(t.format("Method: %s (%s) %s",i,a?"spherical":"planar","weighted_visvalingam"==r?"(weighting="+GE.getWeightCoefficient(n)+")":"")),l.push(t.format("Removed vertices: %,d",o.removed+o.collapsedRings)),l.push(t.format("   %.1f% of %,d unique coordinate locations",100*s,o.uniqueCount)),l.push(t.format("   %.1f% of %,d filterable coordinate locations",100*u,o.removableCount)),l.push(t.format("Simplification threshold: %.4f %s",e.getRetainedInterval(),a?"meters":"")),l.push(t.format("Collapsed rings: %,d",o.collapsedRings)),l.push("Displacement statistics"),l.push(t.format("   Mean displacement: %.4f",o.displacementMean)),l.push(t.format("   Max displacement: %.4f",o.displacementMax)),f&&l.push(t.format("   Quartiles: %.2f, %.2f, %.2f",f[0],f[1],f[2])),l.push("Vertex angle statistics"),l.push(t.format("   Mean angle: %.2f degrees",o.angleMean)),c&&l.push(t.format("   Quartiles: %.2f, %.2f, %.2f",c[0],c[1],c[2])),gt(l.join("\n   "))}function WE(e){var n,r=Cd(e),i=YE(e,r),a=r.length,o=i.length,s=a>o?a-o:0;a>0&&(n=t.format("Repaired %'i intersection%s",s,t.pluralSuffix(s)),o>0&&(n+=t.format("; %'i intersection%s could not be repaired",o,t.pluralSuffix(o))),gt(n))}function YE(e,t){for(;HE(e,t)>0;)t=Cd(e);return t}function HE(e,n){var r,i,a,o,s=e.getVertexData(),u=e.getRetainedInterval(),c=0,f=0;for(i=XE(n,u,s.zz),t.sortOn(i,"z",!0);i.length>0;)for(1==(r=KE(a=i.pop(),u,s.xx,s.yy,s.zz)).length&&(r=QE(r[0],u,s.zz),c++),o=0;o<r.length;o++)ZE(i,r[o]);return++f>5e5?(bt("Caught an infinite loop at intersection:",a),0):c}function XE(e,t,n){return e.reduce((function(e,r){var i=function(e,t,n){var r,i=Zn(n,t,e.a[0],e.a[1]),a=Zn(n,t,e.b[0],e.b[1]);r=-1==i&&-1==a?null:-1==a||-1!=i&&n[i]>n[a]?{a:e.a,b:e.b,z:n[i]}:{a:e.b,b:e.a,z:n[a]};return r}(r,t,n);return null!==i&&e.push(i),e}),[])}function ZE(e,t){for(var n=e.length;n>0&&!(e[n-1].z<=t.z);)e[n]=e[n-1],n--;e[n]=t}function QE(e,t,n){for(var r=[],i=e.a[0],a=e.a[1],o=e.z,s=i+1;s<=a;s++)n[s]!=o&&s!=a||(r.push({a:[i,s],b:e.b,z:o}),s!=a&&(n[s]=t),i=s);return r.length<2&&dt("Error in unwindIntersection()"),r}function KE(e,t,n,r,i){var a=function(e,t,n,r,i){var a=eP(e.a,t,n,r,i);return a=a.concat(eP(e.b,t,n,r,i)),a}(e,t,n,r,i);return XE(Ud(a,n,r),t,i)}function eP(e,t,n,r,i){var a,o,s,u=[];e[0]<=e[1]?(a=e[0],o=e[1]):(a=e[1],o=e[0]),s=a;for(var c=a+1;c<=o;c++)i[c]>=t&&(n[s]<n[c]?u.push(s,c):u.push(c,s),s=c);return u}GE.getArcCalculator=function(e,n){var r=new eI,i=t.expandoBuffer(Int32Array),a=t.expandoBuffer(Int32Array),o=n?function(t,n,r,i,a,o){return e(i[t],a[t],o[t],i[n],a[n],o[n],i[r],a[r],o[r])}:function(t,n,r,i,a){return e(i[t],a[t],i[n],a[n],i[r],a[r])};return function(e,t,s,u){var c,f,l,d,p=e.length,h=i(p),g=a(p),m=-1/0;for(u&&!n?dt("[visvalingam] Received z-axis data for 2D simplification"):!u&&n?dt("[visvalingam] Missing z-axis data for 3D simplification"):e.length>t.length&&dt("[visvalingam] Incompatible data arrays:",e.length,t.length),l=0;l<p;l++)d=l+1,c=(f=l-1)<0||d>=p?1/0:o(f,l,d,t,s,u),e[l]=c,g[l]=d,h[l]=f;for(r.init(e);r.size()>0&&(c=e[l=r.pop()])!==1/0;)c<m?e[l]=m:m=c,f=h[l],d=g[l],f>0&&(c=o(h[f],f,d,t,s,u),r.updateValue(f,c)),d<p-1&&(c=o(f,d,g[d],t,s,u),r.updateValue(d,c)),g[f]=d,h[d]=f}},GE.standardMetric=$n.triangleArea,GE.standardMetric3D=$n.triangleArea3D,GE.getWeightedMetric=function(e){var t=GE.getWeightFunction(e);return function(e,n,r,i,a,o){var s=$n.triangleArea(e,n,r,i,a,o),u=$n.cosine(e,n,r,i,a,o);return t(u)*s}},GE.getWeightedMetric3D=function(e){var t=GE.getWeightFunction(e);return function(e,n,r,i,a,o,s,u,c){var f=$n.triangleArea3D(e,n,r,i,a,o,s,u,c),l=$n.cosine3D(e,n,r,i,a,o,s,u,c);return t(l)*f}},GE.getWeightCoefficient=function(e){return e&&t.isNumber(e&&e.weighting)?e.weighting:.7},GE.getWeightFunction=function(e){var t=GE.getWeightCoefficient(e);return function(e){return-e*t+1}},GE.weight=function(e){return.7*-e+1},GE.getEffectiveAreaSimplifier=function(e){var t=e?GE.standardMetric3D:GE.standardMetric;return GE.getPathSimplifier(t,e)},GE.getWeightedSimplifier=function(e,t){var n=t?GE.getWeightedMetric3D(e):GE.getWeightedMetric(e);return GE.getPathSimplifier(n,t)},GE.getPathSimplifier=function(e,t){return GE.scaledSimplify(GE.getArcCalculator(e,t))},GE.scaledSimplify=function(e){return function(t,n,r,i){e(t,n,r,i);for(var a=1,o=t.length-1;a<o;a++)t[a]=.65*Math.sqrt(t[a])}};var tP=Object.freeze({__proto__:null,postSimplifyRepair:WE,repairIntersections:YE}),nP={};function rP(e,t){t.forEach((function(t){"polygon"==t.geometry_type&&function(e,t){t.forEach((function(t){iP(e,t)}))}(e,t.shapes)}))}function iP(e,t){for(var n,r,i=0,a=t?t.length:0,o=0;o<a;o++)(r=e.getSimpleShapeBounds(t[o]).area())>i&&(n=t[o],i=r);n&&0!==n.length?function(e,t){var n,r=e.getRetainedInterval(),i=1e-10;e.setRetainedInterval(1/0),n=$n.getPlanarPathArea(t,e);for(;n<=i;){if(0===aP(e,t)){bt("[protectMultiRing()] Failed on ring:",t);break}n=$n.getPlanarPathArea(t,e)}e.setRetainedInterval(r)}(e,n):bt("[protectShape()] Invalid shape:",t)}function aP(e,t){for(var n,r,i,a,o,s,u=0,c=e.getVertexData(),f=0;f<t.length;f++)(r=t[f])<0&&(r=~r),s=(o=c.ii[r])+c.nn[r]-1,-1!=(i=Zn(c.zz,1/0,o,s))&&(a=c.zz[i])>u&&(u=a,n=r);return u>0?(s=(o=c.ii[n])+c.nn[n]-1,oP(c.zz,u,1/0,o,s)):0}function oP(e,t,n,r,i){for(var a=0,o=r;o<=i;o++)e[o]===t&&(e[o]=n,a++);return a}nP.metricSq3D=$n.pointSegDistSq3D,nP.metricSq=$n.pointSegDistSq,nP.calcArcData=function(e,t,n,r){var i=e.length,a=!!r;e[0]=e[i-1]=1/0,i>2&&function i(o,s,u,c){var f,l,d=t[o],p=n[o],h=t[s],g=n[s];a&&(f=r[o],l=r[s]);for(var m,y=0,v=0,b=0,x=0,_=o+1;_<s;_++)(m=a?nP.metricSq3D(t[_],n[_],r[_],d,p,f,h,g,l):nP.metricSq(t[_],n[_],d,p,h,g))>=y&&(y=m,v=_);c<y&&(y=c);v-o>1&&(b=i(o,v,u+1,y));s-v>1&&(x=i(v,s,u+1,y));1==u&&d==h&&p==g&&(y=Math.max(b,x));return e[v]=Math.sqrt(y),y}(0,i-1,1,Number.MAX_VALUE)};var sP=Object.freeze({__proto__:null,keepEveryPolygon:rP,protectShape:iP,replaceInArray:oP});function uP(e,n){var r=e.arcs;n.keep_shapes&&rP(r,e.layers),!n.no_repair&&r.getRetainedInterval()>0&&WE(r),n.stats&&JE(r,n),e.info=t.defaults({simplify:n},e.info)}function cP(e,n){return n=n||{},t.defaults({method:dP(n),spherical:fP(e.arcs,n)},n)}function fP(e,t){return!t.planar&&!e.isPlanar()}function lP(e,n){var r=function(e){var t;"dp"==e.method?t=nP.calcArcData:"visvalingam"==e.method?t=GE.getEffectiveAreaSimplifier(e.spherical):"weighted_visvalingam"==e.method?t=GE.getWeightedSimplifier(e,e.spherical):pt("Unsupported simplify method:",e.method);return t}(n);e.setThresholds(new Float64Array(e.getPointCount())),n.spherical?(!function(e,n){var r=t.expandoBuffer(Float64Array),i=t.expandoBuffer(Float64Array),a=t.expandoBuffer(Float64Array);e.forEach3((function(e,t,o,s){var u=e.length,c=r(u),f=i(u),l=a(u);$n.convLngLatToSph(e,t,c,f,l),n(o,c,f,l)}))}(e,r),hP(e)):function(e,t){e.forEach3((function(e,n,r,i){t(r,e,n)}))}(e,r),n.lock_box&&function(e){var t=1e-14,n=e.getBounds();n.padBounds(-t,-t,-t,-t),pP(e,n.toArray(),!0)}(e)}function dP(e){var t=e.method;return(!t||"weighted"==t||"visvalingam"==t&&e.weighting)&&(t="weighted_visvalingam"),t}function pP(e,t,n){var r=e.getBounds().toArray();!0!==$n.containsBounds(t,r)&&e.forEach3((function(e,r,i){for(var a,o,s=n?1/0:0,u=0,c=i.length;u<c;u++)a=e[u],o=r[u],(a>=t[2]||a<=t[0]||o<=t[1]||o>=t[3])&&(0===s&&(s=gP(i)),i[u]!==1/0&&(i[u]=s))}))}function hP(e){pP(e,ji(1e-12),!1)}function gP(e){for(var t,n=0,r=0,i=e.length;r<i;r++)(t=e[r])>n&&t<1/0&&(n=t);return n}function mP(e){var n,r,i;return t.isNumber(e)?(r=e,i=e):t.isString(e)&&(n=e.split(/[x ,]/),r=Number(n[0])||0,i=2==n.length?Number(n[1])||0:r),r>=0&&i>=0&&r+i>0||pt("Invalid simplify resolution:",e),[r,i]}function yP(e,t,n,r){return 0!==e&&n/r>e/t||0===t?n/e:r/t}function vP(e,t,n){return yP(e,t,$n.degreesToMeters(n.width())*Math.cos(n.centerY()*$n.D2R),$n.degreesToMeters(n.height()))}function bP(e,t,n){var r=Qi(t);return fP(t.arcs,n)?Yf(e,r):Hf(e,r)}function xP(e,t,n){var r,i=mP(e),a=t.getBounds();return r=fP(t,n)?vP(i[0],i[1],a):yP(i[0],i[1],a.width(),a.height()),r*=.5}td.simplify=function(e,n){var r=e.arcs;if(r&&0!==r.size()){if(lP(r,n=cP(e,n)),n.percentage||0===n.percentage)r.setRetainedPct(t.parsePercent(n.percentage));else if(n.interval||0===n.interval)r.setRetainedInterval(bP(n.interval,e,n));else if(n.resolution)r.setRetainedInterval(xP(n.resolution,r,n));else{if(n.presimplify)return;pt("Missing a simplification amount")}uP(e,n)}};var _P=Object.freeze({__proto__:null,finalizeSimplification:uP,getStandardSimplifyOpts:cP,useSphericalSimplify:fP,simplifyPaths:lP,getSimplifyMethod:dP,protectWorldEdges:hP,parseSimplifyResolution:mP,calcPlanarInterval:yP,calcSphericalInterval:vP,convertSimplifyInterval:bP,convertSimplifyResolution:xP});function wP(e,t){var n;return t?(e={name:e.name,data:e.data},n=ql(t,e,null),function(e){var t=n(e);return String(t)}):function(e){return function(t){return(e&&e.name||"split")+"-"+(t+1)}}(e)}td.sortFeatures=function(e,n,r){var i=ti(e),a=!r.descending,o=ql(r.expression,e,n),s=[];t.repeat(i,(function(e){s.push(o(e))}));var u=t.getSortedIds(s,a);e.shapes&&t.reorderArray(e.shapes,u),e.data&&t.reorderArray(e.data.getRecords(),u)},td.snap=function(e,n){var r=0,i=0,a=e.dataset,o=a.arcs,s=o&&o.getBounds();s&&s.hasBounds()||pt("Dataset is missing path data"),n.precision?Uf(a,n.precision):r=n.interval?Hf(n.interval,Qi(a)):Mn(s.toArray()),o.flatten(),r>0&&n.endpoints?(i=jn(o,r),gt(t.format("Snapped %s endpoint%s",i,t.pluralSuffix(i)))):r>0&&(i=Pn(o,r),gt(t.format("Snapped %s point%s",i,t.pluralSuffix(i)))),(i>0||n.precision)&&(o.dedupCoords(),_a(a))},td.splitLayer=function(e,n,r){var i,a,o,s=r||{},u=s.no_replace?hi(e):e,c=u.data?u.data.getRecords():null,f=u.shapes,l={},d=[];return s.ids?(a=s.ids,o=new Set(a),i=function(e){return o.has(e)?"1":"2"}):i=wP(u,n),t.repeat(ti(u),(function(e){var t,n=i(e);n in l==!1?(l[n]=d.length,t={geometry_type:u.geometry_type,name:n,data:c?new Jr:null,shapes:f?[]:null},d.push(t)):t=d[l[n]],f&&t.shapes.push(f[e]),c&&t.data.getRecords().push(c[e])})),d};var SP=Object.freeze({__proto__:null,getSplitNameFunction:wP});td.stop=function(e){!function(e){AM(e).stopped=!0}(e)},td.svgStyle=function(e,t,n){var r;e.data||xi(e),n.where&&(r=ql(n.where,e,t.arcs)),Object.keys(n).forEach((function(t){var i=t.replace("_","-");if(yh(i)){var a=_h(n[t].trim(),i,e);Yr(e).getRecords().forEach((function(e,t){r&&!r(t)?i in e==!1&&(e[i]=void 0):e[i]=a(t)}))}}))};var AP=Lf(.01);function IP(e){return e.fill||"magenta"}function MP(e,t){return"polyline"==e.type?e.stroke=function(e){return e.stroke||e.fill||"magenta"}(t):e.fill=IP(t),t.opacity&&(e.opacity=t.opacity),e}function EP(e){return 0===e.radius||0===e.length||0===e.r?0:e.radius||e.length||e.r||5}function PP(e,n){var r=e&&t.isNumber(e[0]),i=!r&&e&&Array.isArray(e[0]);if(r)return n(e);for(var a=0;a<e.length;a++)i&&PP(e[a],n)}function jP(e){PP(e,(function(e){e[1]=-e[1]}))}function OP(e,t,n){PP(e,(function(e){e[0]=e[0]*t+n[0],e[1]=e[1]*t+n[1]}))}function kP(e,t){if(t){var n=Yp(t,1,[0,0],[0,0]);PP(e,(function(e){var t=n(e[0],e[1]);e[0]=t[0],e[1]=t[1]}))}}function FP(e,t){var n="stick"==t,r=e.direction||0,i=e["stem-taper"]||0,a=e["stem-curve"]||0,o=function(e,t){var n=Math.max(e.radius||e.length||e.r||0,0),r=1,i=function(e){var t=(r=e["head-angle"]||40,1/Math.tan(Math.PI*r/180/2)/2),n={stemWidth:e["stem-width"]||2,stemLen:e["stem-length"]||0,headWidth:e["head-width"],headLen:e["head-length"]};var r;0===n.headWidth?n.headLen=0:n.headWidth>0==!1&&(n.headLen>0?n.headWidth=n.headLen/t:0===n.headLen?n.headWidth=0:n.headWidth=3*n.stemWidth);n.headLen>=0==!1&&(n.headLen=n.headWidth*t);return n}(e);n>=0&&(r=function(e,t,n){var r=n["min-stem-ratio"]>=0?n["min-stem-ratio"]:0,i=n["stem-length"]||0,a=1-r,o=t/e,s=1;o>a?s=a/o:i+t>e&&(s=e/(i+t));return s||0}(n,i.headLen,e),i.stemWidth*=r,i.headWidth*=r,i.headLen*=r,i.stemLen=t?n:n-i.headLen);i.headWidth<i.stemWidth&&i.headWidth>0&&pt("Arrow head must be at least as wide as the stem.");return i}(e,n);if(!o)return null;var s,u,c,f=o.stemLen,l=o.headLen,d=o.headWidth/2,p=o.stemWidth/2,h=p*(1-i);if(a){r>0&&(a=-a);var g=Math.abs(a)/180*Math.PI,m=a>0?1:-1,y=h*Math.cos(g),v=h*Math.sin(g)*-m;if(u=f*Math.sin(g/2)*m,c=f*Math.cos(g/2),n)s=zP(-y,-v,u,c);else{var b=zP(-y,-v,-p+u,c),x=zP(y,v,p+u,c);s=b.concat(x.reverse())}}else u=0,c=f,s=n?[[0,0],[0,f]]:[[-h,0],[h,0]];return n?(s=[s],l>0&&s.push([[-d+u,f-l],[u,f],[d+u,f-l]])):(s.push([p+u,c]),l>0&&s.push([d+u,c],[u,l+c],[-d+u,c]),s.push([-p+u,c],s[0].concat()),s=[s]),"end"==e.anchor?OP(s,1,[-u,-c-l]):"middle"==e.anchor&&OP(s,1,[.5*-u,.5*-c-.25*l]),kP(s,r),e.flipped&&jP(s),s}function zP(e,t,n,r){if(t>r)return[[e*r/t,r]];for(var i=n-e,a=r-t,o=a-(a*a-i*i)/(2*a),s=Math.sqrt(i*i+a*a)/2,u=Math.PI-2*Math.asin(s/o),c=180*u/Math.PI,f=o/Math.tan(u/2),l=n>e?1:-1,d=Math.round(c/5)+2,p=u/(d+1),h=[[n,r]],g=1;g<=d;g++){var m=g*p/2,y=Math.sin(m),v=y*f*2,b=y*v,x=Math.cos(m)*v;h.push([n-b*l,r-x])}return h.push([e,t]),h}function CP(e){var t,n,r=EP(e),i=+e.sides||({circle:72,triangle:3,square:4,pentagon:5,hexagon:6,heptagon:7,octagon:8,nonagon:9,decagon:10}[e.type]||4),a=i%2==1,o=[];if(r>0==!1)return null;i>=3==!1&&pt(`Invalid number of sides (${i})`),("b"==e.orientation||e.flipped||e.rotated)&&(a=!a),n=a?0:.5;for(var s=0;s<i;s++)t=(s+n)/i*360,o.push(Rb(0,0,t,r));return o.push(o[0].concat()),[o]}function NP(e){var t,n,r=EP(e),i=e.points||e.sides&&e.sides/2||5,a=2*i,o=function(e){var t=360/e,n=function(e){var t=1,n=Math.ceil(e/2)-2,r=Math.floor((n+t)/2);return function(e,t){var n=360/e,r=n*(t+1);return 180-r}(e,r)}(e),r=Math.PI/180*t/2,i=Math.PI/180*n/2,a=Math.tan(i)/(Math.tan(i)+Math.tan(r))/Math.cos(r);return a}(i)*r,s="b"==e.orientation||e.flipped||e.rotated?0:1,u=[];if(r>0==!1)return null;i<5&&pt(`Invalid number of points for a star (${i})`);for(var c=0;c<a;c++)n=c%2==0?o:r,t=(c+s)/a*360,u.push(Rb(0,0,t,n));return u.push(u[0].concat()),[u]}function TP(e){var n=Array.isArray(e)?e:ny(e);return t.genericSort(n,!0),t.uniq(n)}function LP(e,t,n){var r;return"MultiPolygon"==n||"Polygon"==n?r={type:"polygon",coordinates:"Polygon"==n?e:Lh(e)}:"LineString"==n||"MultiLineString"==n?r={type:"polyline","stroke-width":t["stroke-width"]||2,coordinates:"LineString"==n?[e]:e}:dt("Unsupported type:",n),MP(r,t),function(e){PP(e,(function(e){e[0]=AP(e[0]),e[1]=AP(e[1])}))}(r.coordinates),r}td.symbols=function(e,n,r){si(e);var i,a=r.no_replace?hi(e):e,o=!!r.geographic;o&&(Hi(n),i=r.pixel_scale||function(e,t){var n=bi(e);return(n.width()||n.height()||1e3)/800}(a));var s,u,c=Yr(a).getRecords(),f=bh(a,r),l=a.shapes.map((function(e,n){if(!e)return null;var a=f(n),s=c[n]||{};if(o||"circle"!=a.type)if(o||"ring"!=a.type){var u,l="Polygon";if("arrow"==a.type&&"stick"==r.arrow_style?(u=function(e){return FP(e,"stick")}(a),l="MultiLineString"):"arrow"==a.type?u=function(e){return FP(e,"standard")}(a):"ring"==a.type?(u=function(e){for(var n,r,i=TP(e.radii||"2"),a=[],o=t.isOdd(i.length),s=0;s<i.length;s++)n=CP({type:"circle",radius:i[s]}),(!o||s>0)&&(r=n,(n=CP({type:"circle",radius:i[++s]})).push(r[0])),a.push(n);return a}(a),l="MultiPolygon"):u="star"==a.type?NP(a):CP(a),!u)return null;if(kP(u,+a.rotation||0),o||jP(u),+r.scale&&OP(u,+r.scale,[0,0]),o)return OP(u,i,e[0]),a.fill&&(s.fill=a.fill),a.stroke&&(s.stroke=a.stroke),a.opacity&&(s.opacity=a.opacity),function(e,t){return{type:t,coordinates:e}}(u,l);s["svg-symbol"]=LP(u,a,l)}else s["svg-symbol"]=function(e,n){var r=+n.scale||1,i=TP(e.radii||"2").map((function(e){return e*r})),a=t.isOdd(i.length),o=IP(e),s=n.opacity||void 0,u=[];a&&u.push({type:"circle",fill:o,opacity:s,r:i.shift()});for(var c=0;c<i.length;c+=2)u.push({type:"circle",fill:"none",stroke:o,opacity:s,"stroke-width":Tf(i[c+1]-i[c]),r:Tf(.5*i[c+1]+.5*i[c])});return{type:"group",parts:u}}(a,r);else s["svg-symbol"]=function(e,t){var n=EP(e);return+t.scale&&(n*=+t.scale),MP({type:"circle",r:n},e)}(a,r)}));return o?(u=function(e,t){var n=e.map((function(e,n){return t[n],{type:"Feature",properties:t[n]||null,geometry:e}}));return By({type:"FeatureCollection",features:n})}(l,c),(s=Xa(e,n,u,r)).data=a.data):s=a,[s]};var BP=Object.freeze({__proto__:null});function DP(e,t,n){for(var r,i=0;i<e.length;i++)if((r=e[i])>=t&&r<t+n)return r-t;return-1}function UP(e,t,n){for(var r=0;r<t.length;r++)e.push(n?n[t[r]]:null)}function RP(e,t,n){return ql(e,t,n)}function qP(e,n,r){var i,a,o,s,u,c=rd(e,n,r),f=[];return t.isBoolean(c)||pt("Expression must evaluate to true or false"),c?(a=bi(e,n),i=function(e,n,r){var i,a,o=e.data?e.data.getRecords():null,s=e.shapes;i={geometry_type:e.geometry_type,shapes:[],data:o?[]:null},a={geometry_type:e.geometry_type,shapes:[],data:o?[]:null};var u=r&&r.width()>r.height(),c=s.map((function(e){var t=n.getMultiShapeBounds(e);return u?t.centerX():t.centerY()})),f=t.range(c.length);f.sort((function(e,t){return c[e]-c[t]})),f.forEach((function(e,t){var n=t<s.length/2?i:a;n.shapes.push(s[e]),o&&n.data.push(o[e])})),o&&(i.data=new Jr(i.data),a.data=new Jr(a.data));return[i,a]}(e,n,a),(o=i[0]).shapes.length>1&&o.shapes.length<e.shapes.length?t.merge(f,qP(o,n,r)):f.push(o),(s=i[1]).shapes.length>1&&s.shapes.length<e.shapes.length?t.merge(f,qP(s,n,r)):f.push(s)):f.push(e),u=wP(e),f.forEach((function(n,r){n.name=u(r),t.defaults(n,e)})),f}async function $P(e,n){var r,i,a,o,s,u,c,f,l,d,p=e.name,h=e.options;if(IM(p,n))return g(null);n||(n=new Xv),n.startCommand(e);try{if(tp.start(),"rename-layers"==p?c=(s=n.catalog.findCommandTargets(h.target||"*")).reduce((function(e,t){return e.concat(t.layers)}),[]):"o"==p?s=n.catalog.findCommandTargets(h.target||h.combine_layers&&"*"):!function(e){return"rotate"==e||"info"==e||"proj"==e||"require"==e||"drop"==e||"target"==e||"if"==e||"elif"==e||"else"==e||"endif"==e||"run"==e||"i"==e||"snap"==e}(p)?((s=n.catalog.findCommandTargets(h.target)).length>1&&("merge-layers"==p||"union"==p)&&(s=Ma(s,n.catalog)),1==s.length?(f=(u=s[0].dataset).arcs,c=s[0].layers,n.catalog.setDefaultTarget(c,u)):s.length>1&&pt("This command does not support targetting layers from different datasets")):s=n.catalog.findCommandTargets(h.target),0===s.length&&(h.target&&pt(t.format("Missing target: %s\nAvailable layers: %s",h.target,Yv(n.catalog))),!function(e){return"graticule"==e||"i"==e||"help"==e||"point-grid"==e||"shape"==e||"rectangle"==e||"require"==e||"run"==e||"define"==e||"include"==e||"print"==e||"comment"==e||"if"==e||"elif"==e||"else"==e||"endif"==e||"stop"==e||"add-shape"==e}(p)))throw new wt("No data is available");h.source&&(r=Gv($v(h.source,s),n.catalog,h)),"add-shape"==p?(u||(c=(u={info:{},layers:[]}).layers,n.catalog.addDataset(u)),a=td.addShape(c,u,h)):"affine"==p?td.affine(c,u,h):"alpha-shapes"==p?a=Qv(td.alphaShapes,c,u,h):"buffer"==p?a=Qv(td.buffer,c,u,h):"data-fill"==p?Qv(td.dataFill,c,f,h):"cluster"==p?Qv(td.cluster,c,f,h):"calc"==p?Qv(td.calc,c,f,h):"classify"==p?Qv(td.classify,c,u,h):"clean"==p?td.cleanLayers(c,u,h):"clip"==p?a=td.clipLayers(c,r,u,h):"colorizer"==p?a=td.colorizer(h):"comment"==p||("dashlines"==p?Qv(td.dashlines,c,u,h):"define"==p?td.define(n.catalog,h):"dissolve"==p?a=Qv(td.dissolve,c,f,h):"dissolve2"==p?a=td.dissolve2(c,u,h):"divide"==p?td.divide(c,u,r,h):"dots"==p?a=Qv(td.dots,c,f,h):"drop"==p?td.drop2(n.catalog,s,h):"each"==p?Qv(td.evaluateEachFeature,c,u,h.expression,h):"erase"==p?a=td.eraseLayers(c,r,u,h):"explode"==p?a=Qv(td.explodeFeatures,c,f,h):"external"==p?td.require(s,h):"filter"==p?a=Qv(td.filterFeatures,c,f,h):"filter-fields"==p?Qv(td.filterFields,c,h.fields,h):"filter-geom"==p?Qv(td.filterGeom,c,f,h):"filter-islands"==p?Qv(td.filterIslands,c,u,h):"filter-islands2"==p?Qv(td.filterIslands2,c,u,h):"filter-points"==p?Qv(td.filterPoints,c,u,h):"filter-slivers"==p?Qv(td.filterSlivers,c,u,h):"frame"==p?td.frame(n.catalog,r,h):"fuzzy-join"==p?Qv(td.fuzzyJoin,c,f,r,h):"graticule"==p?n.catalog.addDataset(td.graticule(u,h)):"grid"==p?i=td.polygonGrid(c,u,h):"help"==p?td.printHelp(e.options):"i"==p?(h.replace&&(n.catalog=new Wv),(u=await td.importFiles(n.catalog,e.options))&&(a=u.layers)):"if"==p||"elif"==p?td[p](n,h):"else"==p||"endif"==p?td[p](n):"ignore"==p?Qv(td.ignore,c,u,h):"include"==p?td.include(h):"info"==p?td.info(s,h):"inlay"==p?a=td.inlay(c,r,u,h):"inspect"==p?Qv(td.inspect,c,f,h):"innerlines"==p?a=Qv(td.innerlines,c,f,h):"join"==p?Qv(td.join,c,u,r,h):"lines"==p?a=Qv(td.lines,c,u,h):"merge-layers"==p?a=td.mergeAndFlattenLayers(c,u,h):"mosaic"==p?a=td.mosaic(c,u,h):"o"==p?(o=await ym(s,h),h.final&&(n.catalog=new Wv),await t.promisify(Zc)(o,h)):"point-grid"==p?(a=[td.pointGrid(u,h)],u||n.catalog.addDataset({layers:a})):"point-to-grid"==p?a=td.pointToGrid(c,u,h):"points"==p?a=Qv(td.createPointLayer,c,u,h):"polygons"==p?a=td.polygons(c,u,h):"print"==p?td.print(e._.join(" ")):"proj"==p?(await Li(h),n.resumeCommand(),s.forEach((function(e){td.proj(e.dataset,n.catalog,h)}))):"rectangle"==p?r||h.bbox||0===s.length?n.catalog.addDataset(td.rectangle(r,h)):a=td.rectangle2(s[0],h):"rectangles"==p?a=Qv(td.rectangles,c,u,h):"rename-fields"==p?Qv(td.renameFields,c,h.fields):"rename-layers"==p?td.renameLayers(c,h.names,n.catalog):"require"==p?td.require(s,h):"rotate"==p?s.forEach((function(e){td.rotate(e.dataset,h)})):"run"==p?await t.promisify(td.run)(n,s,h):"scalebar"==p?td.scalebar(n.catalog,h):"shape"==p?n.catalog.addDataset(td.shape(u,h)):"shapes"==p?a=Qv(td.shapes,c,u,h):"simplify"==p?h.variable?td.variableSimplify(c,u,h):td.simplify(u,h):"slice"==p?a=td.sliceLayers(c,r,u,h):"snap"==p?function(e,n){var r=t.toArray(arguments).slice(2);n.forEach((function(t){e.apply(null,[t].concat(r))&&dt("Unexpected output from command")}))}(s,h):"sort"==p?Qv(td.sortFeatures,c,f,h):"split"==p?a=Qv(td.splitLayer,c,h.expression,h):"stop"==p?td.stop(n):"split-on-grid"==p?a=Qv(td.splitLayerOnGrid,c,f,h):"stitch"==p?td.stitch(u):"style"==p?Qv(td.svgStyle,c,u,h):"symbols"==p?a=Qv(td.symbols,c,u,h):"subdivide"==p?a=Qv(td.subdivideLayer,c,f,h.expression):"target"==p?td.target(n.catalog,h):"union"==p?a=td.union(c,u,h):"uniq"==p?Qv(td.uniq,c,f,h):td.runExternalCommand(e,n.catalog)),"name"in h&&a&&a.forEach((function(e){e.name=h.name})),i?(n.catalog.addDataset(i),a=i.layers,c&&!h.no_replace&&c.forEach((function(e){n.catalog.deleteLayer(e,u)}))):a&&u&&a!=u.layers&&(h.no_replace?(l=a,d=c||[],t.some(d,(function(e){return l.indexOf(e)>-1}))&&dt("Command returned invalid output"),u.layers=u.layers.concat(a)):(Ya(u,c,a),("clip"==p||"erase"==p||"rectangle"==p||"rectangles"==p||"filter"==p&&h.cleanup)&&!h.no_cleanup&&Na(u)),h.apart?n.catalog.setDefaultTargets(Da(u,a).map((function(e){return{dataset:e,layers:e.layers.concat()}}))):n.catalog.setDefaultTarget(a,u)),u&&Ja(u)}catch(e){return g(e)}return g(null);function g(e){if(n.endCommand(),bt("-",tp.stop()),e)throw e;return n}}function VP(e){var t=WP.apply(null,arguments);if(YP(e,t,(function(e){t.callback(e)})),t.promise)return t.promise}function GP(e){var n=WP.apply(null,arguments),r=n.callback,i=n.output=[];if(YP(e,n,(function(e){return e?r(e):n.legacy?r(null,function(e){if(e.length>1)return t.pluck(e,"content");if(1==e.length)return e[0].content;return null}(i)):r(null,i.reduce((function(e,t){return e[t.filename]=t.content,e}),{}))})),n.promise)return n.promise}function JP(e){var t,n=WP.apply(null,arguments),r=pr("path").join(__dirname,"bin/mapshaper"),i=parseFloat(n.options.xl)||8;if(i<1||i>64)return _t(t=new Error("Unsupported heap size:"+i+"GB")),n.callback(t),n.promise;lt()||(e+=" -quiet");var a=Math.round(1e3*i),o=[process.execPath,"--max-old-space-size="+a,r,e].join(" "),s=pr("child_process").exec(o,{},(function(e,t,r){n.callback(e)}));return s.stdout.pipe(process.stdout),s.stderr.pipe(process.stderr),n.promise?n.promise:void 0}function WP(e,n,r){var i={options:{}};return t.isFunction(n)?i.callback=n:t.isFunction(r)?(i.callback=r,i.legacy=n&&null!=Pc(n),i.input=n):i.promise=new Promise((function(e,t){i.callback=function(n,r){n?t(n):e(r)}})),!i.legacy&&t.isObject(n)&&(n.xl?i.options=n:i.input=n),i}function YP(e,n,r){var i,a=n.output||null,o=n.input;try{i=UE(e)}catch(e){return _t(e),r(e)}if(n.legacy&&(gt("Warning: deprecated input format"),i=function(e,n){var r=t.find(e,(function(e){return"i"==e.name})),i=t.find(e,(function(e){return"o"==e.name}));r||(r={name:"i",options:{}},e.unshift(r));r.options.files=["__input__"],r.options.input={__input__:n},i||e.push({name:"o",options:{}});return e}(i,o),o=null),0===i.length)return r(new wt("No commands to run"));if(0===(i=ZP(i)).length)return u(null);i.forEach((function(e){var t;"i"!=(t=e.name)&&"join"!=t&&"erase"!=t&&"clip"!=t&&"include"!=t||!o||(e.options.input=o),a&&("o"==e.name||"info"==e.name&&e.options.save_to)&&(e.options.output=a)}));var s=function(e){var n=e[0],r=n.options;if("i"!=n.name||r.stdin||r.merge_files||r.combine_files||!r.files||r.files.length<2)return[e];return r.files.map((function(n){var i=[{name:"i",options:t.defaults({files:[n],replace:!0},r)}];return i.push.apply(i,e.slice(1)),i}))}(i);function u(e,t){(e=XP(e))&&_t(e),r(e,t)}t.reduceAsync(s,null,(function(e,t,n){HP(t,new Xv,(function(e,t){e=XP(e),n(e,t)}))}),u)}function HP(e,n,r){if(oc()||"o"!=e[e.length-1].name||(e[e.length-1].options.final=!0),n||(n=new Xv),e=function(e,t){var n={VERBOSE:!1,QUIET:!1,DEBUG:!1},r=t.filter((function(e){if("verbose"==e.name)n.VERBOSE=!0;else if("quiet"==e.name)n.QUIET=!0;else{if("debug"!=e.name)return!0;n.DEBUG=!0}return!1}));return e.initSettings(n),r}(n,e),oc()||function(){var e=/^--max-old-space-size=([0-9]+)$/,t=process.execArgv.find((function(t){return e.test(t)}));t&&gt("Allocating",e.exec(t)[1]/1e3,"GB of heap memory")}(),0===(e=ZP(e)).length)return r(null);t.reduceAsync(e,n,(function(e,t,n){$P(t,e).then((function(e){n(null,e)})).catch((function(e){n(e)}))}),r)}function XP(e){return e&&"NonFatalError"==e.name?(_t(e),null):e}function ZP(t){return t.filter((function(t){if("version"==t.name)vt(void 0===e?"":e);else if("encodings"==t.name)Pr();else if("colors"==t.name)eA(),vt("Built-in color schemes (from d3):"),vt("Categorical\n"+It(KS.categorical)),vt("\nSequential\n"+It(KS.sequential)),vt("\nDiverging\n"+It(KS.diverging)),vt("\nMulti-hue/rainbow\n"+It(KS.rainbow));else{if("projections"!=t.name)return!0;ra()}return!1}))}td.target=function(e,t){var n=(t.type||"").toLowerCase().replace("linestring","polyline"),r=t.target||"*",i=e.findCommandTargets(r,n);n&&-1=="polygon,polyline,point".split(",").indexOf(n)&&pt("Invalid layer type:",t.type),0===i.length&&pt("No layers were matched (pattern: "+r+(n?" type: "+n:"")+")"),(t.name||""===t.name)&&(i[0].layers[0].name=t.name),t.combine?i=function(e,t){var n=[],r=[];e.forEach((function(e){n.push(e.dataset),t.removeDataset(e.dataset),r=r.concat(e.layers)}));var i=Ea(n);return t.addDataset(i),[{dataset:i,layers:r}]}(i,e):t.isolate&&(i=function(e,t){var n=[];e.forEach((function(e){n.push(e.dataset),e.layers.forEach((function(n){t.removeLayer(n,e.dataset)}))}))}(i,e)),e.setDefaultTargets(i)},td.union=function(e,n,r){e.length<2&&pt("Command requires at least two target layers"),e.forEach(ci);var i=Vd(n,r),a=[],o=[],s=[];e.forEach((function(e,t){var n=e.data?e.data.getFields():[];r.fields&&(n=r.fields.indexOf("*")>1?n:n.filter((function(e){return r.fields.indexOf(e)>-1}))),s.push({layer:e,fields:n,records:e.data?e.data.getRecords():null,offset:o.length,size:e.shapes.length}),a=a.concat(n),o=o.concat(e.shapes)}));var u=t.uniqifyNames(a,(function(e,t){return e+"_"+t})),c=new sp({geometry_type:"polygon",shapes:o},i,{flat:!1}),f=c.mosaic,l=f.map((function(e,t){for(var n,r,i,a=c.getSourceIdsByTileId(t),o=[],f=0,l=s.length;f<l;f++)i=-1==(r=DP(a,(n=s[f]).offset,n.size))||null===n.records?null:n.records[r],UP(o,n.fields,i);return function(e,t){for(var n={},r=0;r<e.length;r++)n[e[r]]=t[r];return n}(u,o)}));return[{name:"union",geometry_type:"polygon",shapes:f,data:new Jr(l)}]},td.uniq=function(e,n,r){var i=ti(e),a=ql(r.expression,e,n),o=r.max_count||1,s={},u=[],c=!!r.verbose,f=!!r.invert,l=!!r.index,d=e.data?e.data.getRecords():null,p=function(e,t){return u[t]};t.repeat(i,(function(e){var n,r=a(e),i=r in s?s[r]+1:1,p=i<=o;l?(p=!0,(n=d&&d[e])&&(n.index=i)):f&&(p=!p),u[e]=p,s[r]=i,c&&!p&&gt(t.format("Removing feature %i key: [%s]",e,r))})),e.shapes&&(e.shapes=e.shapes.filter(p)),d&&(e.data=new Jr(d.filter(p))),!1!==r.verbose&&gt(t.format("Retained %,d of %,d features",ti(e),i))},td.variableSimplify=function(e,n,r){var i,a,o=e[0],s=n.arcs;1!=e.length&&pt("Variable simplification requires a single target layer"),Zr(o)||pt("Target layer is missing path data"),lP(s,r=cP(n,r)),r.interval?i=function(e,t,n,r){var i=RP(e,t,n.arcs);return function(e){return bP(i(e),n,r)}}(r.interval,o,n,r):r.percentage?i=function(e,n,r,i){var a=RP(e,n,r.arcs),o=da(r.arcs);return function(e){var n=a(e),r=t.parsePercent(n);return o(r)}}(r.percentage,o,n):r.resolution?i=function(e,t,n,r){var i=RP(e,t,n.arcs);return function(e){return xP(i(e),n.arcs,r)}}(r.resolution,o,n,r):pt("Missing a simplification expression"),a=function(e,n,r){var i,a=new Float64Array(n.size()),o=-1;t.initializeArray(a,o),e.shapes.forEach((function(e,t){i=r(t),Qn(e||[],c)}));for(var s=0,u=a.length;s<u;s++)a[s]==o&&(a[s]=0);return a;function c(e){var t=e<0?~e:e,n=a[t];(n>i||n==o)&&(a[t]=i)}}(o,s,i),function(e,t){e.getVertexData().zz,e.forEach2((function(e,n,r,i,a,o){for(var s=t[o],u=1;u<n-1;u++)a[e+u]>=s&&(a[e+u]=1/0)}))}(s,a),s.setRetainedInterval(1e20),uP(n,r),s.flatten()},td.splitLayerOnGrid=function(e,n,r){var i,a=e.shapes,o=e.geometry_type,s=!!r.id_field,u=r.id_field||"__split__",c=function(e,n,r){var i=e.xmin,a=e.ymin,o=e.width(),s=e.height();r>0!=!1&&n>0!=!1||pt("Invalid grid parameters");o>0!=!1&&s>0!=!1||(n=1,r=1);return function(e){var u=Math.floor((e.centerX()-i)/o*n),c=Math.floor((e.centerY()-a)/s*r);return u=t.clamp(u,0,n-1)||0,"r"+(c=t.clamp(c,0,r-1)||0)+"c"+u}}(bi(e,n),r.cols,r.rows);return o||pt("Layer has no geometry"),e.data||(e.data=new Jr(a.length)),i=e.data.getRecords(),e.shapes.forEach((function(e,t){var r="point"==o?Ft([e]):n.getMultiShapeBounds(e),a=r.hasBounds()?c(r):"";(i[t]=i[t]||{})[u]=a})),s?e:td.splitLayer(e,u).filter((function(e){var t=e.data.getRecordAt(0)[u];return e.name=t,e.data.deleteField(u),!!t}))},td.subdivideLayer=function(e,t,n){return qP(e,t,n)};var QP=Object.freeze({__proto__:null,runCommands:VP,applyCommands:GP,runCommandsXL:JP,testCommands:function(e,t){YP(e,{},(function(e,n){var r,i=n?n.catalog.getDefaultTargets():[];!e&&i.length>0&&(r=i[0].dataset),t(e,r)}))},runParsedCommands:HP,runAndRemoveInfoCommands:ZP});function KP(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]}function ej(e,t,n){var r=n[0],i=n[2];return e>i[0]?(t>i[1]?4:t>=r[1]&&5)||6:e>=r[0]?(t>i[1]?3:t>=r[1]&&8)||7:(t>i[1]?2:t>=r[1]&&1)||0}function tj(e){return 0==e||2==e||4==e||6==e}function nj(e,t){return t<8&&t>=0?(t+8-2*e)%8:t}function rj(e,t,n){e.push(function(e,t){if(tj(e))return t[e/2].concat();dt("Invalid corner sector:",e)}(t,n))}function ij(e,t,n,r){var i,a,o=t?ej(t[0],t[1],r):-1,s=ej(n[0],n[1],r);8==o&&8==s?e.push(n):o==s||(-1==o?8==s?e.push(n):tj(s)&&rj(e,s,r):8==o?(oj(e,t,n,r),tj(s)&&rj(e,s,r)):8==s?(oj(e,t,n,r),e.push(n)):(r=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3];return 0===e?t=[n,r,i,a]:1==e?t=[r,i,a,n]:2==e?t=[i,a,n,r]:3==e?t=[a,n,r,i]:dt("Invalid rotation number"),t}(i=(a=o)>1&&a<8?Math.floor(a/2):0,r),o=nj(i,o),s=nj(i,s),0==o?0===s||1===s||7===s||(2==s||6==s?rj(e,s,r):3==s?oj(e,t,n,r)||rj(e,2,r):4==s?(oj(e,t,n,r)||($n.orient2D(t[0],t[1],n[0],n[1],r[0][0],r[0][1])>1?rj(e,6,r):rj(e,2,r)),rj(e,s,r)):5==s&&(oj(e,t,n,r)||rj(e,6,r))):1==o?2==s||0===s?rj(e,s,r):3==s?oj(e,t,n,r)||rj(e,2,r):4==s?(oj(e,t,n,r)||rj(e,2,r),rj(e,4,r)):5==s?oj(e,t,n,r):6==s?(oj(e,t,n,r)||rj(e,0,r),rj(e,6,r)):7==s&&(oj(e,t,n,r)||rj(e,0,r)):dt("Sector error")))}function aj(e,t,n,r,i){var a=$n.segmentIntersection(t[0],t[1],n[0],n[1],r[0],r[1],i[0],i[1]);a&&e.push(a)}function oj(e,t,n,r){var i=[];return aj(i,t,n,r[0],r[1]),aj(i,t,n,r[0],r[3]),aj(i,t,n,r[1],r[2]),aj(i,t,n,r[2],r[3]),i.length>0&&(e.push.apply(e,i),!0)}function sj(e,t){var n=Ed(t);e.shapes=e.shapes.map((function(e,r){return function(e){var r=[];return ur(e,(function(e){var i=n(e);if(0===i.length)dt("[cleanPolygon()] Defective path:",e);else if(1==i.length)r.push(i[0]);else{var a,o=$n.getPlanarPathArea(e,t.arcs)>0?1:-1;i.reduce((function(e,n,r){var i=$n.getPlanarPathArea(n,t.arcs)*o;return i>e&&(a=n,e=i),e}),0),a&&r.push(a)}})),r.length>0?r:null}(e)}))}var uj=Object.freeze({__proto__:null,repairPolygonGeometry:function(e,t,n){var r=Vd(t);return e.forEach((function(e){sj(e,r)})),e},repairSelfIntersections:sj}),cj={};cj.svg=Object.assign({},cg,eh,Dh,qh,Yh),Object.assign(cj,{Job:Xv,Dbf:jg,DbfReader:wy,DouglasPeucker:nP,geojson:yp,json:{parse:function(e){var t=_v(new Mm(e),0);ov(t);var n=lv(t);return ov(t),t.peek()!=Vy&&rv(t.peek(),t.index()),n}},ShpType:tm,topojson:im,Visvalingam:GE,ArcCollection:ma,Bounds:kt,clipIterByBounds:function(e,t){for(var n,r,i,a,o=[],s=function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin]]}(t);e.hasNext();)ij(o,r,n=[e.x,e.y],s),r=n,i||(i=n);return(a=KP(i,n))&&o.length>0&&!KP(o[0],o[o.length-1])&&o.push(o[0].concat()),(a&&o.length<4||o.length<2)&&(o=[]),o},CommandParser:fy,DataTable:Jr,editArcs:II,GeoJSONReader:wv,Heap:eI,IdLookupIndex:ip,NodeCollection:Ca,parseDMS:gl,formatDMS:yl,PathIndex:sf,PolygonIndex:of,ShpReader:Oy,Transform:Ot}),Object.assign(cj,jl,vw,La,Dt,IA,Pg,zb,ad,ed,Hv,FA,vA,CA,Pi,pd,Qa,Gr,Iy,em,Wm,Lm,jr,sm,Sm,Zl,ef,qv,fo,Pm,qc,dI,cI,Wp,Lp,Yb,kp,qy,pc,Ov,LM,ep,vE,sd,$A,QA,Ev,pm,sP,zi,_i,eM,jt,ka,cp,cy,mm,xA,Mc,Lv,qE,Tb,za,pf,Ff,_f,Ny,jd,ar,rg,AI,eE,BE,Tt,xd,pp,zd,rp,_w,uj,op,hA,tP,mM,oa,cM,NI,Rf,QP,eg,$d,la,dr,Py,rm,Ly,_P,Sl,ga,il,Cn,Jv,SP,sc,o,mf,Mg,Ph,BP,Ll,cm,Gy,Sa,Kf,fh,dg,JM,Hc);var fj={runCommands:VP,applyCommands:GP,runCommandsXL:JP,enableLogging:ft};Object.assign(fj,{cli:Xc,cmd:td,geom:$n,utils:t,internal:cj}),"object"==typeof module&&module.exports?module.exports=fj:"object"==typeof window&&window&&(window.mapshaper=fj)}();